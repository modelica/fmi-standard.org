<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<title>Functional Mock-up Interface Specification</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:30em;padding-right:0}
#toc.toc2{width:30em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

/* customizations */

body{
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
}

.toc-hidden {
  padding-left: 0 !important;
}

.imageblock {
  text-align: center;
}

.imageblock img {
  display: block;
  margin: auto;
}

.imageblock .title {
  display: inline-block;
  margin: auto;
}

.vertical-text {
	transform: rotate(-90deg) translate(-11em, 0);
	transform-origin: left top 0;
  float: left;
  display: inline-block;
  white-space: nowrap;
  width: 1em;
  height: 11em;
}

/* no alternating row colors */
table tr.even,table tr.alt,table tr:nth-of-type(even) {
  background:none
}

/* use parent text color for captions */
.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
  color: inherit;
}

a {
  text-decoration: none;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<script>
// hide / show the Table of Contents (TOC)
function toggleTOC() {
  var toc = document.getElementById("toc");
  var body = document.getElementsByTagName("body")[0];

  if (toc.style.display === "none") {
      toc.style.display = "block";
      body.classList.remove("toc-hidden");
  } else {
      toc.style.display = "none";
      body.classList.add("toc-hidden");
  }
}

// toggle the TOC when "t" key is pressed
document.addEventListener('keydown', (event) => {
  if (event.key == 't') {
    toggleTOC();
  }
});
</script>

<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
.tocify-header {
    font-style: italic;
}

.tocify-subheader {
    font-style: normal;
    font-size: 90%;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    color: #7a2518;
    background-color: rgba(0, 0, 0, 0.1);
}

.tocify-focus > a {
    color: #7a2518;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            // don't hide the sections in the TOC
            showAndHide: false,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3" : "h2,h3,h4",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>

<img style="display: block; margin: 2em auto; width: 30em;" src="images/FMI_logo_horizontal.svg" alt="FMI logo">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Functional Mock-up Interface Specification</h1>
<div class="details">
<span id="revnumber">version 3.0.1,</span>
<span id="revdate">2023-07-10</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#fmi-whats-new">1.1. What is new in FMI 3.0</a>
<ul class="sectlevel3">
<li><a href="#fmi-301">1.1.1. Changes in FMI 3.0.1</a></li>
</ul>
</li>
<li><a href="#_overview">1.2. Overview</a>
<ul class="sectlevel3">
<li><a href="#_fmi_for_model_exchange_me">1.2.1. FMI for Model Exchange (ME)</a></li>
<li><a href="#_fmi_for_co_simulation_cs">1.2.2. FMI for Co-Simulation (CS)</a></li>
<li><a href="#_fmi_for_scheduled_execution_se">1.2.3. FMI for Scheduled Execution (SE)</a></li>
<li><a href="#_feature_overview_of_the_interface_types">1.2.4. Feature Overview of the Interface Types</a></li>
</ul>
</li>
<li><a href="#_properties_and_guiding_ideas">1.3. Properties and Guiding Ideas</a></li>
<li><a href="#_how_to_read_this_document">1.4. How to Read This Document</a></li>
</ul>
</li>
<li><a href="#fmi-common-concepts">2. Common Concepts</a>
<ul class="sectlevel2">
<li><a href="#mathematical-definitions">2.1. Mathematical Notation</a></li>
<li><a href="#general-mechanisms">2.2. General Mechanisms</a>
<ul class="sectlevel3">
<li><a href="#_requirements_for_implementations_of_the_c_api">2.2.1. Requirements for Implementations of the C-API</a></li>
<li><a href="#header-files-and-naming-of-functions">2.2.2. Header Files and Naming of Functions</a></li>
<li><a href="#_platform_dependent_definitions">2.2.3. Platform Dependent Definitions</a></li>
<li><a href="#status-returned-by-functions">2.2.4. Status Returned by Functions</a></li>
<li><a href="#inquire-version-number">2.2.5. Inquire Version Number of Header Files</a></li>
<li><a href="#advancing-time">2.2.6. Advancing Time</a></li>
<li><a href="#fmu-variables">2.2.7. Variables</a>
<ul class="sectlevel4">
<li><a href="#serialization-of-variables">2.2.7.1. Serialization of Array Variables</a></li>
<li><a href="#get-and-set-variable-values">2.2.7.2. Getting and Setting Variable Values</a></li>
<li><a href="#min-max-violations">2.2.7.3. Handling min/max Range Violations</a></li>
<li><a href="#get-set-fmu-state">2.2.7.4. Getting and Setting the Complete FMU State</a></li>
</ul>
</li>
<li><a href="#Clock">2.2.8. Clocks</a>
<ul class="sectlevel4">
<li><a href="#_motivation">2.2.8.1. Motivation</a></li>
<li><a href="#fmi3Clock">2.2.8.2. Clock Types</a></li>
<li><a href="#clocked-variable">2.2.8.3. Model Partitions and Clocked Variables</a></li>
<li><a href="#_clocks_specific_api">2.2.8.4. Clocks specific API</a></li>
</ul>
</li>
<li><a href="#model-dependencies">2.2.9. Dependencies of Variables</a></li>
<li><a href="#selective-computation">2.2.10. Selective Computation of Variables</a></li>
<li><a href="#algebraic-loops">2.2.11. Algebraic Loops</a></li>
<li><a href="#partial-derivatives">2.2.12. Getting Partial Derivatives</a>
<ul class="sectlevel4">
<li><a href="#directionDerivatives">2.2.12.1. Directional Derivatives</a></li>
<li><a href="#adjointDerivatives">2.2.12.2. Adjoint Derivatives</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#common-state-machine">2.3. State Machine and Semantics</a>
<ul class="sectlevel3">
<li><a href="#FMUStateSettable">2.3.1. Super State: FMU State Settable</a></li>
<li><a href="#Instantiated">2.3.2. State: Instantiated</a></li>
<li><a href="#InitializationMode">2.3.3. State: Initialization Mode</a></li>
<li><a href="#Initialized">2.3.4. Super State: Initialized</a></li>
<li><a href="#EventMode">2.3.5. State: Event Mode</a></li>
<li><a href="#ConfigurationMode">2.3.6. State: Configuration Mode</a></li>
<li><a href="#ReconfigurationMode">2.3.7. State: Reconfiguration Mode</a></li>
<li><a href="#Terminated">2.3.8. State: Terminated</a></li>
</ul>
</li>
<li><a href="#modelDescription.xml">2.4. FMI Description Schema</a>
<ul class="sectlevel3">
<li><a href="#fmiModelDescription">2.4.1. Model Description</a></li>
<li><a href="#common-capability-flags">2.4.2. Attributes and Capability Flags</a></li>
<li><a href="#_physical_units">2.4.3. Physical Units</a></li>
<li><a href="#definition-of-types">2.4.4. Variable Types</a></li>
<li><a href="#definition-of-log-categories">2.4.5. Log Categories</a></li>
<li><a href="#DefaultExperiment">2.4.6. Default Experiment</a></li>
<li><a href="#ModelVariables">2.4.7. Model Variables</a>
<ul class="sectlevel4">
<li><a href="#_static_information">2.4.7.1. Static information</a></li>
<li><a href="#Dimension">2.4.7.2. Array variables and structural parameters</a></li>
<li><a href="#_alias_variables">2.4.7.3. Alias variables</a></li>
<li><a href="#_variable_attributes">2.4.7.4. Variable Attributes</a></li>
<li><a href="#_type_specific_properties">2.4.7.5. Type-specific properties</a>
<ul class="sectlevel5">
<li><a href="#namingSection">2.4.7.5.1. Variable Naming Conventions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ModelStructure">2.4.8. Model Structure</a></li>
<li><a href="#fmiTerminalsAndIcons">2.4.9. Terminals and Icons</a>
<ul class="sectlevel4">
<li><a href="#graphicalRepresentation">2.4.9.1. Definition of a Graphical Representation</a>
<ul class="sectlevel5">
<li><a href="#_overview_2">2.4.9.1.1. Overview</a></li>
<li><a href="#_coordinatesystem">2.4.9.1.2. CoordinateSystem</a></li>
<li><a href="#_icon">2.4.9.1.3. Icon</a></li>
<li><a href="#_placement_extent_and_painting_order_of_graphical_items">2.4.9.1.4. Placement, Extent, and Painting Order of Graphical Items</a></li>
</ul>
</li>
<li><a href="#definitionOfTerminals">2.4.9.2. Definition of Terminals</a>
<ul class="sectlevel5">
<li><a href="#_overview_3">2.4.9.2.1. Overview</a></li>
<li><a href="#section-terminals">2.4.9.2.2. Terminals</a></li>
<li><a href="#section-terminalvars">2.4.9.2.3. Terminal Member Variable</a></li>
<li><a href="#_terminal_stream_member_variable">2.4.9.2.4. Terminal Stream Member Variable</a></li>
<li><a href="#_terminal_graphical_representation">2.4.9.2.5. Terminal Graphical Representation</a></li>
<li><a href="#GeneralRemarkOnSignal">2.4.9.2.6. General Remark on Signal</a></li>
<li><a href="#_general_remark_on_inflow_and_outflow">2.4.9.2.7. General Remark on Inflow and Outflow</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#BuildConfiguration">2.4.10. Build Configurations</a>
<ul class="sectlevel4">
<li><a href="#_sourcefileset">2.4.10.1. SourceFileSet</a></li>
<li><a href="#SourceFile">2.4.10.2. SourceFile</a></li>
<li><a href="#_preprocessordefinition">2.4.10.3. PreprocessorDefinition</a></li>
<li><a href="#_preprocessordefinitionoption">2.4.10.4. PreprocessorDefinition/Option</a></li>
<li><a href="#_includedirectory">2.4.10.5. IncludeDirectory</a></li>
<li><a href="#_library">2.4.10.6. Library</a></li>
<li><a href="#_examples">2.4.10.7. Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmu-distribution">2.5. FMU Distribution</a>
<ul class="sectlevel3">
<li><a href="#structure-of-zip">2.5.1. Structure of the ZIP file</a>
<ul class="sectlevel4">
<li><a href="#documentation-directory">2.5.1.1. Directory <code>documentation</code></a>
<ul class="sectlevel5">
<li><a href="#license-information">2.5.1.1.1. Directory <code>licenses</code></a></li>
</ul>
</li>
<li><a href="#terminalsAndIcons-directory">2.5.1.2. Directory <code>terminalsAndIcons</code></a></li>
<li><a href="#sources-directory">2.5.1.3. Directory <code>sources</code></a></li>
<li><a href="#binaries-directory">2.5.1.4. Directory <code>binaries</code></a>
<ul class="sectlevel5">
<li><a href="#platform-tupe-definition">2.5.1.4.1. Platform Tuple Definition</a></li>
<li><a href="#platform-tuple-examples">2.5.1.4.2. Platform Tuple Examples</a></li>
<li><a href="#external-libraries">2.5.1.4.3. External Libraries</a></li>
</ul>
</li>
<li><a href="#resources-directory">2.5.1.5. Directory <code>resources</code></a></li>
<li><a href="#extra-directory">2.5.1.6. Directory <code>extra</code></a></li>
</ul>
</li>
<li><a href="#multipleInterfaceTypes">2.5.2. Multiple Interface Types</a></li>
<li><a href="#dependency-on-external-tool">2.5.3. Dependency on Installed Tool</a></li>
<li><a href="#_import_examples">2.5.4. Import Examples</a>
<ul class="sectlevel4">
<li><a href="#_accessing_fmi_functions_in_shared_libraries">2.5.4.1. Accessing FMI Functions in Shared Libraries</a></li>
<li><a href="#_accessing_fmi_functions_in_static_libraries_and_source_code">2.5.4.2. Accessing FMI Functions in Static Libraries and Source Code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#VersioningLayered">2.6. Versioning and Layered Standards</a></li>
</ul>
</li>
<li><a href="#fmi-for-model-exchange">3. FMI for Model Exchange</a>
<ul class="sectlevel2">
<li><a href="#concepts-model-exchange">3.1. Concepts</a>
<ul class="sectlevel3">
<li><a href="#localizationStateEvents">3.1.1. Localization of State Events</a></li>
</ul>
</li>
<li><a href="#state-machine-model-exchange">3.2. State Machine for Model Exchange</a>
<ul class="sectlevel3">
<li><a href="#ContinuousTimeMode">3.2.1. State: Continuous-Time Mode</a></li>
</ul>
</li>
<li><a href="#_code_example">3.3. Code Example</a></li>
<li><a href="#model-exchange-schema">3.4. Description Schema</a>
<ul class="sectlevel3">
<li><a href="#xml-example-model-exchange">3.4.1. Example Model Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmi-for-co-simulation">4. FMI for Co-Simulation</a>
<ul class="sectlevel2">
<li><a href="#concepts-co-simulation">4.1. Concepts</a>
<ul class="sectlevel3">
<li><a href="#smoothness">4.1.1. Smoothness, Continuity and Discontinuity</a></li>
<li><a href="#getting-output-derivatives">4.1.2. Getting Derivatives of Continuous Outputs</a></li>
<li><a href="#early-return">4.1.3. Early Return</a></li>
</ul>
</li>
<li><a href="#state-machine-co-simulation">4.2. State Machine for Co-Simulation</a>
<ul class="sectlevel3">
<li><a href="#StepMode">4.2.1. State: Step Mode</a></li>
<li><a href="#IntermediateUpdateMode">4.2.2. State: Intermediate Update Mode</a></li>
</ul>
</li>
<li><a href="#_code_examples">4.3. Code Examples</a>
<ul class="sectlevel3">
<li><a href="#_basic_co_simulation">4.3.1. Basic Co-Simulation</a></li>
<li><a href="#_early_return">4.3.2. Early Return</a></li>
<li><a href="#_event_mode">4.3.3. Event Mode</a></li>
<li><a href="#_intermediate_update">4.3.4. Intermediate Update</a></li>
<li><a href="#_connected_fmus">4.3.5. Connected FMUs</a></li>
</ul>
</li>
<li><a href="#co-simulation-schema">4.4. Description Schema</a>
<ul class="sectlevel3">
<li><a href="#_example_model_description_file">4.4.1. Example Model Description File</a>
<ul class="sectlevel4">
<li><a href="#xml-example-co-simulation">4.4.1.1. Example Model Description File with Early Return</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmi-for-scheduled-execution">5. FMI for Scheduled Execution</a>
<ul class="sectlevel2">
<li><a href="#concepts-scheduled-execution">5.1. Concepts</a>
<ul class="sectlevel3">
<li><a href="#_activating_model_partitions">5.1.1. Activating Model Partitions</a></li>
<li><a href="#preemption-support">5.1.2. Preemption Support</a></li>
</ul>
</li>
<li><a href="#state-machine-scheduled-execution">5.2. State Machine for Scheduled Execution</a>
<ul class="sectlevel3">
<li><a href="#ClockActivationMode">5.2.1. State: Clock Activation Mode</a></li>
<li><a href="#ClockUpdateMode">5.2.2. State: Clock Update Mode</a></li>
</ul>
</li>
<li><a href="#example-scheduled-execution">5.3. Code Example</a>
<ul class="sectlevel3">
<li><a href="#_simulation_algorithm_implementation">5.3.1. Simulation Algorithm Implementation</a></li>
<li><a href="#_fmu_implementation">5.3.2. FMU Implementation</a></li>
</ul>
</li>
<li><a href="#scheduled-execution-schema">5.4. Description Schema</a>
<ul class="sectlevel3">
<li><a href="#_example_model_description_file_2">5.4.1. Example Model Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_references">References</a></li>
<li><a href="#glossary">Appendix A: Glossary</a></li>
<li><a href="#_acknowledgements">Appendix B: Acknowledgements</a></li>
<li><a href="#_contributors">Appendix C: Contributors</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://fmi-standard.org/">Functional Mock-up Interface (FMI)</a> is a free standard that defines a container and an interface to exchange dynamic models using a combination of XML files, binaries and C code, distributed as a ZIP file.
<a id="MAP"></a>It is supported by <a href="https://fmi-standard.org/tools/">more than 170 tools</a> and maintained as a <a href="https://www.modelica.org/projects">Modelica Association Project</a> (MAP FMI).
<a href="https://github.com/modelica/fmi-standard/releases">Releases</a> and <a href="https://github.com/modelica/fmi-standard/issues">issues</a> can be found on <a href="https://github.com/modelica/fmi-standard">github.com/modelica/fmi-standard</a>.</p>
</div>
<div class="paragraph">
<p><br>
</p>
</div>
<div class="paragraph">
<p>Copyright &#169; 2008-2011 MODELISAR Consortium and 2012-2023 The Modelica Association Project FMI.</p>
</div>
<div class="paragraph">
<p>This document is licensed under the Attribution-ShareAlike 4.0 International license.
The code is released under the 2-Clause BSD License.
The licenses text can be found in the <a href="https://raw.githubusercontent.com/modelica/fmi-standard/master/LICENSE.txt">LICENSE.txt</a> file that accompanies this distribution.</p>
</div>
<div class="paragraph">
<p>Attention is drawn to the possibility that some of the elements of this document may be the subject of patent rights.
Modelica Association shall not be held responsible for identifying such patent rights.
All contributors to this specification have signed the <a href="https://github.com/modelica/fmi-standard/blob/master/FMI_CCLA.adoc">Corporate Contributor License Agreement of the FMI Project</a> or the <a href="https://github.com/modelica/ModelicaAssociationCLA/releases/download/1.1.1/ModelicaAssociationCLA_1.1.1.pdf">Contributor License Agreement of the Modelica Association</a>.</p>
</div>
<div class="paragraph">
<p></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="link" href="#_introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="fmi-whats-new"><a class="link" href="#fmi-whats-new">1.1. What is new in FMI 3.0</a></h3>
<div class="paragraph">
<p>The FMI Design Community has improved the FMI standard to react to new requirements from the system simulation community.</p>
</div>
<div class="paragraph">
<p>Especially the ability to package control code into FMUs required some workarounds in FMI 2.0.
With FMI 3.0, virtual electronic control units (vECUs) can be exported as FMUs in a more natural way.
Concrete features to support vECU export are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>introduction of <a href="#definitionOfTerminals">terminals</a> to group variables semantically to ease connecting compatible signals,</p>
</li>
<li>
<p>introduction of <a href="#graphicalRepresentation">icons</a> to define a graphical representation of the FMU and its terminals,</p>
</li>
<li>
<p>introduction of <a href="#Clock">Clocks</a> to more exactly control timing of events and evaluation of model partitions across FMUs,</p>
</li>
<li>
<p>introduction of more integer types and a 32-bit float type (see <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>) to communicate native controller types to the outside,</p>
</li>
<li>
<p>introduction of a binary type to support non-numeric data handling, such as complex sensor data interfaces,</p>
</li>
<li>
<p>extension of variables to arrays for more efficient and natural handling of non-scalar variables,</p>
</li>
<li>
<p>introduction of structural parameters that allow description and changing of array sizes, even during runtime to support advanced online calibration of control code, and</p>
</li>
<li>
<p>addition of the new interface type "Scheduled Execution" (see <a href="#fmi-for-scheduled-execution">Section 5</a>) that allows activation of individual model partitions by an external scheduler, e.g. on real-time platforms.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To allow implementation of more robust and efficient co-simulation algorithms, the following features were added to <a href="#fmi-for-co-simulation">FMI for Co-Simulation</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#early-return">Early return</a> from a <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> call,</p>
</li>
<li>
<p><a href="#EventMode"><strong>Event Mode</strong></a> (see <a href="#state-machine-co-simulation">FMI Co-Simulation state machine</a>),</p>
</li>
<li>
<p>the <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>, and</p>
</li>
<li>
<p><a href="#Clock">Clocks and clocked variables</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Besides <a href="#directionDerivatives">directional derivatives</a>, now <a href="#adjointDerivatives">adjoined derivatives</a> of variables can be obtained.</p>
</div>
<div class="paragraph">
<p>The newly introduced <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> simplifies the integration of source-code FMUs.</p>
</div>
<div class="paragraph">
<p>The following features have been removed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The asynchronous mode for FMUs known from FMI 2.0 CS: this mode was not supported by tools and it can be suitably replaced by Co-Simulation implementations that control the asynchronous computation of FMUs via separate processes/threads created for each FMU.</p>
</li>
<li>
<p>The FMI <code>fmi2SetRealInputDerivatives</code> function: replaced by enabling the setting of inputs in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Parallel to the new standard features, the FMI Design Community has improved the standard quality by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>modernizing the development methodology (e.g. moving to github and following the github process) and a text-based source format,</p>
</li>
<li>
<p>publishing the FMI Standard now primarily as html to support easier navigation within the document and viewing on a wider range of devices,</p>
</li>
<li>
<p>supplying a large set of continuously validated Reference FMUs, and</p>
</li>
<li>
<p>integrating within the FMI Standard only validated C-code, XML and XSD snippets to reduce redundancy and ensure correctness.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="fmi-301"><a class="link" href="#fmi-301">1.1.1. Changes in FMI 3.0.1</a></h4>
<div class="paragraph">
<p>Clarifications and fixes in FMI 3.0.1 are listed in the <a href="https://github.com/modelica/fmi-standard/releases">Release notes on Github.</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_overview"><a class="link" href="#_overview">1.2. Overview</a></h3>
<div class="paragraph">
<p>The Functional Mock-up Interface (FMI) defines a ZIP archive and an application programming interface (API) to exchange dynamic models using a combination of XML files, binaries and C code: the Functional Mock-up Unit (FMU).
The API is used by a simulation environment, the importer, to create one or more instances of an FMU and to simulate them, typically together with other models.
The FMI defines three interface types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#fmi-for-co-simulation">Co-Simulation (CS)</a> where the FMU typically contains its own solver or scheduler,</p>
</li>
<li>
<p><a href="#fmi-for-model-exchange">Model Exchange (ME)</a> that requires the importer to perform numerical integration, and</p>
</li>
<li>
<p><a href="#fmi-for-scheduled-execution">Scheduled Execution (SE)</a> where the importer triggers the execution of the model partitions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This document does not describe how to generate an FMU from a modeling environment.</p>
</div>
<div class="paragraph">
<p>The interface types have large parts in common, defined in <a href="#fmi-common-concepts">Common Concepts</a>.
In particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI Application Programming Interface (C)&#8201;&#8212;&#8201;<a href="#general-mechanisms">Section 2.2</a><br>
All required computations are triggered by calling standardized C functions from the importer into the FMU.
The FMU can signal certain events back to the importer using callback functions provided by the importer.
C is used because it is the most portable programming language today and is the only programming language that can be utilized in all embedded control systems.
The FMI API does not restrict what operating system services an FMU can use on the platform it runs on.
However, for maximal portability, any dependency on the target platform should be minimized and operating system services should be accessed only through standard libraries.
Special run-time requirements should be documented in the appropriate directory inside the <a href="#fmu-distribution">ZIP file</a>.</p>
</li>
<li>
<p>FMI Description Schema (XML)<br>
The schema defines the structure and content of a model description file (<a href="#modelDescription.xml"><code>modelDescription.xml</code></a>), for example, generated by a modeling environment.
This XML file contains the definition of all exposed variables, their interdependencies (model structure) and capability flags of the FMU.
Providing variable descriptions outside the C-API allows an importer to access and store the variable definitions (without any memory or efficiency overhead of standardized access functions) in its own representation.</p>
</li>
<li>
<p>FMU Distribution (ZIP)&#8201;&#8212;&#8201;<a href="#fmu-distribution">Section 2.5</a><br>
An FMU is distributed as one ZIP file.
The ZIP file contains the FMI <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>, the binaries and libraries required to execute the FMI functions (.dll or .so files), and/or the sources of the FMI functions, documentation, and other data used by the FMU (e.g., tables or maps).</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_fmi_for_model_exchange_me"><a class="link" href="#_fmi_for_model_exchange_me">1.2.1. FMI for Model Exchange (ME)</a></h4>
<div class="paragraph">
<p>The Model Exchange interface exposes an ODE to an external solver of an importer.
Models are described by differential, algebraic and discrete equations with time-, state- and step-events.
That integration algorithm of the importer, usually a ODE/DAE solver, is responsible for advancing time, setting states, handling events, etc.
(See <a href="#fmi-for-model-exchange">Section 3</a>.)</p>
</div>
<div id="figure-model-exchange-data-flow" class="imageblock text-center">
<div class="content">
<img src="images/model-exchange-data-flow.svg" alt="model exchange data flow" width="40%">
</div>
<div class="title">Figure 1. Schematic view of data flow between user, the solver of the importer and the FMU for Model Exchange</div>
</div>
</div>
<div class="sect3">
<h4 id="_fmi_for_co_simulation_cs"><a class="link" href="#_fmi_for_co_simulation_cs">1.2.2. FMI for Co-Simulation (CS)</a></h4>
<div class="paragraph">
<p>The Co-Simulation interface is designed both for the coupling of simulation tools, and the coupling of subsystem models, exported by a modeling environment together with their solvers as runnable code.
(See <a href="#fmi-for-co-simulation">Section 4</a>.)</p>
</div>
<div id="figure-co-simulation-data-flow" class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-data-flow.svg" alt="co simulation data flow" width="40%">
</div>
<div class="title">Figure 2. Schematic view of data flow between user, the co-simulation algorithm of the importer and the FMU for Co-Simulation</div>
</div>
</div>
<div class="sect3">
<h4 id="_fmi_for_scheduled_execution_se"><a class="link" href="#_fmi_for_scheduled_execution_se">1.2.3. FMI for Scheduled Execution (SE)</a></h4>
<div class="paragraph">
<p>The Scheduled Execution interface exposes individual <a href="#model-partition">model partitions</a>.
A scheduler provided by the <a href="#importer">importer</a> can control the execution of each model partition separately.
In some ways the Scheduled Execution interface has similarities to the Model Exchange interface: the first externalizes a scheduling algorithm usually found in a controller algorithm (see <a href="#fmi-for-scheduled-execution">Section 5</a>) and the second interface externalizes the ODE/DAE solver.</p>
</div>
<div id="figure-scheduled-execution-data-flow" class="imageblock text-center">
<div class="content">
<img src="images/scheduled-execution-data-flow.svg" alt="scheduled execution data flow" width="40%">
</div>
<div class="title">Figure 3. Schematic view of data flow between user, the scheduler of the importer and model partitions of the FMU for Scheduled Execution</div>
</div>
</div>
<div class="sect3">
<h4 id="_feature_overview_of_the_interface_types"><a class="link" href="#_feature_overview_of_the_interface_types">1.2.4. Feature Overview of the Interface Types</a></h4>
<div class="paragraph">
<p>Co-Simulation FMUs contain all code necessary to abstract away the details of their internal computations.
This simplifies the importer compared to Model Exchange and Scheduled Execution, at the cost of reduced flexibility of use.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/fmi-types-overview.svg" alt="fmi types overview" width="50%">
</div>
<div class="title">Figure 4. Simplicity of import versus flexibility of use</div>
</div>
<div class="paragraph">
<p><a href="#table-overview-features">Table 1</a> gives a non-normative overview of the features of the different interface types.</p>
</div>
<table id="table-overview-features" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Non-normative overview of features per interface type.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-center valign-top">Model Exchange</th>
<th class="tableblock halign-center valign-top">Co-Simulation</th>
<th class="tableblock halign-center valign-top">Scheduled Execution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advancing Time</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Call <a href="#fmi3SetTime"><code>fmi3SetTime</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Call <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> and monitor argument <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Call <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solver Included</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Possibly</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Possibly</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheduler included</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Possibly</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Possibly</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#eventIndicator">Event Indicators</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#early-return">Early Return</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Includes similar or better mechanism</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#IntermediateUpdateMode">Intermediate Update</a> or <a href="#ClockUpdateMode">Clock Update</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Includes similar or better mechanism</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Signal output <a href="#Clock">Clock</a> ticks: <span class="icon"><i class="fa fa-check"></i></span><br>
Inputs/Outputs: <span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Clock">Clocks</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Feedthrough</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">In <a href="#EventMode"><strong>Event Mode</strong></a>: <span class="icon"><i class="fa fa-check"></i></span><br>
Else: <span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_properties_and_guiding_ideas"><a class="link" href="#_properties_and_guiding_ideas">1.3. Properties and Guiding Ideas</a></h3>
<div class="paragraph">
<p>In this section, properties are listed and some principles are defined that guided the design of the FMI API and XML schema itself (not the content of the FMUs).
These principles may help the reader understand why certain design decisions have been made.
The listed principles are sorted, starting from high-level properties to low-level implementation issues.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Expressivity</dt>
<dd>
<p>The FMI provides the necessary features to package models of different domains, such as multi-body and virtual ECUs, into an FMU.</p>
</dd>
<dt class="hdlist1">Stability</dt>
<dd>
<p>The FMI is expected to be supported by many simulation tools worldwide.
Implementing such support is a major investment for tool vendors.
Stability and backwards compatibility of the FMI has therefore high priority.</p>
</dd>
<dt class="hdlist1">Implementation</dt>
<dd>
<p>FMUs can be written manually or can be generated automatically from a modeling environment.
Existing manually coded models can be transformed manually to a model according to the FMI standard.</p>
</dd>
<dt class="hdlist1">Processor and operating system independence</dt>
<dd>
<p>It is possible to distribute an FMU without knowing the target processor.
This allows an FMU to run on a PC, a Hardware-in-the-Loop simulation platform or as part of the controller software of an ECU.
Keeping the FMU independent of the target processor increases the usability of the FMU.
To be processor and operating system independent, the FMU must include its C (or C++) sources.
To be maximally portable, FMUs must reduce their dependency on operating system services and use these only through standard library calls.</p>
</dd>
<dt class="hdlist1">Simulator independence</dt>
<dd>
<p>It is possible to compile, link and distribute an FMU without knowing the environment in which the FMU will be loaded.</p>
<div class="paragraph">
<p>Reason: The standard would be much less attractive otherwise, unnecessarily restricting the later use of an FMU at compile time and forcing users to maintain simulator specific variants of an FMU.
To be simulator independent, the FMU must export its implementation in self-contained binary form.
This requires the processor and target operating system (if dependencies exist) to be known.
Once exported with binaries, the FMU can be executed by any simulator running on the target platform (provided the necessary licenses are available, if required from the model or from the used runtime libraries).</p>
</div>
</dd>
<dt class="hdlist1">Semantic versioning</dt>
<dd>
<p>The FMI standard uses semantic version numbers, as defined in <a href="#PW13">[PW13]</a>, where the standard version consists of a triple of version numbers, consisting of major version, minor version, and patch version numbers, see <a href="#VersioningLayered">Section 2.6</a>.</p>
</dd>
<dt class="hdlist1">Version independence</dt>
<dd>
<p>FMUs with a specific major and minor version number are valid FMUs w.r.t. the same major version and any minor version because features of minor versions are optional and ignorable.</p>
<div class="paragraph">
<p>Reason: A tool can always export the greatest minor version it supports.
Such an FMU can be imported into all tools supporting this major version and arbitrary minor versions.
This achieves maximal longevity of FMUs protecting its value for users.</p>
</div>
</dd>
<dt class="hdlist1">Small runtime overhead</dt>
<dd>
<p>Communication between an FMU and an importer through the FMI does not introduce significant runtime overhead.
This can be achieved by enabling caching of the FMU outputs and by exchanging multiple quantities with one call.</p>
</dd>
<dt class="hdlist1">Small footprint</dt>
<dd>
<p>The FMI standard shall not significantly increase the memory requirements of the binary.</p>
<div class="paragraph">
<p>Reason: An FMU may run on an ECU with strong memory limitations.
This is achieved by storing variable attributes (<code>name</code>, <code>unit</code>, etc.) and all other static information not needed for model evaluation in the separate <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> that is not needed on the microprocessor where the executable might run.</p>
</div>
</dd>
<dt class="hdlist1">Hide data structure</dt>
<dd>
<p>The FMI does not prescribe a data structure (e.g., a C struct) to represent a model and its variables.</p>
<div class="paragraph">
<p>Reason: the FMI standard shall not unnecessarily restrict or prescribe a certain implementation of FMUs or simulators (whichever contains the model data) to ease implementation by different tool vendors.</p>
</div>
</dd>
<dt class="hdlist1">Support many and nested FMUs</dt>
<dd>
<p>A simulator may run many FMUs in a single simulation run and/or multiple instances of one FMU.
The inputs and outputs of these FMUs can be connected with direct feedthrough.
Moreover, an FMU may contain nested FMUs.</p>
</dd>
<dt class="hdlist1">Numerical Robustness</dt>
<dd>
<p>The FMI standard allows problems which are numerically critical (for example, <a href="#time-event">time event</a> and <a href="#state-event">state events</a>, multiple sample rates, stiff problems) to be treated in a robust way.</p>
</dd>
<dt class="hdlist1">Hide cache</dt>
<dd>
<p>A typical FMU will cache computed results for later reuse.
To simplify usage and to reduce likelihood of programming errors by the importer, the caching mechanism is hidden from the usage of the FMU.</p>
<div class="paragraph">
<p>Reason: First, the FMI should not force an FMU to implement a certain caching policy.
Second, this helps to keep the FMI simple.
To help implement this cache, the FMI provides explicit methods called by the importer for setting properties that invalidate cached data.
An FMU that chooses to implement a cache may maintain a set of "dirty" flags, hidden from the importer.
A get method, for example to a state, will then either trigger a computation, or return cached data, depending on the value of these flags.</p>
</div>
</dd>
<dt class="hdlist1">Support numerical solvers</dt>
<dd>
<p>A typical importer for Model Exchange FMUs uses numerical solvers.
These solvers require vectors for <a href="#state">states</a>, <a href="#derivative"><code>derivatives</code></a> and zero-crossing functions.
The FMU directly fills the values of such vectors provided by the solvers.</p>
<div class="paragraph">
<p>Reason: minimize execution time.
The exposure of these vectors conflicts somewhat with the "hide data structure" requirement, but the efficiency gain justifies this.</p>
</div>
</dd>
<dt class="hdlist1">Explicit signature</dt>
<dd>
<p>The intended operations, arguments, and return types are made explicit in the signature.
For example, an operator (such as <code>doStep</code>) is not passed as an integer argument but a special function is provided.
The <code>const</code> prefix is used for any pointer that should not be changed, including <code>const char*</code> instead of <code>char*</code>.</p>
<div class="paragraph">
<p>Reason: the correct use of the FMI can be checked at compile time and allows calling of the C code in a C++ environment (which is much stricter on <code>const</code> than C is).
This will help to develop FMUs that use the FMI in the intended way.</p>
</div>
</dd>
<dt class="hdlist1">Few functions</dt>
<dd>
<p>The FMI consists of a few, "orthogonal" functions, avoiding redundant functions that could be defined in terms of others.</p>
<div class="paragraph">
<p>Reason: This leads to a compact, easy-to-use, and hence attractive API with a compact documentation.</p>
</div>
</dd>
<dt class="hdlist1">Error handling</dt>
<dd>
<p>All FMI methods use a common set of methods to communicate errors.</p>
</dd>
<dt class="hdlist1">Allocator must free</dt>
<dd>
<p>All memory (and other resources) allocated by the FMU are freed (released) by the FMU.
Likewise, resources allocated by the importer are released by the importer.</p>
<div class="paragraph">
<p>Reason: this helps to prevent memory leaks and runtime errors due to incompatible runtime environments for different components.</p>
</div>
</dd>
<dt class="hdlist1">Immutable strings</dt>
<dd>
<p>All strings passed as arguments or returned are read-only and must not be modified by the receiver.</p>
<div class="paragraph">
<p>Reason: This eases the reuse of strings.</p>
</div>
</dd>
<dt class="hdlist1">Named list elements</dt>
<dd>
<p>Each element of lists defined in the <code>fmi3ModelDescription.xsd</code> have a string attribute called <code>name</code>.
This attribute must be unique with respect to all other <code>name</code> attributes of the same list.</p>
</dd>
<dt class="hdlist1">Use C</dt>
<dd>
<p>The FMI API is written in C, not C++, to avoid problems with compiler and linker dependent behavior, and to enable the use of FMUs on embedded systems.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This version of the FMI standard does not have the following desirable properties.
They might be added in a future version.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The FMI for Model Exchange is for ordinary differential equations (ODEs) in state space form.
It is not for a general differential-algebraic equation (DAE) system.
However, algebraic equation systems inside the FMU are supported (for example, the FMU can report to the environment to re-run the current step with a smaller step size since a solution could not be found for an algebraic equation system).</p>
</li>
<li>
<p>Special features that might be useful for multi-body system programs are not included.</p>
</li>
<li>
<p>The interface is for simulation and for embedded systems.
Properties that might be additionally needed for trajectory optimization, for example, derivatives of the model with respect to parameters during continuous integration are not included.</p>
</li>
<li>
<p>No explicit definition of the variable hierarchy in the XML file, except for terminal variables.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_read_this_document"><a class="link" href="#_how_to_read_this_document">1.4. How to Read This Document</a></h3>
<div class="paragraph">
<p>The core of this document is the description of the state machines and their states for each of the three interface types, each interface type in its own section.
Each state description starts with a brief state&#8217;s purpose, then the mathematical model in a table linking formulas with C-API functions, and finally descriptions of all allowed functions for this particular state.</p>
</div>
<div class="paragraph">
<p>To keep the descriptions brief and redundancy low, <a href="#fmi-common-concepts">common concepts</a>, which are used by more than one interface type, are described once.</p>
</div>
<div class="paragraph">
<p>The standard document is in HTML allowing heavy use of in-document links: all state names, function names, many function arguments, XML elements and attributes are links to definitions or descriptions.
By pressing "t", the table of contents can be displayed on the left side or hidden.</p>
</div>
<div class="paragraph">
<p>In key parts of this document, non-normative examples are used to help understand the standard.
To keep the standard itself brief, the <a href="https://modelica.github.io/fmi-guides/main/fmi-guide/">FMI Implementer&#8217;s Guide</a> was created.
It contains further technical discussions and examples on how to implement certain aspects of the standard for both FMUs and importers.
Contrary to the standard, the FMI Implementer&#8217;s Guide will be a living document, enhanced with further tips and tricks as the FMI community encounters them.</p>
</div>
<div class="paragraph">
<p>Conventions used in this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-normative text is given in square brackets in italic font: <em>[Especially examples are defined in this style.]</em></p>
</li>
<li>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="https://tools.ietf.org/html/rfc2119">RFC 2119</a> (regardless of formatting and capitalization).</p>
</li>
</ul>
</div>
<div id="VariableType" class="ulist">
<ul>
<li>
<p><code>{VariableType}</code> is used as a placeholder for all variable type names without the <code>fmi3</code> prefix (e.g. <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> stands for <code>fmi3GetUInt8</code>, <code>fmi3GetBoolean</code>, <code>fmi3GetFloat64</code>, <code>fmi3GetClock</code>, <code>fmi3GetBinary</code>, etc.).</p>
</li>
</ul>
</div>
<div id="VariableTypeExclClock" class="ulist">
<ul>
<li>
<p><code>{VariableTypeExclClock}</code> is used just like <a href="#VariableType"><code>{VariableType}</code></a>, except does not include functions on variable type <code>fmi3Clock</code>.</p>
</li>
<li>
<p>State machine states are formatted as <strong>bold</strong> link, e.g. <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-common-concepts"><a class="link" href="#fmi-common-concepts">2. Common Concepts</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The FMI defines the following interface types: FMI for Model Exchange, Co-Simulation, and Scheduled Execution.
The concepts defined in this chapter are common to at least two of these interface types.
The definitions that are specific to the particular interfaces are defined in <a href="#fmi-for-model-exchange">Section 3</a>, <a href="#fmi-for-co-simulation">Section 4</a>, and <a href="#fmi-for-scheduled-execution">Section 5</a>.</p>
</div>
<div class="paragraph">
<p>In the following, we assume that the reader is familiar with the basics of the C programming language and the basics of numerical simulation.
Please refer to <a href="#glossary">Appendix A</a> for the most commonly used terms specific to FMI.</p>
</div>
<div class="sect2">
<h3 id="mathematical-definitions"><a class="link" href="#mathematical-definitions">2.1. Mathematical Notation</a></h3>
<div class="paragraph">
<p>This section introduces the mathematical notation used throughout this document to describe:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ordinary differential equations in state-space representations with discontinuities (events),</p>
</li>
<li>
<p>algebraic equation systems,</p>
</li>
<li>
<p>discrete-time equations (sampled-data systems).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FMU and importer use variables to exchange information.
The properties and semantics of variables are described in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
Access to variable values is possible via appropriate API functions.</p>
</div>
<div class="paragraph">
<p>The <a href="#independent"><code>independent</code></a> variable \(t \in \mathbb{T}\) <em>[typically: time]</em> is a tuple \(t = (t_R,t_I)\), where \(t_R \in \mathbb{R},\ t_{I} \in \mathbb{N} = \{0, 1, 2, \ldots\}\).
The real part \(t_R\) of this tuple is the <a href="#independent"><code>independent</code></a> variable of the FMU for describing the continuous-time behavior of the model between events.
During continuous-time integration the integer part of time \(t_I = 0\).
\(t_I\) is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(t_R\).
This time definition is also called "super-dense time" in literature, see, for example, <a href="#LZ07">[LZ07]</a>.
An ordering is defined on \(\mathbb{\text{T}}\) that leads to the notation in <a href="#table-model-exchange-math-notation">Table 2</a>.</p>
</div>
<table id="table-model-exchange-math-notation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Conventions and notation used for time.</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 58.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-left valign-top">Mathematical meaning</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t_1 &lt; t_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((t_{\mathit{R1}},t_{\mathit{I1}}) &lt; (t_{\mathit{R2}}, t_{\mathit{I2}})\ \Leftrightarrow \ t_{\mathit{R1}} &lt; t_{\mathit{R2}}\ \textbf{or} \ t_{\mathit{R1}}= t_{\mathit{R2}} \ \textbf{and} \ t_{\mathit{I1}} &lt; t_{\mathit{I2}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_1\) is before \(t_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t_1 = t_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((t_{\mathit{R1}},t_{\mathit{I1}}) = (t_{\mathit{R2}},t_{\mathit{I2}}) \ \Leftrightarrow  t_{\mathit{R1}}= t_{\mathit{R2}}\ \textbf{and} \ t_{\mathit{I1}} = t_{\mathit{I2}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_1\) is identical to \(t_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t^{+}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({(t_R,t_I)}^{+} \Leftrightarrow (\lim_{\mathit{\epsilon \rightarrow 0}}{\left(t_R + \varepsilon \right),t_{\mathit{Imax}})}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">right limit at \(t\).
\(t_{\mathit{Imax}}\) is the largest occurring integer index of super-dense time at this \(t_R\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^-t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{-}{(t_R,t_I)} \Leftrightarrow (\lim_{\mathit{\epsilon \rightarrow 0}}{\left( t_R - \varepsilon \right),0)}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left limit at \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(v^+(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(t^+)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the right limit of \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{-}v(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^-t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the left limit of \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}v(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(
\begin{cases}
^{\bullet}v(t) \\
^{\bullet}v(\left( t_R,t_I \right))
\end{cases}
\Leftrightarrow
\begin{cases}
 v(^-t) &amp; \text{ during } v(\left( t_R, 0 \right)) \text{, v not clocked }  \\
 v(\left( t_R,t_I - 1 \right)) &amp; \text{ for } v(\left( t_R,t_I \right)) \text{ with } I &gt; 0  \text{, v not clocked } \\
 v \text{ at previous tick of k } &amp; \text{ if } v \text{ for clocked variable } v \text{ of clock k}
\end{cases}
\)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>previous value</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Assume that an FMU has an event at \(t_R=2.1s\) and here a variable changes discontinuously.</em>
<em>If no event iteration occurs, the time instant when the event occurs is defined as (2.1, 0), and the time instant when the integration is restarted is defined as (2.1, 1).]</em></p>
</div>
<div class="paragraph">
<p>The hybrid differential equations exposed by FMI for Model Exchange or wrapped by FMI for Co-Simulation are described as piecewise continuous-time systems.
Discontinuities can occur at time instants \(t_0, t_1, \ldots, t_n\) where \(t_i &lt; t_{i+1}\).
These time instants are called <code>events</code>.
Events can be known beforehand (<a href="#time-event">time events</a>), or are defined implicitly (<a href="#state-event">state event</a> and <a href="#step-event">step events</a>), see below.
Between events, variables are either <a href="#continuous"><code>continuous</code></a> or do not change their value.
A variable is called discrete-time, if it changes its value only at events.
Otherwise the variable is called continuous-time.
Only floating point variables can be continuous-time variables.
The following variable subscripts are used to describe the timing behavior of the corresponding variable (for example, \(\mathbf{v}_d\) is a discrete-time variable):</p>
</div>
<table id="table-subscripts" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Conventions and notation used for variable subscripts.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subscript</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A continuous-time variable is a floating-point variable representing a continuous function of time inside each interval \(t_i^+ &lt; \ ^-t_{i+1}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A discrete-time variable changes its value only at event instants \(t = (t_R, t_I)\).
Such a variable can change multiple times at the same continuous-time instant, but only at subsequent super-dense time instants \(t_I \in \mathbb{N} = \{0, 1, 2, \ldots\}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>k</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <a href="#clocked-variable">clocked variable</a> is a discrete-time variable associated with a <a href="#Clock">Clock</a>.
<a href="#Clock">Clock</a> (not clocked) variables synchronize events with the importer and across FMUs, they carry the information that a specific event happens.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c+d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of continuous-time and discrete-time variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d-k</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of non-clocked, discrete-time variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intermediate variables: a set of variables accessible in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.
These variables are continuous-time variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable at the start time of the simulation as defined by the argument <a href="#startTime"><code>startTime</code></a> of <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>attribute = value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of variables which have an XML attribute-value combination as defined.
<em>[Example:</em> \(\mathbf{v}_{\mathit{initial=exact}}\) <em>are variables defined with attribute <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> (see <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a>).]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At every event instant \(t_i\), continuous-time variables might change discontinuously (see <a href="#figure-piecewise-continuous-variables">Figure 5</a>):</p>
</div>
<div id="figure-piecewise-continuous-variables" class="imageblock">
<div class="content">
<img src="images/PieceWiseContinuousVariables.svg" alt="PieceWiseContinuousVariables" width="40%">
</div>
<div class="title">Figure 5. Piecewise-continuous variables of an FMU: continuous-time (\(\mathbf{v}_c\)), discrete-time (\(\mathbf{v}_d\)) and clocked (\(\mathbf{v}_k\)).</div>
</div>
<div class="paragraph">
<p>The mathematical description of an FMU uses the following variables, where bold variables (e.g. \(\mathbf{v}\)) indicate vectors and italic variables (e.g. \(t\)) denote scalars:</p>
</div>
<table id="table-variable-types" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Symbols for specific variable types.</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>\(t\)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#independent"><code>independent</code></a> variable <em>[typically: time]</em> \(\in \mathbb{T}\).
This variable is defined with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>.
All other variables are functions of this independent variable.</p>
</div>
<div class="paragraph">
<p>For Co-Simulation and Scheduled Execution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The i-th communication point is denoted as \(t_i\).<br></p>
</li>
<li>
<p>The communication step size is denoted as \(h_i = t_{i+1} - t_i\).<br></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{v}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All exposed variables as listed in <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a>.
A subset of variables is selected via a <a href="#table-subscripts">subscript</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{p}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters.
The symbol without a subscript references variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a>.
A subset of parameters is selected via a <a href="#table-subscripts">subscript</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{u}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input variables.
The values of these variables are defined outside of the model.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>.
A subset of inputs is selected via a <a href="#table-subscripts">subscript</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{y}\)<br>
\(\mathbf{y}^{(j)}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output variables.
The values of these variables are computed in the FMU and they are designed to be used outside the FMU.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a>.
For CS: Also j-th derivatives \(\mathbf{y}^{(j)}(t_{i+1})\) can be provided if supported by the FMU.
A subset of outputs is selected via a <a href="#table-subscripts">subscript</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{w}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local variables of the FMU that must not be used for FMU connections.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#local"><code>local</code></a>.
A subset of local variables is selected via a <a href="#table-subscripts">subscript</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{k}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Clock">Clock</a> variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{z}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of floating point continuous-time variables representing the <a href="#state-event">event indicators</a> used to locate <a href="#state-event">state events</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="state"></a>\(\mathbf{x}_c\)<br>
\(\mathbf{\dot{x}}_c\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of floating point continuous-time variables representing the continuous-time <a href="#state">states</a>.<br>
A vector of floating point continuous-time variables representing the first derivatives of the continuous-time <a href="#state">states</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d\)<br>
\(^{\bullet}\mathbf{x}_d\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d\) is a vector of (internal) discrete-time variables (of any type) representing the discrete-time states.<br>
\({}^{\bullet}\mathbf{x}_d\) is the value of \(\mathbf{x}_d\) at the previous super-dense time instant.<br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(T_{\mathit{next}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At an event instant, an FMU can define the next time instant \(T_{\mathit{next}}\), at which the next time event occurs (see also the definition of <a href="#EventMode">events</a>).
Every event removes automatically a previous definition of \(T_{\mathit{next}}\), and it must be explicitly defined again, even if a previously defined \(T_{\mathit{next}}\) was not yet reached (see <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="relations"></a> \(\mathbf{r}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of Boolean variables representing relations: \(\mathbf{r}_j := \mathbf{z}_j &gt; 0\).
When entering <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> all relations reported via the event indicators \(\mathbf{z}\) are fixed and during this mode these relations are replaced by \(^{\bullet}\mathbf{r}\).
Only during <a href="#InitializationMode"><strong>Initialization Mode</strong></a> or <a href="#EventMode"><strong>Event Mode</strong></a> the domains \(\mathbf{z}_j &gt; 0\) can change.
<em>[For more details, see <a href="#frozen-relations">Remark 3</a> below.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="buffers"></a> \(\mathbf{b}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hidden data of the FMU.
<em>[For example, delay buffers in Model Exchange FMUs that are used in <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>]</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="general-mechanisms"><a class="link" href="#general-mechanisms">2.2. General Mechanisms</a></h3>
<div class="sect3">
<h4 id="_requirements_for_implementations_of_the_c_api"><a class="link" href="#_requirements_for_implementations_of_the_c_api">2.2.1. Requirements for Implementations of the C-API</a></h4>
<div class="paragraph">
<p>The following general requirements for implementations of FMUs and importers must be followed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI functions of one instance are not required to be thread-safe.<br>
<em>[For example, if the functions of one instance of an FMU are accessed from more than one thread;
the multi-threaded simulation environment that uses the FMU must guarantee that there are no race conditions while invoking the FMI functions.
The FMU itself does not implement any services to support this.]</em></p>
</li>
<li>
<p>The following FMI callback functions must not call back into the FMU:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#logMessage"><code>fmi3LogMessageCallback</code></a>, and</p>
</li>
<li>
<p><a href="#preemption-support"><code>fmi3LockPreemptionCallback</code></a>, and</p>
</li>
<li>
<p><a href="#preemption-support"><code>fmi3UnlockPreemptionCallback</code></a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following callback functions lead to well-defined states and may call FMI functions according to their respective state definitions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#intermediateUpdate"><code>fmi3IntermediateUpdateCallback</code></a>, and</p>
</li>
<li>
<p><a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>FMI functions must not change global settings which affect other processes/threads.
An FMI function may change settings of the thread in which it is called (such as floating point control registers), provided these changes are restored before leaving the function or before a callback function is called.
To prepare the FMU code to run reliably on <a href="#preemption-support">preemptive systems</a> FMI functions must not change global settings.<br>
<em>[This property ensures that functions of different FMU instances can be called safely in any order.</em>
<em>Additionally, they can be called in parallel provided the functions are called in different processes.</em>
<em>If an FMI function changes, for example, the floating point control word of the CPU, it must restore the previous value before return of the function.]</em></p>
</li>
<li>
<p>FMI function arguments must not to be <code>NULL</code>, unless explicitly allowed by the standard document where <code>NULL</code> will be assigned a specific semantic.<br>
<em>[For an example of <code>NULL</code> being explicitly allowed see <a href="#resourcePath"><code>resourcePath</code></a>.</em>
<em>Defensive implementations should still guard against <code>NULL</code> pointers.]</em></p>
</li>
<li>
<p>The FMI Standard does not provide a runtime platform or portability layer.
Access to operating system resources and services, such as memory, network or file system, should be implemented with special care because the availability of such resources and services is not guaranteed on every target platform and/or simulator.
If some resource is required by the FMU but is not available, the FMU must log what resource failed and return with error.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="header-files-and-naming-of-functions"><a class="link" href="#header-files-and-naming-of-functions">2.2.2. Header Files and Naming of Functions</a></h4>
<div class="paragraph">
<p>The FMI C-API is defined by three C99 header files.
By convention, all function declarations and type definitions in these header files have the prefix <code>fmi3</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3PlatformTypes.h</code></dt>
<dd>
<p>contains the type definitions of the input and output arguments of the functions as well as some C preprocessor macro definitions for constants.
This header file must be used both by the FMU and by the importer.<br>
<em>[Example of a definition in this header file:</em></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef          double fmi3Float64;  /* Double precision floating point (64-bit) */</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</dd>
<dt class="hdlist1"><code>fmi3FunctionTypes.h</code></dt>
<dd>
<p>contains <code>typedef</code> definitions of all function prototypes of an FMU as well as enumerations for constants.
This header file includes <code>fmi3PlatformTypes.h</code>.
When dynamically loading an FMU, these definitions can be used to type-cast the function pointers to the respective function definition.
For simplicity, the function type for each function is composed of the function name itself with the suffix <code>TYPE</code>.<br>
<em>[Example of a definition in this header file:</em></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetTimeTYPE(fmi3Instance instance, fmi3Float64 time);</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</dd>
<dt class="hdlist1"><code>fmi3Functions.h</code></dt>
<dd>
<p>contains the function prototypes of an FMU that may be accessed in simulation environments.</p>
<div class="paragraph">
<p>This header file includes <code>fmi3PlatformTypes.h</code> and <code>fmi3FunctionTypes.h</code>.
The header file version number for which the model was compiled, may be inquired by the importer with <a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a>.<br></p>
</div>
<div class="paragraph">
<p><em>[Example of a definition in this header file:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">FMI3_Export fmi3SetTimeTYPE             fmi3SetTime;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>For Microsoft and Cygwin compilers <code>FMI3_Export</code> is defined as</em> <code>__declspec(dllexport)</code> <em>and for Gnu-Compilers as</em> <code>__attribute__ ( ( visibility("default") ) )</code> <em>in order to export the name for dynamic loading.</em>
<em>Otherwise it is an empty definition.]</em></p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The goal is that both source code and binary representations of FMUs are supported and that several FMUs might be present at the same time in an executable (for example, FMU A may use an FMU B).
In order for this to be possible, the names of the functions in different FMUs must be different, or function pointers must be used.
To support the source code representation of FMUs, macros are provided in <code>fmi3Functions.h</code> to build the actual function names by using a function prefix that depends on how the FMU is shipped (shared object or static library).</p>
</div>
<div class="paragraph">
<p><em>[These macros can be defined differently in a target specific variant of <code>fmi3Functions.h</code> to adjust them to the requirements of the supported compilers and platforms of the importer, e.g. one can remove the use of the <code>FMI3_FUNCTION_PREFIX</code> macro in the <code>fmi3Function.h</code> file of the importer to compile function names without prefix for building shared objects (DLL/SO).]</em></p>
</div>
<div class="paragraph">
<p>When compiling an FMU C-file the macro <code>FMI3_FUNCTION_PREFIX</code> must be defined before the <code>#include &lt;fmi3Functions.h&gt;</code> or on precompiler level with the same value as the value of the <a href="#modelIdentifier"><code>modelIdentifier</code></a> attribute defined in <code>&lt;fmiModelDescription&gt;&lt;ModelExchange&gt;</code>, <code>&lt;fmiModelDescription&gt;&lt;CoSimulation&gt;</code>, and <code>&lt;fmiModelDescription&gt;&lt;ScheduledExecution&gt;</code> together with <code>_</code> at the end (see <a href="#model-exchange-schema">Section 3.4</a>, <a href="#co-simulation-schema">Section 4.4</a>, <a href="#scheduled-execution-schema">Section 5.4</a>).</p>
</div>
<div class="paragraph">
<p>Typically, FMU functions are used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">// FMU is shipped with C source code, or with static link library
#define FMI3_FUNCTION_PREFIX MyModel_
#include &lt;fmi3Functions.h&gt;
&lt; usage of the FMU functions e.g. MyModel_fmi3SetTime &gt;

// FMU is shipped with DLL/SharedObject
#include &lt;fmi3FunctionTypes.h&gt;
fmi3SetTimeTYPE *myname_setTime = &lt; load symbol "fmi3SetTime" from DLL/SharedObject &gt;;
&lt; usage of the FMU function pointers, e.g. myname_setTime &gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function that is defined as <code>fmi3GetFloat64</code> is changed by the macros to a function name as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the FMU is shipped with C source code or with static link library:<br>
The constructed function name is <code>MyModel_fmi3GetFloat64</code>.
In other words, the function name is prefixed with the model name and an <code>_</code>.
A simulation environment may therefore construct the relevant function names by generating code for the actual function call.
In case of a static link library, the name of the library must be <code>MyModel.lib</code> on Windows and <code>libMyModel.a</code> on Linux; in other words the <a href="#modelIdentifier"><code>modelIdentifier</code></a> attribute is used to create the library name.</p>
</li>
<li>
<p>If the FMU is shipped with DLL/SharedObject:<br>
The constructed function name is <code>fmi3GetFloat64</code>, in other words, it is not changed.
<em>[This can be realized in the case of a source code FMU with a target-specific version of <code>fmi3Functions.h</code> that does not use FMI3_FUNCTION_PREFIX to construct the function names.</em>
<em>Using the standard-supplied version of <code>fmi3Functions.h</code>, the same effect can be achieved by defining the <code>FMI3_OVERRIDE_FUNCTION_PREFIX</code> precompiler macro prior to the inclusion of the <code>fmi3Functions.h</code> header, for example using precompiler command-line flags.]</em>
A simulation environment dynamically loads this library and explicitly imports the function pointers by providing the FMI function names as strings.
The name of the library must be <code>MyModel.dll</code> on Windows or <code>MyModel.so</code> on Linux; in other words the <a href="#modelIdentifier"><code>modelIdentifier</code></a> attribute is used as library name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since <a href="#modelIdentifier"><code>modelIdentifier</code></a> may be used as prefix of a C-function name it must fulfill the restrictions on C-function
names (only letters, digits and/or underscores are allowed).
<em>[For example, if <code>modelName = "A.B.C"</code>, then <a href="#modelIdentifier"><code>modelIdentifier</code></a> might be "A_B_C".]</em>
Since <a href="#modelIdentifier"><code>modelIdentifier</code></a> is also used as name in a file system, it must also fulfill the restrictions of the targeted operating system.
Basically, this means that it should be short.
These restrictions apply to all interface types and for binary and source-code FMUs.
<em>[For example, the Windows API only supports full path-names of a file up to 260 characters (see: <a href="https://msdn.microsoft.com/en-us/library/aa365247%28VS.85%29.aspx" class="bare">https://msdn.microsoft.com/en-us/library/aa365247%28VS.85%29.aspx</a>).]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_platform_dependent_definitions"><a class="link" href="#_platform_dependent_definitions">2.2.3. Platform Dependent Definitions</a></h4>
<div class="paragraph">
<p>To simplify porting, no C types are used in the function interfaces, but the alias types are defined in this section.
All definitions in this section are provided in the header file <code>fmi3PlatformTypes.h</code>.
This definition must be used by binary FMUs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef           void* fmi3Instance;             /* Pointer to the FMU instance */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to an FMU specific data structure that contains the information needed to process the model/subsystem represented by the FMU.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef           void* fmi3InstanceEnvironment;  /* Pointer to the FMU environment */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to a data structure in the importer.
Using this pointer, data may be transferred between the importer and callback functions the importer provides with the <a href="#FMUStateSettable">instantiation functions</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef           void* fmi3FMUState;             /* Pointer to the internal FMU state */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to a data structure in the FMU that stores the internal FMU state of the current or a previously stored time instant.
This allows to restart a simulation from a previously stored FMU state (see <a href="#get-set-fmu-state">Section 2.2.7.4</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef        uint32_t fmi3ValueReference;       /* Handle to the value of a variable */</code></pre>
</div>
</div>
<div id="fmi3ValueReference" class="paragraph">
<p>This is a handle to access a variable of the model via the C-API.
An <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a> uniquely identifies the value and other properties of a variable, except for the variable name and the display unit that may differ for <a href="#alias"><code>alias</code></a> variable definitions.
All <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a> are defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> as attribute <a href="#valueReference"><code>valueReference</code></a> for each variable.</p>
</div>
<div class="paragraph">
<p>Structured entities exposed by an FMU must be flattened into a set of values (scalars or arrays) of type <code>fmi3Float64</code>, <code>fmi3Int32</code>, etc.
Semantic relations may be expressed using <a href="#namingSection">naming conventions</a>.
Arrays may be flattened into a set of scalars or represented directly as <a href="#Dimension">array</a>.
An <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a> references one such value (scalar or array).</p>
</div>
<div class="paragraph">
<p>The following listing shows the base types used in the FMI C-API:</p>
</div>
<div id="code-base-types" class="listingblock">
<div class="title">Base types</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef           float fmi3Float32;  /* Single precision floating point (32-bit) */
typedef          double fmi3Float64;  /* Double precision floating point (64-bit) */
typedef          int8_t fmi3Int8;     /* 8-bit signed integer */
typedef         uint8_t fmi3UInt8;    /* 8-bit unsigned integer */
typedef         int16_t fmi3Int16;    /* 16-bit signed integer */
typedef        uint16_t fmi3UInt16;   /* 16-bit unsigned integer */
typedef         int32_t fmi3Int32;    /* 32-bit signed integer */
typedef        uint32_t fmi3UInt32;   /* 32-bit unsigned integer */
typedef         int64_t fmi3Int64;    /* 64-bit signed integer */
typedef        uint64_t fmi3UInt64;   /* 64-bit unsigned integer */
typedef            bool fmi3Boolean;  /* Data type to be used with fmi3True and fmi3False */
typedef            char fmi3Char;     /* Data type for one character */
typedef const fmi3Char* fmi3String;   /* Data type for character strings
                                         ('\0' terminated, UTF-8 encoded) */
typedef         uint8_t fmi3Byte;     /* Smallest addressable unit of the machine
                                         (typically one byte) */
typedef const fmi3Byte* fmi3Binary;   /* Data type for binary data
                                         (out-of-band length terminated) */
typedef            bool fmi3Clock;    /* Data type to be used with fmi3ClockActive and
                                         fmi3ClockInactive */

/* Values for fmi3Boolean */
#define fmi3True  true
#define fmi3False false

/* Values for fmi3Clock */
#define fmi3ClockActive   true
#define fmi3ClockInactive false</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="status-returned-by-functions"><a class="link" href="#status-returned-by-functions">2.2.4. Status Returned by Functions</a></h4>
<div class="paragraph">
<p>This section defines the return values the C-API functions indicating success or failure of the function call.
It is defined in file <code>fmi3FunctionTypes.h</code> as an enumeration of type <code>fmi3Status</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum {
    fmi3OK,
    fmi3Warning,
    fmi3Discard,
    fmi3Error,
    fmi3Fatal,
} fmi3Status;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The status values have the following meaning:</p>
</div>
<div id="fmi3OK" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3OK</code></dt>
<dd>
<p>The call was successful.
The output argument values are defined.</p>
</dd>
</dl>
</div>
<div id="fmi3Warning" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3Warning</code></dt>
<dd>
<p>A non-critical problem was detected, but the computation may continue.
The output argument values are defined.
Function <a href="#logMessage"><code>logMessage</code></a> should be called by the FMU with further information before returning this status, respecting the current logging settings.<br>
<em>[In certain applications, e.g. in a prototyping environment, warnings may be acceptable.</em>
<em>For production environments warnings should be treated like errors unless they can be safely ignored.]</em></p>
</dd>
</dl>
</div>
<div id="fmi3Discard" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3Discard</code></dt>
<dd>
<p>The call was not successful and the FMU is in the same state as before the call.
The output argument values are undefined, but the computation may continue.
Function <a href="#logMessage"><code>logMessage</code></a> should be called by the FMU with further information before returning this status, respecting the current logging settings.
Advanced importers may try alternative approaches to continue the simulation by calling the function with different arguments or calling another function - except in FMI for Scheduled Execution where repeating failed function calls is not allowed.
Otherwise the simulation algorithm must treat this return code like <a href="#fmi3Error"><code>fmi3Error</code></a> and must terminate the simulation.<br>
<em>[Examples for usage of <a href="#fmi3Discard"><code>fmi3Discard</code></a> are</em></p>
<div class="ulist">
<ul>
<li>
<p><em>handling of <a href="#min-max-violations">min/max violation</a>, or</em></p>
</li>
<li>
<p><em>signal numerical problems during model evaluation forcing smaller step sizes.]</em></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="fmi3Error" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3Error</code></dt>
<dd>
<p>The call failed.
The output argument values are undefined and the simulation must not be continued.
Function <a href="#logMessage"><code>logMessage</code></a> should be called by the FMU with further information before returning this status, respecting the current logging settings.
If a function returns <a href="#fmi3Error"><code>fmi3Error</code></a>, it is possible to restore a previously retrieved FMU state by calling <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>.
Otherwise <a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a> or <a href="#fmi3Reset"><code>fmi3Reset</code></a> must be called.
When detecting illegal arguments or a function call not allowed in the current state according to the respective state machine, the FMU must return <a href="#fmi3Error"><code>fmi3Error</code></a>.
Other instances of this FMU are not affected by the error.<br>
<em>[For example, when setting a constant with a call to <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a>, then the function must return with an error (<a href="#fmi3Error"><code>fmi3Status = fmi3Error</code></a>.]</em></p>
</dd>
</dl>
</div>
<div id="fmi3Fatal" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3Fatal</code></dt>
<dd>
<p>The state of all instances of the model is irreparably corrupted.
<em>[For example, due to a runtime exception such as access violation or integer division by zero during the execution of an FMI function.]</em>
Function <a href="#logMessage"><code>logMessage</code></a> should be called by the FMU with further information before returning this status, respecting the current logging settings, if still possible.
The importer must not call any other function for any instance of the FMU.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="inquire-version-number"><a class="link" href="#inquire-version-number">2.2.5. Inquire Version Number of Header Files</a></h4>
<div id="fmi3GetVersion" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef const char* fmi3GetVersionTYPE(void);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns <code>fmi3Version</code> of the <code>fmi3Functions.h</code> header file which was used to compile the functions of the FMU.
This function call is allowed always and in all interface types.</p>
</div>
<div class="paragraph">
<p>The standard header file as documented in this specification has version <code>3.0</code>, so this function returns <code>3.0</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="advancing-time"><a class="link" href="#advancing-time">2.2.6. Advancing Time</a></h4>
<div class="paragraph">
<p>This section highlights the differences of the concept of time (in general the independent variable) for the three different FMI types, ME, CS and SE.
The FMI type defines which functions drive the time in the simulation.</p>
</div>
<div class="paragraph">
<p>The initial value of the independent variable is the value of the argument <a href="#startTime"><code>startTime</code></a> of <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>.</p>
</div>
<div class="paragraph">
<p>In Model Exchange, time is under the sole control of the <a href="#importer">importer</a> and its integration algorithm.
The model itself receives the current time to be used in its computation with <a href="#fmi3SetTime"><code>fmi3SetTime</code></a>.
Time is not necessarily always advancing as solvers might need to jump back and forth in time, for example, to localize events using <a href="#eventIndicator">event indicators</a>.</p>
</div>
<div class="paragraph">
<p>In Co-Simulation, time advances in (possibly variable) steps negotiated between the co-simulation algorithm of the importer and the FMU.
The importer calls <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with the <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> and a target <a href="#communicationStepSize"><code>communicationStepSize</code></a> (required to be larger than 0.0).
During this <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, both importer and FMU might encounter events (or other situations) that require reduction of the <a href="#communicationStepSize"><code>communicationStepSize</code></a> (potentially even down to 0.0).
The FMU may use the return argument <a href="#earlyReturn"><code>earlyReturn</code></a> of the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> function to tell the importer that the FMU returned earlier than requested.
The importer may use the return argument <a href="#earlyReturnRequested"><code>earlyReturnRequested</code></a> of the callback <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a> to signal the FMU to return early from the current <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.
The output argument <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> allows the FMU to signal the importer its current internal time.</p>
</div>
<div class="paragraph">
<p>In Scheduled Execution, just like in Model Exchange, time is under the sole control of the importer i.e. its scheduler.
By scheduling the exposed <a href="#model-partition">model partitions</a> of an FMU and executing them for dedicated points in time it is the scheduler that defines how time progresses.
These points in time are <a href="#event">events</a> defined by time-based or triggered <a href="#Clock">Clocks</a>.
The time itself is communicated to the FMU as <a href="#activationTime"><code>activationTime</code></a> argument of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.</p>
</div>
<div class="paragraph">
<p><em>[Examples for Scheduled Execution:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>A simple scheduler calls the model partitions of periods 5 ms and 10 ms of an FMU in a loop.</em>
<em>The latter one is activated only every second loop iteration.</em>
<em>Thus the time of the simulation advances discretely by 5 ms in every step of the loop.</em></p>
</li>
<li>
<p><em>A scheduler of a real-time simulator activates the model partitions whenever wall-clock time has progressed for 5 ms or 10 ms.]</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="fmu-variables"><a class="link" href="#fmu-variables">2.2.7. Variables</a></h4>
<div class="paragraph">
<p>FMU and importer use variables to exchange information.
All variables are listed in <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> as elements of <code>&lt;fmiModelDescription&gt;&lt;ModelVariables&gt;</code>.</p>
</div>
<div class="paragraph">
<p>They are identified with a unique handle called <a href="#valueReference">value reference</a>.</p>
</div>
<div class="paragraph">
<p>The attribute <a href="#causality"><code>causality</code></a> defines the direction of the information flow with respect to the FMU (e.g. <a href="#input"><code>input</code></a>, <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a>).</p>
</div>
<div class="paragraph">
<p>Variables, except Clocks, may be scalar or multi-dimensional arrays.
Clocks must always be scalar.</p>
</div>
<div class="sect4">
<h5 id="serialization-of-variables"><a class="link" href="#serialization-of-variables">2.2.7.1. Serialization of Array Variables</a></h5>
<div class="paragraph">
<p>Array variables in C-API and <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> (i.e. <a href="#start"><code>start</code></a> attribute) are serialized as row major.
The order of dimensions is defined as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For the C-language it is defined from left to right (e.g. <code>array[dim1][dim2]&#8230;&#8203;[dimN]</code>).</p>
</li>
<li>
<p>In <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> it is defined by the order of the <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> elements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[Example: A 2D matrix</em></p>
</div>
<div class="stemblock">
<div class="content">
\[A = \left( \begin{array}{cc} a_{11}&amp;a_{12}\\
                             a_{21}&amp;a_{22}\\
                             a_{31}&amp;a_{32}\\
            \end{array} \right)\]
</div>
</div>
<div class="paragraph">
<p><em>is serialized as follows:</em></p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[0][0]=a11</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[0][1]=a12</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+1</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[1][0]=a21</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+2</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[1][1]=a22</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+3</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[2][0]=a31</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+4</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[2][1]=a32</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+5</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Corresponding definition in C:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">double A[3][2] = { {0.0, 0.1},
                   {1.0, 1.1},
                   {2.0, 2.1}};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Corresponding <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a> definition in <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;Float64 name="A" valueReference="2" causality="parameter" variability="tunable"
  start="0.0 0.1 1.0 1.1 2.0 2.1"&gt;
  &lt;Dimension start="3"/&gt;
  &lt;Dimension start="2"/&gt;
&lt;/Float64&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>For this serialization of array variables the sparsity pattern of the array is not taken into account.
All elements of the array, including structural zeros, are serialized.
If an API function takes multiple value references, the serialized variables are concatenated.</p>
</div>
</div>
<div class="sect4">
<h5 id="get-and-set-variable-values"><a class="link" href="#get-and-set-variable-values">2.2.7.2. Getting and Setting Variable Values</a></h5>
<div class="paragraph">
<p>Restrictions for setting and getting of variables with certain types, causalities and variabilities are defined in the state machine and state descriptions (see <a href="#common-state-machine">Section 2.3</a> for common states, <a href="#state-machine-model-exchange">Section 3.2</a> for Model Exchange, <a href="#state-machine-co-simulation">Section 4.2</a> for Co-Simulation, and <a href="#state-machine-scheduled-execution">Section 5.2</a> for Scheduled Execution).
In addition to those state-specific restrictions, setting and getting of <a href="#clocked-variable">clocked variables</a> is only allowed during <a href="#EventMode"><strong>Event Mode</strong></a> when their respective Clocks are active, and during <a href="#InitializationMode"><strong>Initialization Mode</strong></a> irrespective of Clock activation status.</p>
</div>
<div class="paragraph">
<p>The variable <a href="#ModelVariables">type</a> defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> determines the function <a href="#get-and-set-variable-values"><code>fmi3Get/Set{VariableType}</code></a> (see also <a href="#VariableType"><code>{VariableType}</code></a> and <a href="#VariableTypeExclClock"><code>{VariableTypeExclClock}</code></a>) that must be used for accessing the respective variable values.
To set or inquire variables of type <a href="#figure-schema-Enumeration"><code>Enumeration</code></a>, <code>fmi3SetInt64</code> and <code>fmi3GetInt64</code> must be used.<br>
<em>[Since C allows negative values for enumerations, signed integers are used.</em>
<em>With enums being defined as int in the programming language C and compilers are free to choose any bit-width for int, 64 bit getters and setters are needed to be platform and compiler agnostic.]</em></p>
</div>
<div class="paragraph">
<p>The current values of the variables may be inquired with the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetFloat32TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Float32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetFloat64TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Float64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt8TYPE   (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt8TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt16TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt16TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt32TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt32TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt64TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt64TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetBooleanTYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Boolean values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetStringTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3String values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetBinaryTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      size_t valueSizes[],
                                      fmi3Binary values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetClockTYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Clock values[]);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is a vector of <code>nValueReferences</code> handles that reference the variables that shall be inquired.</p>
</li>
<li>
<p><code>values</code> is a vector consisting of the <a href="#serialization-of-variables">serialized</a> values of these variables.</p>
</li>
<li>
<p><code>valueSizes</code> is a vector with the actual sizes of the values for binary variables.</p>
</li>
<li>
<p><code>nValues</code> provides the number of values in the <code>values</code> vector (and <code>valueSizes</code> vector, where applicable) which is only equal to <code>nValueReferences</code> if all <a href="#valueReference"><code>valueReference</code></a>s point to scalar variables.
<em>[The passing of <code>nValues</code> is redundant:
The number of values can be reconstructed from the value references passed in and their corresponding variable definitions and (potentially dynamic) array sizes.
It is added to enable memory safety and other sanity checks.]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The strings returned by <code>fmi3GetString</code>, as well as the binary values returned by <code>fmi3GetBinary</code>, must be copied by the importer because the allocated memory for these strings might be deallocated or overwritten by the next call of an FMU function.</p>
</div>
<div class="paragraph">
<p>It is possible to set the values of variables using the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetFloat32TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Float32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetFloat64TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Float64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt8TYPE   (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt8TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt16TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt16TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt32TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt32TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt64TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt64TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetBooleanTYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Boolean values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetStringTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3String values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetBinaryTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const size_t valueSizes[],
                                      const fmi3Binary values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetClockTYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Clock values[]);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is a vector of <code>nValueReferences</code> handles that reference the variables that shall be set.</p>
</li>
<li>
<p><code>values</code> is a vector consisting of the <a href="#serialization-of-variables">serialized</a> values of these variables.</p>
</li>
<li>
<p><code>valueSizes</code> is a vector with the actual sizes of the values of binary variables.</p>
</li>
<li>
<p><code>nValues</code> provides the number of values in the <code>values</code> vector (and <code>valueSizes</code> vector, where applicable) which is only equal to <code>nValueReferences</code> if all <a href="#valueReference"><code>valueReference</code></a>s point to scalar variables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With two exceptions, all variables that are allowed to be set with <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> keep their respective values until the next call to <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a>.
Exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Variables of type Clock must be deactivated during <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> by the FMU.</p>
</li>
<li>
<p>By setting the complete <a href="#get-set-fmu-state">FMU state</a> using <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>, all variables are potentially changed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All strings passed as arguments to <code>fmi3SetString</code>, as well as all binary values passed as arguments to <code>fmi3SetBinary</code>, must be copied during these function calls by the FMU, because there is no guarantee of the lifetime of strings or binary values, when these functions return.</p>
</div>
<div class="paragraph">
<p><em>[Note: In Scheduled Execution, Clocks are neither activated nor deactivated by the importer using <a href="#fmi3SetClock"><code>fmi3SetClock</code></a>.</em>
<em>Instead: The activation of a clock requires the importer to call <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="min-max-violations"><a class="link" href="#min-max-violations">2.2.7.3. Handling min/max Range Violations</a></h5>
<div class="paragraph">
<p>Attributes <a href="#min"><code>min</code></a> and <a href="#max"><code>max</code></a> can be defined for variables of float, integer or enumeration types.
There are several conflicting requirements on how to utilize these min/max definitions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avoiding forbidden regions, for example, if <code>u</code> is an <a href="#input"><code>input</code></a> and "sqrt(u)" is computed in the FMU, <code>min = 0</code> on <code>u</code> shall guarantee that only values of <code>u</code> in the allowed regions are provided.
Numerical algorithms, for example, solvers and optimizers, cannot guarantee these limits.
If a variable is outside of the bounds, the solver tries to bring it back into the bounds.
As a consequence, calling <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> during an iteration of such a solver might provide values that are not within defined min/max region.
After the iteration is finalized, it is only guaranteed that a value is within its bounds up to a certain numerical precision.</p>
</li>
<li>
<p>During system creation and prototyping, checks on min/max should be performed.
For maximum performance or real-time systems, these checks might not be performed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The approach in FMI is therefore that min/max definitions inform the importer about the region in which the FMU is designed to operate.
However, the FMU should not rely on the min/max range to be properly observed.
For example, dividing by an <a href="#input"><code>input</code></a> or taking the square root of an <a href="#input"><code>input</code></a> may result in returning either <a href="#fmi3Discard"><code>fmi3Discard</code></a> or <a href="#fmi3Error"><code>fmi3Error</code></a>, or the FMU is able to handle this situation gracefully.</p>
</div>
<div class="paragraph">
<p>If an FMU defines min/max values for <a href="#local"><code>local</code></a> and <a href="#output"><code>output</code></a> variables of integer and &lt;Enumeration&gt; types, then the FMU must return values within the defined range when <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> is called.</p>
</div>
<div class="paragraph">
<p>If an FMU defines min/max values for <a href="#local"><code>local</code></a> and <a href="#output"><code>output</code></a> variables of floating point types, then the FMU may return values in the defined range with a certain uncertainty related to the tolerances of the numerical algorithms and representational limits of IEEE 754.</p>
</div>
</div>
<div class="sect4">
<h5 id="get-set-fmu-state"><a class="link" href="#get-set-fmu-state">2.2.7.4. Getting and Setting the Complete FMU State</a></h5>
<div class="paragraph">
<p>The FMU has internal data representing its state.
This internal state consists especially of the values of the continuous states, iteration variables, <a href="#parameter"><code>parameter</code></a> values, <a href="#input"><code>input</code></a> values, delay buffers, file identifiers, and FMU internal status information.
Depending on the FMI type, only a subset of this data is directly accessible via the FMI C-API.
With the functions of this section, the entire internal FMU state can be stored and reapplied to continue the simulation from this state.</p>
</div>
<div class="paragraph">
<p><em>[Examples for using this feature:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>For variable step-size control of co-simulation algorithms: get the FMU state for every accepted communication step; if the follow-up step is not accepted, restart co-simulation from this FMU state.</em></p>
</li>
<li>
<p><em>For nonlinear Kalman filters: get the FMU state just before initialization; in every sample period, set new continuous states from the Kalman filter algorithm based on measured values; integrate to the next sample instant and inquire the predicted continuous states that are used in the Kalman filter algorithm as basis to set new continuous states.</em></p>
</li>
<li>
<p><em>For nonlinear model predictive control: get the FMU state just before initialization; in every sample period, set new continuous states from an observer, initialize and get the FMU state after initialization.</em>
<em>From this state, perform many simulations that are restarted after the initialization with new input variables proposed by the optimizer.]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Furthermore, the FMU state can be serialized and copied in a byte vector.
<em>[This can be, for example, used to perform an expensive steady-state initialization, copy the received FMU state in a byte vector and store this vector on file.</em>
<em>Whenever needed, the byte vector can be loaded from file and deserialized, and the simulation can be restarted from this FMU state, in other words, from the steady-state initialization.]</em></p>
</div>
<div id="fmi3GetFMUState" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3GetFMUState</code></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetFMUStateTYPE (fmi3Instance instance, fmi3FMUState* FMUState);</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="FMUState"></a>This function copies the internal FMU state and returns a pointer to this copy in <a href="#FMUState"><code>FMUState</code></a>.
<a href="#FMUState"><code>FMUState</code></a> must contain all information required to allow continuing the simulation from the current FMU state without additional FMI C-API calls.
If on entry <code>*FMUState = NULL</code>, a new allocation is required.
If <code>*FMUState != NULL</code>, then <code>*FMUState</code> points to a previously returned <a href="#FMUState"><code>FMUState</code></a> that is no longer needed and can be overwritten.
In particular, <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a> had not been called with this <a href="#FMUState"><code>FMUState</code></a> as an argument.
<em>[Function <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a> typically reuses the memory of this <a href="#FMUState"><code>FMUState</code></a> in this case and returns the same pointer to it, but with the current <a href="#FMUState"><code>FMUState</code></a>.]</em></p>
</div>
<div id="fmi3SetFMUState" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3SetFMUState</code></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetFMUStateTYPE (fmi3Instance instance, fmi3FMUState  FMUState);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function restores the state provided by <a href="#FMUState"><code>FMUState</code></a>.
The FMU must not change the content of the provided <a href="#FMUState"><code>FMUState</code></a> to allow multiple calls of <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> with this <a href="#FMUState"><code>FMUState</code></a>.</p>
</div>
<div id="fmi3FreeFMUState" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3FreeFMUState</code></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3FreeFMUStateTYPE(fmi3Instance instance, fmi3FMUState* FMUState);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function frees all memory and other resources allocated with the <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a> call for the provided argument <a href="#FMUState"><code>FMUState</code></a>.
If a NULL pointer is provided, the call is ignored.
The function returns a NULL pointer in argument <a href="#FMUState"><code>FMUState</code></a>.</p>
</div>
<div class="paragraph">
<p>The functions above may be called, only if the capability flag <a href="#canGetAndSetFMUState"><code>canGetAndSetFMUState</code></a> is set to <code>true</code>.</p>
</div>
<div id="fmi3SerializedFMUStateSize" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3SerializedFMUStateSize</code></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SerializedFMUStateSizeTYPE(fmi3Instance instance,
                                                  fmi3FMUState FMUState,
                                                  size_t* size);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the <code>size</code> of the byte vector, in order that <a href="#FMUState"><code>FMUState</code></a> can be stored in it.
With this information, the environment must allocate an <code>fmi3Byte</code> vector of the required length <code>size</code>.</p>
</div>
<div id="fmi3SerializeFMUState" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3SerializeFMUState</code></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SerializeFMUStateTYPE     (fmi3Instance instance,
                                                  fmi3FMUState FMUState,
                                                  fmi3Byte serializedState[],
                                                  size_t size);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function serializes the data which is referenced by pointer <a href="#FMUState"><code>FMUState</code></a> and copies this data in to the byte vector <code>serializedState</code> of length <code>size</code>, that must be provided by the environment.</p>
</div>
<div id="fmi3DeserializeFMUState" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3DeserializeFMUState</code></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3DeserializeFMUStateTYPE   (fmi3Instance instance,
                                                  const fmi3Byte serializedState[],
                                                  size_t size,
                                                  fmi3FMUState* FMUState);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function deserializes the byte vector <code>serializedState</code> of length <code>size</code>, constructs a copy of the FMU state and returns <a href="#FMUState"><code>FMUState</code></a>, the pointer to this copy.</p>
</div>
<div class="paragraph">
<p>These serialization and deserialization functions may be called, only if the capability flags <a href="#canGetAndSetFMUState"><code>canGetAndSetFMUState</code></a> and <a href="#canSerializeFMUState"><code>canSerializeFMUState</code></a> are set to <code>true</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Clock"><a class="link" href="#Clock">2.2.8. Clocks</a></h4>
<div class="paragraph">
<p>This specification defines the behavior of clocked FMUs, it does not specify how the importer uses this functionality.
This allows different use cases to be implemented with different Clock semantics.</p>
</div>
<div class="sect4">
<h5 id="_motivation"><a class="link" href="#_motivation">2.2.8.1. Motivation</a></h5>
<div class="paragraph">
<p>Clock variables synchronize events between importer and across FMUs, by</p>
</div>
<div class="ulist">
<ul>
<li>
<p>communicating exactly which specific event happens (using <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a> in ME and CS or <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in SE) and</p>
</li>
<li>
<p>exactly at which time instant, independent from continuous time specified by the arguments of <a href="#fmi3SetTime"><code>fmi3SetTime</code></a> or <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clocks define <a href="#clocked-variable">model partitions</a> effecting only <a href="#clocked-variable">clocked variables</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="fmi3Clock"><a class="link" href="#fmi3Clock">2.2.8.2. Clock Types</a></h5>
<div class="paragraph">
<p>Clocks are <a href="#discrete"><code>discrete</code></a> <a href="#fmu-variables">variables</a> of type <code>fmi3Clock</code>.
They are restricted to being scalar variables.</p>
</div>
<div class="paragraph">
<p>The variable&#8217;s attribute <a href="#intervalVariability"><code>intervalVariability</code></a> declares the type of Clock, see overview in <a href="#table-overview-clocks">Table 5</a>.
After <a href="#table-overview-clocks">Table 5</a> Clock types are explained in more detail.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Input Clock</dt>
</dl>
</div>
<div id="inputClock" class="paragraph">
<p>is a variable of type Clock with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>.
In Model Exchange and Co-Simulation, when input Clocks tick, the importer will activate the input Clocks using <a href="#fmi3SetClock"><code>fmi3SetClock</code></a>.
In Scheduled Execution, when input Clocks tick, the importer will activate the associated model partitions (but not the input Clocks) using <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.
While the importer is the source of the actual Clock activations, the timing of the Clocks is defined by the FMU, either through the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> or calling <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a>, or by another Clock connected to a <a href="#triggered"><code>triggered</code></a> input Clock.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Output Clock</dt>
</dl>
</div>
<div id="outputClock" class="paragraph">
<p>is a variable of type Clock with <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a>.</p>
</div>
<div class="paragraph">
<p>The attribute <a href="#intervalVariability"><code>intervalVariability</code></a> must be <a href="#triggered"><code>triggered</code></a> for <a href="#outputClock">output Clocks</a>.
The importer calls <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> to inquire the Clock&#8217;s activation state.</p>
</div>
<table id="table-overview-clocks" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Overview of Clock types.</caption>
<colgroup>
<col style="width: 7.317%;">
<col style="width: 7.317%;">
<col style="width: 13.0081%;">
<col style="width: 7.317%;">
<col style="width: 32.5203%;">
<col style="width: 32.5206%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top" colspan="2" rowspan="2"><p class="tableblock">Clock properties</p></th>
<th class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">XML attributes</p></th>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Related API calls</p></th>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Example</p></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><a href="#causality"><code>causality</code></a></p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock"><a href="#intervalVariability"><code>intervalVariability</code></a></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock"><a href="#time-based-clock">time-based</a></p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><a id="periodic-clock"></a>periodic</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>constant</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="constant-clock"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> and <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clocked PI-controller with a defined constant interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fixed</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="fixed-clock"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <a href="#intervalDecimal"><code>intervalDecimal</code></a> is defined, <a href="#fmi3SetInterval"><code>fmi3SetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>,</p>
</li>
<li>
<p>if <a href="#intervalDecimal"><code>intervalDecimal</code></a> is not defined, <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> and <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clocked PI-controller with directly or indirectly adaptable interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tunable</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="tunable-clock"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <a href="#intervalDecimal"><code>intervalDecimal</code></a> is defined, <a href="#fmi3SetInterval"><code>fmi3SetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a> and in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a></p>
</li>
<li>
<p>if <a href="#intervalDecimal"><code>intervalDecimal</code></a> is not defined, <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a> and in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clocked PI-controller with directly or indirectly tunable interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><a id="aperiodic-clock"></a>aperiodic</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>changing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="changing-aperiodic-clock"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in both <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> if and only if this Clock ticked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simulation of the behavior of a control algorithm with variable execution time, generation of pulse sequences</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>countdown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="countdown-aperiodic-clock"></a><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>,
<a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, in every <a href="#EventMode"><strong>Event Mode</strong></a> and in every <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a>.
In Scheduled Execution the FMU must inform the importer by calling <a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a> that the Clock is about to tick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time-delayed actions after an event, for example, ignition signal some time after specific crank shaft angle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2" rowspan="3"><p class="tableblock"><a id="triggered"></a><a href="#triggered-clock">triggered</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>triggered</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>,
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">triggered by a hardware interrupt of an embedded system, e.g. a control algorithm, triggered by a crankshaft angle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#output"><code>output</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>triggered</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetClock"><code>fmi3GetClock</code></a> in both <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">crankshaft angle sensor ticking several times per revolution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#local"><code>local</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>triggered</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetClock"><code>fmi3GetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e.g. a clock inside a composed FMU that can be used only for debugging</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1"><a id="time-based-clock"></a>Time-based Clock</dt>
<dd>
<p>is predictable and allows the importer to take its Clock ticks into account a priori.
Time-based Clocks are input Clocks because the importer calls <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> or <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> on these Clocks.
The importer queries the FMU about when a time-based Clock should tick.
The importer must activate the Clock by calling <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> or <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.</p>
<div class="paragraph">
<p>The mathematical descriptions of time-based Clocks uses the following notations:</p>
</div>
<table id="table-notation-description" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Mathematical Notation Description.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_0\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time instant when the Clock ticks the first time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_{i-1}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The previous time instant, when the Clock ticked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(T_{\mathit{shift}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The delay for the first Clock tick relative to \(t_{\mathit{start}}\). \(T_{\mathit{shift}}\) is defined differently for the different Clock types, and can be set with <a href="#fmi3SetShiftDecimal"><code>fmi3SetShiftDecimal</code></a> or retrieved from the FMU with <a href="#fmi3GetShiftDecimal"><code>fmi3GetShiftDecimal</code></a> as floating point value, or as rational number using <a href="#fmi3SetShiftFraction"><code>fmi3SetShiftFraction</code></a> or <a href="#fmi3GetShiftFraction"><code>fmi3GetShiftFraction</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(T_{\mathit{interval, i}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval until the next Clock tick, defined differently for the different Clock types.
\(T_{\mathit{interval, i}}\) can be set with <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> or retrieved with <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> as floating point value, or as rational number using <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a> or <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_{\mathit{event}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current event time in <a href="#EventMode"><strong>Event Mode</strong></a>, or the current time in Scheduled Execution.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Periodic Clock</dt>
<dd>
<p>is a time-based Clock with a constant interval, except when <a href="#intervalVariability"><code>intervalVariability</code></a> = <a href="#tunable"><code>tunable</code></a>, which indicates that the interval can change when tunable <a href="#parameter">parameters</a> change.
The time instant of the first Clock tick is defined by a <a href="#shiftCounter"><code>shiftCounter</code></a> or <a href="#shiftDecimal"><code>shiftDecimal</code></a>.</p>
<div class="paragraph">
<p>The next Clock tick at time instant \(t_i\) is defined as:<br>
\(\begin{align*}
t_0 &amp;:= t_{\mathit{start}} + T_{\mathit{shift}} \\
t_i &amp;:= t_{i-1} + T_{\mathit{interval, i}} \qquad i = 1,2,3,{...}
\end{align*}\)</p>
</div>
<table id="periodic-clock-restrictions" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Restrictions.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(T_{\mathit{interval, i}} &gt; 0\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval from the previous Clock tick to the current Clock tick, specified differently for the different Clock types.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Constant periodic Clock</dt>
<dd>
<p>is a time-based periodic clock that defines its <a href="#intervalDecimal"><code>intervalDecimal</code></a> and optionally <a href="#intervalCounter"><code>intervalCounter</code></a>, <a href="#shiftCounter"><code>shiftCounter</code></a> and <a href="#shiftDecimal"><code>shiftDecimal</code></a> in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</p>
</dd>
<dt class="hdlist1">Fixed periodic Clock</dt>
<dd>
<p>is a time-based periodic Clock which ticks with an arbitrary, but fixed interval \(T_{\mathit{interval}}\) starting after an arbitrary \(T_{\mathit{shift}}\), both interval and shift can be changed by the importer.</p>
<div class="paragraph">
<p>If <a href="#intervalDecimal"><code>intervalDecimal</code></a> is specified, the importer sets the Clock&#8217;s <code>fixed</code> interval using <a href="#fmi3SetInterval"><code>fmi3SetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.
If the function is not called the value given in <a href="#intervalDecimal"><code>intervalDecimal</code></a> and <a href="#intervalCounter"><code>intervalCounter</code></a> is used.</p>
</div>
<div class="paragraph">
<p><em>[Calling <a href="#fmi3SetInterval"><code>fmi3SetInterval</code></a> informs the FMU about the interval determined by the importer to enable the FMU to adapt internal computations to this <code>fixed</code> interval.]</em></p>
</div>
<div class="paragraph">
<p>If <a href="#intervalDecimal"><code>intervalDecimal</code></a> is not specified, then the importer must use <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> and <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> to retrieve the Clock interval and shift in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> because they depend on <a href="#fixed"><code>fixed</code></a> <a href="#parameter">parameters</a>.</p>
</div>
</dd>
<dt class="hdlist1">Tunable periodic Clock</dt>
<dd>
<p>is a time-based periodic Clock which ticks with an arbitrary and changeable interval \(T_{\mathit{interval}}\) starting after an arbitrary \(T_{\mathit{shift}}\), both interval and shift can be changed by the importer.</p>
<div class="paragraph">
<p>If <a href="#intervalDecimal"><code>intervalDecimal</code></a> is specified, the importer sets the Clock&#8217;s <code>tunable</code> interval using <a href="#fmi3SetInterval"><code>fmi3SetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.
It can later change this interval in <a href="#EventMode"><strong>Event Mode</strong></a> or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>.
If the function is not called, the value given in <a href="#intervalDecimal"><code>intervalDecimal</code></a> and <a href="#intervalCounter"><code>intervalCounter</code></a> is used by the importer.</p>
</div>
<div class="paragraph">
<p><em>[Calling <a href="#fmi3SetInterval"><code>fmi3SetInterval</code></a> informs the FMU about the interval determined by the importer to enable the FMU to adapt internal computations to this <code>tunable</code> interval.]</em></p>
</div>
<div class="paragraph">
<p>If <a href="#intervalDecimal"><code>intervalDecimal</code></a> is not specified, then the importer must use <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> to retrieve the Clock interval in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, and later in <a href="#EventMode"><strong>Event Mode</strong></a> or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>, if any of the <a href="#tunable"><code>tunable</code></a> <a href="#parameter">parameters</a> the Clock&#8217;s interval depends on was changed.
The shift may only depend on <a href="#fixed"><code>fixed</code></a> <a href="#parameter">parameters</a>.
The importer must use <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> to retrieve the Clock shift in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</div>
</dd>
<dt class="hdlist1">Aperiodic Clock</dt>
<dd>
<p>is a time-based Clock with an interval that can change during runtime by FMU-internal mechanisms.
Calling <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> or <a href="#fmi3SetShift"><code>fmi3SetShift</code></a> is not allowed.</p>
</dd>
<dt class="hdlist1">Changing aperiodic Clock</dt>
<dd>
<p>is a time-based Clock whose next interval is unchangeably known right after the Clock just ticked.</p>
<div class="paragraph">
<p>The next Clock tick at time instant \(t_i\) is defined as:<br>
\(\begin{align*}
t_0 &amp;:= t_{\mathit{start}} + T_{\mathit{interval, 0}} \\
t_i &amp;:= t_{i-1} + T_{\mathit{interval, i}} \qquad i = 1,2,3,{...}
\end{align*}\)</p>
</div>
<table id="changing-clock-restrictions" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Restrictions.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(T_{\mathit{interval, 0}} \geq 0\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval from \(t_{\mathit{start}}\) to first Clock tick.
Must be retrieved using <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(T_{\mathit{interval, i}} \geq 0, \qquad i = 1,2,3,{...}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval from the current Clock tick to the next Clock tick.
Must be retrieved using <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a> or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> if and only if the corresponding Clock ticked.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Countdown aperiodic Clock</dt>
<dd>
<p>is a time-based Clock whose next interval is not yet known right after the Clock just ticked, forcing the importer to call <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, in every <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a>.
The return argument <a href="#qualifiers"><code>qualifiers</code></a> of <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> is used to indicate if the next interval is already known.</p>
<div class="paragraph">
<p>The next Clock tick at time instant \(t_i\) is defined as:<br>
\(\begin{align*}
t_0 &amp;:= t_{\mathit{start}} + T_{\mathit{interval, 0}} \\
t_i &amp;:= t_{\mathit{event}} + T_{\mathit{interval, i}} \qquad i = 1,2,3,{...}
\end{align*}\)</p>
</div>
<table id="countdown-clock-restrictions" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Restrictions.</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(T_{\mathit{interval, 0}} \geq 0\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval from \(t_{\mathit{start}}\) to the first Clock tick.
Must be retrieved using <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(T_{\mathit{interval, i}} \geq 0, \qquad i = 1,2,3,{...}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time interval starting at the current <a href="#EventMode"><strong>Event Mode</strong></a> or <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a> when <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> is called.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1"><a id="triggered-clock"></a>Triggered Clock</dt>
<dd>
<p>ticks unpredictably.</p>
</dd>
<dt class="hdlist1">Triggered input Clock</dt>
<dd>
<p>is activated with <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> by the importer in <a href="#EventMode"><strong>Event Mode</strong></a>, or triggers activation of the associated model partition with <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>.</p>
</dd>
<dt class="hdlist1">Triggered output Clock</dt>
<dd>
<p>is activated within the FMU and the importer must call <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a> or in <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a>.</p>
</dd>
<dt class="hdlist1">Triggered local Clock</dt>
<dd>
<p>is activated within the FMU and the importer must call <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> in <a href="#EventMode"><strong>Event Mode</strong></a>.
Only local variables can be clocked variables of local Clocks.
Like all local variables, local Clocks must not be used as inputs to other FMUs and must not be listed in the <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.
This clock type is not allowed in Scheduled Execution.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>[<a href="#outputClock">Output Clocks</a> enable an FMU to provide a trigger to the outside world, e.g. to a <a href="#triggered">triggered input Clock</a> of another FMU.</em><br>
<em>If an FMU wants to actively trigger a model partition (Clock) of itself, it should use a <a href="#countdown-aperiodic-clock">countdown Clock</a>.</em>
<em>An example is provided in <a href="#example-scheduled-execution">Section 5.3</a>.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="clocked-variable"><a class="link" href="#clocked-variable">2.2.8.3. Model Partitions and Clocked Variables</a></h5>
<div class="paragraph">
<p>Each Clock \(k\) induces a discrete subsystem.
Its state advances at each tick of \(k\).
Such a system, also called the <a href="#model-partition">model partition</a> of \(k\), may represent a part of control code, an interrupt service routine of an embedded system, or a discretized part of a plant model.</p>
</div>
<div class="paragraph">
<p>A model partition is written as:</p>
</div>
<div class="paragraph">
<p>\(\begin{align*}
(\mathbf{x}_k) &amp;:= \mathbf{f}_{\mathit{disc}}(^\bullet{\mathbf{x}_k}, \mathbf{u}, t) \\
(\mathbf{y}_k) &amp;:= \mathbf{f}_{\mathit{event}}(\mathbf{x}_k, \mathbf{u}, t)
\end{align*}\)</p>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\mathbf{f}_{\mathit{disc}}\) denotes the state transition function and</p>
</li>
<li>
<p>\(\mathbf{f}_{\mathit{event}}\) denotes the output function of the <a href="#model-partition">model partition</a> of \(k\).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When \(k\) is active (i.e., ticking) invoking the FMI functions <code>fmi3Get{VariableType}</code> on variables in the output vector \(\mathbf{y}_k\) will trigger the execution of the output function \(\mathbf{f}_{\mathit{event}}\) to compute such variables.
If <a href="#providesEvaluateDiscreteStates"><code>providesEvaluateDiscreteStates</code></a> is <code>false</code>, then \(\mathbf{f}_{\mathit{disc}}\) cannot be called explicitly using <a href="#fmi3EvaluateDiscreteStates"><code>fmi3EvaluateDiscreteStates</code></a>, but will be implicitly executed during \(\mathbf{f}_{\mathit{event}}\).
When <a href="#fmi3EvaluateDiscreteStates"><code>fmi3EvaluateDiscreteStates</code></a> is called, the state vector \(\mathbf{x}_k\) is updated according to state transition function \(\mathbf{f}_{\mathit{disc}}\).</p>
</div>
<div class="paragraph">
<p><em>[Separating</em> \(\mathbf{f}_{\mathit{disc}}\) <em>from</em> \(\mathbf{f}_{\mathit{event}}\) <em>allows manipulation of the current (discrete) state and compute the corresponding outputs, for instance for model-based control applications.]</em></p>
</div>
<div class="paragraph">
<p>The discrete-time variables \(\mathbf{x}_k\) and \(\mathbf{y}_k\) are called clocked variables.
Clocked variables \(\mathbf{v}_k\) can acquire new values and can be queried only when their Clock \(k\) is active, except during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.
<em>[This is common in clock semantics, see for example <a href="#MLS12">[MLS12]</a>.]</em>
During <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, if a clocked variable is declared as an <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a>, then it must be initialized as all other discrete variable of the FMU.
Declaring a clocked variable as an <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a> is optional.
Uninitialized clocked variables must be initialized in the corresponding Clock&#8217;s first tick.</p>
</div>
<div class="paragraph">
<p>A <a href="#ClockedState"><code>&lt;ClockedState&gt;</code></a> is a clocked variable belonging to the state vector \(\mathbf{x}_k\), whose value depends on its previous value (i.e., the value computed at the last Clock tick).
Clocked states declare the <a href="#valueReference"><code>valueReference</code></a> of their previous variable using the <a href="#previous"><code>previous</code></a> attribute.</p>
</div>
<div class="paragraph">
<p>The association between <a href="#clocked-variable">clocked variables</a> and their <a href="#Clock">Clocks</a> is defined by the attribute <a href="#clocks"><code>clocks</code></a>.
<a href="#clocked-variable">Clocked variables</a> can depend on multiple Clocks.
<em>[For example, a global counter could be incremented by multiple model partitions, each controlled by a different Clock.]</em></p>
</div>
<div class="paragraph">
<p>Output clocks may depend on input Clocks and other variables.
Such <a href="#dependencies"><code>dependencies</code></a> are declared in the <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.
A Clock \(k\) depends on a Clock or variable \(v\) if a tick or the value of \(v\) may trigger a tick of \(k\) during the same super-dense time instant.</p>
</div>
<div class="paragraph">
<p>Declaring a variable as <a href="#clocked-variable">clocked variable</a> using the <a href="#clocks"><code>clocks</code></a> attribute specifies a <a href="#dependencies">dependency</a> too, but also declares that such a clocked variable can only be <a href="#get-and-set-variable-values">accessed</a> when one of the referenced Clocks is active.
This also holds for <a href="#clocked-variable">clocked variables</a> of type <a href="#Clock">Clock</a>.<br>
<em>[This means that variables referenced by <a href="#clocks"><code>clocks</code></a> and <a href="#dependencies"><code>dependencies</code></a> are not strict subsets of one another because <a href="#clocks"><code>clocks</code></a> may list output Clocks that are not part of the</em> \({\mathbf{v}_{\mathit{known}}}\) <em>.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_clocks_specific_api"><a class="link" href="#_clocks_specific_api">2.2.8.4. Clocks specific API</a></h5>
<div id="fmi3GetClock" class="paragraph">
<p><a id="fmi3SetClock"></a>Clocks are get and set just like any other variable (see also <a href="#get-and-set-variable-values">Section 2.2.7.2</a>).
For restrictions on when to call which of the following functions for <a href="#table-overview-clocks">each Clock type</a>, see <a href="#table-overview-clocks">Table 5</a>.</p>
</div>
<div class="paragraph">
<p><a href="#fmi3SetClock"><code>fmi3SetClock</code></a> must not be called in Scheduled Execution, instead <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> must be called.</p>
</div>
<div id="fmi3SetInterval" class="paragraph">
<p>For <a href="#table-overview-clocks">some Clock types</a>, the interval must be set by the environment for the current time instant by the function <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> or <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a>.
The values of the arguments <a href="#intervals"><code>intervals</code></a>, <a href="#shifts"><code>shifts</code></a>, and <a href="#counters"><code>counters</code></a> / <a href="#resolutions"><code>resolutions</code></a> refer to the unit of the <a href="#independent"><code>independent</code></a> variable.</p>
</div>
<div class="paragraph">
<p>The attribute <a href="#supportsFraction"><code>supportsFraction</code></a> of a Clock declares if the <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a> and/or <code>fmi3GetXXXFraction</code> functions may be called.</p>
</div>
<div id="fmi3SetIntervalDecimal" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetIntervalDecimalTYPE(fmi3Instance instance,
                                              const fmi3ValueReference valueReferences[],
                                              size_t nValueReferences,
                                              const fmi3Float64 intervals[]);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is an array of size <code>nValueReferences</code> holding the value references of the Clock variables.</p>
</li>
</ul>
</div>
<div id="intervals" class="ulist">
<ul>
<li>
<p><a href="#intervals"><code>intervals</code></a> is an array of size <code>nValueReferences</code> holding the Clock intervals to be set.</p>
</li>
</ul>
</div>
<div id="fmi3SetIntervalFraction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetIntervalFractionTYPE(fmi3Instance instance,
                                               const fmi3ValueReference valueReferences[],
                                               size_t nValueReferences,
                                               const fmi3UInt64 counters[],
                                               const fmi3UInt64 resolutions[]);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is an array of size <code>nValueReferences</code> holding the value references of the Clock variables.</p>
</li>
</ul>
</div>
<div id="counters" class="ulist">
<ul>
<li>
<p><a href="#counters"><code>counters</code></a> <em>[Note: This variable may increment by values other than 1.]</em> and</p>
</li>
</ul>
</div>
<div id="resolutions" class="ulist">
<ul>
<li>
<p><a href="#resolutions"><code>resolutions</code></a> are arrays of size <code>nValueReferences</code> holding the Clock <a href="#counters"><code>counters</code></a> and <a href="#resolutions"><code>resolutions</code></a> to be set.</p>
</li>
</ul>
</div>
<div id="fmi3GetInterval" class="paragraph">
<p>For <a href="#table-overview-clocks">other Clock types</a>, the importer must call <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> or <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a> to query the next Clock interval:</p>
</div>
<div id="fmi3GetIntervalDecimal" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetIntervalDecimalTYPE(fmi3Instance instance,
                                              const fmi3ValueReference valueReferences[],
                                              size_t nValueReferences,
                                              fmi3Float64 intervals[],
                                              fmi3IntervalQualifier qualifiers[]);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is an array of size <code>nValueReferences</code> holding the value references of the Clock variables.</p>
</li>
<li>
<p><a href="#intervals"><code>intervals</code></a> is an array of size <code>nValueReferences</code> to retrieve the Clock intervals.</p>
</li>
</ul>
</div>
<div id="qualifiers" class="ulist">
<ul>
<li>
<p><a href="#qualifiers"><code>qualifiers</code></a> is an array of size <code>nValueReferences</code> to retrieve the Clocks <a href="#qualifiers"><code>qualifiers</code></a>.
<a href="#qualifiers"><code>qualifiers</code></a> describes how to treat the <a href="#intervals"><code>intervals</code></a> and <a href="#counters"><code>counters</code></a> arguments and is defined as:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum {
    fmi3IntervalNotYetKnown,
    fmi3IntervalUnchanged,
    fmi3IntervalChanged
} fmi3IntervalQualifier;</code></pre>
</div>
</div>
<div class="paragraph">
<p>with the following meanings:</p>
</div>
<div id="fmi3IntervalChanged" class="ulist">
<ul>
<li>
<p><code>fmi3IntervalChanged</code> is returned to indicate that the value for the interval has changed for this <a href="#Clock">Clock</a>.
Any previously returned intervals (if any) are overwritten with the current value.
The new <a href="#Clock">Clock</a> interval is relative to the time of the current <a href="#EventMode"><strong>Event Mode</strong></a> or <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a> in contrast to the interval of a periodic <a href="#Clock">Clock</a>, where the interval is defined as the time between consecutive <a href="#Clock">Clock</a> ticks.
In Scheduled Execution this means that the corresponding model partition must be scheduled or re-scheduled (if a previous call to <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> returned <a href="#fmi3IntervalChanged"><code>fmi3IntervalChanged</code></a>).</p>
</li>
</ul>
</div>
<div id="fmi3IntervalUnchanged" class="ulist">
<ul>
<li>
<p><code>fmi3IntervalUnchanged</code> is returned if a previous call to <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> already returned a value qualified with <a href="#fmi3IntervalChanged"><code>fmi3IntervalChanged</code></a> which has not changed since.
In Scheduled Execution this means the corresponding model partition has already been scheduled.</p>
</li>
</ul>
</div>
<div id="fmi3IntervalNotYetKnown" class="ulist">
<ul>
<li>
<p><code>fmi3IntervalNotYetKnown</code> is returned for a <a href="#countdown-aperiodic-clock"><code>countdown</code></a> Clock for which the next interval is not yet known.
This qualifier value can only be returned directly after the Clock was active and previous calls to <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> never returned <a href="#fmi3IntervalChanged"><code>fmi3IntervalChanged</code></a> (nor <a href="#fmi3IntervalUnchanged"><code>fmi3IntervalUnchanged</code></a>).
In Scheduled Execution this return value means that the corresponding model partition cannot be scheduled yet.</p>
</li>
</ul>
</div>
<div id="fmi3GetIntervalFraction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetIntervalFractionTYPE(fmi3Instance instance,
                                               const fmi3ValueReference valueReferences[],
                                               size_t nValueReferences,
                                               fmi3UInt64 counters[],
                                               fmi3UInt64 resolutions[],
                                               fmi3IntervalQualifier qualifiers[]);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is an array of size <code>nValueReferences</code> holding the value references of the <code>Clock</code> variables.</p>
</li>
<li>
<p><a href="#counters"><code>counters</code></a> and <a href="#resolutions"><code>resolutions</code></a> are arrays of size <code>nValueReferences</code> to retrieve the Clock intervals as a fraction <code>counters / resolutions</code>.</p>
</li>
<li>
<p><a href="#qualifiers"><code>qualifiers</code></a> is an array of size <code>nValueReferences</code> to retrieve the Clock <a href="#qualifiers"><code>qualifiers</code></a>.</p>
</li>
</ul>
</div>
<div id="shifts" class="paragraph">
<p>For <a href="#table-overview-clocks">some Clock types</a>, the importer must query the delay to the first Clock tick from the FMU using the following functions<a id="fmi3GetShift"></a>:</p>
</div>
<div id="fmi3GetShiftDecimal" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetShiftDecimalTYPE(fmi3Instance instance,
                                           const fmi3ValueReference valueReferences[],
                                           size_t nValueReferences,
                                           fmi3Float64 shifts[]);</code></pre>
</div>
</div>
<div id="fmi3GetShiftFraction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetShiftFractionTYPE(fmi3Instance instance,
                                            const fmi3ValueReference valueReferences[],
                                            size_t nValueReferences,
                                            fmi3UInt64 counters[],
                                            fmi3UInt64 resolutions[]);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is an array of size <code>nValueReferences</code> holding the value references of the Clock variables.</p>
</li>
<li>
<p><a href="#shifts"><code>shifts</code></a> and <a href="#counters"><code>counters</code></a> are arrays of length <code>nValueReferences</code> that define the time of the first Clock tick (see <a href="#shiftCounter"><code>shiftCounter</code></a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For <a href="#table-overview-clocks">other Clock types</a>, the importer may set the delay to the first Clock tick from the FMU using the following functions<a id="fmi3SetShift"></a>:</p>
</div>
<div id="fmi3SetShiftDecimal" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetShiftDecimalTYPE(fmi3Instance instance,
                                           const fmi3ValueReference valueReferences[],
                                           size_t nValueReferences,
                                           const fmi3Float64 shifts[]);</code></pre>
</div>
</div>
<div id="fmi3SetShiftFraction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetShiftFractionTYPE(fmi3Instance instance,
                                            const fmi3ValueReference valueReferences[],
                                            size_t nValueReferences,
                                            const fmi3UInt64 counters[],
                                            const fmi3UInt64 resolutions[]);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is an array of size <code>nValueReferences</code> holding the value references of the Clock variables.</p>
</li>
<li>
<p><a href="#shifts"><code>shifts</code></a> and <a href="#counters"><code>counters</code></a> is an array of length <code>nValueReferences</code> that defines the time of the first Clock tick (see <a href="#shiftCounter"><code>shiftCounter</code></a>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="model-dependencies"><a class="link" href="#model-dependencies">2.2.9. Dependencies of Variables</a></h4>
<div class="paragraph">
<p>Dependencies between variables of an FMU:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>allow the detection and classification of <a href="#algebraic-loops">algebraic loops</a> across inputs and outputs when connecting FMUs,</p>
</li>
<li>
<p>declare the relationship between derivatives and continuous states and other variables,</p>
</li>
<li>
<p>associate event indicators with variables, and</p>
</li>
<li>
<p>define the sparseness when computing <a href="#partial-derivatives">partial derivatives</a>, avoiding unnecessary calls to <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> and <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note, the dependencies between <a href="#clocked-variable">clocked variables</a> and their <a href="#Clock">Clocks</a> are defined by the attribute <a href="#clocks"><code>clocks</code></a> in <code>&lt;fmiModelDescription&gt;&lt;ModelVariables&gt;</code>.
Compared to <a href="#dependencies"><code>dependencies</code></a>, <a href="#clocks"><code>clocks</code></a> declared dependencies also restrict when <a href="#clocked-variable">clocked variables</a> can be <a href="#get-and-set-variable-values">accessed</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="#dependencies"><code>dependencies</code></a> are encoded in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> with the element <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a> and:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>do not resolve to dependencies of individual array elements,</p>
</li>
<li>
<p>do not take changing dependencies due to resizing of arrays via <a href="#structuralParameter"><code>structural parameters</code></a> into account,</p>
</li>
<li>
<p>are independent of the FMUs current operating point and parameter settings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An FMU can indicate via the <code>providesPerElementDependencies</code> capability flag that it is able to provide detailed dependency information at runtime through the following C-API.
The dependency information returned by these functions depend on the current operating point and parameter settings.</p>
</div>
<div class="paragraph">
<p>The number of dependencies of a given variable, which may change if <a href="#structuralParameter"><code>structural parameters</code></a> are changed, can be retrieved by calling the following function:</p>
</div>
<div id="fmi3GetNumberOfVariableDependencies" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNumberOfVariableDependenciesTYPE(fmi3Instance instance,
                                                           fmi3ValueReference valueReference,
                                                           size_t* nDependencies);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of <a href="#dependencies"><code>dependencies</code></a> for a given variable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valueReference</code> specifies the <a href="#valueReference"><code>valueReference</code></a> of the variable for which the number of <a href="#dependencies"><code>dependencies</code></a> shall be returned.</p>
</li>
<li>
<p><code>nDependencies</code> points to the <code>size_t</code> variable that will receive the number of <a href="#dependencies"><code>dependencies</code></a>.</p>
</li>
</ul>
</div>
<div id="fmi3GetVariableDependencies" class="paragraph">
<p>The actual <a href="#dependencies"><code>dependencies</code></a> (of type <a href="#dependenciesKind"><code>dependenciesKind</code></a>) may be retrieved by calling the function <a href="#fmi3GetVariableDependencies"><code>fmi3GetVariableDependencies</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum {
    fmi3Independent,
    fmi3Constant,
    fmi3Fixed,
    fmi3Tunable,
    fmi3Discrete,
    fmi3Dependent
} fmi3DependencyKind;

typedef fmi3Status fmi3GetVariableDependenciesTYPE(fmi3Instance instance,
                                                   fmi3ValueReference dependent,
                                                   size_t elementIndicesOfDependent[],
                                                   fmi3ValueReference independents[],
                                                   size_t elementIndicesOfIndependents[],
                                                   fmi3DependencyKind dependencyKinds[],
                                                   size_t nDependencies);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the dependency information for a single variable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dependent</code> specifies the <a href="#valueReference"><code>valueReference</code></a> of the variable for which the dependencies should be returned.</p>
</li>
<li>
<p><code>nDependencies</code> specifies the number of dependencies that the calling environment allocated space for in the result buffers, and should correspond to value obtained by calling <a href="#fmi3GetNumberOfVariableDependencies"><code>fmi3GetNumberOfVariableDependencies</code></a>.</p>
</li>
<li>
<p><code>elementIndicesOfDependent</code> must point to a buffer of <code>size_t</code> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the element index of the dependent variable that dependency information is provided for.
The element indices start with 1. Using the element index 0 means all elements of the variable.
(Note: If an array has more than one dimension the indices are serialized in the same order as defined for values in <a href="#serialization-of-variables">Section 2.2.7.1</a>.)</p>
</li>
<li>
<p><code>independents</code> must point to a buffer of <a href="#fmi3ValueReference"><code>fmi3ValueReference</code></a> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the value reference of the <a href="#independent"><code>independent</code></a> variable that this dependency entry is dependent upon.</p>
</li>
<li>
<p><code>elementIndicesIndependents</code> must point to a buffer of <code>size_t</code> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the element index of the <a href="#independent"><code>independent</code></a> variable that this dependency entry is dependent upon.
The element indices start with 1.
Using the element index 0 means all elements of the variable.
(Note: If an array has more than one dimension the indices are serialized in the same order as defined for values in <a href="#serialization-of-variables">Section 2.2.7.1</a>.)</p>
</li>
<li>
<p><code>dependencyKinds</code> must point to a buffer of <a href="#dependenciesKind"><code>dependenciesKind</code></a> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the enumeration value describing the dependency of this dependency entry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this function is called before the <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> call, it returns the initial dependencies.
If this function is called after the <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> call, it returns the runtime dependencies.
The retrieved dependency information of one variable becomes invalid as soon as a <a href="#structuralParameter"><code>structural parameter</code></a> linked to the variable or to any of its depending variables is set.</p>
</div>
</div>
<div class="sect3">
<h4 id="selective-computation"><a class="link" href="#selective-computation">2.2.10. Selective Computation of Variables</a></h4>
<div class="paragraph">
<p>Depending on the phase of the solver algorithm, different FMU variables need to be computed.
FMI allows selective retrieval of FMU variables with specific get functions (e.g. <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a>, <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>, <a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a>).
This enables computation on demand with subsequent calls returning the same value until some set operation requires re-computation.</p>
</div>
<div class="paragraph">
<p>For example:
* during the iteration of an integrator step, only the state derivatives need to be computed, provided the <a href="#output"><code>output</code></a> of an FMU is not connected, or
* when localizing <a href="#state-event">state events</a>, only the computation of event indicators may be required.</p>
</div>
<div class="paragraph">
<p>Because specific set functions exist (<a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a>, <a href="#fmi3SetTime"><code>fmi3SetTime</code></a>, <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>), caching algorithms can be applied to reuse already computed values.</p>
</div>
<div class="paragraph">
<p>In all tables describing the mathematical model of a state (e.g. <a href="#table-math-model-exchange">ContinuousTimeMode</a>), for notational convenience one function (e.g. \(\mathbf{f}_{\mathit{cont}}\)) is defined to compute all outputs from all input arguments.
However, in an efficiently implemented FMU, computation of each output may be triggered by its specific get function.
Additionally, the outputs may be a function of a subset of the input arguments, as defined in the <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.</p>
</div>
<div class="paragraph">
<p><em>[The functions above have the slight drawback that values must always be copied.</em>
<em>For example, a call to</em> <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a> <em>provides the new continuous states in a vector.</em>
<em>This function must copy the state values into an internal data structure such that subsequent computations triggered by get functions will utilize these values.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="algebraic-loops"><a class="link" href="#algebraic-loops">2.2.11. Algebraic Loops</a></h4>
<div class="paragraph">
<p>When connecting FMUs, loop structures may occur that lead to linear or nonlinear algebraic systems of equations, involving continuous and discrete-time variables.
In order to detect and solve such systems of equations efficiently, information which <a href="#output"><code>output</code></a> depends directly on which <a href="#input"><code>inputs</code></a> is needed.
This data may be provided in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> under element <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.
If this data is not provided, the worst case must be assumed: all <a href="#output"><code>output</code></a> variables depend algebraically on all <a href="#input"><code>input</code></a> variables.</p>
</div>
<div class="paragraph">
<p><em>[Example: In <a href="#figure-connected-fmus">Figure 6</a> two different types of connected FMUs are shown (the "dotted lines" characterize the dependency information):</em></p>
</div>
<div id="figure-connected-fmus" class="imageblock text-center">
<div class="content">
<img src="images/ArtificialAlgebraicLoops.svg" alt="ArtificialAlgebraicLoops" width="80%">
</div>
<div class="title">Figure 6. Calling sequences for FMUs that are connected in a loop.</div>
</div>
<div class="paragraph">
<p><em>Since different variables are computed in every mode and the causality of variable computation can be different in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> compared to other modes, it might be necessary to solve different kinds of loops in the different modes.</em><br>
<em>Artificial algebraic loops (see left diagram of <a href="#figure-connected-fmus">Figure 6</a>) can be solved in the modes <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a>, and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> by an appropriate sequence of <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> and <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> calls:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    FMU *M1, *M2;
    fmi3ValueReference vr_M1_u, vr_M1_y, vr_M2_u1, vr_M2_u2, vr_M2_y1;
    fmi3Float64 s = 0.1, M2_y1, M1_y, M2_y2;
    // ...
    M2-&gt;fmi3SetFloat64(M2-&gt;instance, &amp;vr_M2_u1, 1, &amp;s, 1);
    M2-&gt;fmi3GetFloat64(M2-&gt;instance, &amp;vr_M2_y1, 1, &amp;M2_y1, 1);
    M1-&gt;fmi3SetFloat64(M1-&gt;instance, &amp;vr_M1_u,  1, &amp;M2_y1, 1);
    M1-&gt;fmi3GetFloat64(M1-&gt;instance, &amp;vr_M1_y,  1, &amp;M1_y, 1);
    M2-&gt;fmi3SetFloat64(M2-&gt;instance, &amp;vr_M2_u2, 1, &amp;M1_y, 1);
    M2-&gt;fmi3GetFloat64(M2-&gt;instance, &amp;vr_M2_y1, 1, &amp;M2_y2, 1);
    //...</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>In the right diagram of <a href="#figure-connected-fmus">Figure 6</a>, FMUs <code>M3</code> and <code>M4</code> are connected in such a way that a real algebraic loop is formed.</em>
<em>This loop might be solved iteratively, for example with a Newton method.</em>
<em>In every iteration the iteration variable <code>s</code> is provided by the solver, and via the shown sequence of <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> and <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> calls, the <code>residual</code> is computed and used by the solver to determine a new value of <code>s</code> as input <code>u</code> of <code>M4</code>.</em>
<em>The iteration is terminated when the <code>residual</code> is small enough.</em>
<em>This method works for <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a>, and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>.</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    FMU *M3, *M4;
    fmi3ValueReference vr_M3_u, vr_M3_y, vr_M4_u, vr_M4_y;
    fmi3Float64 s, M3_y, M4_y, residual, tolerance;
    bool converged = false;

    while (!converged) { // start iteration
        // s determined by the solver
        // ...
        M4-&gt;fmi3SetFloat64(M4-&gt;instance, &amp;vr_M4_u, 1, &amp;s, 1);
        M4-&gt;fmi3GetFloat64(M4-&gt;instance, &amp;vr_M4_y, 1, &amp;M4_y, 1);
        M3-&gt;fmi3SetFloat64(M3-&gt;instance, &amp;vr_M3_u, 1, &amp;M4_y, 1);
        M3-&gt;fmi3GetFloat64(M3-&gt;instance, &amp;vr_M3_y, 1, &amp;M3_y, 1);
        residual = s - M3_y; // provided to the solver
        converged = residual &lt; tolerance;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>In <a href="#StepMode"><strong>Step Mode</strong></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> is required to restore the FMU state before the next iteration with <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a>, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, and <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> is executed.</em></p>
</div>
<div class="paragraph">
<p><em>In <a href="#EventMode"><strong>Event Mode</strong></a>, the algorithms from above must be embedded in an event iteration:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    FMU *M1, *M2;  // structures that hold the functions and instances of the FMUs

    M1-&gt;fmi3EnterEventMode(M1-&gt;instance);
    M2-&gt;fmi3EnterEventMode(M2-&gt;instance);

    // start event iteration
    do {
        // solve algebraic loop as described in the sample codes above

        // introduce new instant of super-dense time
        M1-&gt;fmi3UpdateDiscreteStates(M1-&gt;instance, &amp;M1_DStatesNeedUpdate, p2, p3, p4, p5, p6);
        M2-&gt;fmi3UpdateDiscreteStates(M2-&gt;instance, &amp;M2_DStatesNeedUpdate, p2, p3, p4, p5, p6);

    } while (M1_DStatesNeedUpdate || M2_DStatesNeedUpdate);

    if (isCoSimulation) {
        // Co-Simulation
        M1-&gt;fmi3EnterStepMode(M1-&gt;instance);
        M2-&gt;fmi3EnterStepMode(M2-&gt;instance);
    } else {
        // Model Exchange
        M1-&gt;fmi3EnterContinuousTimeMode(M1-&gt;instance);
        M2-&gt;fmi3EnterContinuousTimeMode(M2-&gt;instance);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>When solving algebraic loops in <a href="#EventMode"><strong>Event Mode</strong></a>, limitations to variable manipulations declared with attribute <a href="#canHandleMultipleSetPerTimeInstant"><code>canHandleMultipleSetPerTimeInstant</code></a> must be observed.</p>
</div>
</div>
<div class="sect3">
<h4 id="partial-derivatives"><a class="link" href="#partial-derivatives">2.2.12. Getting Partial Derivatives</a></h4>
<div class="paragraph">
<p>Partial derivatives can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in Newton algorithms to solve <a href="#algebraic-loops">algebraic loops</a>,</p>
</li>
<li>
<p>in implicit integration algorithms in Model Exchange, and</p>
</li>
<li>
<p>in iterative co-simulation algorithms.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To avoid expensive numeric approximations of these derivatives, FMI offers dedicated functions to retrieve partial derivatives for variables of an FMU.
For Model Exchange, this means computing the partial derivatives at any time instant, whereas for Co-Simulation, this means computing the partial derivatives at a communication point.</p>
</div>
<div class="paragraph">
<p>An FMU has different states and in every state an FMU might be described by different equations and different unknowns.
The precise definitions are given in the mathematical descriptions of Model Exchange (<a href="#state-machine-model-exchange">Section 3.2</a>), Co-Simulation (<a href="#state-machine-co-simulation">Section 4.2</a>), and Scheduled Execution (<a href="#state-machine-scheduled-execution">Section 5.2</a>).
In every state, the general form of the FMU equations is:</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{v}_{\mathit{unknown}} = \mathbf{f}(\mathbf{v}_{\mathit{known}}, \mathbf{v}_{\mathit{rest}}),\]
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\mathbf{v}_{\mathit{unknown}}\) is the vector of unknown variables computed in the current state:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#InitializationMode"><strong>Initialization Mode</strong></a>: The exposed unknowns listed as elements <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a> in <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a> that have a floating point type.</p>
</li>
<li>
<p><a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> (Model Exchange): The continuous-time outputs and state derivatives (= the variables listed as elements <a href="#Output"><code>&lt;Output&gt;</code></a> of <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a> with a floating point type and <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a> and the variables listed as elements <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a> in <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>).</p>
</li>
<li>
<p><a href="#EventMode"><strong>Event Mode</strong></a> (Model Exchange): The same variables as in the <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> and additionally variables listed as elements <a href="#Output"><code>&lt;Output&gt;</code></a> of <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a> with a floating point type and <a href="#variability"><code>variability</code></a> = <a href="#discrete"><code>discrete</code></a>.</p>
</li>
<li>
<p><a href="#StepMode"><strong>Step Mode</strong></a> (Co-Simulation): The variables listed as elements <a href="#Output"><code>&lt;Output&gt;</code></a> of <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a> with a floating point type and <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a> or <a href="#discrete"><code>discrete</code></a>.
Each continuous state derivative variable listed as elements <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a> in <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>, if present.</p>
</li>
</ul>
</div>
</li>
<li>
<p>\(\mathbf{v}_{\mathit{known}}\) is the vector of <a href="#input"><code>input</code></a> variables of function \(\mathbf{f}\) which can be changed by the importer in the current state.
Details about which variables are in \(\mathbf{v}_{\mathit{known}}\) are given in the description of element <a href="#dependencies"><code>dependencies</code></a> in <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.</p>
</li>
<li>
<p>\({\mathbf{v}_{\mathit{rest}}}\) is the set of <a href="#input"><code>input</code></a> variables and discrete-time states of function \(\mathbf{f}\) which cannot be set by the importer in the current state, but in other states <em>[for example, discrete-time <a href="#input"><code>inputs</code></a> in <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>]</em>.</p>
</li>
<li>
<p><a href="#EventIndicator"><code>EventIndicators</code></a> must not be included among \(\mathbf{v}_{\mathit{unknown}}\).<br>
<em>[This is intentional as their dependencies listed in <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a> are intended for debugging purposes and not for partial derivatives.]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[The variable relationships are different in different states.</em>
<em>For example, during <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>, the partial derivate of a continuous-time output</em> \(\mathbf{y}\) <em>with respect to discrete-time <a href="#input"><code>inputs</code></a> is undefined, because discrete-time <a href="#input"><code>inputs</code></a> cannot be set between events.]</em></p>
</div>
<div class="paragraph">
<p>There are two access functions for partial derivatives:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> to compute the directional derivatives \(\mathbf{v}_{\mathit{sensitivity}} = \mathbf{J} \cdot \mathbf{v}_{\mathit{seed}}\), and</p>
</li>
<li>
<p><a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a> to calculate the adjoint derivatives \(\mathbf{v}_{\mathit{sensitivity}}^T = \mathbf{v}_{\mathit{seed}}^T \cdot \mathbf{J}\)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>with the Jacobian</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{J}
=
\begin{bmatrix}
\frac{\partial g_1}{\partial v_{\mathit{known},1}} &amp; \cdots &amp; \frac{\partial g_1}{\partial v_{\mathit{known},n}} \\
\vdots &amp; \ddots &amp; \vdots \\
\frac{\partial g_m}{\partial v_{\mathit{known},1}} &amp; \cdots &amp; \frac{\partial g_m}{\partial v_{\mathit{known},n}}
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p>where \(\mathbf{v}_{\mathit{known}}\) are the \(n\) knowns, and \(\mathbf{g}\) are the \(m\) functions to calculate the \(m\) unknown variables \(\mathbf{v}_{\mathit{unknwon}}\)  from the knowns.</p>
</div>
<div class="paragraph">
<p>Both functions can also be used to construct the partial derivative matrices.
The functions may only be called if their availability is indicated by the attributes <a href="#providesDirectionalDerivatives"><code>providesDirectionalDerivatives</code></a> and <a href="#providesAdjointDerivatives"><code>providesAdjointDerivatives</code></a>, respectively.</p>
</div>
<div id="fmi3GetDirectionalDerivative" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetDirectionalDerivativeTYPE(fmi3Instance instance,
                                                    const fmi3ValueReference unknowns[],
                                                    size_t nUnknowns,
                                                    const fmi3ValueReference knowns[],
                                                    size_t nKnowns,
                                                    const fmi3Float64 seed[],
                                                    size_t nSeed,
                                                    fmi3Float64 sensitivity[],
                                                    size_t nSensitivity);</code></pre>
</div>
</div>
<div id="fmi3GetAdjointDerivative" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetAdjointDerivativeTYPE(fmi3Instance instance,
                                                const fmi3ValueReference unknowns[],
                                                size_t nUnknowns,
                                                const fmi3ValueReference knowns[],
                                                size_t nKnowns,
                                                const fmi3Float64 seed[],
                                                size_t nSeed,
                                                fmi3Float64 sensitivity[],
                                                size_t nSensitivity);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both functions have the same arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>unknowns</code> contains value references to the unknowns.</p>
</li>
<li>
<p><code>nUnknowns</code> contains the length of argument <code>unknowns</code>.</p>
</li>
<li>
<p><code>knowns</code> contains value references of the knowns.</p>
</li>
<li>
<p><code>nKnowns</code> contains the length of argument <code>knowns</code>.</p>
</li>
<li>
<p><code>seed</code> contains the <a href="#serialization-of-variables">serialized</a> components of the seed vector.</p>
</li>
<li>
<p><code>nSeed</code> contains the length of <code>seed</code>.</p>
</li>
<li>
<p><code>sensitivity</code> contains the <a href="#serialization-of-variables">serialized</a> components of the sensitivity vector.</p>
</li>
<li>
<p><code>nSensitivity</code> contains the length of <code>sensitivity</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[Note that array variables will be serialized, so <code>nSeed</code> is only equal to <code>nKnowns</code> in the case of directional derivatives (resp., equal to <code>nUnknowns</code> in the case of adjoint derivatives) if all value references of <code>knowns</code> (resp., <code>unknowns</code>) point to scalar variables.</em>
<em>Likewise <code>nSensitivity</code> is only equal to <code>nUnknowns</code> (resp., <code>nKnowns</code>) if all value references of <code>unknowns</code> (resp., <code>knowns</code>) point to scalar variables.]</em></p>
</div>
<div class="sect4">
<h5 id="directionDerivatives"><a class="link" href="#directionDerivatives">2.2.12.1. Directional Derivatives</a></h5>
<div id="example-directional-derivatives" class="paragraph">
<p><em>[Example:</em><br>
<em>Assume an FMU has the output equations</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{bmatrix}
y_1
\\
y_2
\end{bmatrix}
=
\begin{bmatrix}
g_1(x, u_1, u_3, u_4)
\\
g_2(x, u_1)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>and this FMU is connected, so that \({y_1, u_1, u_3}\) appear in an algebraic loop.</em>
<em>Then the nonlinear solver needs a Jacobian and this Jacobian can be computed (without numerical differentiation) provided the partial derivative of \({y_1}\) with respect to \({u_1}\) and \({u_3}\) is available.</em>
<em>Depending on the environment where the FMUs are connected, these <a href="#derivative"><code>derivatives</code></a> can be provided:</em></p>
</div>
<div class="paragraph">
<p>(a) <em>with one wrapper function around function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> to compute the directional derivatives with respect to these two variables (in other words, \({v_{\mathit{unknown}} = y_1}\), \({v_{\mathit{known}} = \left \{ u_1, u_3 \right \}}\)), and then the environment calls this wrapper function with \({v_{\mathit{seed}} = \left \{ 1, 0 \right \}}\) to compute the partial derivative with respect to \({u_1}\) and \({v_{\mathit{seed}} = \left \{ 0, 1 \right \}}\) to compute the partial derivative with respect to \({u_3}\), or</em></p>
</div>
<div class="paragraph">
<p>(b) <em>with two direct function calls of <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> (in other words, \({v_{\mathit{unknown}} = y_1, v_{\mathit{known}} = u_1, v_{\mathit{seed}} = 1}\); and \({v_{\mathit{unknown}} = y_1, v_{\mathit{known}} = u_3, v_{\mathit{seed}} = 1}\)).</em></p>
</div>
<div class="paragraph">
<p><em>Note that a direct implementation of this function with analytic derivatives:</em></p>
</div>
<div class="paragraph">
<p>(a) <em>Provides the directional derivative for all <a href="#input"><code>input</code></a> variables; so in the <a href="#example-directional-derivatives">above example</a>: \({\Delta y_1 = \frac{\partial g_1}{\partial x} \cdot \Delta x + \frac{\partial g_1}{\partial u_1} \cdot \Delta u_1 + \frac{\partial g_1}{\partial u_3} \cdot \Delta u_3 + \frac{\partial g_1}{\partial u_4} \cdot \Delta u_4}\)</em></p>
</div>
<div class="paragraph">
<p>(b) <em>Initializes all seed-values to zero; so in the <a href="#example-directional-derivatives">above example</a>: \({\Delta x = \Delta u_1 = \Delta u_3 = \Delta u_4 = 0}\)</em></p>
</div>
<div class="paragraph">
<p>(c) <em>Computes the directional derivative with the seed-values provided in the function arguments; so in the <a href="#example-directional-derivatives">above example</a>: \({v_{\mathit{sensitivity}} = \Delta y_1 (\Delta x = 0, \Delta u_1 = 1, \Delta u_3 = 0, \Delta u_4 = 0)}\)] and \({v_{\mathit{sensitivity}} = \Delta y_1 (\Delta x = 0, \Delta u_1 = 0, \Delta u_3 = 1, \Delta u_4 = 0)}\)]</em></p>
</div>
<div class="paragraph">
<p><em>[Note, function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> can be utilized for the following purposes:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Numerical integrators of stiff methods need matrix \({\frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\).</em></p>
</li>
<li>
<p><em>If the FMU is connected with other FMUs, the partial derivatives of the state derivatives and outputs with respect to the continuous states and the <a href="#input"><code>inputs</code></a> are needed in order to compute the Jacobian for the system of the connected FMUs.</em></p>
</li>
<li>
<p><em>If the FMU shall be linearized, the same <a href="#derivative"><code>derivatives</code></a> as in the previous item are needed.</em></p>
</li>
<li>
<p><em>If the FMU is used as the model for an extended Kalman filter, \({\frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\) and \({\frac{\partial \mathbf{g}}{\partial \mathbf{x}}}\) are needed.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>If a dense matrix shall be computed, the columns of the matrix can be easily constructed by successive calls of <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</em>
<em>For example, constructing the system Jacobian \({\mathbf{J} = \frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\) as dense matrix can be performed in the following way:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    //   c[]      column vector

    // set time, states and inputs
    CALL(FMI3SetTime(S, time));
    CALL(FMI3SetContinuousStates(S, x, nx));
    // fmi3Set{VariableType}(s, ...)

    // if required at this step, compute the Jacobian as a dense matrix
    for (i = 0; i &lt; nx; i++) {
        // construct the Jacobian matrix column wise
        CALL(FMI3GetDirectionalDerivative(S, vr_dx, nx, &amp;vr_x[i], 1, &amp;dk, 1, c, nx));
        for (j = 0; j &lt; nx; j++) {
            J[j][i] = c[j];
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>If the sparsity of a matrix shall be taken into account, then the matrix can be constructed in the following way:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>The incidence information of the matrix (whether an element is zero or not zero) is extracted from the XML file from element <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.</em></p>
</li>
<li>
<p><em>A so called graph coloring algorithm is employed to determine the columns of the matrix that can be computed by one call of <code>fmi3GetDirectionalDerivative</code>.</em></p>
</li>
<li>
<p><em>For the columns determined in (2), one call to <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> is made.</em>
<em>After each such call, the elements of the resulting directional derivative vector are copied into their correct locations of the partial derivative matrix.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>More details and implementational notes are available from <a href="#ABL12">[ABL12]</a>.</em></p>
</div>
<div class="paragraph">
<p><em>Example:</em></p>
</div>
<div class="paragraph">
<p><em>Directional derivatives for higher dimension variables are almost treated in the same way.
Consider, for example, an FMU which calculates its output \({Y}\) by multiplying its 2x2 input \({U}\) with a 3x2 constant gain \({K}\), with</em></p>
</div>
<div class="stemblock">
<div class="content">
\[K=
\begin{bmatrix}
a, b
\\
c, d
\\
e, f
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>The output \({Y=K U}\) is a matrix of size 3x2.</em>
<em>The directional derivative of an output element \({Y(i,j)}\) with respect to the input \({U}\) and the seed \({\Delta U}\) is:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\Delta Y(i,j) =
\frac{\partial Y(i,j)}{\partial U(1,1)} \cdot \Delta U(1,1) +
\frac{\partial Y(i,j)}{\partial U(1,2)} \cdot \Delta U(1,2) +
\frac{\partial Y(i,j)}{\partial U(2,1)} \cdot \Delta U(2,1) +
\frac{\partial Y(i,j)}{\partial U(2,2)} \cdot \Delta U(2,2)\]
</div>
</div>
<div class="stemblock">
<div class="content">
\[\Delta \mathbf{Y} =
\begin{bmatrix}
a \Delta U(1,1)+b \Delta U(2,1), a \Delta U(1,2)+ b \Delta U(2,2)
\\
c \Delta U(1,1)+d \Delta U(2,1), c \Delta U(1,2)+ d \Delta U(2,2)
\\
e \Delta U(1,1)+f \Delta U(2,1), e \Delta U(1,2)+ f \Delta U(2,2)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>To get the directional derivative of \({Y}\) with respect to \({U(2,1)}\) the command <code>fmi3GetDirectionalDerivative(m, vr_Y, 1, vr_U, 1, {0.0, 0.0, 1.0, 0.0}, 4, dd, 6)</code> can be used where <code>vr_Y</code> and <code>vr_U</code> are references of the variable \({Y}\) and \({U}\), respectively.</em>
<em>Note that in order to get the directional derivative of \({Y}\) with respect to \({U(2,1)}\), the seed value <code>{0, 0, 1.0, 0}</code> has been used.</em>
<em>The retrieved directional derivative <code>dd</code> is stored in a matrix of size 3x2, so <code>nSensitivity</code> is 6.</em></p>
</div>
</div>
<div class="sect4">
<h5 id="adjointDerivatives"><a class="link" href="#adjointDerivatives">2.2.12.2. Adjoint Derivatives</a></h5>
<div class="paragraph">
<p><em>[Adjoint derivatives are beneficial in several contexts:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>in artificial intelligence (AI) frameworks the adjoint derivatives are called "vector gradient products" (VJPs).</em>
<em>There adjoint derivatives are used in the backpropagation process to perform gradient-based optimization of parameters using reverse mode automatic differentiation (AD), see, e.g., <a href="#BPRS15">[BPRS15]</a>.</em></p>
</li>
<li>
<p><em>in parameter estimation (see <a href="#BKF17">[BKF17]</a>)</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Typically, reverse mode automatic differentiation (AD) is more efficient for these use cases than forward mode AD, as explained in the cited references.</em></p>
</div>
<div class="paragraph">
<p><em>If one would like to construct the full Jacobian matrix, one can use either <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> (to column-wise construct it) or <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a> (to row-wise construct it, possibly improved with coloring methods as mentioned above).</em>
<em>However in the applications motivating the adjoint derivatives, one does not need the full Jacobian matrix \(\mathbf{J}\), but vector  \(\mathbf{v}^T\) multiplied from the left to the Jacobian, i.e. \(\mathbf{v}^T\mathbf{J}\).</em>
<em>For computing the full Jacobian matrix, the column-wise construct is generally more efficient.]</em></p>
</div>
<div class="paragraph">
<p><em>Example:</em><br>
<em>Assume an FMU has the output equations</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{bmatrix}
y_1
\\
y_2
\end{bmatrix}
=
\begin{bmatrix}
g_1(u_1, u_2)
\\
g_2(u_1, u_2)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>and \(\left( w_1,  w_2 \right)^T \cdot \mathbf{ \frac{\partial g}{\partial u} }\) for some vector \(\left( w_1,  w_2 \right)^T\) is needed.</em>
<em>Then one can get this with one function call of <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a> (with arguments</em> \(\mathbf{v}_{\mathit{unknown}} = \text{valueReferences of} \left \{ y_1, y_2 \right \},  \mathbf{v}_{\mathit{known}} = \text{valueReferences of} \left \{ u_1, u_2 \right \},  \mathbf{v}_{\mathit{seed}} = \left( w_1, w_2 \right)^T\) <em>), while with <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> at least two calls would be necessary to first construct the Jacobian column-wise and then multiplying from the right with</em> \(\left( w_1,  w_2 \right)^T\) <em>.</em></p>
</div>
<div class="paragraph">
<p><em>If a dense matrix shall be computed, the rows of the matrix can be easily constructed by successive calls of <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</em>
<em>For example, constructing the system Jacobian \({\mathbf{J} = \frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\) as a dense matrix can be performed in the following way:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    for (i = 0; i &lt; nx; i++) {
        // construct the Jacobian matrix column wise
        CALL(FMI3GetAdjointDerivative(S, &amp;vr_dx[i], 1, vr_x, nx, &amp;dk, 1, &amp;J[i][0], nx));
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common-state-machine"><a class="link" href="#common-state-machine">2.3. State Machine and Semantics</a></h3>
<div class="paragraph">
<p>To define allowed calling sequences of FMI functions, state machines are used.
Each state of the state machine corresponds to a certain phase of a simulation.
All interface types share a number of states in their respective state machines.
This chapter describes these common states used in at least two of the interface types.
State-machine states specific to a single interface type will be described in their respective chapters.</p>
</div>
<div id="each-state-description" class="paragraph">
<p>Each state description lists the governing equations and actions and the corresponding API functions influencing these equations in a table (not defining the calling order), and also lists the allowed function calls and usage restrictions.</p>
</div>
<div id="figure-common-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/state-machines-common-states.svg" alt="state machines common states" width="80%">
</div>
<div class="title">Figure 7. Common calling sequence for C functions of common states for at least two of the interface types.</div>
</div>
<div class="paragraph">
<p>The state machine is given here as UML 2.0 state machine.
If a transition is labeled with one or more function names (for example, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>), the transition is taken if the function call returns successfully (not <code>NULL</code> for <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a> or <a href="#fmi3OK"><code>fmi3OK</code></a> and <a href="#fmi3Warning"><code>fmi3Warning</code></a> for all other functions).
This way, importer and FMU can determine in which state the FMU is.</p>
</div>
<div class="sect3">
<h4 id="FMUStateSettable"><a class="link" href="#FMUStateSettable">2.3.1. Super State: FMU State Settable</a></h4>
<div class="paragraph">
<p>The state <a href="#FMUStateSettable"><strong>FMU State Settable</strong></a> is entered when any of the following functions is called: <a href="#fmi3InstantiateModelExchange"><code>fmi3InstantiateModelExchange</code></a>, <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> and <a href="#fmi3InstantiateScheduledExecution"><code>fmi3InstantiateScheduledExecution</code></a>.
The state is left by either calling <a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a> or when any of the functions called during <a href="#FMUStateSettable"><strong>FMU State Settable</strong></a> returns <a href="#fmi3Fatal"><code>fmi3Fatal</code></a>.
If any function called in super state <a href="#FMUStateSettable"><strong>FMU State Settable</strong></a> returns <a href="#fmi3Error"><code>fmi3Error</code></a>, the FMU enters state <a href="#Terminated"><strong>Terminated</strong></a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls to enter this Super State</dt>
</dl>
</div>
<div id="fmi3InstantiateModelExchange" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3InstantiateModelExchange</code></dt>
<dd>
<p>This function instantiates a Model Exchange FMU (see <a href="#fmi-for-model-exchange">Section 3</a>).
It is allowed to call this function only if <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> includes a <code>&lt;ModelExchange&gt;</code> element.</p>
</dd>
</dl>
</div>
<div id="fmi3InstantiateCoSimulation" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3InstantiateCoSimulation</code></dt>
<dd>
<p>This function instantiates a Co-Simulation FMU (see <a href="#fmi-for-co-simulation">Section 4</a>).
It is allowed to call this function only if <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> includes a <code>&lt;CoSimulation&gt;</code> element.</p>
</dd>
</dl>
</div>
<div id="fmi3InstantiateScheduledExecution" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3InstantiateScheduledExecution</code></dt>
<dd>
<p>This function instantiates a Scheduled Execution FMU (see <a href="#fmi-for-scheduled-execution">Section 5</a>).
It is allowed to call this function only if <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> includes a <code>&lt;ScheduledExecution&gt;</code> element.</p>
<div id="fmi3Instantiate" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Instance fmi3InstantiateModelExchangeTYPE(
    fmi3String                 instanceName,
    fmi3String                 instantiationToken,
    fmi3String                 resourcePath,
    fmi3Boolean                visible,
    fmi3Boolean                loggingOn,
    fmi3InstanceEnvironment    instanceEnvironment,
    fmi3LogMessageCallback     logMessage);

typedef fmi3Instance fmi3InstantiateCoSimulationTYPE(
    fmi3String                     instanceName,
    fmi3String                     instantiationToken,
    fmi3String                     resourcePath,
    fmi3Boolean                    visible,
    fmi3Boolean                    loggingOn,
    fmi3Boolean                    eventModeUsed,
    fmi3Boolean                    earlyReturnAllowed,
    const fmi3ValueReference       requiredIntermediateVariables[],
    size_t                         nRequiredIntermediateVariables,
    fmi3InstanceEnvironment        instanceEnvironment,
    fmi3LogMessageCallback         logMessage,
    fmi3IntermediateUpdateCallback intermediateUpdate);

typedef fmi3Instance fmi3InstantiateScheduledExecutionTYPE(
    fmi3String                     instanceName,
    fmi3String                     instantiationToken,
    fmi3String                     resourcePath,
    fmi3Boolean                    visible,
    fmi3Boolean                    loggingOn,
    fmi3InstanceEnvironment        instanceEnvironment,
    fmi3LogMessageCallback         logMessage,
    fmi3ClockUpdateCallback        clockUpdate,
    fmi3LockPreemptionCallback     lockPreemption,
    fmi3UnlockPreemptionCallback   unlockPreemption);</code></pre>
</div>
</div>
<div class="paragraph">
<p>These functions return a new instance of an FMU with the respective interface type.
If a NULL pointer is returned, then instantiation failed.
In that case, the FMU must call <a href="#logMessage"><code>logMessage</code></a> with detailed information about the reason.
An FMU can be instantiated many times (provided capability flag <code>canBeInstantiatedOnlyOncePerProcess = false</code>).</p>
</div>
<div class="paragraph">
<p>The arguments of the instantiation functions are detailed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceName</code> is a unique identifier for the FMU instance.
It is used to name the instance, for example, in error or information messages generated by one of the <code>fmi3XXX</code> functions.
The argument <code>instanceName</code> must be a non empty string (in other words, must have at least one character that is not a white space).
<em>[If only one FMU is simulated, either the attribute <code>modelName</code> of <a href="#fmiModelDescription"><code>&lt;fmiModelDescription&gt;</code></a> or the attribute <a href="#modelIdentifier"><code>modelIdentifier</code></a> of <code>&lt;ModelExchange|CoSimulation|ScheduledExecution&gt;</code> can be used as <code>instanceName</code>.]</em></p>
</li>
<li>
<p><a href="#instantiationToken"><code>instantiationToken</code></a> can be used by the FMU to check that the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file (see <a href="#fmu-distribution">Section 2.5</a>) is compatible with the implementation of the FMU.
It is an opaque string generated by the FMU exporter that is stored in the xml file as mandatory attribute <a href="#instantiationToken"><code>instantiationToken</code></a> (see <a href="#fmiModelDescription"><code>&lt;fmiModelDescription&gt;</code></a>).
It must be passed unchanged to the FMU.
This argument must not be a NULL pointer.</p>
</li>
<li>
<p><a id="resourcePath"></a> <code>resourcePath</code> is the absolute file path (with a trailing file separator) of the <code>resources</code> directory of the extracted FMU archive.<br>
<em>[Example: An FMU is extracted to the directory <code>C:\temp\MyFMU</code>, then <a href="#resourcePath"><code>resourcePath</code></a> = <code>C:\temp\MyFMU\resources\</code>.]</em><br>
<a href="#resourcePath"><code>resourcePath</code></a> must be <code>NULL</code>, if no resource path can be provided to the FMU, which may occur if</p>
<div class="ulist">
<ul>
<li>
<p>the FMU does not contain a <code>resources</code> folder, or</p>
</li>
<li>
<p>the environment is not able to provide the file path to the resources folder <em>[e.g., if the environment does not have a file system.].</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the FMU cannot work without content of the <code>resources</code> folder, <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a> must return NULL.</p>
</div>
</li>
<li>
<p><code>visible = fmi3False</code> defines that the interaction with the user should be reduced to a minimum (no application window, no plotting, no animation, etc.).
In other words, the FMU is executed in batch mode.
If <code>visible = fmi3True</code>, the FMU is executed in interactive mode, and the FMU might require to explicitly acknowledge start of simulation / instantiation / initialization (acknowledgment is non-blocking).</p>
</li>
<li>
<p><a id="loggingOn"></a> If <code>loggingOn = fmi3False</code>, then any logging is disabled and the <a href="#logMessage"><code>logMessage</code></a> callback function must not be called by the FMU.
If <code>loggingOn = fmi3True</code>, then all <code>&lt;LogCategories&gt;</code> are enabled.
The function <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a> gives more detailed control about enabling specific <code>&lt;LogCategories&gt;</code> (see <a href="#definition-of-log-categories">Section 2.4.5</a>).</p>
</li>
<li>
<p><a id="eventModeUsed"></a>If <code>eventModeUsed = fmi3True</code> the importer can handle events.
The flag may only be <code>fmi3True</code>, if <a href="#hasEventMode"><code>hasEventMode = true</code></a>, otherwise the FMU must raise an error.
For FMUs that have clocks, <code>eventModeUsed = fmi3True</code> is required.</p>
</li>
<li>
<p><a id="earlyReturnAllowed"></a>If <code>earlyReturnAllowed = fmi3True</code> the importer can handle <a href="#early-return">early return</a>.
Only in this case, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> may return with <a href="#earlyReturn"><code>earlyReturn = fmi3True</code></a>.</p>
</li>
<li>
<p><code>instanceEnvironment</code> is a pointer that must be passed to <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a>, <a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a>, and <a href="#logMessage"><code>fmi3LogMessageCallback</code></a> to allow the simulation environment an efficient way to identify the calling FMU.</p>
</li>
<li>
<p><a id="requiredIntermediateVariables"></a> <code>requiredIntermediateVariables</code> is an array of the value references of all <a href="#input"><code>input</code></a> variables that the simulation algorithm intends to set and all <a href="#output"><code>output</code></a> variables it intends to get during intermediate updates.
This set may be empty (<a href="#nRequiredIntermediateVariables"><code>nRequiredIntermediateVariables</code></a> = 0) when the simulation algorithm does not intend to use intermediate update.
Only the variables in <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> may be accessed by the simulation algorithm using <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> and <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> during <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.
All variables referenced in this set must be marked with the attribute <a href="#intermediateUpdate"><code>intermediateUpdate = "true"</code></a> in <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</p>
</li>
<li>
<p><a id="nRequiredIntermediateVariables"></a> <code>nRequiredIntermediateVariables</code> gives the number of entries in <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a>.
If <a href="#nRequiredIntermediateVariables"><code>nRequiredIntermediateVariables</code></a> is zero <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> is not defined.</p>
</li>
<li>
<p><a id="logMessage"></a>Callback function <code>logMessage</code></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void  (*fmi3LogMessageCallback) (fmi3InstanceEnvironment instanceEnvironment,
                                         fmi3Status status,
                                         fmi3String category,
                                         fmi3String message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pointer to a function that is called by the FMU to provide information about its internal status in human readable form.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>status</code> contains the severity of the message, see <code>fmi3Status</code>.
If <a href="#fmi3OK"><code>status = fmi3OK</code></a>, the message is a pure information message.
If a function does not return <a href="#fmi3OK"><code>fmi3OK</code></a>, it must provide the reason by calling <a href="#logMessage"><code>logMessage</code></a> at least once with this <code>status</code>.</p>
</li>
<li>
<p><code>category</code> is the category of the message.
The allowed values for <code>category</code> are defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file via the element <a href="#definition-of-log-categories"><code>&lt;LogCategories&gt;</code></a>.
<a href="#logMessage"><code>logMessage</code></a> must only be called for log categories that were enabled by calls to <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a> or via <a href="#loggingOn"><code>loggingOn = fmi3True</code></a> in <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a>.
If the FMU does not define any log categories, <code>category</code> must be <code>NULL</code>.</p>
</li>
<li>
<p><code>message</code> is a string that contains the message to log. It may contain line-breaks (<code>\n</code>), but should not have a trailing line break.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All string-valued arguments passed by the FMU to the <a href="#logMessage"><code>logMessage</code></a> may be deallocated by the FMU directly after function <a href="#logMessage"><code>logMessage</code></a> returns.
<em>[The simulation environment must therefore create copies of these strings if it needs to access these strings later.]</em><br>
Variables can be referenced in a message with <code>#&lt;ValueReference&gt;#</code>.
If the character <code>#</code> shall be included in the message, it has to be prefixed with <code>#</code>, so <code>#</code> is an escape character.<br>
<em>[Example: The message <code>#1365# must be larger than zero (used in IO channel ##4)</code> might be changed by the <a href="#logMessage"><code>logMessage</code></a> function to <code>body.m must be larger than zero (used in IO channel #4)</code> if <code>body.m</code> is the name of the variable with value reference 1365.]</em></p>
</div>
</li>
<li>
<p>Callback function <code>intermediateUpdate</code><br>
See <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a> for details.</p>
</li>
<li>
<p>Callback function <code>clockUpdate</code><br>
See <a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a> for details.</p>
</li>
<li>
<p>Callback function <a href="#preemption-support"><code>lockPreemption</code></a> and <a href="#preemption-support"><code>unlockPreemption</code></a><br>
See <a href="#preemption-support">Section 5.1.2</a> for details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The arguments <a href="#logMessage"><code>logMessage</code></a>, <a href="#fmi3IntermediateUpdateCallback"><code>intermediateUpdate</code></a>, <a href="#fmi3ClockUpdateCallback"><code>clockUpdate</code></a>, <a href="#preemption-support"><code>lockPreemption</code></a>, and <a href="#preemption-support"><code>unlockPreemption</code></a>, are function pointers provided by the simulation environment to be used by the FMU.
Each of these pointers can be NULL to indicate missing support for the respective functionality.
If such functionality is used anyway, undefined behavior results.
<em>[For example, if <a href="#logMessage"><code>logMessage = NULL</code></a>, calls to <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a> result in undefined behavior of the FMU.</em>
<em>If <a href="#intermediateUpdate"><code>intermediateUpdate = NULL</code></a> and arguments <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables != NULL</code></a> and/or <a href="#nRequiredIntermediateVariables"><code>nRequiredIntermediateVariables != 0</code></a> the behavior of the FMU is undefined.]</em>
Additionally, a pointer to the environment is provided (<code>instanceEnvironment</code>) that needs to be passed to the callback functions <a href="#logMessage"><code>logMessage</code></a>, <a href="#fmi3IntermediateUpdateCallback"><code>intermediateUpdate</code></a>, <a href="#fmi3ClockUpdateCallback"><code>clockUpdate</code></a>, in order that those functions can utilize data from the environment, such as mapping a <a href="#valueReference"><code>valueReference</code></a> to a string, or assigning memory to a certain FMU instance.</p>
</div>
</dd>
<dt class="hdlist1">Allowed Function Calls</dt>
</dl>
</div>
<div id="fmi3SetDebugLogging" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3SetDebugLogging</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetDebugLoggingTYPE(fmi3Instance instance,
                                           fmi3Boolean loggingOn,
                                           size_t nCategories,
                                           const fmi3String categories[]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function controls the debug logging that is output by the FMU via the callback function <a href="#logMessage"><code>logMessage</code></a>.
The FMU must call the <a href="#logMessage"><code>logMessage</code></a> callback function only for <code>categories</code> which are turned on by this function.
If this function is never called, logging for all log categories is allowed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <a href="#loggingOn"><code>loggingOn = fmi3True</code></a>, debug logging is enabled for the log categories specified in <code>categories</code>.
If <a href="#loggingOn"><code>loggingOn = fmi3False</code></a>, debug logging is disabled for the log categories specified in <code>categories</code>.</p>
</li>
<li>
<p><code>nCategories</code> defines the length of the array of argument <code>categories</code>.
If <code>nCategories = 0</code>, <a href="#loggingOn"><code>loggingOn</code></a> applies to all log categories and the value of <code>categories</code> must be NULL.</p>
</li>
<li>
<p><code>categories</code> is an array of <code>nCategories</code> elements.
The importer must only use values specified in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> via element <a href="#definition-of-log-categories"><code>&lt;LogCategories&gt;</code></a> as elements of argument <code>categories</code>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>[For example: If <a href="#logMessage"><code>logMessage</code></a> shall be called only for log category <code>logStatusFatal</code>, two calls are required:</em>
* <em>first, all log categories are turned off using <a href="#loggingOn"><code>loggingOn = fmi3False</code></a> with <code>nCategories = 0</code>, and</em>
* <em>second, only <code>logStatusFatal</code> is placed in <code>categories</code> with <a href="#loggingOn"><code>loggingOn = fmi3True</code></a>.]</em></p>
</div>
<div id="fmi3Reset" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3Reset</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3ResetTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Is called by the environment to reset the FMU after a simulation run.
The FMU goes into the same state as if <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a> would have been called.
All variables have their default values.
Before starting a new run <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> has to be called.</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3FreeInstance" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3FreeInstance</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void fmi3FreeInstanceTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Disposes the given instance, unloads the loaded model, and frees all the allocated memory and other resources that have been allocated by the functions of the FMU interface.
If a NULL pointer is provided for argument <code>instance</code>, the function call is ignored (does not have an effect).</p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a></dt>
<dt class="hdlist1">Function <a href="#fmi3DeserializeFMUState"><code>fmi3DeserializeFMUState</code></a></dt>
<dd>
<p>All these allowed functions are described in <a href="#get-set-fmu-state">Section 2.2.7.4</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="Instantiated"><a class="link" href="#Instantiated">2.3.2. State: Instantiated</a></h4>
<div class="paragraph">
<p>In the state <a href="#Instantiated"><strong>Instantiated</strong></a> the FMU can do one-time initializations and allocate memory.</p>
</div>
<table id="table-math-instantiated" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \((\mathbf{v}_{\mathit{initial=exact}}\) or \(\mathbf{v}_{\mathit{initial=approx}})\) and \(\mathbf{v}_{\mathit{variability \neq constant}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get variable <a href="#start"><code>start</code></a> values as defined in <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>\(t_{\mathit{start}} := (\)<a href="#startTime"><code>startTime</code></a>\(,0)\)</p>
</li>
<li>
<p>Activate initialization equations \(\mathbf{f}_{\mathit{init}}\).</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></dt>
<dd>
<p>This function can be called for variables with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> and with <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a>.
<em>[<a href="#input">Inputs</a> \(\mathbf{u}\), <a href="#parameter">parameters</a> \(\mathbf{p}\) and continuous-time <a href="#state">states</a> \(\mathbf{x}_{c,\mathit{initial=exact}}\) are included here.]</em>
The intention is to set <a href="#start"><code>start</code></a> and guess values for these variables.</p>
</dd>
</dl>
</div>
<div id="fmi3EnterConfigurationMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3EnterConfigurationMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterConfigurationModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the importer needs to change <a href="#structuralParameter"><code>structural parameters</code></a>, it must move the FMU into <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> using <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a>.</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3GetNumberOfContinuousStates" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3GetNumberOfContinuousStates</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNumberOfContinuousStatesTYPE(fmi3Instance instance,
                                                       size_t* nContinuousStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of <a href="#state">continuous states</a>.<br>
This function can only be called in Model Exchange.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>nContinuousStates</code> points to the <code>size_t</code> variable that will receive the number of <a href="#state">states</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The number of <a href="#state">continuous states</a> might change if a variable representing a state has a <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> element that references a <a href="#structuralParameter"><code>structural parameter</code></a> (see <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> and <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>).
<a href="#fmi3GetNumberOfContinuousStates"><code>fmi3GetNumberOfContinuousStates</code></a> must be called after such <a href="#structuralParameter"><code>structural parameters</code></a> changed.
As long as no <a href="#structuralParameter"><code>structural parameters</code></a> changed, the number of states is given in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>, alleviating the need to call this function.</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3GetNumberOfEventIndicators" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3GetNumberOfEventIndicators</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNumberOfEventIndicatorsTYPE(fmi3Instance instance,
                                                      size_t* nEventIndicators);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of <a href="#state-event">event indicators</a>.<br>
This function can only be called in Model Exchange.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>nEventIndicators</code> points to the <code>size_t</code> variable that will receive the number of event indicators.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The initial value of <code>nEventIndicators</code> is the sum of the sizes of the variables referenced by the <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a> elements.
The number of <a href="#state-event">event indicators</a> might change if a variable related to <a href="#state-event">event indicators</a> has a <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> that references a <a href="#structuralParameter"><code>structural parameter</code></a>  (see <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> and <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>).
<a href="#fmi3GetNumberOfEventIndicators"><code>fmi3GetNumberOfEventIndicators</code></a> must be called after such <a href="#structuralParameter"><code>structural parameters</code></a> changed.
As long as no <a href="#structuralParameter"><code>structural parameters</code></a> changed, the number of event indicators is given in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>, alleviating the need to call this function.</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3EnterInitializationMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3EnterInitializationMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterInitializationModeTYPE(fmi3Instance instance,
                                                   fmi3Boolean toleranceDefined,
                                                   fmi3Float64 tolerance,
                                                   fmi3Float64 startTime,
                                                   fmi3Boolean stopTimeDefined,
                                                   fmi3Float64 stopTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changes state to <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="toleranceDefined"></a><code>toleranceDefined</code> and</p>
</li>
<li>
<p><a id="tolerance"></a><code>tolerance</code> depend on the interface type:</p>
<div class="ulist">
<ul>
<li>
<p>Model Exchange: If <a href="#toleranceDefined"><code>toleranceDefined = fmi3True</code></a>, then the model is called with a numerical integration scheme where the step size is controlled by using <a href="#tolerance"><code>tolerance</code></a> for error estimation (usually as relative tolerance).
In such a case all numerical algorithms used inside the model (for example, to solve nonlinear algebraic equations) should also operate with an error estimation of an appropriate smaller relative tolerance.</p>
</li>
<li>
<p>Co-Simulation: If <a href="#toleranceDefined"><code>toleranceDefined = fmi3True</code></a>, then the communication step size of the FMU is controlled by error estimation.
In case the FMU utilizes a numerical integrator with variable step size and error estimation, it is suggested to use <a href="#tolerance"><code>tolerance</code></a> for the error estimation of the integrator (usually as relative tolerance).<br>
An FMU for Co-Simulation might ignore this argument.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="startTime"></a><code>startTime</code> and</p>
</li>
<li>
<p><a id="stopTime"></a><code>stopTime</code> can be used to check whether the model is valid within the given boundaries, or to allocate the necessary memory for storing results.
<a href="#startTime"><code>startTime</code></a> is the <a href="#fixed"><code>fixed</code></a> <a href="#initial"><code>initial</code></a> value of the <a href="#independent"><code>independent</code></a> variable and inherits its unit.</p>
<div class="paragraph">
<p><em>[It is defined with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a> in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</em>
<em>If the <a href="#independent"><code>independent</code></a> variable is <code>time</code>, <a href="#startTime"><code>startTime</code></a> is the starting time of initialization.]</em></p>
</div>
</li>
<li>
<p><a id="stopTimeDefined"></a> If <code>stopTimeDefined = fmi3True</code>, then <a href="#stopTime"><code>stopTime</code></a> is the final value of the <a href="#independent"><code>independent</code></a> variable and inherits its unit.
If the environment tries to compute past <a href="#stopTime"><code>stopTime</code></a>, the FMU has to return <a href="#fmi3Error"><code>fmi3Status = fmi3Error</code></a>.
If <a href="#stopTimeDefined"><code>stopTimeDefined = fmi3False</code></a>, then no final value of the <a href="#independent"><code>independent</code></a> variable is defined and argument <a href="#stopTime"><code>stopTime</code></a> is meaningless.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="InitializationMode"><a class="link" href="#InitializationMode">2.3.3. State: Initialization Mode</a></h4>
<div class="paragraph">
<p>The <a href="#InitializationMode"><strong>Initialization Mode</strong></a> is used by the simulation algorithm to compute consistent initial conditions for the overall system.
Equations are active to determine the initial FMU state, as well as all <a href="#output"><code>outputs</code></a> (and optionally other variables exposed by the exporting tool).
Artificial or real algebraic loops over connected FMUs in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> may be handled by using appropriate numerical algorithms.</p>
</div>
<div class="paragraph">
<p>In <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, the FMU computes initial values at the start time \(t_{\mathit{start}}\) using function \(\mathbf{f}_{\mathit{start}}\), not present in the other modes, for example, equations to define the <a href="#start"><code>start</code></a> value for a <a href="#state">state</a> or for the derivative of a <a href="#state">state</a>.</p>
</div>
<table id="table-math-initializationMode" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(\mathbf{v}_{\mathit{initial=exact}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time <a href="#input"><code>inputs</code></a>  \(\mathbf{u}_{c+d}(t_{\mathit{start}})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{x}_{c+d}, ^{\bullet}\mathbf{x}_d, \mathbf{z}, \mathbf{r}, \mathbf{w}_{c+d}, \mathbf{b}, \mathbf{T}_{\mathit{shift}}, \mathbf{T}_{\mathit{start}}) := \mathbf{f}_{\mathit{init}}(\mathbf{u}_{c+d}, \mathbf{p}, t_{\mathit{start}}, \mathbf{v}_{\mathit{initial=exact}})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a>, <a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a>, <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>, <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>, <a href="#fmi3GetShift"><code>fmi3GetShift</code></a>, <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Evaluate \(\mathbf{f}_{\mathit{init}}\), if no <code>fmi3GetXXX</code> function was called</p>
</li>
<li>
<p>Deactivate initialization equations \(\mathbf{f}_{\mathit{init}}\)</p>
</li>
<li>
<p>Update previous values of <a href="#buffers">buffers</a>: \({}^\bullet\mathbf{b} := \mathbf{b}\)</p>
</li>
<li>
<p>\(t := (t_{\mathit{start}}, 0)\)</p>
</li>
<li>
<p>Model Exchange:</p>
<div class="ulist">
<ul>
<li>
<p>activate event equations \(\mathbf{f}_{\mathit{event}}\)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Co-Simulation:</p>
<div class="ulist">
<ul>
<li>
<p>If <a href="#eventModeUsed"><code>eventModeUsed</code></a> of <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> is <code>fmi3True</code><br>
activate event equations \(\mathbf{f}_{\mathit{event}}\)</p>
</li>
<li>
<p>else<br>
activate doStep equations \(\mathbf{f}_{\mathit{doStep}}\)</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></dt>
<dd>
<p>This function can be called for variables with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> and with <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>.
<em>[<a href="#input">Inputs</a> \(\mathbf{u}\), <a href="#parameter">parameters</a> \(\mathbf{p}\) and continuous-time <a href="#state">states</a> \(\mathbf{x}_{c,\mathit{initial=exact}}\) are included here.]</em></p>
</dd>
<dt class="hdlist1">Functions <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>Getting variables might trigger <a href="#selective-computation">computations</a>.<br>
<em>[For variables not computed by</em> \(\mathbf{f}_{\mathit{init}}\) <em>their <a href="#start"><code>start</code></a> values will be returned.]</em></p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a></dt>
<dd>
<p>See <a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a> for Model Exchange only.</p>
</dd>
</dl>
</div>
<div id="fmi3GetContinuousStates" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3GetContinuousStates</code></dt>
<dd>
<p>In Model Exchange only:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetContinuousStatesTYPE(fmi3Instance instance,
                                               fmi3Float64 continuousStates[],
                                               size_t nContinuousStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Return the current continuous state vector.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Return argument <code>continuousStates</code> contains the values for each <a href="#state">continuous state</a> with the same convention for the order as defined for <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>.</p>
</li>
<li>
<p>Argument <code>nContinuousStates</code> is the size of the <code>continuousStates</code> vector.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="fmi3GetNominalsOfContinuousStates" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3GetNominalsOfContinuousStates</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNominalsOfContinuousStatesTYPE(fmi3Instance instance,
                                                         fmi3Float64 nominals[],
                                                         size_t nContinuousStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Return the nominal values of the continuous <a href="#state">states</a>.
This function can only be called in Model Exchange.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Return argument <code>nominals</code> contains the nominal values for each <a href="#state">continuous state</a> with the same convention for the order as defined for <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>.
If the FMU does not have information about the nominal value of a continuous <a href="#state">state</a> <code>i</code>, a nominal value <code>nominals[i] = 1.0</code> should be returned.
It is required that <code>nominals[i] &gt; 0.0</code>.</p>
</li>
<li>
<p>Argument <code>nContinuousStates</code> is the size of the <code>nominals</code> vector.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This function should always be called after calling function <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>, if <code>nominalsOfContinuousStatesChanged = fmi3True</code>, since then the nominal values of the continuous <a href="#state">states</a> have changed <em>[for example, because the mapping of the continuous <a href="#state">states</a> to variables has changed because of internal <a href="#dynamic-state-selection">dynamic state selection</a>]</em>.</p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a></dt>
<dd>
<p>See <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#fmi3GetShiftDecimal"><code>fmi3GetShiftDecimal</code></a> &amp; <a href="#fmi3GetShiftFraction"><code>fmi3GetShiftFraction</code></a></dt>
<dd>
<p>See <a href="#fmi3GetShift"><code>fmi3GetShift</code></a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> &amp; <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a></dt>
<dd>
<p>See <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#fmi3SetShiftDecimal"><code>fmi3SetShiftDecimal</code></a> &amp; <a href="#fmi3SetShiftFraction"><code>fmi3SetShiftFraction</code></a></dt>
<dd>
<p>See <a href="#fmi3SetShift"><code>fmi3SetShift</code></a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> &amp; <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a></dt>
<dd>
<p>One of these functions must be called for all <a href="#fixed-clock">fixed periodic Clocks</a> and <a href="#tunable-clock">tunable periodic Clocks</a>.</p>
</dd>
</dl>
</div>
<div id="fmi3ExitInitializationMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3ExitInitializationMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3ExitInitializationModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changes the state to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Model Exchange: <a href="#EventMode"><strong>Event Mode</strong></a></p>
</li>
<li>
<p>Co-Simulation:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#eventModeUsed"><code>eventModeUsed = fmi3True</code></a>: <a href="#EventMode"><strong>Event Mode</strong></a></p>
</li>
<li>
<p><a href="#eventModeUsed"><code>eventModeUsed = fmi3False</code></a>: <a href="#StepMode"><strong>Step Mode</strong></a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Scheduled Execution: <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="Initialized"><a class="link" href="#Initialized">2.3.4. Super State: Initialized</a></h4>
<div class="paragraph">
<p>This super state is entered by the FMU when <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called.</p>
</div>
<table id="table-math-initialized" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activate termination equations \(\mathbf{f}_{\mathit{term}}\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Terminate"><code>fmi3Terminate</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#fmi3GetNominalsOfContinuousStates"><code>fmi3GetNominalsOfContinuousStates</code></a></dt>
<dd>
<p>See <a href="#fmi3GetNominalsOfContinuousStates"><code>fmi3GetNominalsOfContinuousStates</code></a>.</p>
</dd>
</dl>
</div>
<div id="fmi3Terminate" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3Terminate</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3TerminateTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changes state to <a href="#Terminated"><strong>Terminated</strong></a>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="EventMode"><a class="link" href="#EventMode">2.3.5. State: Event Mode</a></h4>
<div class="paragraph">
<p>In <a href="#EventMode"><strong>Event Mode</strong></a> all continuous-time, discrete-time equations and active model partitions are evaluated.
<a href="#algebraic-loops">Algebraic loops</a> active during <a href="#EventMode"><strong>Event Mode</strong></a> are solved by <a href="#eventIteration">event iteration</a>.</p>
</div>
<div class="paragraph">
<p><a href="#EventMode"><strong>Event Mode</strong></a> is not available in Scheduled Execution.
While the reasons for entering <a href="#EventMode"><strong>Event Mode</strong></a> are different for Model Exchange and Co-Simulation (see <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> (ME) and <a href="#fmi3EnterEventModeCS"><code>fmi3EnterEventMode</code></a> (CS)), the event handling itself works the same.</p>
</div>
<div class="paragraph">
<p>There are multiple kinds of events that require a transition to <a href="#EventMode"><strong>Event Mode</strong></a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#input-event">Input events</a> indicate a non-continuous change of at least one input, in both Model Exchange and Co-Simulation.
Additionally, in Co-Simulation, the exact event time can be communicated to the FMU by the return argument <a href="#earlyReturnTime"><code>earlyReturnTime</code></a> of <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a>.</p>
</li>
<li>
<p><a href="#time-event">Time events</a> are announced to the importer in advance by the FMU through</p>
<div class="ulist">
<ul>
<li>
<p>the argument <a href="#nextEventTime"><code>nextEventTime</code></a> of <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>, or</p>
</li>
<li>
<p>the arguments of <a href="#fmi3GetShift"><code>fmi3GetShift</code></a> and <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#state-event">State events</a> are signaled to the importer by <a href="#eventIndicators"><code>eventIndicators</code></a> in Model Exchange (see <a href="#localizationStateEvents">Section 3.1.1</a>).
In Co-Simulation, the FMU returns from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with <a href="#eventHandlingNeeded"><code>eventHandlingNeeded = fmi3True</code></a>.
The exact event localization is hidden from the importer.</p>
</li>
<li>
<p><a href="#step-event">Step events</a> are initiated by the FMU at the end of an integrator step (see argument <a href="#enterEventMode"><code>enterEventMode</code></a> of <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a>) in Model Exchange.</p>
</li>
</ul>
</div>
<table id="table-math-event-mode" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 71.4285%;">
<col style="width: 28.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{\mathit{variability = tunable}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{c+d}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Activate clocks and output equations of the respective model partitions.</p>
</li>
<li>
<p>Deactivate clocks and</p>
<div class="ulist">
<ul>
<li>
<p>Reset respective clocked variables to their previous values: \(\mathbf{v}_{\mathit{k}} := {}^\bullet\mathbf{v}_{\mathit{k}}\), and</p>
</li>
<li>
<p>Deactivate respective model partitions in \(\mathbf{f}_{\mathit{event}}\).</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetClockEM"><code>fmi3SetClock</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>If <a href="#providesEvaluateDiscreteStates"><code>providesEvaluateDiscreteStates</code></a> is <code>true</code>, then execute state transition function of the model partitions<br>
\((\mathbf{x}_{d}) := \mathbf{f}_{\mathit{disc}}({}^\bullet\mathbf{x}_{c+d}, \mathbf{u}_{c+d}, \mathbf{p}, {}^\bullet\mathbf{b}, t)\)</p>
</li>
<li>
<p>else function is ignored.</p>
</li>
<li>
<p>For all active Clocks \(\mathbf{k}\), the <a href="#clocked-variable">clocked variables</a> \(\mathbf{v}_{\mathbf{k}}\) are part of the set of discrete variables \(\mathbf{v}_d\) computed by \(\mathbf{f}_{\mathit{disc}}\).</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EvaluateDiscreteStates"><code>fmi3EvaluateDiscreteStates</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Computes \(\mathbf{f}_{\mathit{event}}\) depending on</p>
<div class="ulist">
<ul>
<li>
<p>if <a href="#providesEvaluateDiscreteStates"><code>providesEvaluateDiscreteStates</code></a> is <code>true</code>, then<br>
\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{x}_{c}, \mathbf{z}, \mathbf{r}, \mathbf{w}_{c+d}, \mathbf{b}, \mathbf{T}_{\mathit{next}}) := \mathbf{f}_{\mathit{event}}({}^\bullet\mathbf{x}_{c+d}, \mathbf{x}_{d}, \mathbf{u}_{c+d}, \mathbf{p}, {}^\bullet\mathbf{b}, t)\)</p>
</li>
<li>
<p>else<br>
\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{x}_{c+d}, \mathbf{z}, \mathbf{r}, \mathbf{w}_{c+d}, \mathbf{b}, \mathbf{T}_{\mathit{next}}) := \mathbf{f}_{\mathit{event}}({}^\bullet\mathbf{x}_{c+d}, \mathbf{u}_{c+d}, \mathbf{p}, {}^\bullet\mathbf{b}, t)\)<br>
  which includes \(\mathbf{f}_{\mathit{disc}}\).</p>
</li>
</ul>
</div>
</li>
<li>
<p>For all active Clocks \(\mathbf{k}\), the <a href="#clocked-variable">clocked variables</a> \(\mathbf{v}_{\mathbf{k}}\) are part of the set of discrete variables \(\mathbf{v}_d\) computed by \(\mathbf{f}_{\mathit{event}}\).</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a>,<br>
<a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a>,<br>
<a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>,<br>
<a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Signals end of super-dense time instant.</p>
</li>
<li>
<p>Compute</p>
<div class="ulist">
<ul>
<li>
<p>\(\mathbf{f}_{\mathit{disc}}\) if <a href="#providesEvaluateDiscreteStates"><code>providesEvaluateDiscreteStates</code></a> is <code>true</code> and \(\mathbf{f}_{\mathit{disc}}\) (<a href="#fmi3EvaluateDiscreteStates"><code>fmi3EvaluateDiscreteStates</code></a>) was not called within this super-dense time, or</p>
</li>
<li>
<p>\(\mathbf{f}_{\mathit{event}}\) if <a href="#providesEvaluateDiscreteStates"><code>providesEvaluateDiscreteStates</code></a> is <code>false</code> and \(\mathbf{f}_{\mathit{event}}\) was not called within this super-dense time.</p>
</li>
</ul>
</div>
</li>
<li>
<p>\((\mathbf{T}_{\mathit{interval}}) := \mathbf{f}_{\mathit{update}}({}^\bullet\mathbf{x}_{c+d}, \mathbf{u}_{c+d}, \mathbf{p}, {}^\bullet\mathbf{b}, t)\)</p>
</li>
<li>
<p>\((\mathbf{T}_{\mathit{next}}) := \mathbf{f}_{\mathit{update}}({}^\bullet\mathbf{x}_{c+d}, \mathbf{u}_{c+d}, \mathbf{p}, {}^\bullet\mathbf{b}, t)\)</p>
</li>
<li>
<p>Update previous values of discrete states: \({}^\bullet\mathbf{x}_d := \mathbf{x}_d\).</p>
</li>
<li>
<p>Update previous values of <a href="#buffers">buffers</a>: \({}^\bullet\mathbf{b} := \mathbf{b}\).</p>
</li>
<li>
<p>Deactivate active clocks and respective model partitions.</p>
</li>
<li>
<p>Increment super-dense time: \(t := (t_{R}, t_{I} + 1)\).</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><a id="updateRelations"></a>Update previous values of <a href="#relations">relations</a>: \({}^\bullet\mathbf{r} := \mathbf{r}\).</p>
</li>
<li>
<p>Deactivate event equations \(\mathbf{f}_{\mathit{event}}\).</p>
</li>
<li>
<p>Model Exchange: Activate continuous-time equations \(\mathbf{f}_{\mathit{cont}}\).</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterContinuousTimeMode"><code>fmi3EnterContinuousTimeMode</code></a>,
<a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></dt>
<dd>
<p>This function can be called for variables with <a href="#causality"><code>causality = input</code></a> and for variables with <a href="#causality"><code>causality = parameter</code></a> and <a href="#variability"><code>variability = tunable</code></a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>Getting variables might trigger <a href="#selective-computation">computations</a>.</p>
</dd>
</dl>
</div>
<div id="fmi3SetClockEM" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3SetClock"><code>fmi3SetClock</code></a></dt>
<dd>
<p>For <a href="#inputClock"><code>input Clocks</code></a>, <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> is called to set the activation status of <a href="#Clock"><code>Clocks</code></a> to <code>fmi3ClockActive</code> or <code>fmi3ClockInactive</code>.
During the solution of algebraic loops, the activation condition of triggered input clocks may change and therefore <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> can be called multiple times per super-dense time instant.
When a Clock \(k\) is deactivated, the FMU must</p>
<div class="ulist">
<ul>
<li>
<p>reset all clocked states of this Clock to the values computed during the last <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> when this Clock was active (\({}^\bullet\mathbf{v}_{\mathit{k}}\)); and, as a result:</p>
</li>
<li>
<p>deactivate all Clocks that were activated as a result of \(k\)'s activation during the current super-dense time instant.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[Rationale: a triggered <a href="#outputClock">output Clock</a> \(c\) may depend on some variable \(v\) that is involved in an algebraic loop.</em>
<em>As part of the iterations to solve the algebraic loop, \(v\) acquires a value that activates the Clock.</em>
<em>If the final (or some intermediate) value of \(v\) no longer activates the Clock, then this Clock must be deactivated by the Importer during the same super-dense time instant.]</em><br>
The importer can set a Clock to <code>fmi3ClockInactive</code> only if the Clock has the attribute <a href="#canBeDeactivated"><code>canBeDeactivated = true</code></a>.
Any Clock active during <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> must be deactivated by the FMU itself.<br>
Only <a href="#time-based-clock">time-based Clocks</a> must not be active for more than one call of <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> per <a href="#EventMode"><strong>Event Mode</strong></a>.<br>
<em>[The event iteration for handling discontinuities of the continuous part of the FMU should precede handling of time-based Clocks.</em>
<em>No further constraints on activations of <a href="#time-based-clock">time-based Clocks</a> are defined, e.g. activating at the first instant of super-dense time.</em>
<em>If the semantics of some Clocks require any specific treatment, e.g. activation at the same super-dense time instant, only the importer will know and must therefore enforce proper activation of the respective Clocks.]</em></p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetClock"><code>fmi3GetClock</code></a></dt>
<dd>
<p>is used to inquire the status of <a href="#Clock">Clocks</a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> &amp; <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a></dt>
<dd>
<p>For <a href="#inputClock"><code>input Clocks</code></a> it is allowed to call these functions to query the next activation interval.<br>
For <a href="#changing-aperiodic-clock"><code>changing</code> aperiodic Clocks</a>, these functions must be called in every <a href="#EventMode"><strong>Event Mode</strong></a> where this clock was activated.<br>
For <a href="#countdown-aperiodic-clock"><code>countdown</code> aperiodic Clocks</a>, these functions must be called in every <a href="#EventMode"><strong>Event Mode</strong></a>.<br>
Clock intervals are computed in <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> (at the latest), therefore, these functions should be called after <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a></dt>
<dd>
<p>This function must be called if <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> returned with <a href="#valuesOfContinuousStatesChanged"><code>valuesOfContinuousStatesChanged = fmi3True</code></a>.
Not allowed in Co-Simulation and Scheduled Execution.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a></dt>
<dd>
<p>Not allowed in Co-Simulation and Scheduled Execution.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a></dt>
<dd>
<p>Not allowed in Co-Simulation and Scheduled Execution.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetNumberOfContinuousStates"><code>fmi3GetNumberOfContinuousStates</code></a></dt>
<dd>
<p>Not allowed in Co-Simulation and Scheduled Execution.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetNumberOfEventIndicators"><code>fmi3GetNumberOfEventIndicators</code></a></dt>
<dd>
<p>Not allowed in Co-Simulation and Scheduled Execution.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3EvaluateDiscreteStates"><code>fmi3EvaluateDiscreteStates</code></a></dt>
<dd>
<p>This function is called to trigger the evaluation of \(\mathbf{f}_{\mathit{disc}}\) to compute the current values of discrete states from previous values.
The FMU signals the support of <a href="#fmi3EvaluateDiscreteStates"><code>fmi3EvaluateDiscreteStates</code></a> via the capability flag <a href="#providesEvaluateDiscreteStates"><code>providesEvaluateDiscreteStates</code></a>.</p>
<div id="fmi3EvaluateDiscreteStates" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EvaluateDiscreteStatesTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a></dt>
<dd>
<p>This function is called to signal a converged solution at the current super-dense time instant.
<a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> must be called at least once per super-dense time instant.</p>
<div id="fmi3UpdateDiscreteStates" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3UpdateDiscreteStatesTYPE(fmi3Instance instance,
                                                fmi3Boolean* discreteStatesNeedUpdate,
                                                fmi3Boolean* terminateSimulation,
                                                fmi3Boolean* nominalsOfContinuousStatesChanged,
                                                fmi3Boolean* valuesOfContinuousStatesChanged,
                                                fmi3Boolean* nextEventTimeDefined,
                                                fmi3Float64* nextEventTime);</code></pre>
</div>
</div>
<div id="discreteStatesNeedUpdate" class="ulist">
<ul>
<li>
<p>When <code>discreteStatesNeedUpdate = fmi3True</code>, the importer must stay in <a href="#EventMode"><strong>Event Mode</strong></a> for another event iteration, starting a new super-dense time instant.</p>
</li>
</ul>
</div>
<div id="terminateSimulationUDS" class="ulist">
<ul>
<li>
<p>When <a href="#terminateSimulationUDS"><code>terminateSimulation = fmi3True</code></a>, the FMU requests to stop the simulation and the importer must call <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>.</p>
</li>
</ul>
</div>
<div id="nominalsOfContinuousStatesChanged" class="ulist">
<ul>
<li>
<p>If argument <code>nominalsOfContinuousStatesChanged = fmi3True</code>, then at least one nominal value of the <a href="#state">states</a> has changed and can be inquired with <a href="#fmi3GetNominalsOfContinuousStates"><code>fmi3GetNominalsOfContinuousStates</code></a>.<br>
This argument is only valid in Model Exchange.</p>
</li>
</ul>
</div>
<div id="valuesOfContinuousStatesChanged" class="ulist">
<ul>
<li>
<p>If argument <code>valuesOfContinuousStatesChanged = fmi3True</code>, then at least one continuous state has changed its value because it was re-initialized (see <a href="#reinit"><code>reinit</code></a>).<br></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The new values of the <a href="#state">states</a> can be inquired with <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a> or individually for each state for which <a href="#reinit"><code>reinit = true</code></a> by calling <code>fmi3GetFloat64</code>.<br>
This argument is only valid in Model Exchange.</p>
</div>
<div id="nextEventTimeDefined" class="ulist">
<ul>
<li>
<p>When <a href="#nextEventTimeDefined"><code>nextEventTimeDefined = fmi3True</code></a>, the next time event is known and <a href="#nextEventTime"><code>nextEventTime</code></a> has a valid value.</p>
</li>
</ul>
</div>
<div id="nextEventTime" class="ulist">
<ul>
<li>
<p>The return argument <a href="#nextEventTime"><code>nextEventTime</code></a> contains the absolute time of the next time event \(T_{\mathit{next}}\) if <a href="#nextEventTimeDefined"><code>nextEventTimeDefined = fmi3True</code></a>.
The importer must compute up to <a href="#nextEventTime"><code>nextEventTime</code></a> (or if needed slightly further) and then enter <a href="#EventMode"><strong>Event Mode</strong></a> using <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>.
The FMU must handle this time event during the <a href="#EventMode"><strong>Event Mode</strong></a> that is entered by the first call to <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>, at or after <a href="#nextEventTime"><code>nextEventTime</code></a>.<br>
<em>[This might be needed if, for example, the time resolution of the importer does not allow hitting the precise <a href="#nextEventTime"><code>nextEventTime</code></a>.</em>
<em>If the time offset proves to be too large, the FMU could issue a log message and return <a href="#fmi3Error"><code>fmi3Error</code></a>.</em>
<em>The user can improve time settings of the importer to alleviate the issues.]</em><br>
If another (e.g. <a href="#state-event">state event</a>) event happens before that <a href="#nextEventTime"><code>nextEventTime</code></a>, the previous definition of <a href="#nextEventTime"><code>nextEventTime</code></a> becomes obsolete.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="dummy1" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a></dt>
<dd>
<p><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> changes state to <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a> in Model Exchange.
<a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> must not be called if the FMU contains no <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a> (i.e. with <a href="#causality"><code>causality</code></a>= <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>).</p>
</dd>
</dl>
</div>
<div id="fmi3EnterContinuousTimeMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3EnterContinuousTimeMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterContinuousTimeModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function must be called to change from <a href="#EventMode"><strong>Event Mode</strong></a> into <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> in Model Exchange.</p>
</div>
</dd>
</dl>
</div>
<div id="fmi3EnterStepMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3EnterStepMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterStepModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function must be called to change from <a href="#EventMode"><strong>Event Mode</strong></a> into <a href="#StepMode"><strong>Step Mode</strong></a> in Co-Simulation.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ConfigurationMode"><a class="link" href="#ConfigurationMode">2.3.6. State: Configuration Mode</a></h4>
<div class="paragraph">
<p>The <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> allows setting <a href="#structuralParameter"><code>structural parameters</code></a> for example to resize array variables.
<a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> must not be called if the FMU contains no <a href="#structuralParameter"><code>structural parameter</code></a>.</p>
</div>
<table id="table-math-configurationMode" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set \(\mathbf{v}_{\mathit{causality=structuralParameter}}\)<br>
<em>[<a href="#structuralParameter"><code>structuralParameters</code></a> with</em> \(\mathbf{p}_{\mathit{variability=fixed}}\) <em>or</em> \(\mathbf{p}_{\mathit{variability=tunable}}\) <em>are included here]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resize arrays with dimensions that just changed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></dt>
<dd>
<p>Only for variables with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#fixed"><code>fixed</code></a> or <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>.</p>
</dd>
</dl>
</div>
<div id="fmi3ExitConfigurationMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3ExitConfigurationMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3ExitConfigurationModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Exits the <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> and returns to state <a href="#Instantiated"><strong>Instantiated</strong></a>.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ReconfigurationMode"><a class="link" href="#ReconfigurationMode">2.3.7. State: Reconfiguration Mode</a></h4>
<div class="paragraph">
<p>The <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a> allows setting <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a> for example to resize array variables during the simulation.
This state must not be entered, if the FMU contains no <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a>.</p>
</div>
<table id="table-math-reconfigurationMode" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set \(\mathbf{v}_{\mathit{causality=structuralParameter}}\)<br>
<em>[<a href="#structuralParameter"><code>structuralParameters</code></a> with</em> \(\mathbf{p}_{\mathit{variability=tunable}}\) <em>are included here]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resize arrays with dimensions that just changed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a></dt>
<dd>
<p><a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a> returns back to <a href="#EventMode"><strong>Event Mode</strong></a> (ME), <a href="#StepMode"><strong>Step Mode</strong></a> (CS) or <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> (SE).</p>
</dd>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></dt>
<dd>
<p>Only for variables with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="Terminated"><a class="link" href="#Terminated">2.3.8. State: Terminated</a></h4>
<div class="paragraph">
<p>In this state, the final values of all variables at the final time of a simulation can be retrieved.</p>
</div>
<table id="table-math-terminated" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{x}_{c+d}, \mathbf{z}, \mathbf{w}_{c+d}) := \mathbf{f}_{\mathit{term}}({}^\bullet\mathbf{x}_{c+d}, \mathbf{u}_{c+d}, \mathbf{p}, t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a>, <a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a>, <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>, <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>, <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Functions <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>Getting variables might trigger <a href="#selective-computation">computations</a>.
<em>[If <a href="#Terminated"><strong>Terminated</strong></a> is entered because of an <code>fmi3Error</code> return value, retrieved values should only be used for debugging purposes.]</em></p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a></dt>
<dd>
<p>Not allowed in Co-Simulation and Scheduled Execution.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a></dt>
<dd>
<p>Not allowed in Co-Simulation and Scheduled Execution.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetNominalsOfContinuousStates"><code>fmi3GetNominalsOfContinuousStates</code></a></dt>
<dd>
<p>Not allowed in Co-Simulation and Scheduled Execution.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a></dt>
<dd>
<p>Not allowed in Co-Simulation and Scheduled Execution.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></dt>
<dd>
<p>Not allowed in Model Exchange and Scheduled Execution.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modelDescription.xml"><a class="link" href="#modelDescription.xml">2.4. FMI Description Schema</a></h3>
<div class="paragraph">
<p>All static information related to the core functionality of an FMU is stored in the text file <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> in XML format as specified by the XML schema file <code>fmi3ModelDescription.xsd</code>.
Especially, the FMU variables and their attributes such as <code>name</code>, <code>unit</code>, <a href="#start"><code>start</code></a> value, etc. are stored in this file.</p>
</div>
<div class="paragraph">
<p>Additional optional information about the graphical representation and the grouping of FMU variables into terminals is stored in the optional text file <code>terminalsAndIcons/terminalsAndIcons.xml</code> in XML format as specified by the XML schema file <a href="#fmiTerminalsAndIcons"><code>fmi3TerminalsAndIcons.xsd</code></a>.</p>
</div>
<div class="paragraph">
<p>Build information for source code FMUs is provided together with a <a href="#BuildConfiguration"><code>buildDescription.xml</code></a> file in the <code>sources</code> directory that adheres to the <code>fmi3BuildDescription.xsd</code> schema file.</p>
</div>
<div class="paragraph">
<p>It is not allowed to change the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file within an FMU.
<em>[Reason: The <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file has to be consistent with the binary or source code implementations.</em>
<em>Specifically, changes to the start values would introduce such inconsistencies.]</em></p>
</div>
<div class="paragraph">
<p>In this section the schema files mentioned above, including their helper schema files, are discussed.
In the graphical representation of the schemata, optional elements are marked with a dashed box (e.g., see <a href="#figure-schema-Annotations">Figure 8</a>).
The required data types (like: <code>xs:normalizedString</code>) are defined in <a href="https://www.w3.org/TR/xmlschema-2/">XML Schema Part 2: Datatypes Second Edition</a>.
The types used in the FMI schema files are:</p>
</div>
<table id="table-types-in-schema" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Types used in the FMI 3.0 schema files.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 16.6666%;">
<col style="width: 16.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">XML</th>
<th class="tableblock halign-left valign-top">Description (<a href="https://www.w3.org/TR/xmlschema-2/" class="bare">https://www.w3.org/TR/xmlschema-2/</a>)</th>
<th class="tableblock halign-left valign-top">Mapping to C</th>
<th class="tableblock halign-left valign-top">Mapping to FMI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE 754 double-precision 64-bit floating point type <em>[An IEEE 754 double-precision floating point value can have up to 17 significant digits in its decimal representation.
In order to not loose precision, either an appropriate minimal printer algorithm should be used, or alternatively a number of this type should be stored in XML files with at least 17 significant digits.]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Float64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>single</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE 754 single-precision 32-bit floating point type <em>[An IEEE 754 single-precision floating point value can have up to 9 significant digits in its decimal representation.
In order to not loose precision, either an appropriate minimal printer algorithm should be used, or alternatively a number of this type should be stored in XML files with at least 9 significant digits.]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>float</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Float32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 127 and minimum value -128 (8-bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int8_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Int8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedByte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 255 and minimum value 0 (8-bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint8_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3UInt8</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>short</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 32767 and minimum value -32768 (16-bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int16_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Int16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedShort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 65535 and minimum value 0 (16-bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint16_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3UInt16</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 2147483647 and minimum value -2147483648 (32-bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int32_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Int32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedInt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 4294967295 and minimum value 0 (32-bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint32_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3UInt32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 9223372036854775807 and minimum value -9223372036854775808 (64-bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int64_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Int64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedLong</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 18446744073709551615 and minimum value 0 (64-bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint64_t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3UInt64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean number.
Legal literals: <code>false</code>, <code>true</code>, <code>0</code>, <code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any number of characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>normalizedString</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String without carriage return, line feed, and tab characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hexBinary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrary hex-encoded binary data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint_8*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Binary</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date, time and time zone (for details see <a href="https://www.w3.org/TR/xmlschema-2/">XML Schema Part 2: Datatypes Second Edition</a>).
Example: <code>2002-10-23T12:00:00Z</code> (noon on October 23, 2002, Greenwich Mean Time)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tool specific</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not defined</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first line of an XML file, such as <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>, must contain the encoding scheme of the XML file.
It is required that the encoding scheme is always UTF-8:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FMI schema files (<code>fmi3*.xsd</code>) are also stored in UTF-8.<br>
<em>[Note that the definition of an encoding scheme is a prerequisite in order for the XML file to contain letters outside of the 7-bit ANSI ASCII character set, such as German umlauts, or Asian characters.</em>
<em>Furthermore, note the FMI calling interface requires that strings are encoded in UTF-8.</em>
<em>Since the XML files are also required to be encoded in UTF-8, string variables need not to be transformed when reading from the XML files in to C string variables.].</em></p>
</div>
<div id="uniqueNameAttribute" class="paragraph">
<p><code>name</code> attributes of list elements (for example <a href="#table-type-details">VariableType</a> or <a href="#table-variableBase-attributes">Variable</a>) must be unique within that list and must not be empty strings.
Additional restrictions for these <code>name</code> attributes are listed in their respective sections.</p>
</div>
<div class="paragraph">
<p><em>[Note that child information items, such as elements in a sequence are ordered lists according to document order, whereas attribute information items are unordered sets (see <a href="https://www.w3.org/TR/XML-infoset/#infoitem.element" class="bare">https://www.w3.org/TR/XML-infoset/#infoitem.element</a>).</em>
<em>The FMI schema is based on ordered lists in a sequence and therefore parsing must preserve this order.</em>
<em>For example, the order of the <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a> elements define the order to be used in <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>, <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>, and <a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a>.]</em></p>
</div>
<div id="Annotations" class="paragraph">
<p>All XML-based file formats defined in this standard allow optional <code>Annotation</code> elements to be inserted in certain XML elements.
This is achieved through the <code>Annotations</code> element:</p>
</div>
<div id="figure-schema-Annotations" class="imageblock">
<div class="content">
<img src="images/schema/Annotations.png" alt="Annotations" width="80%">
</div>
<div class="title">Figure 8. Annotations Element.</div>
</div>
<div class="paragraph">
<p>Each <code>Annotation</code> element contains a required <code>type</code> attribute, which contains the namespace for that annotation.
The content of the <code>Annotation</code> element can be arbitrary XML data, and can make use of XML namespaces and XML schemas for combined validation where appropriate.</p>
</div>
<div class="paragraph">
<p>The namespace mechanism for the <code>type</code> attribute is based on reverse domain notation:
The originator of a specification for additional data specifies a domain name under their control as the namespace for the additional data, in order to avoid conflicts due to name collisions.
All namespaces under both the <code>org.modelica</code> and <code>org.fmi-standard</code> domains are reserved for use in future layered standards.</p>
</div>
<div class="paragraph">
<p><em>[For example, extensions defined by the Modelica Association might make use of the <code>org.modelica.fmi</code> namespace.</em>
<em>This could lead to annotations with a <code>type</code> attribute of <code>org.modelica.fmi.something</code>, and/or extra files under the <code>extra/org.modelica.ssp.something</code> sub-directory.]</em></p>
</div>
<div class="paragraph">
<p>Annotations are intended to allow structured extensions of the FMI XML files, without creating conflicting extensions, or leaving ambiguities in interpretation.
All annotations may safely be ignored by implementations that just implement the base FMI standard.</p>
</div>
<div class="sect3">
<h4 id="fmiModelDescription"><a class="link" href="#fmiModelDescription">2.4.1. Model Description</a></h4>
<div class="paragraph">
<p><a href="#system_overview">Figure 9</a> shows the root element <code>fmiModelDescription</code>.</p>
</div>
<div id="system_overview" class="imageblock">
<div class="content">
<img src="images/schema/fmiModelDescription.png" alt="fmiModelDescription" width="70%">
</div>
<div class="title">Figure 9. <code>fmiModelDescription</code> element.</div>
</div>
<div class="paragraph">
<p><em>[If an optional element is present and defines a list (such as <code>&lt;UnitDefinitions&gt;</code>), the list must have at least one element (such as <code>&lt;Unit&gt;</code>).]</em></p>
</div>
<table id="table-schema-fmiModelDescription" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. <code>fmiModelDescription</code> element details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;ModelExchange&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on FMI for Model Exchange (<a href="#fmi-for-model-exchange">Section 3</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;CoSimulation&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on FMI for Co-Simulation (<a href="#fmi-for-co-simulation">Section 4</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;ScheduledExecution&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on FMI for Scheduled Execution (<a href="#fmi-for-scheduled-execution">Section 5</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;UnitDefinitions&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of unit and display unit definitions <em>[for example, used to convert display units into the units used in the model equations]</em>.
These definitions are used in the XML element <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;TypeDefinitions&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of type definitions that are utilized in <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;LogCategories&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of log categories that can be set to define the log information that is supported from the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;DefaultExperiment&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default settings for the importer algorithms, such as stop time and relative tolerance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of all variables of the FMU that are accessible via the FMU functions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the structure of the model.
Especially, the ordered lists of <a href="#output"><code>outputs</code></a>, continuous-time <a href="#state">states</a>, clocked states, initial unknowns (the unknowns during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>), and the event indicators are defined here.
Furthermore, the dependency of the unknowns from the knowns (as described in <a href="#model-dependencies">Section 2.2.9</a>) can be optionally defined for <a href="#output"><code>outputs</code></a>, continuous-time <a href="#state">states</a> and initial unknowns.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Annotations"><code>&lt;Annotations&gt;</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional annotations for the top-level element.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At least one element of <code>&lt;ModelExchange&gt;</code>, <code>&lt;CoSimulation&gt;</code> or <code>&lt;ScheduledExecution&gt;</code> must be present to identify the type of the FMU.
The details of these elements are defined in <a href="#model-exchange-schema">Section 3.4</a>, <a href="#co-simulation-schema">Section 4.4</a> or <a href="#scheduled-execution-schema">Section 5.4</a>.
How to support multiple interface types within one FMU, see <a href="#multipleInterfaceTypes">Section 2.5.2</a>.</p>
</div>
<div class="paragraph">
<p>The XML attributes of <code>&lt;fmiModelDescription&gt;</code> are:</p>
</div>
<table id="table-schema-fmiModelDescription-attributes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. <code>fmiModelDescription</code> attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmiVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of FMI the XML file complies with.
The value for this version is <code>3.0</code>.
Future minor revisions will be denoted as <code>3.1</code>, <code>3.2</code> &#8230;&#8203;</p>
<p class="tableblock"><em>[During development prototype FMU implementations can indicate compliance with a certain development version based on the tags available at <a href="https://github.com/modelica/fmi-standard/tags" class="bare">https://github.com/modelica/fmi-standard/tags</a>.</em>
<em>For example the value for the FMI 3.0 Alpha 2 release is <code>3.0-alpha.2</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the model as used in the modeling environment that generated the XML file, such as <code>Modelica.Mechanics.Rotational.Examples.CoupledClutches</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>instantiationToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="instantiationToken"></a>The <a href="#instantiationToken"><code>instantiationToken</code></a> is a string that may be used by the FMU to check that the XML file is compatible with the implementation of the FMU.
For this purpose the importer must pass the <a href="#instantiationToken"><code>instantiationToken</code></a> from the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> to the <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a> function call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional string with a brief description of the model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>author</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional string with the name of the model author.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional version of the model <em>[for example <code>1.0</code>]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>copyright</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional information on the intellectual property copyright for this FMU <em>[for example <code>&#169; My Company 2022</code>]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>license</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional information on the intellectual property licensing for this FMU.<br>
<em>[For example <code>BSD license &lt;license text or link to license&gt;</code>.</em>
<em>If more space is required, the folder <a href="#license-information"><code>licenses</code></a> should be used.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generationTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional name of the tool that generated the XML file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generationDateAndTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional date and time when the XML file was generated.
The format is a subset of <code>dateTime</code> and should be: <code>YYYY-MM-DDThh:mm:ssZ</code> (with one <code>T</code> between date and time; <code>Z</code> characterizes the Zulu time zone, in other words, Greenwich meantime) <em>[for example <code>2009-12-08T14:33:22Z</code>, according to ISO 8601]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="variableNamingConvention"></a><code>variableNamingConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines whether the variable names in <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a> and in <code>&lt;TypeDefinitions&gt;</code> follow the <code>flat</code> or <code>structured</code> convention as defined in <a href="#namingSection">Section 2.4.7.5.1</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="common-capability-flags"><a class="link" href="#common-capability-flags">2.4.2. Attributes and Capability Flags</a></h4>
<div class="paragraph">
<p>The elements <code>&lt;ModelExchange&gt;</code>, <code>&lt;CoSimulation&gt;</code> and <code>&lt;ScheduledExecution&gt;</code> contain attributes, some representing capability flags, describing which optional functionalities the FMU supports.</p>
</div>
<div class="paragraph">
<p>Note that future FMI minor releases may add additional capability flags for optional features.
Importers must be prepared to ignore unknown capability flags.
Exporters must not generate capability flags without an XML namespace, unless specified by this standard or any later release of this standard.</p>
</div>
<div class="paragraph">
<p>The following table contains attributes and capability flags common to all three interface types.
For all Boolean attributes the default is <code>false</code>.</p>
</div>
<table id="table-common-capability-flags" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Common attributes and capability flags.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelIdentifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="modelIdentifier"></a>Short class name according to C syntax, for example, <code>A_B_C</code>.
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries, but not if the functions are provided by a DLL/SharedObject.
<a href="#modelIdentifier"><code>modelIdentifier</code></a> is also used as name of the static library or DLL/SharedObject.
See also <a href="#header-files-and-naming-of-functions">Section 2.2.2</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>needsExecutionTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="needsExecutionTool"></a>If <code>true</code>, a tool is needed to execute the FMU.
The FMU implements the communication to this tool.
These tool dependencies must be <a href="#documentation-directory">documented</a>.
<em>[Typically, this information is only utilized for information purposes.</em>
<em>For example, when loading an FMU with <code>needsExecutionTool = true</code>, the importer should inform the user that a tool has to be available on the computer where the FMU is instantiated.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canBeInstantiatedOnlyOncePerProcess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the FMU must be instantiated only once per process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canGetAndSetFMUState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="canGetAndSetFMUState"></a>If <code>true</code>, the environment may inquire the internal FMU state and may restore it.
That is, functions <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>, and <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a> are supported by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canSerializeFMUState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="canSerializeFMUState"></a>If <code>true</code>, the environment may serialize the internal FMU state, in other words, functions <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a>, <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a>, <a href="#fmi3DeserializeFMUState"><code>fmi3DeserializeFMUState</code></a> are supported by the FMU.
If <code>true</code>, the flag <a href="#canGetAndSetFMUState"><code>canGetAndSetFMUState</code></a> must be <code>true</code> as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesDirectionalDerivatives</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="providesDirectionalDerivatives"></a>If <code>true</code>, the directional derivative of the equations may be retrieved using <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesAdjointDerivatives</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="providesAdjointDerivatives"></a>If <code>true</code>, the adjoint derivatives of the equations may be retrieved using <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesPerElementDependencies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the FMU is able to provide detailed dependency information at runtime using <a href="#fmi3GetNumberOfVariableDependencies"><code>fmi3GetNumberOfVariableDependencies</code></a> and <a href="#fmi3GetVariableDependencies"><code>fmi3GetVariableDependencies</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesEvaluateDiscreteStates</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="providesEvaluateDiscreteStates"></a>If <code>true</code>, the FMU supports <a href="#fmi3EvaluateDiscreteStates"><code>fmi3EvaluateDiscreteStates</code></a>.
This flag is ignored in Scheduled Execution.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_physical_units"><a class="link" href="#_physical_units">2.4.3. Physical Units</a></h4>
<div class="paragraph">
<p>This section describes how units for variables can be defined.
These descriptions allow automatic unit checks and value conversion in the importer to bridge the gap between FMUs from different simulation domains.
The FMI unit descriptions are more secure than using humanly readable unit strings only, because all units can be defined as combinations of the seven SI base units.</p>
</div>
<div class="paragraph">
<p>Element <code>&lt;fmiModelDescription&gt;&lt;UnitDefinitions&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-UnitDefinitions" class="imageblock">
<div class="content">
<img src="images/schema/UnitDefinitions.png" alt="UnitDefinitions" width="90%">
</div>
<div class="title">Figure 10. <code>UnitDefinitions</code> element.</div>
</div>
<div class="paragraph">
<p>Units are referenced via its <a href="#uniqueNameAttribute">unique</a> attribute <code>name</code> by the attribute <code>unit</code> and <code>displayUnit</code> of <a href="#table-type-details">variable types</a> and <a href="#table-type-attributes">variables</a>.
The <code>name</code> of a <code>Unit</code> must be <a href="#uniqueNameAttribute">unique</a> with respect to all other <code>&lt;Unit&gt;</code> elements.
If a variable is associated with a <code>Unit</code>, the value passed to <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> (resp. retrieved with <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a>) has this unit.
<em>[The purpose of the name is to uniquely identify a unit and, for example, use it to display the unit in menus or in plots.</em>
<em>Since there is no standard to represent units in strings, and there are different ways how this is performed in different tools, no specific format for the string representation of the unit is required.]</em></p>
</div>
<div class="paragraph">
<p>The <code>Unit</code> definition consists of the exponents of the seven SI base units <code>kg</code>, <code>m</code>, <code>s</code>, <code>A</code>, <code>K</code>, <code>mol</code>, <code>cd</code>, the exponent of the SI derived unit <code>rad</code>, and optionally a <code>factor</code> and an <code>offset</code>.
<em>[The additional <code>rad</code> base unit helps to handle the often occurring quantities in technical systems that depend on an angle.]</em></p>
</div>
<div id="figure-schema-BaseUnit" class="imageblock text-center">
<div class="content">
<img src="images/schema/BaseUnit.png" alt="BaseUnit" width="50%">
</div>
<div class="title">Figure 11. <code>BaseUnit</code> element.</div>
</div>
<div class="paragraph">
<p>A value \(v_{\mathit{unit}}\) in <code>Unit</code> is converted to the base unit \(v_{\mathit{base}}\) by the equation</p>
</div>
<div class="stemblock">
<div class="content">
\[v_{\mathit{base}} = \texttt{factor} * v_{\mathit{unit}} + \texttt{if relativeQuantity then 0 else offset}\]
</div>
</div>
<div class="paragraph">
<p>where <code>factor</code> and <code>offset</code> are attributes of the <code>&lt;BaseUnit&gt;</code>, and  <code>relativeQuantity</code> an attribute of the <code>TypeDefinition</code> of a variable.</p>
</div>
<div class="paragraph">
<p><em>[For example, if</em> \({p_{\mathit{bar}}}\) <em>is a pressure value in unit <code>bar</code>, and</em> \({p_{\mathit{Pa}}}\) <em>is the pressure value in <code>&lt;BaseUnit&gt;</code>, then</em></p>
</div>
<div class="stemblock">
<div class="content">
\[{p_{\mathit{Pa}} = 10^5 p_{\mathit{bar}}}\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, <code>factor = 1.0e5</code> and <code>offset = 0.0</code>.</em></p>
</div>
<div class="paragraph">
<p><em>In the following table several unit examples are given.</em>
<em>Note that if in column <code>exponents</code> the definition</em> \(\frac{kg \cdot m^2}{s^2}\) <em>is present, then the attributes of <code>&lt;BaseUnit&gt;</code> are  <code>kg=1, m=2, s=-2</code>.</em></p>
</div>
<table id="table-unit-examples" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Unit examples.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Quantity</p></th>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Unit.name (examples)</p></th>
<th class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Unit.BaseUnit</p></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">exponents</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">factor</p></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">offset</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Torque</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>N.m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({kg \cdot m^2 / s^2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Energy</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>J</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({kg \cdot m^2 / s^2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Pressure</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({\frac{kg}{m \cdot s^2}}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0e5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Angle</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rad</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.01745329251994330 (= pi/180)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Angular velocity</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Angular velocity</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.1047197551196598 (= 2*pi/60)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Frequency</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Hz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6.283185307179586 (= 2*pi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Temperature</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#176;F</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>K</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.5555555555555556 (= 5/9)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>255.3722222222222 (= 273.15-32*5/9)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Percent by length</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%/m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1/m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.01</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Parts per million</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ppm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.0e-6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Length</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>km</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Length</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.9144</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Note that <code>Hz</code> is typically used as <code>Unit.name</code> for a frequency quantity, but it can also be used as <code>&lt;DisplayUnit&gt;</code> for an angular velocity quantity (since <code>revolution/s</code>).</em></p>
</div>
<div class="paragraph">
<p><em>The <code>&lt;BaseUnit&gt;</code> definitions can be utilized for different purposes (the following application examples are optional and a tool may also completely ignore the <code>Unit</code> definitions):</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Unit check when connecting variables of different FMUs</dt>
<dd>
<div class="paragraph">
<p><em>When only one of <a href="#input"><code>input</code></a> <code>v2</code> and <a href="#output"><code>output</code></a> <code>v1</code>, connected with equation <code>v2 = v1</code>, defines a <code>&lt;BaseUnit&gt;</code> element, <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> must be used to get the value of <code>v1</code>  to then set it with <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> for <code>v2</code>.</em></p>
</div>
<div class="paragraph">
<p><em>When two variables v1 and v2 are connected and for both of them <code>&lt;BaseUnit&gt;</code> elements are defined, then they must have identical exponents of their <code>&lt;BaseUnit&gt;</code>.</em>
<em>If <code>factor</code> and <code>offset</code> are also identical, again the connection equation <code>v2 = v1</code> holds.</em>
<em>If <code>factor</code> and <code>offset</code> are not identical, the tool may either trigger an error or, if supported, perform a conversion; in other words, use the connection equation (in this case the <code>relativeQuantity</code> of the <code>&lt;TypeDefinition&gt;</code>, see below, has to be taken into account in order to determine whether <code>offset</code> shall or shall not be utilized):</em></p>
</div>
<div class="paragraph">
<p><code>factor(v1) * v1 + (if relativeQuantity(v1) then 0 else offset(v1)) = factor(v2) * v2 + (if relativeQuantity(v2) then 0 else offset(v2))</code><br>
<em>where</em> <code>relativeQuantity(v1) = relativeQuantity(v2)</code> <em>is required</em>.</p>
</div>
<div class="paragraph">
<p><em>As a result, wrong connections can be detected (for example, connecting a force with an angle-based variable would trigger an error) and conversions between, say, US and SI units can be either automatically performed or, if not supported, an error is triggered as well.</em></p>
</div>
<div class="paragraph">
<p><em>This approach is not satisfactory for variables belonging to different quantities that have, however, the same <code>&lt;BaseUnit&gt;</code>, such as quantities <code>Energy</code> and <code>Torque</code>, or <code>AngularVelocity</code> and <code>Frequency</code>.</em>
<em>To handle such cases, quantity definitions have to be taken into account (see <code>&lt;TypeDefinitions&gt;</code>) and quantity names need to be standardized.</em></p>
</div>
<div class="paragraph">
<p><em>This approach allows a general treatment of units, without being forced to standardize the grammar and allowed values for units (for example, in FMI 1.0, a unit could be defined as <code>N.m</code> in one FMU and as <code>N*m</code> in another FMU, and a tool would have to reject a connection, since the units are not identical.</em>
<em>In FMI 2.0, the connection would be accepted, provided both elements have the same <code>&lt;BaseUnit&gt;</code> definition).</em></p>
</div>
</dd>
<dt class="hdlist1">Dimensional analysis of equations</dt>
<dd>
<div class="paragraph">
<p><em>In order to check the validity of equations in a modeling language, the defined units can be used for dimensional analysis, by using the <code>&lt;BaseUnit&gt;</code> definition of the respective unit.</em>
<em>For this purpose, the <code>&lt;BaseUnit&gt;</code> <code>rad</code> has to be treated as <code>1</code>.</em>
<em>Example:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}
J \cdot \alpha = \tau \rightarrow [kg.m^2]*[rad/s^2] = [kg.m^2/s^2] &amp; \quad \text{// o.k. ("rad" is treated as "1")} \\
J \cdot \alpha = f \rightarrow [kg.m^2]*[rad/s^2] = [kg.m/s^2] &amp; \quad \text{// error, since dimensions do not agree}
\end{align*}\]
</div>
</div>
</dd>
<dt class="hdlist1">Unit propagation</dt>
<dd>
<div class="paragraph">
<p><em>If unit definitions are missing for variables, they might be deduced from the equations where the variables are used.</em>
<em>If no unit computation is needed, <code>rad</code> is propagated.</em>
<em>If a unit computation is needed and one of the involved units has <code>rad</code> as a <code>&lt;BaseUnit&gt;</code>, then unit propagation is not possible.</em>
<em>Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>a = b + c, and <code>Unit</code> of c is provided, but not <code>Unit</code> of a and b:</em><br>
<em>The Unit definition of <code>c</code> (in other words, <code>Unit.name</code>, <code>&lt;BaseUnit&gt;</code>, <code>&lt;DisplayUnit&gt;</code>) is also used for <code>a</code> and <code>b</code>.</em>
<em>For example, if BaseUnit(c) = <code>rad/s</code>, then BaseUnit(a) = BaseUnit(b) = <code>rad/s</code>.</em></p>
</li>
<li>
<p><em>a = b*c, and <code>Unit</code> of a and of c is provided, but not <code>Unit</code> of b:</em><br>
<em>If <code>rad</code> is either part of the <code>&lt;BaseUnit&gt;</code> of <code>a</code> and/or of <code>c</code>, then the <code>&lt;BaseUnit&gt;</code> of <code>b</code> cannot be deduced (otherwise it can be deduced).</em>
<em>Example: If <code>BaseUnit(a) = kg.m/s2</code> and <code>BaseUnit(c) = m/s2</code>, then the <code>BaseUnit(b)</code> can be deduced to be <code>kg</code>.</em>
<em>In such a case <code>Unit.name</code> of b cannot be deduced from the <code>Unit.name</code> of <code>a</code> and <code>c</code>, and a tool would typically construct the <code>Unit.name</code> of <code>b</code> from the deduced <code>&lt;BaseUnit&gt;</code>.]</em></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A <code>&lt;Unit&gt;</code> can contain any number of <code>&lt;DisplayUnit&gt;</code> elements.</p>
</div>
<div id="figure-schema-DisplayUnit" class="imageblock text-center">
<div class="content">
<img src="images/schema/DisplayUnit.png" alt="DisplayUnit" width="70%">
</div>
<div class="title">Figure 12. DisplayUnit element.</div>
</div>
<div class="paragraph">
<p>A <code>&lt;DisplayUnit&gt;</code> is defined by <code>name</code>, <code>factor</code>, <code>offset</code>, and <code>inverse</code>.
The attribute <code>name</code> must be unique with respect to all other names of the <code>&lt;DisplayUnit&gt;</code> definitions of the same <code>Unit</code>.
<em>[Different <code>Unit</code> elements may have the same <code>&lt;DisplayUnit&gt;</code> names].</em><br>
<code>inverse = true</code> is only allowed if <code>offset = 0</code>.<br>
<em>[Reason: no use case is known for the combination of inverse and offset, which would also be more complicated.]</em></p>
</div>
<div class="paragraph">
<p>A value \(v_{\mathit{unit}}\) in <code>Unit</code> is converted to a value \(v_{\mathit{display}}\) in <code>DisplayUnit</code> by the equation:</p>
</div>
<div class="stemblock">
<div class="content">
\[v_{\mathit{display}} =
\left\{\begin{array}{ll}
\texttt{factor} *          v_{\mathit{unit}}  + \texttt{offset} &amp;\text{if} \; \texttt{inverse = false} \\
\texttt{factor} * \frac{1}{v_{\mathit{unit}}}  &amp;\text{if} \; \texttt{inverse = true}
\end{array}\right.\]
</div>
</div>
<div class="paragraph">
<p><em>[<code>offset</code> is needed for temperature units like <code>F</code> (Fahrenheit), <code>inverse</code> for inverse display units like <code>mpg</code> (miles per gallon) or <code>S</code> (Siemens).</em></p>
</div>
<div class="paragraph">
<p><em>For example, if \({T_K}\) is the temperature value of <code>Unit.name</code> (in <code>K</code>) and \({T_F}\) is the temperature value of <code>&lt;DisplayUnit&gt;</code> (in <code>&#176;F</code>), then</em></p>
</div>
<div class="stemblock">
<div class="content">
\[T_F = (9/5) * (T_K - 273.15) + 32\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, <code>factor = 1.8 (=9/5)</code> and <code>offset = -459.67 (= 32 - 273.15*9/5)</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Both the <code>DisplayUnit.name</code> definitions as well as the <code>Unit.name</code> definitions are used in the variable elements.</em></p>
</div>
<div class="paragraph">
<p><em>Example of a definition:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;UnitDefinitions&gt;
  &lt;Unit name="rad/s"&gt;
    &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;DisplayUnit name="deg/s" factor="57.29577951308232"/&gt;
    &lt;DisplayUnit name="rev/min" factor="9.549296585513721"/&gt;
  &lt;/Unit&gt;
  &lt;Unit name="bar"&gt;
    &lt;BaseUnit kg="1" m="-1" s="-2" factor="1e5" offset="0"/&gt;
  &lt;/Unit&gt;
  &lt;Unit name="L/100km"&gt;
    &lt;BaseUnit m="2" factor="1e-8"/&gt;
    &lt;DisplayUnit name="mpg" inverse="true" factor="235.214583"/&gt;
  &lt;/Unit&gt;
  &lt;Unit name="Re"&gt;
    &lt;BaseUnit/&gt; &lt;!-- unit="1" --&gt;
                &lt;!-- (dimensionless, all exponents of BaseUnit are zero) --&gt;
  &lt;/Unit&gt;
  &lt;Unit name="Euro/PersonYear"/&gt;  &lt;!-- no mapping to BaseUnit defined --&gt;
&lt;/UnitDefinitions&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="definition-of-types"><a class="link" href="#definition-of-types">2.4.4. Variable Types</a></h4>
<div class="paragraph">
<p>Element <code>&lt;fmiModelDescription&gt;&lt;TypeDefinitions&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-TypeDefinitions" class="imageblock text-center">
<div class="content">
<img src="images/schema/TypeDefinitions.png" alt="TypeDefinitions" width="70%">
</div>
<div class="title">Figure 13. TypeDefinitions element.</div>
</div>
<div class="paragraph">
<p>This element consists of a set of <code>&lt;TypeDefinition&gt;</code> elements according to schema <code>fmi3TypeDefinition</code> in file <code>fmi3Type.xsd</code>.</p>
</div>
<div class="paragraph">
<p>Each variable type has its own set of attributes.
<a href="#figure-schema-Float64Type">Figure 14</a>, <a href="#figure-schema-Int32Type">Figure 15</a>, <a href="#figure-schema-BooleanType">Figure 16</a>, <a href="#figure-schema-BinaryType">Figure 17</a>, <a href="#figure-schema-EnumerationType">Figure 18</a>, and <a href="#figure-schema-ClockType">Figure 19</a> are representative examples.</p>
</div>
<div id="figure-schema-Float64Type" class="imageblock text-center">
<div class="content">
<img src="images/schema/Float64Type.png" alt="Float64Type" width="90%">
</div>
<div class="title">Figure 14. Float64Type element.</div>
</div>
<div id="figure-schema-Int32Type" class="imageblock text-center">
<div class="content">
<img src="images/schema/Int32Type.png" alt="Int32Type" width="90%">
</div>
<div class="title">Figure 15. Int32Type element.</div>
</div>
<div id="figure-schema-BooleanType" class="imageblock text-center">
<div class="content">
<img src="images/schema/BooleanType.png" alt="BooleanType" width="90%">
</div>
<div class="title">Figure 16. BooleanType element.</div>
</div>
<div id="figure-schema-BinaryType" class="imageblock text-center">
<div class="content">
<img src="images/schema/BinaryType.png" alt="BinaryType" width="100%">
</div>
<div class="title">Figure 17. BinaryType element.</div>
</div>
<div id="figure-schema-EnumerationType" class="imageblock text-center">
<div class="content">
<img src="images/schema/EnumerationType.png" alt="EnumerationType" width="100%">
</div>
<div class="title">Figure 18. EnumerationType element.</div>
</div>
<div id="figure-schema-ClockType" class="imageblock text-center">
<div class="content">
<img src="images/schema/ClockType.png" alt="ClockType" width="100%">
</div>
<div class="title">Figure 19. ClockType element.</div>
</div>
<div class="paragraph">
<p>The <code>&lt;TypeDefinition&gt;</code> elements are referred to in variable elements to declare their type.
<em>[The alternative would be to define a type per variable.</em>
<em>However, this would lead to a situation where, e.g., the definition of a <code>Torque</code> type would have to be repeated over and over.]</em>
The attributes and elements have the following meaning:</p>
</div>
<table id="table-type-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Type element and attribute details.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute or Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="#uniqueNameAttribute">unique</a> name of the variable type referenced using the attribute <a href="#table-type-attributes"><code>declaredType</code></a>.
This attribute must be different to all <code>name</code> attributes of variables <em>[if the same names would be used, then this would nearly always give problems when importing the FMU in an environment using the Modelica language, where a type name cannot be used as instance name]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional description string describing the meaning of the variable type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quantity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical quantity of the variable.
<em>[For example, <code>Angle</code>, or <code>Energy</code>.</em>
<em>The quantity names are not standardized.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit of the variable referencing to a <code>&lt;UnitDefinitions&gt;&lt;Unit&gt;</code> with the same <code>name</code>, which must exist.
Type definitions without unit must not have a <code>unit</code> attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>displayUnit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="displayUnit"></a>Default display unit of the variable referencing to a <code>&lt;DisplayUnit&gt;</code> which must exist under <code>&lt;UnitDefinitions&gt;&lt;Unit&gt;</code> with the <code>name</code> of <code>unit</code>.
The conversion to the <code>unit</code> is defined with the element <code>&lt;fmiModelDescription&gt;&lt;UnitDefinitions&gt;&lt;Unit&gt;&lt;DisplayUnit&gt;</code>.
If <code>displayUnit</code> is defined a <code>unit</code> must also be defined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mimeType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="mimeType"></a>Indicates the type of data passed as a binary.
Defaults to <code>application/octet-stream</code>, which is unspecific.
Implementations may use this information to provide guidance about valid/useful connections.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the maximum size (bytes) of the data passed as a binary.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relativeQuantity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this attribute is <code>true</code>, then the <code>offset</code> of <code>BaseUnit</code> and <code>displayUnit</code> must be ignored.
<em>[For example, 10 degree Celsius = 10 Kelvin if <code>relativeQuantity = true</code> and not 283.15 Kelvin.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="min"></a>Minimum value of variable (variable value \(\geq\) <code>min</code>).
If not defined, the minimum is the largest negative number that can be represented on the machine for that <code>&lt;TypeDefinition&gt;</code>.
The <code>min</code> defines the region in which the FMU is designed to operate (see <a href="#min-max-violations">Section 2.2.7.3</a>).
<em>[If, for example, an <code>&lt;Enumeration&gt;</code> is defined with <code>name1 = -4</code>, <code>name2 = 1</code>, <code>name3 = 5</code>, <code>name4 = 11</code> and <code>min = -2</code>, <code>max = 5</code>, then only <code>name2</code> and <code>name3</code> are allowed.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="max"></a>Maximum value of variable (variable value \(\leq\) <code>max</code>).
If not defined, the maximum is the largest positive number that can be represented on the machine for that <code>&lt;TypeDefinition&gt;</code>.
The <code>max</code> defines the region in which the FMU is designed to operate (see <a href="#min-max-violations">Section 2.2.7.3</a>).
<em>[If, for example, an <code>&lt;Enumeration&gt;</code> is defined with <code>name1 = -4</code>, <code>name2 = 1</code>, <code>name3 = 5</code>, <code>name4 = 11</code> and <code>min = -2</code>, <code>max = 5</code>, then only <code>name2</code> and <code>name3</code> are allowed.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nominal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nominal value of variable.
If not defined and no other information about the nominal value is available, then <code>nominal = 1</code> is assumed.
For array variables, this nominal value applies to all elements of the array.<br>
<em>[The nominal value of a variable can be, for example, used to determine the absolute tolerance for this variable as needed by numerical algorithms:</em><br>
<code>absoluteTolerance = nominal * tolerance * 0.01</code><br>
<em>where <code>tolerance</code> is, for example, the relative tolerance defined in <a href="#DefaultExperiment">Section 2.4.6</a>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unbounded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, indicates that during time integration, the variable gets a value much larger than its nominal value <code>nominal</code>.
<em>[Typical examples are the monotonically increasing rotation angles of crank shafts and the longitudinal position of a vehicle along the track in long distance simulations.</em>
<em>This information can, for example, be used to increase numerical stability and accuracy by setting the corresponding bound for the relative error to zero (relative tolerance = 0.0), if the corresponding variable is a continuous <a href="#state">state</a> variable.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Item</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <code>&lt;EnumerationType&gt;</code> must have a non-empty sequence of <code>&lt;Item&gt;</code> elements with attributes <code>name</code> and <code>value</code>.
<code>name</code> and <code>value</code> must be unique within the same <code>&lt;EnumerationType&gt;</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Attributes for <code>ClockType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canBeDeactivated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="canBeDeactivated"></a>
<a href="#Clock"><code>Clocks</code></a> with the attribute <a href="#canBeDeactivated"><code>canBeDeactivated = true</code></a> may be actively deactivated using <a href="#fmi3SetClockEM"><code>fmi3SetClock</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>priority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="priority"></a>
This attribute is mandatory for input <a href="#Clock"><code>Clocks</code></a> in Scheduled Execution.
For Co-Simulation and Model Exchange, this attribute must be ignored <em>[i.e. if present in <a href="#multipleInterfaceTypes">mixed interface FMUs</a>]</em>.
Output <a href="#Clock"><code>Clocks</code></a> must not have this attribute.
Smaller values signal higher priorities.
<a href="#Clock"><code>Clocks</code></a> that have to be activated at the same time instant are ordered according to this attribute.
For multiple <a href="#Clock"><code>Clocks</code></a> with the same priority the order is undefined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intervalVariability</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="intervalVariability"></a>
The attribute <code>intervalVariability</code> declares the Clock type, see <a href="#table-overview-clocks">Table 5</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">The values of the following float and integer attributes refer to the unit of the <a href="#independent"><code>independent</code></a> variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intervalDecimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="intervalDecimal"></a>
This attribute defines the time interval \(T_{\mathit{interval}}\) between consecutive <a href="#Clock">Clock</a> ticks.
This value must be greater than 0.0.
This attribute is required if Clock type is <a href="#constant-clock"><code>constant</code></a>, <a href="#fixed-clock"><code>fixed</code></a> or <a href="#tunable-clock"><code>tunable</code></a> <a href="#periodic-clock">periodic Clocks</a>.
It must not be used otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shiftDecimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="shiftDecimal"></a>
This attribute defines the delay of the first clock activation relative to \(t_{\mathit{start}}\) (<a href="#startTime"><code>startTime</code></a>).
This attribute requires that <a href="#intervalDecimal"><code>intervalDecimal</code></a> is present.
The value of this attribute value must be equal to or greater than 0.0.
Default value is 0.0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>supportsFraction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="supportsFraction"></a>
This attribute defines, if the functions <code>fmi3GetXXXFraction</code> and <code>fmi3SetIntervalFraction</code> are allowed to be called for all <a href="#time-based-clock">time-based Clocks</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resolution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="resolution"></a>Instead of defining clock timing using floating point numbers, FMI allows the definition of rational numbers using <a href="#intervalCounter"><code>intervalCounter</code></a> and <a href="#shiftCounter"><code>shiftCounter</code></a>.
The <code>resolution</code> defines the minimal quanta clock timing can be resolved by.
This attribute is required for <a href="#periodic-clock">time-based periodic clocks</a> if <a href="#supportsFraction"><code>supportsFraction = true</code></a> and <a href="#intervalCounter"><code>intervalCounter</code></a> is present.
This attribute must only be used for <a href="#periodic-clock">periodic Clocks</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intervalCounter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="intervalCounter"></a>This attribute defines (together with <a href="#resolution"><code>resolution</code></a>) the interval between consecutive clock ticks:</p>
<p class="tableblock">\(T_{\mathit{interval}} = \) <code>intervalCounter / resolution</code>.</p>
<p class="tableblock"><a href="#intervalCounter"><code>intervalCounter</code></a> and <a href="#resolution"><code>resolution</code></a> have no default value.
If present the value of this attribute must be greater than 0.
This attribute may be present if <a href="#supportsFraction"><code>supportsFraction = true</code></a> and Clock type is <a href="#constant-clock"><code>constant</code></a>, <a href="#fixed-clock"><code>fixed</code></a> or <a href="#tunable-clock"><code>tunable</code></a> <a href="#periodic-clock">periodic Clocks</a>.
It must not be used otherwise.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shiftCounter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="shiftCounter"></a>This value defines (together with <a href="#resolution"><code>resolution</code></a>) the delay of the first clock activation relative to \(t_{\mathit{start}}\) (<a href="#startTime"><code>startTime</code></a>):</p>
<p class="tableblock">\(T_{\mathit{shift}} = \) <code>shiftCounter / resolution</code>.</p>
<p class="tableblock">This attribute requires that <a href="#intervalCounter"><code>intervalCounter</code></a> is present.
The value of this attribute value must be equal to or greater than <code>0</code>.
Default value is <code>0</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="definition-of-log-categories"><a class="link" href="#definition-of-log-categories">2.4.5. Log Categories</a></h4>
<div class="paragraph">
<p>Element <code>&lt;fmiModelDescription&gt;&lt;LogCategories&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-LogCategories" class="imageblock text-center">
<div class="content">
<img src="images/schema/LogCategories.png" alt="LogCategories" width="80%">
</div>
<div class="title">Figure 20. LogCategories element.</div>
</div>
<div class="paragraph">
<p><code>&lt;LogCategories&gt;</code> defines an unordered set of category strings that classify output of the callback function <a href="#logMessage"><code>logMessage</code></a>.
The importer may use the function <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a> to control for which <code>&lt;LogCategories&gt;</code> the callback function <a href="#logMessage"><code>logMessage</code></a> is allowed to be called.
The <code>name</code> attribute of <code>&lt;Category&gt;</code> must be <a href="#uniqueNameAttribute">unique</a> with respect to all other elements of the <code>&lt;LogCategories&gt;</code> list.</p>
</div>
<div class="paragraph">
<p><a href="#table-standard-categories">Table 16</a> shows the standardized values for <code>name</code> of <code>&lt;Category&gt;</code>.
These names should be used if a tool supports the corresponding log category.
If an FMU supports one of these log categories, then an element <code>&lt;Category&gt;</code> with this <code>name</code> must be added to <code>&lt;LogCategories&gt;</code>.
Any other FMU specific <code>&lt;LogCategories&gt;</code> may be defined.</p>
</div>
<table id="table-standard-categories" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Standard <code>name</code> definitions for <code>&lt;Category&gt;</code>.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logEvents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log all events (during initialization and simulation).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logSingularLinearSystems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the solution of linear systems of equations if the solution is singular (and the tool picked one solution of the infinitely many solutions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logNonlinearSystems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the solution of nonlinear systems of equations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logDynamicStateSelection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the dynamic selection of <a href="#state">states</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusWarning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <a href="#fmi3Warning"><code>fmi3Warning</code></a> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusDiscard</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <a href="#fmi3Discard"><code>fmi3Discard</code></a> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <a href="#fmi3Error"><code>fmi3Error</code></a> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusFatal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <a href="#fmi3Fatal"><code>fmi3Fatal</code></a> status from any function.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The optional attribute <code>description</code> shall contain a description of the respective log category.</p>
</div>
<div class="paragraph">
<p><em>[Typically, this string can be shown by a tool if more details for a log category are presented.</em>
<em>This approach to define <code>&lt;LogCategories&gt;</code> has the following advantages:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>An importer may present the possible log categories in a menu and the user can select the desired one.</em><br></p>
</li>
<li>
<p><em>The log output is drastically reduced, because via <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a> the categories are set that shall be logged and therefore the FMU will print only the messages with the corresponding categories to the <a href="#logMessage"><code>logMessage</code></a> function.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Note that since element <code>&lt;LogCategories&gt;</code> is optional, an FMU does not need to expose its log categories.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="DefaultExperiment"><a class="link" href="#DefaultExperiment">2.4.6. Default Experiment</a></h4>
<div class="paragraph">
<p>Element <code>&lt;fmiModelDescription&gt;&lt;DefaultExperiment&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-DefaultExperiment" class="imageblock text-center">
<div class="content">
<img src="images/schema/DefaultExperiment.png" alt="DefaultExperiment" width="60%">
</div>
<div class="title">Figure 21. DefaultExperiment element.</div>
</div>
<div class="paragraph">
<p><a id="stepSize"></a><code>&lt;DefaultExperiment&gt;</code> consists of the optional default start time, stop time, relative tolerance, and step size for a simulation run.
A tool may ignore this information.<br>
<em>[However, it is convenient for a user that <a href="#startTime"><code>startTime</code></a>, <a href="#stopTime"><code>stopTime</code></a>, <a href="#tolerance"><code>tolerance</code></a> and <a href="#stepSize"><code>stepSize</code></a> have already a meaningful default value for the model at hand.]</em><br>
Furthermore, for Co-Simulation FMUs the <a href="#stepSize"><code>stepSize</code></a> defines the preferred <a href="#communicationStepSize"><code>communicationStepSize</code></a>.
<a href="#startTime"><code>startTime</code></a>, <a href="#stopTime"><code>stopTime</code></a> and <a href="#stepSize"><code>stepSize</code></a> refer to the unit of the <a href="#independent"><code>independent</code></a> variable.</p>
</div>
</div>
<div class="sect3">
<h4 id="ModelVariables"><a class="link" href="#ModelVariables">2.4.7. Model Variables</a></h4>
<div class="sect4">
<h5 id="_static_information"><a class="link" href="#_static_information">2.4.7.1. Static information</a></h5>
<div class="paragraph">
<p>The element of <code>&lt;fmiModelDescription&gt;&lt;ModelVariables&gt;</code> is the central part of the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
It provides the static information of all exposed variables and is defined as follows:</p>
</div>
<div id="figure-schema-ModelVariables" class="imageblock text-center">
<div class="content">
<img src="images/schema/ModelVariables.png" alt="ModelVariables" width="60%">
</div>
<div class="title">Figure 22. ModelVariables element.</div>
</div>
<div class="paragraph">
<p>The <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a> element consists of an arbitrary number of <code>&lt;fmi3Variable&gt;</code> elements (see <a href="#figure-schema-ModelVariables">Figure 22</a>).
<code>&lt;fmi3Variable&gt;</code> elements represent scalars or arrays of an arbitrary (but fixed) number of dimensions for variables of different types, like single-precision floating point, string or binary.
The schema definition is present in a separate file <code>fmi3Variable.xsd</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="Dimension"><a class="link" href="#Dimension">2.4.7.2. Array variables and structural parameters</a></h5>
<div class="paragraph">
<p>Except for Clocks, variable elements can represent an array variable.
Variable elements representing array variables must contain at least one <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> element.
Each <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> element specifies the size of one dimension of the array:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <a href="#start"><code>start</code></a> attribute of the <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> element is present, it defines a constant unsigned 64-bit integer size for this dimension.
The <a href="#variability"><code>variability</code></a> of the dimension size is <a href="#constant"><code>constant</code></a> in this case.</p>
</li>
<li>
<p>If the <a href="#valueReference"><code>valueReference</code></a> attribute of the <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> element is present, it defines the size of this dimension to be the value of the variable with the value reference given by the <a href="#valueReference"><code>valueReference</code></a> attribute.
The referenced variable must be a variable of type <code>&lt;UInt64&gt;</code>, and must either be a constant (i.e. with <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>) or a <a href="#structuralParameter"><code>structural parameter</code></a> (i.e. with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a>).
The <a href="#variability"><code>variability</code></a> of the dimension size is in this case the <a href="#variability"><code>variability</code></a> of the referenced variable.
A <a href="#structuralParameter"><code>structural parameter</code></a> must be a variable of type <code>&lt;UInt64&gt;</code> only if it is referenced in <a href="#Dimension"><code>&lt;Dimension&gt;</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two options are mutually exclusive, i.e., for each <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> element either a <a href="#start"><code>start</code></a> attribute or a <a href="#valueReference"><code>valueReference</code></a> attribute can be supplied, but not both.
However different <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> sizes for the same variable may be specified using different mechanisms by having different <a href="#variability"><code>variability</code></a> attributes.</p>
</div>
<div class="paragraph">
<p>All initial dimension sizes (defined by <a href="#start"><code>start</code></a> values either directly or indirectly in the <a href="#fmiModelDescription"><code>&lt;fmiModelDescription&gt;</code></a>) must be positive integers (i.e. not zero), so that no dimension is initially vanished.</p>
</div>
<div class="paragraph">
<p><em>[This allows importers to ignore <a href="#structuralParameter"><code>structural parameters</code></a> because their <a href="#start"><code>start</code></a> values reflect the internal default settings of <a href="#structuralParameter"><code>structural parameters</code></a>.</em>
<em>If we allowed 0 dimension sizes for initial values, tools that do not even care about changing dimension sizes would need to be able to handle vanishing arrays.]</em></p>
</div>
<div class="paragraph">
<p><em>[Example:</em>
<em>The variable <code>V</code> is a floating point vector parameter.</em>
<em>The length of the vector depends on the <a href="#structuralParameter"><code>structural parameter</code></a> <code>len</code>, connected via the <code>valueReference = "100"</code>.</em>
<em>The default length of the vector is 7.</em>
<em>This length can be changed in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> because the <a href="#variability"><code>variability</code></a> of the <a href="#structuralParameter"><code>structural parameter</code></a> <code>len</code> is <a href="#fixed"><code>fixed</code></a>.</em>
<em>The values of <code>V</code> can be changed whenever <a href="#tunable"><code>tunable</code></a> parameters can be changed.</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;UInt64 name="len" valueReference="100" causality="structuralParameter"
  variability="fixed" start="7"/&gt;
&lt;Float32 name="V" valueReference="1" causality="parameter" variability="tunable"
  start="0.1 -0.2 0.3 -0.4 0.5 -0.6 0.7"&gt;
  &lt;Dimension valueReference="100"/&gt;
&lt;/Float32&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>Changes to dimension sizes are constrained by the <code>min</code>/<code>max</code> attributes of the referenced <a href="#structuralParameter"><code>structural parameters</code></a>, which can be any non-negative integer, including zero.
Specifying a minimum size of zero on a <a href="#structuralParameter"><code>structural parameter</code></a> allows any related dimension sizes to be changed to zero in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> or <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>, thus causing the respective array size to go to zero, which leaves the respective array variable without any active elements.</p>
</div>
<div class="paragraph">
<p>The actual dimension sizes of arrays are also constrained by the importer, due to memory and addressing constraints:
Since the API functions to access variables and their values are constrained to <code>size_t</code> individual elements, platforms with addresses of less than 64-bit width will not be able to access elements beyond their addressing limits, neither will they be able to allocate enough memory or address space to represent such arrays.
For these reasons implementations must take platform-specific constraints into account when changing dimension sizes, and must be prepared to handle the inability of the FMU to adjust to the desired sizes during <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> or <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>Changing any dimension of a variable in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> or <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a> invalidates the variable&#8217;s current value (including its <a href="#start"><code>start</code></a> value).
Changing one <a href="#structuralParameter"><code>structural parameter</code></a> might affect dimension sizes of several variables.</p>
</div>
</div>
<div class="sect4">
<h5 id="_alias_variables"><a class="link" href="#_alias_variables">2.4.7.3. Alias variables</a></h5>
<div id="alias" class="paragraph">
<p>A variable can have any number of <code>&lt;Alias&gt;</code> elements that define a variable alias.
Each variable alias has a required attribute <code>name</code> whose value must be unique among all variables and variable aliases, and an optional attribute <code>description</code>.
Variable aliases of floating point variables may additionally have a <a href="#displayUnit"><code>displayUnit</code></a> that follows the same rules as for variables.</p>
</div>
<div class="paragraph">
<p><em>[ Example:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> &lt;Float64 name="engine.torque" valueReference="1" unit="N.m"&gt;
   &lt;Alias name="engine.torqueLbfFt" description="Engine torque in pound-foot"
     displayUnit="lbf.ft"/&gt;
 &lt;/Float64&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_variable_attributes"><a class="link" href="#_variable_attributes">2.4.7.4. Variable Attributes</a></h5>
<div class="paragraph">
<p>The common attributes of variables are shown in <a href="#figure-schema-fmi3ArrayableVariable">Figure 23</a>.</p>
</div>
<div id="figure-schema-fmi3ArrayableVariable" class="imageblock text-center">
<div class="content">
<img src="images/schema/fmi3ArrayableVariable.png" alt="fmi3ArrayableVariable" width="80%">
</div>
<div class="title">Figure 23. fmi3ArrayableVariable element.</div>
</div>
<table id="table-variableBase-attributes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. fmi3ArrayableVariable attribute details.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <a href="#uniqueNameAttribute">unique</a> name of the variable.
This attribute may follow a defined <a href="#namingSection">naming convention</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueReference</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="valueReference" class="paragraph">
<p>A handle of the variable to identify the variable value in the C-API functions and for references within the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
The <code>valueReference</code> must be unique for all variables of an FMU.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional description string describing the meaning of the variable.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>causality</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="causality" class="paragraph">
<p>Enumeration that defines the causality of the variable.
Allowed combinations of <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a> and their semantics are defined in <a href="#table-allowed-variability-causality-combinations">Table 18</a>.</p>
</div>
<div class="paragraph">
<p>Values of this enumeration are:</p>
</div>
<div id="parameter" class="paragraph">
<p><code>= parameter</code>: A data value that is provided by the importer or user to change the behavior of the FMU.
It is constant during the simulation (except for <a href="#tunable"><code>tunable</code></a> parameters) and should not be used in connections, except for parameter propagation in terminals as described in <a href="#GeneralRemarkOnSignal">Section 2.4.9.2.6</a>.
These parameters can be changed independently, unlike <a href="#calculatedParameter">calculated parameters</a>.</p>
</div>
<div id="calculatedParameter" class="paragraph">
<p><code>= calculatedParameter</code>: A data value that is constant during the simulation and is computed during initialization or when <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> change.</p>
</div>
<div id="input" class="paragraph">
<p><code>= input</code>: The variable value may be provided by the importer.<br>
<em>[For example, the importer could forward the output of another FMU into this input.]</em></p>
</div>
<div id="output" class="paragraph">
<p><code>= output</code>: The variable value may be used by the importer.<br>
<em>[For example, this value can be forwarded to an input of another FMU.]</em><br>
The algebraic relationships to the <a href="#input"><code>inputs</code></a> may be defined via the <a href="#dependencies"><code>dependencies</code></a> attribute of <a href="#Output"><code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;&lt;Output&gt;</code></a>.</p>
</div>
<div id="local" class="paragraph">
<p><code>= local</code>: Local variables are:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>continuous <a href="#state">states</a>.
These variables are referenced by the <a href="#derivative"><code>derivative</code></a> attribute of a <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a>.</p>
</li>
<li>
<p><a href="#ContinuousStateDerivative"><code>ContinuousStateDerivatives</code></a>, <a href="#ClockedState"><code>ClockedStates</code></a>, <a href="#EventIndicator"><code>EventIndicators</code></a> or <a href="#InitialUnknown"><code>InitialUnknowns</code></a>.
These variables are listed in the <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.<br></p>
</li>
<li>
<p><a id="localClock"></a> internal, intermediate variables or local clocks which may be read for debugging purposes and are not listed in the <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Setting of local variables:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>See <a href="#InitializationMode"><strong>Initialization Mode</strong></a> and <a href="#Instantiated"><strong>Instantiated</strong></a> for restrictions.</p>
</li>
<li>
<p>In super state <a href="#Initialized"><strong>Initialized</strong></a>, <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> must not be called on any of the local variables.
Only in Model Exchange, continuous <a href="#state">states</a> can be set with <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Local variable values must not be used as input to another model or FMU.</p>
</div>
<div id="independent" class="paragraph">
<p><code>= independent</code>: The independent variable (usually <code>time</code> <em>[but could also be, for example, <code>angle</code>]</em>).
All variables are a function of this <a href="#independent"><code>independent</code></a> variable.
Exactly one variable of an FMU must be defined as <a href="#independent"><code>independent</code></a>.
If the unit for the independent variable is not defined, it is implicitly <code>s</code> (seconds).
The independent variable must be defined as a floating point type without a <a href="#start"><code>start</code></a> attribute.
It is not allowed to call function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> on an <a href="#independent"><code>independent</code></a> variable.
See <a href="#advancing-time">Section 2.2.6</a> for how the independent variable is set.
The actual value may be inquired with <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a>.</p>
</div>
<div id="structuralParameter" class="paragraph">
<p><code>= structuralParameter</code>: The variable value can only be changed in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> or <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>.
The <a href="#start"><code>start</code></a> attribute is mandatory.
A <a href="#structuralParameter"><code>structural parameter</code></a> must not have a <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> element.
A <a href="#structuralParameter"><code>structural parameter</code></a> may be referenced in <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> elements.
If a <a href="#structuralParameter"><code>structural parameter</code></a> is referenced in <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> elements, it must be of type <code>&lt;UInt64&gt;</code> and its <a href="#start"><code>start</code></a> attribute must be larger than 0.
The <code>min</code> attribute might still be 0.</p>
</div>
<div class="paragraph">
<p>The default of <a href="#causality"><code>causality</code></a> is <a href="#local"><code>local</code></a>.<br>
A continuous-time <a href="#state">state</a> or an event indicator must have <a href="#causality"><code>causality</code></a> = <a href="#local"><code>local</code></a> or <a href="#output"><code>output</code></a>, see also <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.<br>
The causality of variables of type <a href="#Clock">Clock</a> must be either <a href="#input"><code>input</code></a>, <a href="#output"><code>output</code></a> or <a href="#local"><code>local</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>variability</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="variability" class="paragraph">
<p>Enumeration that defines the time dependency of the variable, in other words, it defines the time instants when a variable may be changed by the importer or may change its value due to FMU internal computations, depending on their <a href="#causality"><code>causality</code></a>.</p>
</div>
<div class="paragraph">
<p><em>[For example, <a href="#discrete"><code>discrete</code></a> variables change their values only at event instants (ME) or at communication points (CS and SE) and it is therefore only necessary to inquire them with <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> them at these points in time.]</em></p>
</div>
<div class="paragraph">
<p>Allowed combinations of <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a> and their semantics are defined in <a href="#table-allowed-variability-causality-combinations">Table 18</a>.</p>
</div>
<div class="paragraph">
<p>Values of this enumeration are:</p>
</div>
<div id="constant" class="paragraph">
<p><code>= constant</code>: The value of the variable never changes.</p>
</div>
<div id="fixed" class="paragraph">
<p><code>= fixed</code>: The value of the variable is fixed in super state <a href="#Initialized"><strong>Initialized</strong></a>, in other words, after <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> was called the variable value does not change anymore.
The default for variables of causality <code>parameter</code>, <code>structural parameter</code> or <code>calculated parameter</code> is <code>fixed</code>.</p>
</div>
<div id="tunable" class="paragraph">
<p><code>= tunable</code>: The value of the variable is constant between events (ME and CS if <a href="#EventMode"><strong>Event Mode</strong></a> is supported) and between communication points (CS and SE).
A <a href="#parameter"><code>parameter</code></a> with <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> may be changed only in <a href="#EventMode"><strong>Event Mode</strong></a> or, if <a href="#EventMode"><strong>Event Mode</strong></a> is not supported, at communication points (CS and SE).</p>
</div>
<div id="discrete" class="paragraph">
<p><code>= discrete</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Model Exchange: The value of the variable may change only in <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</li>
<li>
<p>Co-Simulation: If <a href="#EventMode"><strong>Event Mode</strong></a> is used (see <a href="#eventModeUsed"><code>eventModeUsed</code></a>), the value of the variable may only change in <a href="#EventMode"><strong>Event Mode</strong></a>.
If <a href="#EventMode"><strong>Event Mode</strong></a> is not used, the value may change at communication points and the FMU must detect and handle such events internally.
During <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>, <a href="#discrete"><code>discrete</code></a> variables are not allowed to change.</p>
</li>
<li>
<p>Scheduled Execution: The value may change only at communication points.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="#variability"><code>variability</code></a> of <a href="#Clock">Clocks</a> must be <a href="#discrete"><code>discrete</code></a>.
The <a href="#variability"><code>variability</code></a> of <a href="#clocked-variable"><code>clocked variables</code></a> must be <a href="#discrete"><code>discrete</code></a> or <a href="#tunable"><code>tunable</code></a>.
The default for variables of causality <code>input</code>, <code>output</code> or <code>local</code> of type other than <code>&lt;Float32&gt;</code> or <code>&lt;Float64&gt;</code> is <a href="#discrete"><code>discrete</code></a>.</p>
</div>
<div id="continuous" class="paragraph">
<p><code>= continuous</code>: Only variables of type <code>&lt;Float32&gt;</code> or <code>&lt;Float64&gt;</code> may be <a href="#continuous"><code>continuous</code></a>.
The default for variables of type <code>&lt;Float32&gt;</code> and <code>&lt;Float64&gt;</code> and causality other than <code>parameter</code>, <code>structural parameter</code> or <code>calculated parameter</code> is <a href="#continuous"><code>continuous</code></a>.
Variables with <a href="#variability"><code>variability</code></a> <code>continuous</code> may change in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> and in super state <a href="#Initialized"><strong>Initialized</strong></a>.</p>
</div>
<div class="paragraph">
<p>For more explanations on value changes see <a href="#smoothness">Section 4.1.1</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canHandleMultipleSetPerTimeInstant</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="canHandleMultipleSetPerTimeInstant" class="paragraph">
<p>Only for variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>.<br>
The default value is <code>true</code>.
If <code>canHandleMultipleSetPerTimeInstant = false</code>, then only one <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> call is allowed for this variable per super-dense time instant in <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p><em>[This flag can be set to <code>false</code> for variables where discrete-time states are directly updated when assigned (</em> \(\mathbf{x}_{d} := f(\mathbf{x}_{d},\mathbf{u}_{c+d})\) <em>instead of</em> \(\mathbf{x}_{d} := f({}^\bullet\mathbf{x}_{d},\mathbf{u}_{c+d})\) <em>).</em>
<em>If an <a href="#output"><code>output</code></a> depends on this <a href="#input"><code>input</code></a> and on discrete-time states, then an algebraic loop could be formed with such an <a href="#input"><code>input</code></a>.</em>
<em>Such loops cannot be solved iteratively because of the limitation on <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a>.</em>
<em>Therefore, such an <a href="#input"><code>input</code></a> should not appear in an algebraic loop.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intermediateUpdate</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="intermediateUpdate" class="paragraph">
<p>If this boolean attribute is <code>true</code>, the variable can be accessed in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.
Only continuous-time variables can have <a href="#intermediateUpdate"><code>intermediateUpdate = true</code></a>.
The default value of this attribute is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Variables of type <a href="#Clock">Clock</a> must not have the <a href="#intermediateUpdate"><code>intermediateUpdate</code></a> attribute.</p>
</div>
<div class="paragraph">
<p>This attribute is ignored in Model Exchange and Scheduled Execution.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>previous</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="previous" class="paragraph">
<p>If present, this variable is a <a href="#ClockedState"><code>&lt;ClockedState&gt;</code></a> and this attribute contains the value reference of the variable with the previous value.
The following constraints apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only clocked variables (i.e. variables with the attribute <a href="#clocks"><code>clocks</code></a>) may have the <a href="#previous"><code>previous</code></a> attribute.</p>
</li>
<li>
<p>Only variables with <a href="#variability"><code>variability = discrete</code></a> may have the <a href="#previous"><code>previous</code></a> attribute.</p>
</li>
<li>
<p>Variables of type <a href="#Clock">Clock</a> must not have the <a href="#previous"><code>previous</code></a> attribute.</p>
</li>
<li>
<p>Two variables must not have the same <a href="#previous"><code>previous</code></a> attribute reference.</p>
</li>
<li>
<p>A variable must not refer to itself in the <a href="#previous"><code>previous</code></a> attribute.</p>
</li>
<li>
<p>The variable referenced by the <a href="#previous"><code>previous</code></a> attribute must have the same numeric type, <a href="#variability"><code>variability = discrete</code></a>, and must not have <a href="#causality"><code>causality = input</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[For example, if <code>previous = 3</code> for variable <code>8</code>, then variable <code>3</code> is the previous value of variable <code>8</code>.</em>
<em>See also <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>.</em>
<em>Note: This is reverse compared to the <a href="#derivative"><code>derivative</code></a> attribute.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clocks</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="clocks" class="paragraph">
<p>If present, this variable is clocked.
The value of the attribute <a href="#clocks"><code>clocks</code></a> is a non-empty list of value references of <a href="#Clock">Clocks</a> this variable belongs to.
Only variables with <a href="#variability"><code>variability = discrete</code></a> or <a href="#variability"><code>variability = tunable</code></a> can have this attribute.
<em>[Some importers might require a variable to be dependent on a single Clock for technical reasons.</em>
<em>They could reject FMUs violating this restriction.</em>
<em>Note: It is not further restricted, which variables can be clocked to not restrict currently unknown use cases.</em>
<em>For example, an <a href="#input"><code>input</code></a> Clock could be a clocked variable of another (<a href="#input"><code>input</code></a> or <a href="#output"><code>output</code></a>) clock to indicate that it can only be activated when that Clock is active.]</em></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#table-allowed-variability-causality-combinations">Table 18</a> shows the combinations of <a href="#variability"><code>variability</code></a>/<a href="#causality"><code>causality</code></a> settings that are allowed.</p>
</div>
<table id="table-allowed-variability-causality-combinations" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Allowed combinations of <a href="#variability"><code>variability</code></a>/<a href="#causality"><code>causality</code></a>.</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><a href="#variability"><code>variability</code></a></p></th>
<th class="tableblock halign-center valign-top" colspan="7"><p class="tableblock"><a href="#causality"><code>causality</code></a></p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#structuralParameter"><code>structural Parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#parameter"><code>parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#calculatedParameter"><code>calculated Parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#output"><code>output</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#local"><code>local</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#independent"><code>independent</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#constant"><code>constant</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(a)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(a)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(a)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(a)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(7)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(10)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(c)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#fixed"><code>fixed</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(16)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(1)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(3)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(d)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(e)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(11)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(c)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#tunable"><code>tunable</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(17)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(2)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(4)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(d)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(e)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(12)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(c)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#discrete"><code>discrete</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(5)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(8)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(13)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(c)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#continuous"><code>continuous</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;(b)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(6)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(9)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(14)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(15)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Discussion of the combinations that are not allowed:</em></p>
</div>
<table id="table-Combinations-not-allowed" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Combinations of variability and causality that are not allowed and why.</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><em>Explanation why this combination is not allowed</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>(a)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The combinations <a href="#constant"><code>constant</code></a> / <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#constant"><code>constant</code></a> / <a href="#parameter"><code>parameter</code></a>, <a href="#constant"><code>constant</code></a> / <a href="#calculatedParameter"><code>calculatedParameter</code></a> and <a href="#constant"><code>constant</code></a> / <a href="#input"><code>input</code></a> do not make sense, since <a href="#parameter"><code>parameters</code></a> and <a href="#input"><code>inputs</code></a> are set by the importer, whereas <a href="#constant"><code>constant</code></a> variables have an unchangeable value.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>(b)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The combinations <a href="#discrete"><code>discrete</code></a> / <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#discrete"><code>discrete</code></a> / <a href="#parameter"><code>parameter</code></a>, <a href="#discrete"><code>discrete</code></a> / <a href="#calculatedParameter"><code>calculatedParameter</code></a>, <a href="#continuous"><code>continuous</code></a> / <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#continuous"><code>continuous</code></a> / <a href="#parameter"><code>parameter</code></a> and <a href="#continuous"><code>continuous</code></a> / <a href="#calculatedParameter"><code>calculatedParameter</code></a> do not make sense, since <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a> define variables that do not depend on time, whereas <a href="#discrete"><code>discrete</code></a> and <a href="#continuous"><code>continuous</code></a> define variables where the values can change during simulation.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>(c)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>For an <a href="#independent"><code>independent</code></a> variable only <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a> makes sense.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>(d)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#input"><code>input</code></a> has exactly the same properties as a <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a>.</em>
<em>For simplicity, only <a href="#fixed"><code>fixed</code></a> and <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> are allowed.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>(e)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#output"><code>output</code></a> has exactly the same properties as a <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a>.</em>
<em>For simplicity, only <a href="#fixed"><code>fixed</code></a> and <a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameters</code></a> are allowed.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Discussion of the combinations that are allowed</em>:</p>
</div>
<table id="table-Combinations-allowed" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Combinations of variability and causality that are allowed and why.</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 25%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><em>Setting</em></th>
<th class="tableblock halign-left valign-top"><em>Example</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(1)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Non-<a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(2)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>Tunable</code></a> <a href="#parameter"><code>parameter</code></a> (<a href="#HowToTreatTunable">See below this table.</a>).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(3)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Non-<a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a> (variable that depends directly or indirectly on constants or <a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameters</code></a>).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(4)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>Tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a> (variable that depends directly or indirectly on constants or <a href="#fixed"><code>fixed</code></a> and <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a>).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(5)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>discrete</code></a> <a href="#input"><code>input</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>Discrete</code></a> <a href="#input"><code>input</code></a> variable from the importer.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(6)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#input"><code>input</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>Continuous</code></a> <a href="#input"><code>input</code></a> variable from the importer.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(7)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#constant"><code>constant</code></a> <a href="#output"><code>output</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable where the value never changes and that can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(8)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>discrete</code></a> <a href="#output"><code>output</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>Discrete</code></a> variable that is computed in the FMU.</em>
<em>Can be used by the importer.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(9)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#output"><code>output</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>Continuous</code></a> variable that is computed in the FMU and can be used by the importer.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(10)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#constant"><code>constant</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable that never changes its value.</em>
<em>Cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(11)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local variable that depends on <a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameters</code></a> only and is computed in the FMU.</em>
<em>Cannot be used in another model.</em>
<em>After initialization, the value of this <a href="#local"><code>local</code></a> variable cannot change.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(12)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local variable that depends on <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> only and is computed in the FMU.</em>
<em>Cannot be used in another model.</em>
<em>The value of this <a href="#local"><code>local</code></a> variable can only change during initialization and at event instants, provided a <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a> was changed.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(13)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>discrete</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>Discrete</code></a> variable that is computed in the FMU and cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(14)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>Continuous</code></a> variable that is computed in the FMU and cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(15)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#independent"><code>independent</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>All variables are a function of the continuous-time variable marked as <a href="#independent"><code>independent</code></a>.</em>
<em>Usually, this is <code>time</code>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(16)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#structuralParameter"><code>structuralParameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#parameter"><code>Parameter</code></a> used in <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> element.</em>
<em>Can be changed in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a>.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>(17)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structuralParameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#parameter"><code>Parameter</code></a> used in <a href="#Dimension"><code>&lt;Dimension&gt;</code></a> element.</em>
<em>Can be changed in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a> and in <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>.</em></p></td>
</tr>
</tbody>
</table>
<div id="HowToTreatTunable" class="paragraph">
<p><em>How to treat <a href="#tunable"><code>tunable</code></a> variables:</em></p>
</div>
<div class="paragraph">
<p><em>A <a href="#parameter"><code>parameter</code></a> p is a variable that does not change its value during simulation, in other words, dp/dt = 0.</em>
<em>If the <a href="#parameter"><code>parameter</code></a> p is changing, then Dirac impulses are introduced since dp/dt of a discontinuous <a href="#constant"><code>constant</code></a> variable <code>p</code> is a Dirac impulse.</em>
<em>Even if this Dirac impulse would be modeled correctly by the FMU, it would introduce unwanted <code>vibrations</code>.</em>
<em>Furthermore, in many cases the model equations are derived under the assumption of a <a href="#constant"><code>constant</code></a> value (like mass or capacity), and the model equations would be different if <code>p</code> would be time varying.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Model Exchange:</em><br>
<em>Therefore, "tuning a (structural) <a href="#parameter"><code>parameter</code></a>" during simulation does not mean to "change the parameter online" during simulation.</em>
<em>Instead, this is a short hand notation for:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Stop the simulation at an event instant (usually, a <a href="#step-event">step event</a>, in other words, after a successful integration step).</em></p>
</li>
<li>
<p><em>Change the values of the <a href="#tunable"><code>tunable</code></a> (structural) <a href="#parameter"><code>parameters</code></a>.</em>
<em>For <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a>, the <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a> must be entered before and left afterwards.</em></p>
</li>
<li>
<p><em>Compute all <a href="#parameter"><code>parameters</code></a> (and sizes of variables, <a href="#state">states</a>, <a href="#derivative"><code>derivatives</code></a>, event indicators, &#8230;&#8203;) that depend on the <a href="#tunable"><code>tunable</code></a> (structural) <a href="#parameter"><code>parameters</code></a>.</em></p>
</li>
<li>
<p><em>Newly start the simulation using as initial values previously stored values and the new values of the <a href="#parameter"><code>parameters</code></a>.</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Basically this means that a new simulation run is started from the previous FMU state with changed <a href="#parameter"><code>parameter</code></a> values.</em>
<em>With this interpretation, changing <a href="#parameter"><code>parameters</code></a> online is "clean", as long as these changes appear at an event instant.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Co-Simulation:</em>
<em>Changing of <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> is allowed before an <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> call (so, whenever an <a href="#input"><code>input</code></a> can be set with <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a>) and before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called (that is before and during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>).</em>
<em>The FMU internally carries out event handling if necessary.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Scheduled Execution:</em>
<em>Changing of <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> is allowed before an <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call (so, whenever an <a href="#input"><code>input</code></a> can be set with <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a>) and before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called (that is before and during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>).]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_type_specific_properties"><a class="link" href="#_type_specific_properties">2.4.7.5. Type-specific properties</a></h5>
<div class="paragraph">
<p><a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a> can be of different types, for example <a href="#figure-schema-Float64">Float64</a>, <a href="#figure-schema-Int32">Int32</a>, <a href="#figure-schema-Boolean">Boolean</a>, <a href="#figure-schema-Binary">Binary</a>, <a href="#figure-schema-Enumeration">Enumeration</a> and <a href="#figure-schema-Clock">Clock</a>.</p>
</div>
<div id="figure-schema-Float64" class="imageblock text-center">
<div class="content">
<img src="images/schema/Float64.png" alt="Float64" width="70%">
</div>
<div class="title">Figure 24. Float64 element.</div>
</div>
<div id="figure-schema-Int32" class="imageblock text-center">
<div class="content">
<img src="images/schema/Int32.png" alt="Int32" width="70%">
</div>
<div class="title">Figure 25. Int32 element.</div>
</div>
<div id="figure-schema-Boolean" class="imageblock text-center">
<div class="content">
<img src="images/schema/Boolean.png" alt="Boolean" width="70%">
</div>
<div class="title">Figure 26. Boolean element.</div>
</div>
<div id="figure-schema-Binary" class="imageblock text-center">
<div class="content">
<img src="images/schema/Binary.png" alt="Binary" width="70%">
</div>
<div class="title">Figure 27. Binary element.</div>
</div>
<div id="figure-schema-Enumeration" class="imageblock text-center">
<div class="content">
<img src="images/schema/Enumeration.png" alt="Enumeration" width="70%">
</div>
<div class="title">Figure 28. Enumeration element.</div>
</div>
<div id="figure-schema-Clock" class="imageblock text-center">
<div class="content">
<img src="images/schema/Clock.png" alt="Clock" width="70%">
</div>
<div class="title">Figure 29. Clock element.</div>
</div>
<div class="paragraph">
<p>The attributes common to all variable types are defined in <a href="#table-type-details">Table 15</a> and <a href="#table-variableBase-attributes">Table 17</a>.
Type specific attributes are listed in the following table.</p>
</div>
<table id="table-type-attributes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Type specific attributes.</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>declaredType</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If present, name of type defined with <code>&lt;TypeDefinitions&gt;&lt;TypeDefinition&gt;</code>.
The attributes defined in the corresponding <code>&lt;TypeDefinition&gt;</code> (see <a href="#definition-of-types">Section 2.4.4</a>) are used as defaults.
<em>[For example, if <code>min</code> is present both in variable type element of <code>&lt;TypeDefinition&gt;</code> and in the specific variable type element of the variable, then the <code>min</code> of the variable is actually used.]</em>
For <code>&lt;Enumeration&gt;</code> the attribute <code>declaredType</code> is required because the <code>&lt;Enumeration&gt;</code> items are defined in <code>&lt;TypeDefinitions&gt;&lt;TypeDefinition&gt;</code>.
For all other types, this attribute is optional.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unit</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This attribute defines the unit of the variable by referencing a <code>&lt;UnitDefinitions&gt;&lt;Unit&gt;</code> with the same <code>name</code>, which must exist.
Variables without unit must not have a <code>unit</code> attribute.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>displayUnit</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Default display unit of the variable referencing to a <code>&lt;DisplayUnit&gt;</code> which must exist under <code>&lt;UnitDefinitions&gt;&lt;Unit&gt;</code> with the <code>name</code> of <code>unit</code>.
The conversion to the <code>unit</code> is defined with the element <code>&lt;fmiModelDescription&gt;&lt;UnitDefinitions&gt;&lt;Unit&gt;&lt;DisplayUnit&gt;</code>.
If <code>displayUnit</code> is defined a <code>unit</code> must also be defined.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initial</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="initial" class="paragraph">
<p>Enumeration that defines how the variable is initialized, i.e. if a <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> is allowed and how the FMU internally treats this value in <a href="#Instantiated"><strong>Instantiated</strong></a> and <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>For the variable with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>, the attribute <a href="#initial"><code>initial</code></a> must not be provided, because its start value is set with the <a href="#startTime"><code>startTime</code></a> parameter of <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>.</p>
</div>
<div class="paragraph">
<p>The attribute <a href="#initial"><code>initial</code></a> for other variables can have the following values and meanings:</p>
</div>
<div id="exact" class="paragraph">
<p><code>= exact</code>: The variable is initialized with the <a href="#start"><code>start</code></a> value by the FMU.
The importer may set a different initial value using <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a>.</p>
</div>
<div id="approx" class="paragraph">
<p><code>= approx</code>: The variable is an iteration variable of an algebraic loop within the FMU and the
iterative solution process in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> starts with the <a href="#start"><code>start</code></a> value as guess value.
<em>[The importer may call <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> in <a href="#Instantiated"><strong>Instantiated</strong></a> to help the FMU find a solution.]</em></p>
</div>
<div id="calculated" class="paragraph">
<p><code>= calculated</code>: The variable is calculated by the FMU from other variables during initialization.
For <code>calculated</code> variables a <a href="#start"><code>start</code></a> attribute must not be provided.</p>
</div>
<div class="paragraph">
<p><a href="#table-definition-initial">Table 22</a> defines the allowed values for <a href="#initial"><code>initial</code></a> as combination of <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a> and the default value if <a href="#initial"><code>initial</code></a> is not present.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="start" class="paragraph">
<p>Initial or guess value of the variable.
During instantiation, the FMU initializes its variables with their <a href="#start"><code>start</code></a> values.
<em>[Therefore, calling</em> <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> <em>to set <a href="#start"><code>start</code></a> values is only necessary, if a different value as stored in the XML file is desired.</em>
<em>It is not allowed to change the start values in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file of an FMU, as this would break the consistency with the hard-coded start values within the FMU.</em>
<em>This could lead to unpredictable behavior of the FMU in different importers, as it is not mandatory to call <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> to set <a href="#start"><code>start</code></a> values during initialization.]</em></p>
</div>
<div class="paragraph">
<p>The <a href="#start"><code>start</code></a> attribute is either a single value or a list of values.
The serialization of a multi-dimensional array variable is described in <a href="#serialization-of-variables">Section 2.2.7.1</a>.
If only a single value is given for a multi-dimensional array, all values of the multi-dimensional array are equal to this value.</p>
</div>
<div class="paragraph">
<p>For variables of type <code>&lt;String&gt;</code> and <code>&lt;Binary&gt;</code>, the start values are not given as a list in the <code>start</code> attribute but as a sequence of <code>&lt;Start&gt;</code> elements with a <code>value</code> attribute.</p>
</div>
<div class="paragraph">
<p><em>[ Example:</em>
<em>Start values of string array variable</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;String name="strings" valueReference="1" causality="parameter" variability="tunable"&gt;
  &lt;Dimension start="3"/&gt;
  &lt;Start value="First string" /&gt;
  &lt;Start value="Second string" /&gt;
  &lt;Start value="Third string" /&gt;
&lt;/String&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>The interpretation of <a href="#start"><code>start</code></a> is defined by variable attribute <a href="#initial"><code>initial</code></a>.<br>
If <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a>, a <a href="#start"><code>start</code></a> attribute must be provided.<br>
If <a href="#initial"><code>initial</code></a> = <a href="#calculated"><code>calculated</code></a> or <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>, it is not allowed to provide a <a href="#start"><code>start</code></a> attribute.</p>
</div>
<div class="paragraph">
<p>Variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> or <a href="#input"><code>input</code></a>, as well as variables with <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>, must have a <a href="#start"><code>start</code></a> attribute which has the following meaning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a>, the <a href="#start"><code>start</code></a> attribute defines the default value of the parameter.</p>
</li>
<li>
<p>If <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>, the <a href="#start"><code>start</code></a> attribute defines the value of the constant.</p>
</li>
<li>
<p>If <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, the <a href="#start"><code>start</code></a> value is used by the FMU as value of the <a href="#input"><code>input</code></a>, if it is not set by the importer, except for variables of type <a href="#Clock">Clock</a>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>derivative</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="derivative" class="paragraph">
<p>If present, then the variable with this attribute is the derivative of the variable with value reference given in <code>derivative</code>.<br>
<em>[For example, if <code>derivative = 3</code> for variable 8, then variable 8 is the derivative of variable 3 with respect to the <a href="#independent"><code>independent</code></a> variable (usually time).]</em><br>
This information may be used to signal that an <a href="#input"><code>input</code></a> or an <a href="#output"><code>output</code></a> is the derivative of another <a href="#input"><code>input</code></a> or <a href="#output"><code>output</code></a>, respectively.
Furthermore, this attribute defines the continuous <a href="#state">states</a> of the FMU.
The derivatives of continuous <a href="#state">states</a> of an FMU are listed as elements <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a> in <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.
All variables listed in these elements must have attribute <code>derivative</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reinit</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="reinit" class="paragraph">
<p>Only used in Model Exchange, ignored for the other interface types.
May only be present for a continuous-time <a href="#state">state</a>.<br>
If <code>true</code>, <a href="#state">state</a> may be reinitialized by the FMU in <a href="#EventMode"><strong>Event Mode</strong></a>.<br>
If <code>false</code>, <a href="#state">state</a> will not be reinitialized.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If <a href="#initial"><code>initial</code></a> is not present in a type that can have that attribute, its value is defined by <a href="#table-definition-initial">Table 22</a> based on the values of <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a> (default <span class="underline">underlined</span>):</p>
</div>
<table id="table-definition-initial" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Definition of <a href="#initial"><code>initial</code></a>.</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock"><a href="#variability"><code>variability</code></a></p></th>
<th class="tableblock halign-center valign-top" colspan="7"><p class="tableblock"><a href="#causality"><code>causality</code></a></p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#structuralParameter"><code>structural Parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#parameter"><code>parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#calculatedParameter"><code>calculated Parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#output"><code>output</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#local"><code>local</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#independent"><code>independent</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#constant"><code>constant</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#fixed"><code>fixed</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span><br>
approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span><br>
approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#tunable"><code>tunable</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span><br>
approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span><br>
approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#discrete"><code>discrete</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span><br>
exact<br>
approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span><br>
exact<br>
approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#continuous"><code>continuous</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">exact</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span><br>
exact<br>
approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="underline">calculated</span><br>
exact<br>
approx</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="namingSection"><a class="link" href="#namingSection">2.4.7.5.1. Variable Naming Conventions</a></h6>
<div class="paragraph">
<p>With attribute <a href="#variableNamingConvention"><code>variableNamingConvention</code></a> in <code>&lt;fmiModelDescription&gt;</code>, the convention is defined how the variable names have been constructed.
The importer may use this information to represent the names in a better way (for example, as a tree and not as a linear list).</p>
</div>
<div class="paragraph">
<p>In the following definitions, the <a href="https://en.wikipedia.org/wiki/Extended_BNF">Extended Backus-Naur Form (EBNF)</a> is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=   production rule
[ ] optional
{ } repeat zero or more times
|   or</pre>
</div>
</div>
<div class="paragraph">
<p>The names must be unique, non-empty strings.</p>
</div>
<div class="paragraph">
<p>The following conventions for scalar names are defined:</p>
</div>
<div class="paragraph">
<p><strong><a href="#variableNamingConvention"><code>variableNamingConvention = flat</code></a></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>name = Unicode-char { Unicode-char } // identical to xs:normalizedString
Unicode-char = any Unicode character without carriage return (#xD),
line feed (#xA) nor tab (#x9)</pre>
</div>
</div>
<div class="paragraph">
<p><strong><a href="#variableNamingConvention"><code>variableNamingConvention = structured</code></a></strong></p>
</div>
<div class="paragraph">
<p>Structured names are using "." as a separator between hierarchies.
A name consists of "_", letters and digits or may consist of any characters enclosed in single apostrophes.
A name may identify an array element on every hierarchical level using "[&#8230;&#8203;]" to identify the respective array index.
If an array is a leaf node of the variable hierarchy then the array can also be represented as a single variable of type array.
A <a href="#derivative"><code>derivative</code></a> of a variable is defined with <code>der(name)</code> for the first time derivative and <code>der(name,N)</code> for the N-th derivative.
Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle.engine.speed
resistor12.u
v_min
robot.axis.'motor #234'
der(pipe[3,4].T[14],2) // second time derivative of pipe[3,4].T[14]</pre>
</div>
</div>
<div class="paragraph">
<p>The precise syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>name            = identifier | "der(" identifier ["," unsignedInteger ] ")"
identifier      = B-name [ arrayIndices ] {"." B-name [ arrayIndices ] }
B-name          = nondigit { digit | nondigit } | Q-name
nondigit        = "pass:[_]" | letters "a" to "z" | letters "A" to "Z"
digit           = "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"
Q-name          = "'" ( Q-char | escape ) { Q-char | escape } "'"
Q-char          = nondigit | digit | "!" | "#" | "$" | "%" | "&amp;" | "(" | ")" |
                                     "*" | "+" | "," | "-" | "." | "/" | ":" |
                                     ";" | "&lt;" | "&gt;" | "=" | "?" | "@" | "[" |
                                     "]" | "^" | "{" | "}" | "|" | "~" | " "
escape          = "\'" | "\"" | "\?" | "\\" | "\a" | "\b" |
                  "\f" | "\n" | "\r" | "\t" | "\v"
arrayIndices    = "[" unsignedInteger {"," unsignedInteger} "]"
unsignedInteger = digit { digit }</pre>
</div>
</div>
<div class="paragraph">
<p><em>[This definition is identical to the syntax of an identifier in the <a href="#MLS12">Modelica Language Specification</a>.]</em></p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle
  transmission
    ratio
    outputSpeed
  engine
    inputSpeed
    temperature</pre>
</div>
</div>
<div class="paragraph">
<p>is mapped to the following list of variable names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle.transmission.ratio
vehicle.transmission.outputSpeed
vehicle.engine.inputSpeed
vehicle.engine.temperature</pre>
</div>
</div>
<div class="paragraph">
<p>It might be that not all elements of an array are present.</p>
</div>
<div class="paragraph">
<p>The <a href="#variableNamingConvention"><code>variableNamingConvention</code></a> <code>structured</code> does not define if arrays are 0-based or 1-based.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ModelStructure"><a class="link" href="#ModelStructure">2.4.8. Model Structure</a></h4>
<div class="paragraph">
<p>The structure of the model is defined in element <code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;</code>.
It defines the <a href="#model-dependencies">dependencies</a> between variables.</p>
</div>
<div class="paragraph">
<p>The required part of the model structure for all FMI types defines the ordering of outputs in <a href="#Output"><code>&lt;Output&gt;</code></a> and unknowns during initialization in <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a>.
A Model Exchange FMU must also expose all derivatives of continuous states in <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a> and all event indicators in <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a>.</p>
</div>
<div class="paragraph">
<p>The optional part of the model structure defines in which way <a href="#derivative"><code>derivatives</code></a>, <a href="#output"><code>outputs</code></a>, and initial unknowns depend on <a href="#input"><code>inputs</code></a> and/or <a href="#parameter"><code>parameters</code></a>, and continuous-time <a href="#state">states</a>.
The listed <a href="#dependencies"><code>dependencies</code></a> declare the dependencies between whole (multi-dimensional-)variables and not individual elements of the variables.
<em>[Dependencies of individual array elements can be retrieved during runtime using <a href="#fmi3GetVariableDependencies"><code>fmi3GetVariableDependencies</code></a>.]</em></p>
</div>
<div class="paragraph">
<p><a href="#figure-schema-ModelStructure">Figure 30</a> shows the definition of <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.</p>
</div>
<div id="figure-schema-ModelStructure" class="imageblock">
<div class="content">
<img src="images/schema/ModelStructure.png" alt="ModelStructure" width="90%">
</div>
<div class="title">Figure 30. ModelStructure element.</div>
</div>
<div class="paragraph">
<p>Note that attribute <a href="#dependenciesKind"><code>dependenciesKind</code></a> for element <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a> has less enumeration values as <a href="#dependenciesKind"><code>dependenciesKind</code></a> in the other lists, as detailed in <a href="#table-model-structure-elements">Table 23</a>.</p>
</div>
<div class="paragraph">
<p><a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a> consists of the elements detailed in <a href="#table-model-structure-elements">Table 23</a> (see also <a href="#figure-schema-ModelStructure">Figure 30</a>; the symbols of the mathematical equations describing the dependencies are defined in <a href="#concepts-model-exchange">Section 3.1</a>):</p>
</div>
<table id="table-model-structure-elements" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. ModelStructure elements.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Output</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="Output"></a>
Ordered list of all outputs, in other words, a list of value references where every corresponding variable must have <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> (and every variable with <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> must be listed here).
Attribute <a href="#dependencies"><code>dependencies</code></a> defines the dependencies of the <a href="#output"><code>outputs</code></a> from the knowns after the <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.
Attribute <a href="#dependencies"><code>dependencies</code></a> for <a href="#output"><code>output</code></a> <a href="#Clock"><code>Clocks</code></a> lists all known variables (including input clocks) that contribute to trigger a clock tick for that <a href="#outputClock">output Clock</a>.
The functional dependency is defined as:<br>
\({(\mathbf{y}_c, \mathbf{y}_d) := \mathbf{f}_{\mathit{output}}(\mathbf{x}_c, \mathbf{u}_c, \mathbf{u}_d, t, \mathbf{p})}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ContinuousStateDerivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="ContinuousStateDerivative"></a>
Ordered list of value references of all derivatives of continuous <a href="#state">states</a>.
The order defined by this list defines the order of the elements for <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>, <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>, and <a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a>.
<em>[Note that only <a href="#continuous"><code>continuous</code></a> floating point variables are listed here.</em>
<em>If a <a href="#state">state</a> or a <a href="#derivative"><code>derivative</code></a> of a <a href="#state">state</a> shall not be exposed from the FMU, or if states are not statically associated with a variable (due to <a href="#dynamic-state-selection">dynamic state selection</a>), then dummy variables have to be introduced, for example, <code>x[4]</code>, or <code>xDynamicStateSet2[5]</code>.]</em></p>
<p class="tableblock">The corresponding continuous-time <a href="#state">states</a> are defined by attribute <a href="#derivative"><code>derivative</code></a> of the corresponding variable state-derivative element.
<em>[Note that higher order derivatives must be mapped to first order derivatives but the mapping definition can be preserved due to attribute <a href="#derivative"><code>derivative</code></a>.</em>
<em>Example: if</em> \({\frac{\text{ds}}{\text{dt}} = v,\ \frac{\text{dv}}{\text{dt}} =f(..)}\) <em>,then</em> \({\left\{ v,\ \frac{\text{dv}}{\text{dt}} \right\}}\) <em>is the vector of state derivatives and attribute <a href="#derivative"><code>derivative</code></a> of</em> \({v}\) <em>references</em> \({s}\) <em>, and attribute <a href="#derivative"><code>derivative</code></a> of</em> \({\frac{\text{dv}}{\text{dt}}}\) <em>references</em> \({v}\) <em>.]</em><br>
For Co-Simulation, elements <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a> are ignored if capability flag <a href="#providesDirectionalDerivatives"><code>providesDirectionalDerivatives</code></a> has a value of <code>false</code>, in other words, it cannot be computed.
The functional dependency is defined as:<br>
\({\dot{\mathbf{x}}_c := \mathbf{f}_{\mathit{der}}(\mathbf{x}_c, \mathbf{u}_c, \mathbf{u}_d, t, \mathbf{p})}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ClockedState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="ClockedState"></a>
A <a href="#ClockedState"><code>&lt;ClockedState&gt;</code></a> is part of the discrete state of a model partition and represented by a clocked variable.
To which Clock or Clocks it belongs is described by the attribute <a href="#clocks"><code>clocks</code></a> of that variable.
Each <a href="#ClockedState"><code>&lt;ClockedState&gt;</code></a> must have the attribute <a href="#previous"><code>previous</code></a> to represent the previous value of this <a href="#ClockedState"><code>&lt;ClockedState&gt;</code></a>.
All clocked states must have <a href="#variability"><code>variability = discrete</code></a>, must have the attribute <a href="#clocks"><code>clocks</code></a>, and must not be of type <a href="#fmi3Clock"><code>fmi3Clock</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitialUnknown</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="InitialUnknown" class="paragraph">
<p>Ordered list of all exposed unknowns in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.
This list consists of all variables which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>are not <a href="#clocked-variable">clocked variables</a> and have <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> (with <a href="#initial"><code>initial</code></a> = <a href="#approx"><code>approx</code></a> or <a href="#calculated"><code>calculated</code></a>), or</p>
</li>
<li>
<p>have <a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a>, or</p>
</li>
<li>
<p>are continuous-time <a href="#state">states</a> or state derivatives (defined with elements <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a>) with <a href="#initial"><code>initial</code></a> = <a href="#approx"><code>approx</code></a> or <a href="#calculated"><code>calculated</code></a>, or</p>
</li>
<li>
<p>are <a href="#clocked-variable">clocked variables</a> that the FMU wishes to initialize in initialization mode.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The resulting list is not allowed to have duplicates (for example, if a <a href="#state">state</a> is also an <a href="#output"><code>output</code></a>, it is included only once in the list).<br>
Attribute <a href="#dependencies"><code>dependencies</code></a> defines the dependencies of the unknowns from the knowns in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.
The functional dependency is defined as:</p>
</div>
<div class="paragraph">
<p>\({\mathbf{v}_{\mathit{initialUnknowns}} := \mathbf{f}_{\mathit{init}}(\mathbf{u}_c, \mathbf{u}_d, t_{\mathit{start}}, \mathbf{v}_{\mathit{initial=exact}})}\)</p>
</div>
<div class="paragraph">
<p>Since, <a href="#output"><code>outputs</code></a>, continuous-time <a href="#state">states</a> and state derivatives are either present as knowns (if <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>) or as unknowns (if <a href="#initial"><code>initial</code></a> = <a href="#approx"><code>approx</code></a> or <a href="#calculated"><code>calculated</code></a>), they can be inquired with <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p><a href="#EventIndicator"><code>EventIndicators</code></a> are available during <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, however their dependencies are intended for debugging purposes only (and not for connection with other FMU&#8217;s), and therefore they must not be listed as <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a>.</p>
</div>
<div class="paragraph">
<p><em>[Example: Assume an FMU is defined in the following way:</em></p>
</div>
<div class="paragraph">
<p>\({(\mathbf{y}_{c+d}, \dot{\mathbf{x}}_c) := \mathbf{f}_{\mathit{init}}(\mathbf{x}_c, \mathbf{u}_{c+d}, t_{\mathit{start}}, \mathbf{p})}\)<br></p>
</div>
<div class="paragraph">
<p>\({(\mathbf{y}_{c+d}, \dot{\mathbf{x}}_c) := \mathbf{f}_{\mathit{sim}}(\mathbf{x}_c, \mathbf{u}_{c+d}, t_i, \mathbf{p})}\)<br></p>
</div>
<div class="paragraph">
<p><em>Therefore, the initial state</em> \({\mathbf{x}_c(t_{\mathit{start}})}\) <em>has <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> and the initial state derivative</em> \({\dot{\mathbf{x}}_c(t_{\mathit{start}})}\) <em>has <a href="#initial"><code>initial</code></a> = <a href="#calculated"><code>calculated</code></a>.</em>
<em>The importer can still initialize this FMU in steady-state, by using</em> \({\mathbf{x}_c(t_{\mathit{start}})}\) <em>as iteration variables and adding the equations</em> \({\dot{\mathbf{x}}_c(t_{\mathit{start}}) = \mathbf{0}}\) <em>in the importer.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EventIndicator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="EventIndicator"></a>
An ordered list of value references where every referenced variable must be an event indicator.
The serialized (if value reference points to array variable) and concatenated values of the variables referenced by the attribute <code>valueReference</code> form the array that can be retrieved with <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>.
The number of event indicators may change if one or more value references listed in <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a> point to array variables of variable size (see <a href="#fmi3GetNumberOfEventIndicators"><code>fmi3GetNumberOfEventIndicators</code></a>).
Only <a href="#continuous"><code>continuous</code></a> variables of type <code>Float32</code> and <code>Float64</code> can be referenced by <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a>.</p>
<p class="tableblock">For Co-Simulation and Scheduled Execution, <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a> elements are ignored.</p>
<p class="tableblock"><em>[The intention for connecting event indicators to variables via <code>valueReferences</code> is to facilitate debugging of the FMU.</em>
<em>If an event indicator shall not be exposed, or if event indicators are not statically associated with a variable (due to dynamic event indicator selection), then dummy variables have to be introduced, for example, <code>eventIndicator[4]</code>.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Elements <a href="#Output"><code>&lt;Output&gt;</code></a>, <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a>, <a href="#ClockedState"><code>&lt;ClockedState&gt;</code></a>, <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a>, and <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a> have (partially) the following attributes:</p>
</div>
<table id="table-output-der-initialUknown-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. <a href="#Output"><code>&lt;Output&gt;</code></a>, <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a>, <a href="#ClockedState"><code>&lt;ClockedState&gt;</code></a>, <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a>, and <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a> attribute details.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueReference</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The value reference of the unknown \({v_{\mathit{unknown}}}\).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependencies</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="dependencies" class="paragraph">
<p>Optional attribute defining the algebraic dependencies as list of value references of the unknown \({\mathbf{v}_{\mathit{unknown}}}\) directly with respect to \({\mathbf{v}_{\mathit{known}}}\).
For a real valued unknown and a real valued known, if the known is not listed among the dependencies then the partial derivative of the unknown with respect to that known is identically zero.
If dependencies is not present, it must be assumed that the unknown depends on all knowns.
If dependencies is present as empty list, the unknown depends on none of the knowns.
Otherwise the unknown depends on the knowns defined by the given value references.<br>
<em>[This means that all dependencies must be listed, also the dependencies of clocked variables on their clocks.]</em><br>
Knowns \({\mathbf{v}_{\mathit{known}}}\) in <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> (ME) and at communication points (CS and SE) for <a href="#Output"><code>&lt;Output&gt;</code></a> and <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a> elements are:<br></p>
</div>
<div class="ulist">
<ul>
<li>
<p>inputs (variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>),</p>
</li>
<li>
<p>continuous states and discrete-time states,</p>
</li>
<li>
<p>parameters (variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a>),</p>
</li>
<li>
<p><a href="#independent"><code>independent</code></a> variable (usually time; <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Knowns \({\mathbf{v}_{\mathit{known}}}\) in <a href="#InitializationMode"><strong>Initialization Mode</strong></a> (for elements <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a>) are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>inputs (variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>),</p>
</li>
<li>
<p>variables with <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>, <em>[for example, <a href="#parameter"><code>parameters</code></a> or initial <a href="#state">states</a>]</em></p>
</li>
<li>
<p><a href="#independent"><code>independent</code></a> variable (usually time; <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[The <a href="#independent"><code>independent</code></a> variable should be treated as any other variable when it comes to dependencies.</em>
<em>As only explicit dependencies are listed it is required that unknowns that depend on the <a href="#independent"><code>independent</code></a> variable have a partial derivative w.r.t this variable that is different from identically zero.</em>
<em>If the FMU supports <a href="#directionDerivatives">directional derivatives</a> or <a href="#adjointDerivatives">adjoined derivatives</a> the <a href="#independent"><code>independent</code></a> variable is a valid input to those functions if it is listed, just as any other listed variable.</em>
<em>For example, for a mechanical system, if it has the <a href="#independent"><code>independent</code></a> variable listed among the dependencies it is called a rheonomous system, otherwise it is called a scleronomous system.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependenciesKind</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="dependenciesKind" class="paragraph">
<p>If <a href="#dependenciesKind"><code>dependenciesKind</code></a> is present, <a href="#dependencies"><code>dependencies</code></a> must be present and must have the same number of list elements.
If <a href="#dependenciesKind"><code>dependenciesKind</code></a> is not present, it must be assumed that the unknown \({\mathbf{v}_{\mathit{unknown}}}\) depends on the knowns \({\mathbf{v}_{\mathit{known}}}\) without a particular structure.
Otherwise, the corresponding known \({\mathbf{v}_{\mathit{known},i}}\) enters the equation as:</p>
</div>
<div class="paragraph">
<p><code>= dependent</code>: no particular structure, \({{\mathbf{f}(..,\ \mathbf{v}}_{\mathit{known},i}},..)\)</p>
</div>
<div class="paragraph">
<p>The following <a href="#dependenciesKind"><code>dependenciesKind</code></a> is only allowed for floating point \({\mathbf{v}_{\mathit{unknown}}}\):</p>
</div>
<div class="paragraph">
<p><code>=</code> <a href="#constant"><code>constant</code></a>: constant factor, \({\mathbf{c} \cdot \mathbf{v}_{\mathit{known},i}}\) where \(\mathbf{c}\) is an expression that is evaluated before <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> is called.</p>
</div>
<div class="paragraph">
<p>The following <a href="#dependenciesKind"><code>dependenciesKind</code></a> is only allowed for floating point \({\mathbf{v}_{\mathit{unknown}}}\) in <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> (ME) and at communication points (CS and SE), and not for <a href="#InitialUnknown"><code>&lt;InitialUnknown&gt;</code></a> for <a href="#InitializationMode"><strong>Initialization Mode</strong></a>:</p>
</div>
<div class="paragraph">
<p><code>=</code> <a href="#fixed"><code>fixed</code></a>: fixed factor, \({\mathbf{p} \cdot \mathbf{v}_{\mathit{known},i}}\) where \(\mathbf{p}\) is an expression that is evaluated before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called.</p>
</div>
<div class="paragraph">
<p><code>=</code> <a href="#tunable"><code>tunable</code></a>: tunable factor, \({\mathbf{p} \cdot \mathbf{v}_{\mathit{known},i}}\) where \(\mathbf{p}\) is an expression that is evaluated before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called and in <a href="#EventMode"><strong>Event Mode</strong></a> or at a communication point (ME and CS) due to a change of a <a href="#tunable"><code>tunable</code></a> parameter.</p>
</div>
<div class="paragraph">
<p><code>=</code> <a href="#discrete"><code>discrete</code></a>: discrete factor, \({\mathbf{d} \cdot \mathbf{v}_{\mathit{known},i}}\) where \(\mathbf{d}\) is an expression that is evaluated before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called and in <a href="#EventMode"><strong>Event Mode</strong></a> or at a communication point (CS and SE).</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="fmiTerminalsAndIcons"><a class="link" href="#fmiTerminalsAndIcons">2.4.9. Terminals and Icons</a></h4>
<div class="paragraph">
<p>Terminals define semantic groups of variables.
This definition adds an additional layer to the interface description of the FMUs.
It does not change the <a href="#causality"><code>causality</code></a> of the variables (e.g. inputs will remain inputs, outputs will remain outputs, and parameters will remain parameters) but enables the definition of physical and bus-like connectors and variable groups that require special handling on the system level by the importer (e.g. flow variables and bus frames).
Icons define a graphical representation of an FMU and its terminals.</p>
</div>
<div class="paragraph">
<p>Both features are optional and may be defined in the separate XML file <code>terminalsAndIcons/terminalsAndIcons.xml</code>.<br>
<em>[The usage of a separate file enables backporting of this feature to previous FMI versions.]</em></p>
</div>
<div id="terminals_and_icons_overview" class="imageblock text-center">
<div class="content">
<img src="images/schema/fmiTerminalsAndIcons.png" alt="fmiTerminalsAndIcons" width="60%">
</div>
<div class="title">Figure 31. fmiTerminalsAndIcons element.</div>
</div>
<div class="paragraph">
<p>On the top level, the schema consists of the following elements (see <a href="#terminals_and_icons_overview">Figure 31</a>).</p>
</div>
<table id="table-terminal-and-icon-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. fmiTerminalAndIcons element details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute or Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmiVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This attribute declares the FMI version defining the XSD of the <code>terminalsAndIcons/terminalsAndIcons.xml</code> file.
Starting with FMI 3.0, this <code>fmiVersion</code> attribute must match the <code>fmiVersion</code> attribute of element <a href="#fmiModelDescription"><code>&lt;fmiModelDescription&gt;</code></a> of the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file.
If used in previous FMI versions, this attribute points to the FMI version defining this <code>terminalsAndIcons/terminalsAndIcons.xml</code> file (e.g. XSD, file location).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;GraphicalRepresentation&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, contains information for importers of FMUs to draw graphical representations of the FMU in a system view.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;Terminals&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, this allows combining variables (e.g. inputs, outputs and parameters) into logical groups, e.g.,  to ease connections on a system level and add semantic information required for system-level connections.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="graphicalRepresentation"><a class="link" href="#graphicalRepresentation">2.4.9.1. Definition of a Graphical Representation</a></h5>
<div class="sect5">
<h6 id="_overview_2"><a class="link" href="#_overview_2">2.4.9.1.1. Overview</a></h6>
<div class="paragraph">
<p>The graphical representation of the FMU and terminals are needed to more easily comprehend the meaning of connected FMUs and to help importers to display the terminals and the FMU icon in the way the exporter intended.</p>
</div>
<div class="paragraph">
<p>The graphical representation is fully optional.
The graphical representation of terminals is separate from the terminal definitions in the <code>&lt;Terminals&gt;</code> element.</p>
</div>
<div class="paragraph">
<p>There are two optional elements in the <code>&lt;GraphicalRepresentation&gt;</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The element <code>&lt;CoordinateSystem&gt;</code> defines the extent of the whole icon, graphical items may exceed that rectangle.</p>
</li>
<li>
<p>The element <code>&lt;Icon&gt;</code> defines the image position.</p>
</li>
</ul>
</div>
<div id="figure-schema-GraphicalRepresentation" class="imageblock text-center">
<div class="content">
<img src="images/schema/GraphicalRepresentation.png" alt="GraphicalRepresentation" width="100%">
</div>
<div class="title">Figure 32. GraphicalRepresentation element.</div>
</div>
</div>
<div class="sect5">
<h6 id="_coordinatesystem"><a class="link" href="#_coordinatesystem">2.4.9.1.2. CoordinateSystem</a></h6>
<div id="figure-schema-CoordinateSystem" class="imageblock text-center">
<div class="content">
<img src="images/schema/CoordinateSystem.png" alt="CoordinateSystem" width="70%">
</div>
<div class="title">Figure 33. CoordinateSytem element.</div>
</div>
<div class="paragraph">
<p>The <code>&lt;CoordinateSystem&gt;</code> element and its extent is used as reference for other graphical items.
It also provides a scaling factor to millimeter.</p>
</div>
<div class="paragraph">
<p>The coordinate system is defined by the coordinates of two points, the lower left (<code>x1</code>, <code>y1</code>) corner and the upper right (<code>x2</code>, <code>y2</code>) corner, where the coordinates of the first point shall be less than the coordinates of the second point <em>[a first quadrant coordinate system]</em>.
The x-axis is directed to the right, the y-axis is directed upwards.</p>
</div>
<div class="paragraph">
<p><em>[The exporting tool should define how the coordinate system unit relates to mm display or printout size.</em>
<em>However, an importer might choose to use the factor from the default coordinate system extent to the actual coordinate system extent to calculate a scaling factor, to match the default icon size in the importer.</em></p>
</div>
<div class="paragraph">
<p><em>The area defined by the coordinate system is suggested to be used as "clickable icon size" in importers.</em>
<em>A <code>&lt;Terminal&gt;</code> might be placed outside of this area, therefore the visible bounding box has to be determined by the importer.]</em></p>
</div>
<div class="paragraph">
<p>The coordinate system default is <code>x1=-100, y1=-100, x2=100, y2=100</code>.
This extent is used if the <code>&lt;CoordinateSystem&gt;</code> element is missing.
The default <code>suggestedScalingFactorTo_mm</code> is <code>0.1</code>.
So the default coordinate system display size should be <code>20 mm</code> width and <code>20 mm</code> height.</p>
</div>
<div class="paragraph">
<p>The FMU icon and all graphical representations provide the position and extent with the attributes <code>x1</code>, <code>y1</code>, <code>x2</code>, <code>y2</code>.
The values of these attributes directly relate to this coordinate system and are not normalized.
Flipping of the FMU icon or a terminal can be realized by setting its attributes <code>x2 &lt; x1</code> or <code>y2 &lt; y1</code> without changing the coordinate system.</p>
</div>
</div>
<div class="sect5">
<h6 id="_icon"><a class="link" href="#_icon">2.4.9.1.3. Icon</a></h6>
<div id="figure-schema-Icon" class="imageblock text-center">
<div class="content">
<img src="images/schema/Icon.png" alt="Icon" width="40%">
</div>
<div class="title">Figure 34. Icon element.</div>
</div>
<div class="paragraph">
<p>The extent and position of the FMU icon are defined in the <code>&lt;Icon&gt;</code> element.
The optional image file of the FMU icon is placed at the path <code>terminalsAndIcons/icon.png</code> in the ZIP archive of the FMU.
The terminals should not be visible in the image.
Optionally an SVG file with path <code>terminalsAndIcons/icon.svg</code> can be provided if also the PNG file is present.
This enables high quality rendering and printing in importers.</p>
</div>
<div class="paragraph">
<p>The point (<code>x1</code>, <code>y1</code>) maps to the left lower corner of the PNG image or SVG viewport.
The point (<code>x2</code>, <code>y2</code>) maps to the right upper corner of the PNG image or SVG viewport.</p>
</div>
</div>
<div class="sect5">
<h6 id="_placement_extent_and_painting_order_of_graphical_items"><a class="link" href="#_placement_extent_and_painting_order_of_graphical_items">2.4.9.1.4. Placement, Extent, and Painting Order of Graphical Items</a></h6>
<div class="imageblock text-center">
<div class="content">
<img src="images/GraphicalRepresentation.svg" alt="GraphicalRepresentation" width="70%">
</div>
</div>
<div class="paragraph">
<p>The clickable icon size is defined by the <code>&lt;CoordinateSystem&gt;</code> element.
The FMU icon itself may exceed this extent (or bounding box).
The bounding box of the terminals is given by the extent in the terminals element.
Their location is neither limited to the extent of the icon nor the extent of the coordinate system.
<em>[An importer has to determine the outer bounding box enclosing all graphical items.]</em></p>
</div>
<div class="paragraph">
<p>Transparent SVG or PNG files are allowed and wanted.
The order of the elements in the XML file defines the order of painting.
The first element in the <code>&lt;TerminalGraphicalRepresentation&gt;</code> is painted first and therefore behind the others, the last element is painted on top of the others and because of that in front of them.
<em>[So the FMU icon should be placed first in the XML file, terminal below.]</em></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="definitionOfTerminals"><a class="link" href="#definitionOfTerminals">2.4.9.2. Definition of Terminals</a></h5>
<div class="sect5">
<h6 id="_overview_3"><a class="link" href="#_overview_3">2.4.9.2.1. Overview</a></h6>
<div class="paragraph">
<p>Terminals are fully optional and can be ignored by any importer.</p>
</div>
<div class="paragraph">
<p>A terminal is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a structured interface for connections to other models,</p>
</li>
<li>
<p>intended to be used for signal flow between models, parameter grouping and propagation, and compatibility checks of the model configuration, and</p>
</li>
<li>
<p>a sequence of references to variables with connection and other meta data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Predefined rules for variable matching in a connection are given in <a href="#table-predefined-matching-rules">Table 26</a>.
Predefined variable kinds are used to describe how the terminal member variables have to be handled.
Domain specific connection rules, terminals and their member variables can be provided by other standards, including layered standards.</p>
</div>
<div class="paragraph">
<p><em>[Algebraic loops in systems of connected FMUs are not addressed or resolved by the terminals.</em>
<em>The FMU standard does not require that the <a href="#causality"><code>causality</code></a> of the terminal member variables in connected terminals match.</em>
<em>This must be handled by the importer.</em></p>
</div>
<div class="paragraph">
<p><em>The <a href="https://ssp-standard.org/">System Structure &amp; Parameterization Standard (SSP)</a> refers to a <code>connectorKind</code>.</em>
<em>This <code>connectorKind</code> is not related to the <code>terminalKind</code> or <code>variableKind</code> described in <a href="#section-terminals">Section 2.4.9.2.2</a> and <a href="#section-terminalvars">Section 2.4.9.2.3</a>.]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="section-terminals"><a class="link" href="#section-terminals">2.4.9.2.2. Terminals</a></h6>
<div class="paragraph">
<p>Element <code>&lt;fmiTerminalsAndIcons&gt;&lt;Terminals&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-Terminals" class="imageblock text-center">
<div class="content">
<img src="images/schema/Terminals.png" alt="Terminals" width="80%">
</div>
<div class="title">Figure 35. Terminals element.</div>
</div>
<div class="paragraph">
<p>The normalized string attribute <code>name</code> of the <code>&lt;Terminal&gt;</code> element is the <a href="#uniqueNameAttribute">unique</a> instance name of the terminal.
The terminal name must be unique on each level.</p>
</div>
<div id="matchingRule" class="paragraph">
<p>The normalized string attribute <code>matchingRule</code> describes the rules for variable matching in a connection of terminals.
As detailed in <a href="#table-predefined-matching-rules">Table 26</a>, there are three predefined matching rules: <code>plug</code>, <code>bus</code>, and <code>sequence</code>.
Other standards may define new matching rules.
In order to avoid ambiguities and conflicts, rule names must follow the reverse domain notation of a domain that is controlled by the entity defining the semantics and content of the additional entries.
The rule names beginning with <code>org.modelica</code> and <code>org.fmi-standard</code> are explicitly reserved for use by layered standards defined by Modelica Association or its own projects (<a href="#MAP">MAPs</a>).</p>
</div>
<table id="table-predefined-matching-rules" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. Predefined matching rules.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>matchingRule</code></th>
<th class="tableblock halign-left valign-top">Description

<a id="plug"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matching of the variables is based on <code>memberName</code>.
An importer should connect terminals only if all member variables are present and match.</p>
<p class="tableblock"><a id="bus"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matching of the variables is based on <code>memberName</code>.
An importer may connect terminals if some or no terminal member variables are present.</p>
<p class="tableblock"><a id="sequence"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sequence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matching of the variables is based on the order of the terminal member variables.
An importer should connect terminals only if the number of member variables matches.</p></td>
</tr>
</tbody>
</table>
<div id="terminalKind" class="paragraph">
<p>The normalized string <code>terminalKind</code> is an optional attribute.
Other standards may define terminal kinds.
It is intended that the <code>terminalKind</code> is used to define domain specific member variable sequences, member names and order, or high level restrictions for connections.</p>
</div>
<div class="paragraph">
<p><em>[Externally defined terminal kinds should refer to a predefined <code>matchingRule</code>, if possible.</em>
<em>Vendor specific terminal kinds should start with <code>_vendorName</code> or <code>_toolName</code> to avoid namespace clashes.</em></p>
</div>
<div class="paragraph">
<p><em>Examples for <code>terminalKind</code>: <code>StandardXXX_Mechanical_Translational</code>, <code>Modelica.Mechanics.Translational.Interfaces.Flange_a</code>, <code>vendorNameA_customTypeA</code>, <code>_vendorNameB_customLibrary_customTypeB</code>.</em></p>
</div>
<div class="paragraph">
<p><em>The structured naming convention of the <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a> is independent from the terminal names and member variable names.</em></p>
</div>
<div class="paragraph">
<p><em>A tool may choose to connect terminals with a different or unknown <code>terminalKind</code>, if the <code>matchingRule</code> matches.</em></p>
</div>
<div class="paragraph">
<p><em>A tool may choose to take the structured naming convention of variable names into account when matching terminals.</em>
<em>This can for example be used to allow matching between terminals employing arrays mapped to scalar variables using structured naming convention ("naming convention arrays"), and those using native FMI 3.0 arrays, as in the following example:</em></p>
</div>
<div class="paragraph">
<p><em>Assume that an (FMI 3.0) FMU has a one-dimensional array variable <code>x</code> of length 3 as member variable of a terminal and is connected to another (FMI 2.0 or FMI 3.0) FMU supporting structured naming convention, which has scalar variables <code>x[1]</code>, <code>x[2]</code>, <code>x[3]</code> as member variables of a terminal.</em>
<em>Then <code>x[1]</code>, <code>x[2]</code>, <code>x[3]</code> are interpreted as a "naming convention array" with name <code>x</code>, which "matches" the array variable <code>x</code> of the first FMU, in name-based matching.</em>
<em>Similarly the notional "naming convention array" <code>x</code> would participate in sequence-based matching as a single notional variable in the place of the underlying scalar variables.</em>
<em>]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="section-terminalvars"><a class="link" href="#section-terminalvars">2.4.9.2.3. Terminal Member Variable</a></h6>
<div class="paragraph">
<p>The <code>&lt;TerminalMemberVariable&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-TerminalMemberVariable" class="imageblock text-center">
<div class="content">
<img src="images/schema/TerminalMemberVariable.png" alt="TerminalMemberVariable" width="70%">
</div>
<div class="title">Figure 36. TerminalMemberVariable element.</div>
</div>
<div class="paragraph">
<p>The normalized string <code>variableName</code> identifies a variable in <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a> which is actually connected and for which <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> and <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> is called.</p>
</div>
<div class="paragraph">
<p>If the <code>matchingRule</code> <code>plug</code> and <code>bus</code> are used, then <code>memberName</code> is used for variable matching.
Therefore, the <code>memberName</code> attribute is required for <code>plug</code> and <code>bus</code> and must be unique per terminal.
The <code>memberName</code> is not required for <code>matchingRule</code> <code>sequence</code>.</p>
</div>
<div class="paragraph">
<p>The normalized string <code>variableKind</code> is used to provide general information about the variable.
This information defines how the connection of this variable has to be implemented (e.g. Kirchhoff&#8217;s current law or common signal flow).</p>
</div>
<div class="paragraph">
<p>The predefined <code>variableKind</code> are:</p>
</div>
<table id="table-variable-kinds" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. Predefined kinds of variables.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>variableKind</code></th>
<th class="tableblock halign-left valign-top">Description

<a id="signal"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The values in connected terminals are intended to be equal.
Restricted to <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a> and <a href="#calculatedParameter"><code>calculatedParameter</code></a>.
<em>[Example: Signal flow, parameter propagation, equality checks]</em></p>
<p class="tableblock"><a id="inoutflow"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inflow</code> / <code>outflow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variables which fulfill Kirchhoff&#8217;s current law.
Restricted to <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a> and <a href="#calculatedParameter"><code>calculatedParameter</code></a>.
<em>[Example: Electric current]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[The suggested variable naming scheme for the structured naming convention is &lt;ModelVariable name&gt; = &lt;terminalName&gt;.&lt;memberName&gt;.</em></p>
</div>
<div class="paragraph">
<p><em>Not all <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a> which have the prefix "&lt;terminalName&gt;." are a member variable, and there may exist member variables which don&#8217;t have this prefix.</em></p>
</div>
<div class="paragraph">
<p><em>Example 1 (suggested scheme): &lt;ModelVariable name&gt; is <code>portA.U</code>, &lt;terminalName&gt; is <code>portA</code>, &lt;memberName&gt; is <code>U</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Example 2 (suggested scheme): &lt;ModelVariable name&gt; is <code>hierarchConn.innerConn.U</code>, &lt;outer terminal name&gt; is <code>hierarchConn</code>, &lt;inner terminal name&gt; is <code>innerConn</code>, &lt;memberName&gt; is <code>U</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Example 3 (no prefix): &lt;ModelVariable name&gt; is <code>u</code>, &lt;terminalName&gt; is <code>portA</code>, &lt;memberName&gt; is <code>u</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Example 4 (prefix but not a member): &lt;ModelVariable name&gt; is <code>portA.u</code>, there is a terminal with &lt;terminalName&gt; <code>portA</code>, but this variable is not a terminal member.</em></p>
</div>
<div class="paragraph">
<p><em>The suggested variable naming scheme for the non-structured naming convention is: &lt;ModelVariable name&gt; = &lt;memberName&gt;</em></p>
</div>
<div class="paragraph">
<p><em>Matching is not restricted by <a href="#variability"><code>variability</code></a>, <a href="#causality"><code>causality</code></a> or variable type.</em>
<em>Example: A <a href="#fixed"><code>fixed</code></a> variable may be connected to a <a href="#tunable"><code>tunable</code></a> variable, a variable of type <code>fmi3Float64</code> may be connected to a variable of type <code>fmi3Int32</code>.</em>
<em>However, it is recommended that the variable types and variabilities are equal.</em></p>
</div>
<div class="paragraph">
<p><em>The <code>matchingRule</code> refers to the <code>&lt;TerminalMemberVariable&gt;</code> on the same level only.</em>
<em>Nested terminals can have different <code>matchingRules</code>.</em></p>
</div>
<div class="paragraph">
<p><em>There is no special handling of <a href="#derivative"><code>derivatives</code></a>.</em>
<em>If a <a href="#derivative"><code>derivative</code></a> is a terminal member variable then it is considered as normal member variable.</em>
<em>However, if a <a href="#derivative"><code>derivative</code></a> of a terminal member variable is not terminal member, then this <a href="#derivative"><code>derivative</code></a> information may be used by an importer.]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="_terminal_stream_member_variable"><a class="link" href="#_terminal_stream_member_variable">2.4.9.2.4. Terminal Stream Member Variable</a></h6>
<div class="paragraph">
<p>The <code>&lt;TerminalStreamMemberVariable&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-TerminalStreamMemberVariable" class="imageblock text-center">
<div class="content">
<img src="images/schema/TerminalStreamMemberVariable.png" alt="TerminalStreamMemberVariable" width="80%">
</div>
<div class="title">Figure 37. TerminalStreamMemberVariable element.</div>
</div>
<div class="paragraph">
<p>This element is used for variables which fulfill the balance equation for transported quantities.
It is restricted to <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a> and <a href="#calculatedParameter"><code>calculatedParameter</code></a>.</p>
</div>
<div class="paragraph">
<p>The Stream concept is described in the appendix D "Derivations of Stream Equations" of the <a href="#MLS12">Modelica Language Specification</a>.
Only one terminal member variable with the <code>variableKind</code> <code>inflow</code> or <code>outflow</code> per terminal is allowed, if a <code>&lt;TerminalStreamMemberVariable&gt;</code> is present.
<em>[More sophisticated structures can be implemented using hierarchical terminals.]</em></p>
</div>
<div class="paragraph">
<p>The attribute <code>inStreamVariableName</code> and <code>outStreamVariableName</code> are used to identify the <a href="#ModelVariables"><code>&lt;ModelVariables&gt;</code></a>.
If the referenced model variables are arrays, then the size of the <code>inStreamVariableName</code> and <code>outStreamVariableName</code> has to be equal.
A terminal may have more than one <code>&lt;TerminalStreamMemberVariable&gt;</code>.
The <code>inStreamMemberName</code> and <code>outStreamMemberName</code> describe the terminal member name for matching purposes, similar to the <code>memberName</code> attribute in the <code>&lt;TerminalMemberVariable&gt;</code>.</p>
</div>
<div class="paragraph">
<p><em>[An example of use for an array of stream variables is a gas mixture flow.</em>
<em>The gas composition could be implemented as a mass fraction vector.</em>
<em>The <code>outStreamVariableName</code> refers to</em> \(portA.q_\textit{outStream}\textit{[]}\) <em>and the <code>inStreamVariableName</code> refers to</em>  \(portA.q_\textit{inStream}\textit{[]}\) <em>.</em>
<em>The <code>inStreamMemberName</code> and <code>outStreamMemberName</code> are "</em> \(q_\textit{inStream}\textit{[]}\) <em>" and "</em> \(q_\textit{outStream}\textit{[]}\) <em>".</em></p>
</div>
<div class="paragraph">
<p><em>Balance equation for transported quantities:</em></p>
</div>
<div class="paragraph">
<p><em>\(0 = \sum{q_i\dot{m}_i}\)</em></p>
</div>
<div class="paragraph">
<p><em>\(0 = \sum{\dot{m}_i}\cdot
\left\{\begin{array}{ll}
q_{i, \mathit{outStream}} &amp;\textit{if $\dot{m}$ is outflowing through terminal $i$}\\
q_{i, \mathit{inStream}} &amp;\textit{if $\dot{m}$ is inflowing through terminal $i$}
\end{array}\right.\)</em></p>
</div>
<div class="paragraph">
<p><em>The</em> \(q_{i,\mathit{outStream}}\) <em>is the convective quantity in case the matter flows out of the FMU.</em>
\(q_{i,\mathit{inStream}}\) <em>is the convective quantity in case the matter flows into the FMU.</em>
<em>Both variables are present in the terminal.</em>
<em>The outStream variable has the <a href="#causality"><code>causality</code></a> <a href="#output"><code>output</code></a> or <a href="#calculatedParameter"><code>calculatedParameter</code></a> because this information has to be provided by each FMU.</em>
<em>The inStream variable has the <a href="#causality"><code>causality</code></a> <a href="#input"><code>input</code></a> or <a href="#parameter"><code>parameter</code></a>.</em>
<em>To display the actual value in an importer, this actual value has to be selected depending on the sign of the terminal member variable with <code>variableKind</code> <code>inflow</code> or <code>outflow</code>.</em>
<em>However, calculating the actual value is not necessary.</em></p>
</div>
<div class="paragraph">
<p><em>If only two terminals with a variable are connected and their <a href="#causality"><code>causality</code></a> matches, then the values of the outStream variables can be forwarded to the corresponding inStream values.</em></p>
</div>
<div class="paragraph">
<p><em>In Modelica the inStream variable is not directly visible, the value can only be accessed using "inStream()", therefore an additional model variable has to be added during the export.</em>
<em>It is suggested that Modelica tools exporting an FMU derive the member name for the inStream variable according to the scheme "&lt;outStream name&gt;_inStream".</em>
<em>E.g. if the outStream name is "h_outflow" then the inStream name should be "h_outflow_inStream".]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="_terminal_graphical_representation"><a class="link" href="#_terminal_graphical_representation">2.4.9.2.5. Terminal Graphical Representation</a></h6>
<div class="paragraph">
<p>The <code>&lt;TerminalGraphicalRepresentation&gt;</code> is defined as:</p>
</div>
<div id="figure-schema-TerminalGraphicalRepresenation" class="imageblock text-center">
<div class="content">
<img src="images/schema/TerminalGraphicalRepresentation.png" alt="TerminalGraphicalRepresentation" width="75%">
</div>
<div class="title">Figure 38. TerminalGraphicalRepresentation element.</div>
</div>
<div class="paragraph">
<p>The <code>iconBaseName</code> attribute is mandatory.
This attribute defines the base name of the image file as a relative URI according to RFC 3986.
The base URI that this relative URI is resolved against is the URI of the <code>terminalsAndIcons/terminalsAndIcons.xml</code> file in the FMU ZIP archive.
Implementations are required to support relative URIs, excluding relative URIs that move beyond the baseURI (i.e. go "up" a level via ..).
Implementations are not required to support any absolute URIs and any specific URI schemes.
The PNG file with the extension '.png' has to be provided.
An additional SVG file with extension '.svg' is optional.</p>
</div>
<div class="paragraph">
<p><em>[Note that this specification is functionally equivalent to looking up image sources from the <code>terminalsAndIcons</code> folder of the FMU ZIP archive after dot removal from the path as per section 5.2.4 of RFC 3986.]</em></p>
</div>
<div class="paragraph">
<p>The <code>defaultConnectionStrokeSize</code> and <code>defaultConnectionColor</code> can be provided to define the intended connection line layout in the importer.
The stroke size is given relative to the coordinate system extent.
The stroke color is given in RGB values from 0 to 255. E.g.: <code>255 255 0</code>.</p>
</div>
<div class="paragraph">
<p><em>[Nested terminals may have a <code>&lt;TerminalGraphicalRepresentation&gt;</code> element.</em>
<em>However, if and how nested terminals are displayed, is up to the importer.]</em></p>
</div>
<div class="paragraph">
<p><em>[The order of painting of the <code>&lt;TerminalGraphicalRepresentation&gt;</code> of terminals on each level is equal to the order in the <code>&lt;Terminal&gt;</code> element.</em>
<em>So graphical representations appearing first, are painted first, are behind graphical representations which appear below.]</em></p>
</div>
<div class="paragraph">
<p>The <code>Annotations</code> element can be used by vendors to store additional information for the graphical representation.
<em>[It is suggested that Modelica tools store the Modelica annotation of the connector under the <code>type</code> <code>org.modelica.Modelica4Annotation</code> in the annotations of an element <code>connector</code>.</em>
<em>The attribute <code>name</code> of the connector element is equal to the <code>name</code> attribute of the referenced <code>fmi3Terminal</code>.]</em></p>
</div>
<div class="paragraph">
<p><em>[If the graphical representation is used for an <a href="#input"><code>input</code></a> or <a href="#output"><code>output</code></a> (e.g. a <code>fmi3Float64</code> <a href="#input"><code>input</code></a> <code>u</code>), then a <code>&lt;Terminal&gt;</code> has to be added to the <code>&lt;Terminals&gt;</code> element which has one <code>&lt;TerminalMemberVariable&gt;</code>.]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="GeneralRemarkOnSignal"><a class="link" href="#GeneralRemarkOnSignal">2.4.9.2.6. General Remark on Signal</a></h6>
<div class="paragraph">
<p><em>[The signal <code>variableKind</code> can be applied for different use cases.</em>
<em>The first use case is a signal flow from an <a href="#output"><code>output</code></a> of one FMU to an <a href="#input"><code>input</code></a> of another FMU.</em>
<em>The <a href="#output"><code>output</code></a> value has to be forwarded to the <a href="#input"><code>input</code></a>.</em></p>
</div>
<div class="paragraph">
<p><em>The signal flow can cause algebraic loops.</em>
<em>If variables in connected terminals have the <a href="#causality"><code>causality</code></a> <a href="#output"><code>output</code></a>, then an importer may iterate an undefined <a href="#input"><code>input</code></a> of an FMU to ensure that the connected output values are equal.</em></p>
</div>
<div class="paragraph">
<p><em>Another use case is the parameter propagation.</em>
<em>If a variable in both connected terminals has the <a href="#causality"><code>causality</code></a> <a href="#parameter"><code>parameter</code></a>, then an importer could ask the user for the value of one of those <a href="#parameter"><code>parameters</code></a> only, and propagate this value to the other FMU.</em>
<em>If only one of the variables has <a href="#causality"><code>causality</code></a> <a href="#parameter"><code>parameter</code></a>, and the other is a <a href="#constant"><code>constant</code></a> <a href="#output"><code>output</code></a> or <a href="#calculatedParameter"><code>calculatedParameter</code></a>, then the importer could also propagate the <a href="#parameter"><code>parameter</code></a> value without presenting a parameter to the user.</em>
<em>One example of use would be the name of a substance flowing through a pipe.</em>
<em>If the fluid flows from one pipe FMU to another, the substance should be the same.</em>
<em>This substance name could be propagated over several FMUs.</em></p>
</div>
<div class="paragraph">
<p><em>Finally the <code>variableKind</code> <code>signal</code> can be applied to implement compatibility checks.</em>
<em>If for example the <a href="#variability"><code>variability</code></a> of the variables in connected terminals are <a href="#constant"><code>constant</code></a>, then the importer can implement an equality assertion.</em>
<em>This is also possible with <a href="#calculated"><code>calculated</code></a> <a href="#parameter"><code>parameters</code></a>.</em>
<em>One example of use would be the cross sectional flow area in pipes which is calculated from geometry parameters.</em>
<em>A change in the cross sectional flow area is relevant for the momentum equation, and therefore the connection has to be deemed incompatible if these variables are present and unequal.]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="_general_remark_on_inflow_and_outflow"><a class="link" href="#_general_remark_on_inflow_and_outflow">2.4.9.2.7. General Remark on Inflow and Outflow</a></h6>
<div class="paragraph">
<p><em>[Flow variables have a direction and must fulfill a zero sum constraint i.e. the sum of all flow variables connected must be zero (Kirchhoff&#8217;s current law).</em>
<em>In addition because different tools might have different direction definitions both, <code>inflow</code> and <code>outflow</code> are available as <code>variableKind</code>.</em>
<em>For variables with <code>inflow</code> a positive value means that the flow is inwards, and for <code>outflow</code> a positive value means that the flow is outwards.</em>
<em>For the sake of simplicity in the following \(\dot{m}_i\) denotes an inflowing quantity:</em></p>
</div>
<div class="paragraph">
<p><em>\(0 = \sum{\dot{m}_i}\)</em></p>
</div>
<div class="paragraph">
<p><em>[Connecting a single <a href="#output"><code>output</code></a> <code>outflow</code> to a single <a href="#input"><code>input</code></a> <code>inflow</code>, or vice versa automatically fulfills the flow constraint, while connecting two variables of the same flow type requires a negation of the variable value.</em></p>
</div>
<div class="paragraph">
<p><code>inflow</code> <em>and</em> <code>outflow</code> <em>is only used as a sign convention for scalar flow quantities which obey Kirchhoff&#8217;s current law (sum up to zero).</em>
<em>Other, nonscalar, quantities which also sum up to zero, like a mechanical force in 3D space according to D&#8217;Alembert&#8217;s principle, are not covered by this sign convention.</em>
<em>This is the case since Kirchhoff&#8217;s current law only holds for scalars where a sign convention is sufficient.</em>
<em>Other definitions are beyond the scope of this terminal specification and need clear definition in other specifications on top of this.]</em></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BuildConfiguration"><a class="link" href="#BuildConfiguration">2.4.10. Build Configurations</a></h4>
<div class="paragraph">
<p>Build configurations are defined in an optional XML file called <code>sources/buildDescription.xml</code>.
This file declares a root element &lt;fmiBuildDescription&gt; that has the following attributes and elements:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. fmiBuildDescription element and attributes details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute or Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmiVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This mandatory attribute declares the FMI version defining the XSD of the <code>sources/buildDescription.xml</code> file.
Starting with FMI 3.0, this <code>fmiVersion</code> attribute must match the <code>fmiVersion</code> attribute of element <a href="#fmiModelDescription"><code>&lt;fmiModelDescription&gt;</code></a> of the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> file.
If used in previous FMI versions, this attribute points to the FMI version defining this <code>sources/buildDescription.xml</code> file (e.g. XSD, file location).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This element defines all the needed information for compiling and linking the binary part of the FMU for a specified target.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The &lt;fmiBuildDescription&gt; element must contain at least one <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> element.
Each <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> provides the necessary information to compile and link the sources of the model into a dynamic library or as part of an executable.
An FMU importer may not regard more than one <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> when building the FMU for a specific <a href="#platform"><code>platform</code></a>.
The importer chooses the matching <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> based on the <a href="#platform"><code>platform</code></a> and <a href="#modelIdentifier"><code>modelIdentifier</code></a> attributes.
<em>[On platforms that support shared libraries, executables should not be linked statically against or be compiled directly from the sources of an FMU in order to avoid name conflicts.]</em></p>
</div>
<div class="paragraph">
<p>In order to avoid symbol name conflicts when compiling and linking multiple source code FMUs, source files should keep the exported symbols to a minimum by declaring all symbols not needed for linking as <code>static</code>.
If only a single <a href="#SourceFile"><code>&lt;SourceFile&gt;</code></a> is provided in the <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> all symbols except for the FMI functions should be defined as <code>static</code>.
This source file may include other source files that are not listed in the <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a>.
It is also recommended to use a descriptive name (e.g. <code>&lt;model_identifier&gt;.c</code>) for this single <a href="#SourceFile"><code>&lt;SourceFile&gt;</code></a> instead of generic names (like <code>all.c</code>, or <code>model.c</code>) in order to aid readability and reduce integration effort.</p>
</div>
<div id="figure-fmiBuildDescription" class="imageblock">
<div class="content">
<img src="images/schema/fmiBuildDescription.png" alt="fmiBuildDescription" width="90%">
</div>
<div class="title">Figure 39. <code>fmiBuildDescription</code> element.</div>
</div>
<table id="table-BuildConfiguration-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. BuildConfiguration attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelIdentifier</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The attribute <a href="#modelIdentifier"><code>modelIdentifier</code></a> of the <code>&lt;ModelExchange&gt;</code>, <code>&lt;CoSimulation&gt;</code> or <code>&lt;ScheduledExecution&gt;</code> elements this build configuration is associated with.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>platform</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="platform"></a>Platform tuple of the platform the <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> is intended for (e.g. <code>x86_64-linux</code>).
This attribute is optional.
Thus there must not be more than one <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> without a <a href="#platform"><code>platform</code></a> attribute.
If a <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> without a <a href="#platform"><code>platform</code></a> attribute is provided this is the fallback <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> an importer can use if it cannot find any other <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> with a matching <a href="#platform"><code>platform</code></a> attribute.
<em>[A BuildDescription may contain multiple BuildConfigurations for the same <a href="#platform"><code>platform</code></a> to support e.g. different compilers.</em>
<em>In this case the importer has to select the BuildConfiguration based on the other attributes of the BuildConfiguration and the contained SourceFileSets.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the build configuration</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_sourcefileset"><a class="link" href="#_sourcefileset">2.4.10.1. SourceFileSet</a></h5>
<div class="paragraph">
<p>The <code>&lt;SourceFileSet&gt;</code> element groups source files that can be compiled with the same compiler and compiler options.
Every build configuration must contain at least one <code>&lt;SourceFileSet&gt;</code>.
An importer of the FMU has to process every <code>&lt;SourceFileSet&gt;</code> of the matching <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a>.</p>
</div>
<div id="figure-SourceFileSet" class="imageblock">
<div class="content">
<img src="images/schema/SourceFileSet.png" alt="SourceFileSet" width="60%">
</div>
<div class="title">Figure 40. <code>SourceFileSet</code> element.</div>
</div>
<table id="table-SourceFileSet-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. SourceFileSet attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#uniqueNameAttribute">Unique</a> name of the <code>&lt;SourceFileSet&gt;</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>language</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Language of the source files (e.g. <code>C99</code>, <code>C++11</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compiler</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The compiler to compile the sources (e.g. <code>VisualC</code>, <code>gcc</code>, <code>clang++</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compilerOptions</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The compiler flags that have to be used when compiling the sources (e.g. <code>-fno-rtti</code>, <code>/Od</code>)</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Please refer to the <a href="https://modelica.github.io/fmi-guides/main/fmi-guide/">FMI Implementer&#8217;s Guide</a> for lists of commonly agreed upon language and compiler names.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="SourceFile"><a class="link" href="#SourceFile">2.4.10.2. SourceFile</a></h5>
<div id="figure-SourceFile" class="imageblock">
<div class="content">
<img src="images/schema/SourceFile.png" alt="SourceFile" width="50%">
</div>
<div class="title">Figure 41. <code>SourceFileSet</code> element.</div>
</div>
<table id="table-SourceFile-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. SourceFile attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Path of the source file relative to the <code>sources</code> directory.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_preprocessordefinition"><a class="link" href="#_preprocessordefinition">2.4.10.3. PreprocessorDefinition</a></h5>
<div class="paragraph">
<p>The <code>&lt;PreprocessorDefinition&gt;</code> element defines a preprocessor definition that needs to be passed to the compiler when compiling the source files in the <code>&lt;SourceFileSet&gt;</code>.</p>
</div>
<div id="figure-PreprocessorDefinition" class="imageblock">
<div class="content">
<img src="images/schema/PreprocessorDefinition.png" alt="PreprocessorDefinition" width="60%">
</div>
<div class="title">Figure 42. <code>PreprocessorDefinition</code> element.</div>
</div>
<table id="table-ProcessorDefinition-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. ProcessorDefintition attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the preprocessor definition</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Value of the preprocessor definition</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Determines whether the definition is optional (default is <code>false</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the preprocessor definition</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_preprocessordefinitionoption"><a class="link" href="#_preprocessordefinitionoption">2.4.10.4. PreprocessorDefinition/Option</a></h5>
<div class="paragraph">
<p>The <code>&lt;Option&gt;</code> element defines a possible value for the <code>&lt;PreprocessorDefinition&gt;</code>.
If a <code>&lt;PreprocessorDefinition&gt;</code> contains <code>&lt;Option&gt;</code> elements, its default value must be contained in the options.</p>
</div>
<table id="table-PreprocessorDefinition-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. PreprocessorDefinition attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Value of the preprocessor definition option</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the preprocessor definition option</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_includedirectory"><a class="link" href="#_includedirectory">2.4.10.5. IncludeDirectory</a></h5>
<div class="paragraph">
<p>The <code>&lt;IncludeDirectory&gt;</code> element defines the include directories that need to be passed to the compiler when compiling the source files in the <code>&lt;SourceFileSet&gt;</code>.</p>
</div>
<div id="figure-IncludeDirectory" class="imageblock">
<div class="content">
<img src="images/schema/IncludeDirectory.png" alt="IncludeDirectory" width="60%">
</div>
<div class="title">Figure 43. <code>IncludeDirectory</code> element.</div>
</div>
<table id="table-IncludeDirectory-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. IncludeDirectory attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Path of the include directory relative to the <code>sources</code> directory</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Note that the header files <code>fmi3PlatformTypes.h</code> and <code>fmi3FunctionTypes.h/fmi3Functions.h</code> are not included in the FMU because:</em></p>
</div>
<div class="paragraph">
<p><em><code>fmi3PlatformTypes.h</code> makes no sense in the <code>sources</code> directory, because if sources are provided, then the importer defines this header file and not the FMU.</em><br>
<em>This header file is not included in the <code>binaries</code> directory, because it is implicitly defined by the platform directory (for example, <code>x86-windows</code> for a 32-bit machine running Windows or <code>x86_64-linux</code> for a 64-bit machine running Linux).</em></p>
</div>
<div class="paragraph">
<p><em><code>fmi3FunctionTypes.h</code> / <code>fmi3Functions.h</code> are not needed in the <code>sources</code> directory, because they are implicitly defined by attribute <code>fmiVersion</code> in file <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</em>
<em>Furthermore, in order that the C compiler can check for consistent function arguments, the header file from the importer should be used when compiling the C sources.</em>
<em>It would therefore be counter-productive (unsafe) if this header file was present.</em><br>
<em>These header files are not included in the <code>binaries</code> directory, since they are already utilized to build the executable of the simulation environment.</em>
<em>The version number of the header file used to construct the FMU can be deduced via attribute <code>fmiVersion</code> in file <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> or via function call <a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a>.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_library"><a class="link" href="#_library">2.4.10.6. Library</a></h5>
<div class="paragraph">
<p>The <code>&lt;Library&gt;</code> element defines a static library required to link the model binary.
An importer of the FMU has to link every library of the matching <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a>.</p>
</div>
<div id="figure-Library" class="imageblock">
<div class="content">
<img src="images/schema/Library.png" alt="Library" width="50%">
</div>
<div class="title">Figure 44. <code>Library</code> element.</div>
</div>
<table id="table-Library-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. Library attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the library</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Version specifier of the library as defined in <a href="https://www.python.org/dev/peps/pep-0440/#version-specifiers">PEP 440</a>.
The characters <code>&gt;</code> (greater-than) and <code>&lt;</code> (less-than) must be escaped as <code>&gt;</code> and <code>&lt;</code>.
 <em>[For example <code>2.5</code>, <code>&gt;=2.0,&lt;3.0</code> or <code>&gt;=1.0,!=1.2</code>]</em>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>external</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Boolean attribute that determines whether the library is contained in the <code>binaries/&lt;platform_tuple&gt;</code> directory (<code>false</code>) or if it has to be provided by the environment (<code>true</code>).
The default is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the library definition option</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_examples"><a class="link" href="#_examples">2.4.10.7. Examples</a></h5>
<div class="listingblock">
<div class="title">A minimal build configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiBuildDescription fmiVersion="3.0"&gt;

  &lt;BuildConfiguration modelIdentifier="PIDContoller"&gt;
    &lt;SourceFileSet&gt;
      &lt;SourceFile name="PIDContoller.c"/&gt;
    &lt;/SourceFileSet&gt;
  &lt;/BuildConfiguration&gt;

&lt;/fmiBuildDescription&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Multiple complex build configurations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiBuildDescription fmiVersion="3.0"&gt;

  &lt;BuildConfiguration modelIdentifier="PlantModel" description="Build configuration for desktop platforms"&gt;
    &lt;SourceFileSet language="C99"&gt;
      &lt;SourceFile name="fmi3Functions.c"/&gt;
      &lt;SourceFile name="solver.c"/&gt;
    &lt;/SourceFileSet&gt;
    &lt;SourceFileSet language="C++11"&gt;
      &lt;SourceFile name="model.c"/&gt;
      &lt;SourceFile name="logging/src/logger.c"/&gt;
      &lt;PreprocessorDefinition name="FMI_VERSION" value="3"/&gt;
      &lt;PreprocessorDefinition name="LOG_TO_FILE" optional="true"/&gt;
      &lt;PreprocessorDefinition name="LOG_LEVEL" value="0" optional="true"&gt;
        &lt;Option value="0" description="Log infos, warnings and errors"/&gt;
        &lt;Option value="1" description="Log warnings and errors"/&gt;
        &lt;Option value="2" description="Log only errors"/&gt;
      &lt;/PreprocessorDefinition&gt;
      &lt;IncludeDirectory name="logging/include"/&gt;
    &lt;/SourceFileSet&gt;
    &lt;Library name="hdf5" version="&amp;gt;=1.8,!=1.8.17,&amp;lt;1.10" external="true" description="HDF5"/&gt;
  &lt;/BuildConfiguration&gt;

  &lt;BuildConfiguration modelIdentifier="PlantModel" platform="aarch64-linux"&gt;
    &lt;SourceFileSet language="C99"&gt;
      &lt;SourceFile name="fmi3Functions.c"/&gt;
    &lt;/SourceFileSet&gt;
    &lt;SourceFileSet language="C++11" compiler="clang++" compilerOptions="-fno-rtti"&gt;
      &lt;SourceFile name="model.c"/&gt;
      &lt;PreprocessorDefinition name="NO_FILE_SYSTEM"/&gt;
    &lt;/SourceFileSet&gt;
    &lt;Library name="libm.a" description="OpenLibm math library"/&gt;
  &lt;/BuildConfiguration&gt;

&lt;/fmiBuildDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fmu-distribution"><a class="link" href="#fmu-distribution">2.5. FMU Distribution</a></h3>
<div class="paragraph">
<p>An FMU consists of several files, that are stored in a ZIP file with a pre-defined structure.
The implementation of the FMI C-API may be distributed in source code and/or in binary format.
The FMU must be distributed with at least one implementation, in other words, either sources or one of the binaries for a particular machine.
It is also possible to provide the sources and binaries for different target machines together in one ZIP file.
The FMU must implement all API functions declared in <code>fmi3Functions.h</code>, even if they are only needed for interface types or optional capabilities that the FMU does not support.
The behavior of those functions is unspecified, so while calling environments can rely on the functions being present, they cannot rely on any particular behavior for functions only needed for capabilities or interface types the FMU does not support.
<em>[The recommended implementation for such stub functions is to return <code>fmi3Error</code> after logging the error reason, as specified in <a href="#status-returned-by-functions">Section 2.2.4</a>.
Calling environments should not rely on the presence of functions that are not required and avoid calling them.]</em>
Additional functions may be present in the FMU, as for example required by the OS ABI, for layered standards, or future FMI versions.
All symbols starting with the prefix <code>fmi3</code> are reserved for use in future minor releases of FMI 3.0.
The extension of the ZIP file must be <code>.fmu</code> <em>[, for example, <code>HybridVehicle.fmu</code>]</em>.
The compression method for all files stored in the ZIP archive must be either <code>8</code> (deflate) or <code>0</code> (store).
Only files stored using compression method <code>8</code> (deflate) may be stored with general purpose bit <code>3</code> set.
The field <code>version needed to extract</code> of the archive must not be higher than <code>2.0</code> and encryption must not be employed.
The archive must not be a split or spanned ZIP archive.
Links must not be used inside the ZIP archive.
 <em>[These restrictions ensure broad compatibility of the archive with common ZIP processing tools and libraries.)]</em></p>
</div>
<div class="paragraph">
<p><em>[Note: especially section 4.4.17 of <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">the ZIP format specification</a> states that backslashes "\" are forbidden as path separator, only forward slashes "/" are allowed.</em><br>
<em>Non-ASCII directory names are not explicitly forbidden, but might pose a problem on different operating systems and are thus discouraged.]</em></p>
</div>
<div class="paragraph">
<p>Every FMU is distributed with its own ZIP file.</p>
</div>
<div class="sect3">
<h4 id="structure-of-zip"><a class="link" href="#structure-of-zip">2.5.1. Structure of the ZIP file</a></h4>
<div id="figure-zip-structure" class="listingblock">
<div class="title">Structure of the ZIP file of an FMU</div>
<div class="content">
<pre>modelDescription.xml                // description of FMU (required file)
documentation                       // directory containing the documentation (optional)
   index.html                       // entry point of the documentation
   diagram.png                      // descriptive diagram view of the model (optional)
   diagram.svg                      // if provided, diagram.png is also required (optional)
   externalDependencies.{txt|html}  // documentation of external resources required to load
                                    // or simulate the FMU
   &lt;other documentation files&gt;
   licenses                         // directory for licenses (optional)
      license.{txt|html|spdx}       // entry point for license information
      &lt;license files&gt;               // for example BSD licenses (optional)
   staticLinking.{txt|html}         // entry point for static link information (optional)
terminalsAndIcons                   // FMU and terminal icons (optional)
   terminalsAndIcons.xml            // description of terminals and icons (optional)
   icon.png                         // image file of icon without terminals (optional)
   icon.svg                         // if existing the icon.png is required (optional)
                                    // all terminal and fmu icons referenced in the
                                    // graphical representation
sources                             // directory containing the C sources (optional)
   buildDescription.xml
binaries                            // directory containing the binaries (optional)
   x86_64-windows                   // binaries for Windows on Intel 64-bit
      &lt;modelIdentifier&gt;.dll         // shared library of the FMI implementation
      &lt;other files&gt;                 // other platform dependend files
                                    // needed at linking or loading time
   x86-linux                        // binaries for Linux on Intel 32-bit
      &lt;modelIdentifier&gt;.so          // shared library of the FMI implementation
   aarch32-linux                    // binaries for Linux on ARM 32-bit
      &lt;modelIdentifier&gt;.so          // shared library of the FMI implementation
   x86_64-darwin                    // binaries for macOS
      &lt;modelIdentifier&gt;.dylib       // shared library of the FMI implementation
resources                           // resources used by the FMU (optional)
extra                               // Additional (meta-)data of the FMU (optional)</pre>
</div>
</div>
<div class="sect4">
<h5 id="documentation-directory"><a class="link" href="#documentation-directory">2.5.1.1. Directory <code>documentation</code></a></h5>
<div class="paragraph">
<p>Figure <a href="#figure-zip-structure">Structure of the ZIP file of an FMU</a> defines the files expected in the <code>documentation</code> directory.
If the FMU depends on external resources <em>[e.g. shared libraries, files, or servers]</em> to be loaded or simulated <code>documentation/externalDependencies.{txt|html}</code> must be present to document these dependencies and how to provide them.</p>
</div>
<div class="sect5">
<h6 id="license-information"><a class="link" href="#license-information">2.5.1.1.1. Directory <code>licenses</code></a></h6>
<div class="paragraph">
<p>This optional subdirectory can be used to bundle all license texts for the code, binaries or other material (documentation, content of resources folder) contained in the FMU.
If it is present, it must contain either a <a href="https://spdx.dev">license.spdx</a>, <code>license.txt</code> or <code>license.html</code> file as entry point.</p>
</div>
<div class="paragraph">
<p><em>[It is strongly recommended to include all license and copyright related information in the licenses folder of an FMU (especially but not only for contained open source software) - the <code>license.{txt|html}</code> file can serve as an entry point for describing the contained licenses.</em>
<em>This will help the users to comply with license conditions when passing source or binary code contained in an FMU to other persons or organizations.]</em></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="terminalsAndIcons-directory"><a class="link" href="#terminalsAndIcons-directory">2.5.1.2. Directory <code>terminalsAndIcons</code></a></h5>
<div class="paragraph">
<p>See <a href="#fmiTerminalsAndIcons">Section 2.4.9</a> for a definition of the directory <code>terminalsAndIcons</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="sources-directory"><a class="link" href="#sources-directory">2.5.1.3. Directory <code>sources</code></a></h5>
<div class="paragraph">
<p>A source code FMU contains the sources of the model in the <code>sources</code> directory together with a <code>buildDescription.xml</code> that contains at least one <a href="#BuildConfiguration"><code>&lt;BuildConfiguration&gt;</code></a> element for the supported platforms.
The header files <code>fmi3PlatformTypes.h</code>, <code>fmi3FunctionTypes.h</code> and <code>fmi3Functions.h</code> are not included in the FMU, but supplied by the importer to potentially reflect their specific platform and compiler tool set.</p>
</div>
</div>
<div class="sect4">
<h5 id="binaries-directory"><a class="link" href="#binaries-directory">2.5.1.4. Directory <code>binaries</code></a></h5>
<div class="paragraph">
<p>A binary FMU must contain the binary files - that are needed at linking or loading time - of the FMU for all supported platforms in this folder.
To use the binaries of a specific platform, all items in that platform-specific binary folder must be unpacked at the same location as the binary <code>&lt;modelIdentifier&gt;.{dll|dylib|so}</code>.</p>
</div>
<div class="sect5">
<h6 id="platform-tupe-definition"><a class="link" href="#platform-tupe-definition">2.5.1.4.1. Platform Tuple Definition</a></h6>
<div class="paragraph">
<p>The names of the binary directories are standardized by the "platform tuple".
Further names can be introduced by vendors.
FMUs should contain all resources that are required to load and execute a shared library, link against a static library, or compile from source.
Shared libraries should be statically linked against their dependencies <em>[e.g. the Visual Studio C Runtime on Windows]</em>.
<code>RPATH="$ORIGIN"</code> should be set when building ELF binaries to allow dynamic loading of dependencies on the target machine.
All external dependencies must be documented (see <a href="#documentation-directory">Section 2.5.1.1</a>).</p>
</div>
<div class="paragraph">
<p>The binaries must be placed in the respective <code>&lt;platformTuple&gt;</code> directory with the general format <code>&lt;arch&gt;-&lt;sys&gt;</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Architecture <code>&lt;arch&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM 32-bit Architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM 64-bit Architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel/AMD x86 32-bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel/AMD x86 64-bit</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Operating system <code>&lt;sys&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">darwin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Darwin (macOS, iOS, watchOS, tvOS, audioOS)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Windows</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When shipping the implementation as a static library an optional ABI (Application Binary Interface) directory <code>&lt;arch&gt;-&lt;sys&gt;{-&lt;abi&gt;}</code> may be added to separate binaries for different toolchains on the same platform and a description must be provided in <code>documentation/staticLinking.{txt|html}</code> that contains all necessary information to link against the provided library <em>[e.g. supported compilers]</em>.
The ABI directory must only contain lowercase characters <code>a&#8230;&#8203;z</code>, digits <code>0&#8230;&#8203;9</code>, and underscores <code><em></code> and start with a lowercase character <code>a&#8230;&#8203;z</code> _[e.g. <code>x86_64-windows-msvc140mt</code> for a static library for 64-bit Windows generated with Visual Studio 2015 with <code>/MT</code> flag]</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="platform-tuple-examples"><a class="link" href="#platform-tuple-examples">2.5.1.4.2. Platform Tuple Examples</a></h6>
<div class="paragraph">
<p>The following table lists the most common platform tuples for shared libraries and the corresponding FMI 2.0 platform.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 27.2727%;">
<col style="width: 45.4546%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">FMI 2.0</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64-darwin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">darwin64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">macOS on 64-bit x86</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch64-darwin</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">macOS on Apple Silicon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86-linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux on 32-bit x86</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64-linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux on 64-bit x86</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch64-linux</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux on ARM64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86-windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">win32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows on 32-bit x86</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64-windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">win64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows on 64-bit x86</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch64-windows</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows on ARM64</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="external-libraries"><a class="link" href="#external-libraries">2.5.1.4.3. External Libraries</a></h6>
<div class="paragraph">
<p>If runtime libraries are needed by the FMU that have to be present on the target machine and cannot be shipped within the FMU (e.g., due to licensing issues), then automatic processing is likely impossible.
In such cases special handling is needed, for example, by providing the runtime libraries at appropriate places by the receiver.
The requirements and the expected processing must be documented in the <code>documentation</code> directory in the file <code>externalDependencies.{txt|html}</code>.<br></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="resources-directory"><a class="link" href="#resources-directory">2.5.1.5. Directory <code>resources</code></a></h5>
<div class="paragraph">
<p>In the optional directory <code>resources</code>, additional data can be provided in FMU specific formats, typically for tables and maps used in the FMU.
More folders can be added under <code>resources</code> (tool/model specific).
For the FMU to access these resource files - during runtime, after instantiation - the resources directory shall be available in extracted form and the absolute path to this directory is provided via argument <a href="#resourcePath"><code>resourcePath</code></a> of <a href="#fmi3Instantiate"><code>fmi3InstantiateXXX</code></a>.
The resources directory must be available for the lifetime of the FMU instance.
The FMU instance must not write to or delete the directory or parts of it.</p>
</div>
<div class="paragraph">
<p><em>[The files contained in the resources folder may be platform dependent files.
In contrast to files in the binaries folder, they can be accessed during runtime by the FMU.
For more information, please consult the <a href="https://modelica.github.io/fmi-guides/main/fmi-guide/">FMI Implementer&#8217;s Guide</a>.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="extra-directory"><a class="link" href="#extra-directory">2.5.1.6. Directory <code>extra</code></a></h5>
<div class="paragraph">
<p>The ZIP archive may contain additional subdirectories within <code>extra/</code> that can be used to store additional data, e.g. for the implementation of <a href="#VersioningLayered">layered standards</a>.</p>
</div>
<div class="paragraph">
<p>In order to avoid ambiguities and conflicts, the names of these subdirectories should use the reverse domain notation of a domain that is controlled by the entity defining the semantics and content of the additional entries <em>[(for example <code>extra/com.example/SimTool/meta.xml</code> or <code>extra/org.example.stdname/data.asd</code>)]</em>.
The use of subdirectories beginning with <code>org.modelica</code> and <code>org.fmi-standard</code> is explicitly reserved for use by <a href="#VersioningLayered">layered standards</a> defined by Modelica Association or its own projects (<a href="#MAP">MAPs</a>), i.e. layered standards defined outside the Modelica Association must not use subdirectory names beginning with these prefixes.
It is explicitly allowed for tools and users other than the original creator of an FMU to modify, add or delete entries in the <code>extra/</code> directory without affecting the validity of the FMU in all other aspects.
Specifically all validation or digital signature schemes used to protect the content of the FMU should take the variability of extra file content into account <em>[(for example by having separate checksums or signatures for FMU core content and extra content, or not having signatures at all for extra content)]</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multipleInterfaceTypes"><a class="link" href="#multipleInterfaceTypes">2.5.2. Multiple Interface Types</a></h4>
<div class="paragraph">
<p>One FMU may implement multiple FMI types.
Such an FMU may be used by differently capable simulation algorithms and for different use cases.
To indicate support for a specific interface type, the <code>&lt;fmiModelDescription&gt;</code> must have the respective element present.
Supported interface types may be provided differently, as binary and/or source code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Example of different libraries:
   binaries
     x86_64-windows
        MyModel_ModelExchange.dll      // modelIdentifier of &lt;ModelExchange&gt; =
                                       //    "MyModel_ModelExchange"
        MyModel_CoSimulation.dll       // modelIdentifier of &lt;CoSimulation&gt; =
                                       //    "MyModel_CoSimulation"
]</pre>
</div>
</div>
<div class="paragraph">
<p>Support of multiple interface types in one FMU is possible only, if the interface variables are identical.</p>
</div>
</div>
<div class="sect3">
<h4 id="dependency-on-external-tool"><a class="link" href="#dependency-on-external-tool">2.5.3. Dependency on Installed Tool</a></h4>
<div class="paragraph">
<p>If an FMU depends on services provided by an external tool, then <a href="#needsExecutionTool"><code>needsExecutionTool = true</code></a>.
These tool dependencies must be <a href="#documentation-directory">documented</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_import_examples"><a class="link" href="#_import_examples">2.5.4. Import Examples</a></h4>
<div class="paragraph">
<p>The following code examples demonstrate how to access the FMI functions of FMUs that are implemented as a shared library or static library / source code.</p>
</div>
<div class="sect4">
<h5 id="_accessing_fmi_functions_in_shared_libraries"><a class="link" href="#_accessing_fmi_functions_in_shared_libraries">2.5.4.1. Accessing FMI Functions in Shared Libraries</a></h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">/* This example demonstrates how to import an FMU implemented as a shared library */

#ifdef _WIN32
#include &lt;Windows.h&gt;
#else
#include &lt;dlfcn.h&gt;
#endif

#include &lt;stdlib.h&gt;

// FMI function types
#include "fmi3FunctionTypes.h"

#define INSTANTIATION_TOKEN "{8c4e810f-3da3-4a00-8276-176fa3c9f000}"


static void cb_logMessage(fmi3InstanceEnvironment instanceEnvironment, fmi3Status status, fmi3String category, fmi3String message) {
    // log message...
}

int main(int argc, char* argv[]) {

#if defined(_WIN32)
    HMODULE libraryHandle = LoadLibraryA("VanDerPol\\binaries\\x86_64-windows\\VanDerPol.dll");
#elif defined(__APPLE__)
    void *libraryHandle = dlopen("VanDerPol/binaries/x86_64-darwin/VanDerPol.dylib", RTLD_LAZY);
#else
    void *libraryHandle = dlopen("VanDerPol/binaries/x86_64-linux/VanDerPol.so", RTLD_LAZY);
#endif

    if (!libraryHandle) {
        return EXIT_FAILURE;
    }

    fmi3InstantiateModelExchangeTYPE *instantiateModelExchange = (fmi3InstantiateModelExchangeTYPE *)
#ifdef _WIN32
        GetProcAddress(libraryHandle, "fmi3InstantiateModelExchange");
#else
        dlsym(libraryHandle, "fmi3InstantiateModelExchange");
#endif

    fmi3FreeInstanceTYPE *freeInstance = (fmi3FreeInstanceTYPE *)
#ifdef _WIN32
        GetProcAddress(libraryHandle, "fmi3FreeInstance");
#else
        dlsym(libraryHandle, "fmi3FreeInstance");
#endif

    // load remaining FMI functions...

    if (!instantiateModelExchange || !freeInstance) {
        return EXIT_FAILURE;
    }

    fmi3Instance m = instantiateModelExchange(
        "instance1",         // instance name
        INSTANTIATION_TOKEN, // instantiation token (from XML)
        NULL,                // resource path
        fmi3False,           // visible
        fmi3False,           // debug logging disabled
        NULL,                // instance environment
        cb_logMessage);      // logger callback


    if (!m) {
        return EXIT_FAILURE;
    }

    // simulation...

    freeInstance(m);

    // unload shared library
#ifdef _WIN32
    FreeLibrary(libraryHandle);
#else
    dlclose(libraryHandle);
#endif

    return EXIT_SUCCESS;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_accessing_fmi_functions_in_static_libraries_and_source_code"><a class="link" href="#_accessing_fmi_functions_in_static_libraries_and_source_code">2.5.4.2. Accessing FMI Functions in Static Libraries and Source Code</a></h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">/* This example demonstrates how to import an FMU implemented as a static library or source code*/

// FMI function prefix (from XML)
#define FMI3_FUNCTION_PREFIX VanDerPol_
#include "fmi3Functions.h"
#undef FMI3_FUNCTION_PREFIX

#define INSTANTIATION_TOKEN "{8c4e810f-3da3-4a00-8276-176fa3c9f000}"


static void cb_logMessage(fmi3InstanceEnvironment instanceEnvironment, fmi3Status status, fmi3String category, fmi3String message) {
    // log message
}

int main(int argc, char* argv[]) {

    fmi3Instance m = VanDerPol_fmi3InstantiateModelExchange(
        "instance1",         // instance name
        INSTANTIATION_TOKEN, // instantiation token (from XML)
        NULL,                // resource location
        fmi3False,           // visible
        fmi3False,           // debug logging disabled
        NULL,                // instance environment
        cb_logMessage);      // logger callback

    // simulation ...

    VanDerPol_fmi3FreeInstance(m);

    return m ? EXIT_SUCCESS : EXIT_FAILURE;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="VersioningLayered"><a class="link" href="#VersioningLayered">2.6. Versioning and Layered Standards</a></h3>
<div class="paragraph">
<p>The FMI standard uses semantic version numbers, as defined in <a href="#PW13">[PW13]</a>, where the standard version consists of a triple of version numbers, consisting of major version, minor version, and patch version numbers <em>[e.g. 1.2.3 for major version 1, minor version 2 and patch version 3]</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Major versions will introduce changes that are neither backward nor forward compatible, including changes to the XML schemas to include new non-ignorable content.</p>
</li>
<li>
<p>Minor versions will only contain clarifications and include new layered standards, which may add new ignorable XML content, as defined below, into the core standard document, indicating that the standard needs to be supported by all conforming implementations.</p>
</li>
<li>
<p>Patch versions will only change explanatory text of the standard, make formerly defined content clearer, without any other changes to the XML schemas or other content definitions. For this reason, the version number attribute of all FMI files will only contain major and minor version numbers and not the patch version number: It should never be necessary for an importer to know the patch version number of the standard that the generating tool implemented.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to enable the backward-compatible extension of the FMI standard in minor releases and between minor releases, the FMI project intends the use of the layered standard mechanism to introduce new features in a fully backward-compatible and optional way.</p>
</div>
<div class="paragraph">
<p>A layered standard defines extensions to the base FMI standard by specifying, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Annotations">standardized annotations</a>,</p>
</li>
<li>
<p><a href="#extra-directory">standardized extra files in the FMU</a>,</p>
</li>
<li>
<p>support for additional <a href="#mimeType">MIME types</a>,</p>
</li>
<li>
<p>new values for <a href="#matchingRule"><code>matchingRule</code></a> or <a href="#terminalKind"><code>terminalKind</code></a> for <a href="#section-terminals">Terminals</a> and/or</p>
</li>
<li>
<p>adding C-API functions/variables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any FMU following a layered standard on top of FMI 3.0 must still be a compliant FMI 3.0 FMU.</p>
</div>
<div class="paragraph">
<p>Layered standards can fall into one of three categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>defined by third parties, completely independent from the <a href="#MAP">MAP</a> FMI,</p>
</li>
<li>
<p>defined by third parties that are endorsed by the FMI project and listed on the FMI project website, and</p>
</li>
<li>
<p>defined/adopted and published by the <a href="#MAP">MAP</a> FMI project itself, making them FMI project layered standards.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Layered standards that have achieved enough adoption or importance to be included into the base standard could be incorporated into a new minor or major release version of the base standard, making support for this layered standard optional or required for conformance with the newly published release of the FMI standard.</p>
</div>
<div class="paragraph">
<p>To enable implementations to uniformly detect the presence of a layered standard in an FMU, even if they are not aware of the particular layered standard, adherence by layered standards to the following conventions is recommended:</p>
</div>
<div class="paragraph">
<p>A layered standard should require the presence of an XML file named <code>fmi-ls-manifest.xml</code> in the sub-directory of <code>extra</code> mandated by the layered standard.
The root element of this XML file shall have the following attributes in the XML namespace <code><a href="http://fmi-standard.org/fmi-ls-manifest" class="bare">http://fmi-standard.org/fmi-ls-manifest</a></code>:</p>
</div>
<table id="table-schema-fmi-ls-manifest-root-attributes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. <code>fmi-ls-manifest.xml</code> root attribute details.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi-ls-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name, in reverse domain name notation, of the layered standard.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi-ls-version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of the layered standard.
The use of semantic versioning is highly recommended.
In case of semantic versioning it is up to the layered standard to define whether only major and minor version are included in the version attribute, or the full version is to be included.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi-ls-description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String with a brief description of the layered standard that is suitable for display to users.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Otherwise the content of this XML file can be arbitrary, i.e. the layered standard is free to mandate any root element and other content, as well as any XML namespaces.
This allows the use of the file for layered standard content, if the layered standard so wishes.</p>
</div>
<div class="paragraph">
<p>A simple example of a manifest file is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;MyRootElement
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="fmi_ls_manifest_example_schema.xsd"
  xmlns:fmi-ls="http://fmi-standard.org/fmi-ls-manifest"
  fmi-ls:fmi-ls-name="org.fmi-standard.demo-ls-name"
  fmi-ls:fmi-ls-version="1.0"
  fmi-ls:fmi-ls-description="Demonstration FMI Layered Standard"
  normal-attribute="foo"&gt;

  &lt;DemoElement modelIdentifier="PIDContoller"&gt;
    &lt;InfoSet&gt;
      &lt;InfoFile name="PIDContoller.inf"/&gt;
    &lt;/InfoSet&gt;
  &lt;/DemoElement&gt;

&lt;/MyRootElement&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A minimal example of a manifest file, for layered standards that have no need for additional content in that file is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiLayeredStandardManifest
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://fmi-standard.org/fmi-ls-manifest ../../schema/fmi3LayeredStandardManifest.xsd"
  xmlns="http://fmi-standard.org/fmi-ls-manifest"
  xmlns:fmi-ls="http://fmi-standard.org/fmi-ls-manifest"
  fmi-ls:fmi-ls-name="org.fmi-standard.demo-ls-name"
  fmi-ls:fmi-ls-version="1.0"
  fmi-ls:fmi-ls-description="Demonstration FMI Layered Standard"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The standard includes a schema for the attribute definitions and the minimal example element <code>fmiLayeredStandardManifest</code> shown above as <code>fmi3LayeredStandardManifest.xsd</code>.
An example schema that describes the simple example of a manifest above is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xsd hljs" data-lang="xsd">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" elementFormDefault="qualified"
    xmlns:fmi-ls="http://fmi-standard.org/fmi-ls-manifest"&gt;

    &lt;xs:import namespace="http://fmi-standard.org/fmi-ls-manifest" schemaLocation="../../schema/fmi3LayeredStandardManifest.xsd"/&gt;

    &lt;xs:element name="MyRootElement"&gt;
        &lt;xs:complexType&gt;
            &lt;xs:sequence&gt;
                &lt;xs:element name="DemoElement"&gt;
                    &lt;xs:complexType&gt;
                        &lt;xs:sequence&gt;
                            &lt;xs:element name="InfoSet"&gt;
                                &lt;xs:complexType&gt;
                                    &lt;xs:sequence&gt;
                                        &lt;xs:element name="InfoFile" maxOccurs="unbounded"&gt;
                                            &lt;xs:complexType&gt;
                                                &lt;xs:attribute name="name" type="xs:normalizedString"/&gt;
                                            &lt;/xs:complexType&gt;
                                        &lt;/xs:element&gt;
                                    &lt;/xs:sequence&gt;
                                &lt;/xs:complexType&gt;
                            &lt;/xs:element&gt;
                        &lt;/xs:sequence&gt;
                        &lt;xs:attribute name="modelIdentifier" type="xs:NMTOKEN"/&gt;
                    &lt;/xs:complexType&gt;
                &lt;/xs:element&gt;
            &lt;/xs:sequence&gt;
            &lt;xs:attribute ref="fmi-ls:fmi-ls-name" use="required" fixed="org.fmi-standard.demo-ls-name"/&gt;
            &lt;xs:attribute ref="fmi-ls:fmi-ls-version" use="required" fixed="1.0"/&gt;
            &lt;xs:attribute ref="fmi-ls:fmi-ls-description" use="required" fixed="Demonstration FMI Layered Standard"/&gt;
            &lt;xs:attribute name="normal-attribute" type="xs:normalizedString"/&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;    
&lt;/xs:schema&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-model-exchange"><a class="link" href="#fmi-for-model-exchange">3. FMI for Model Exchange</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FMI for Model Exchange provides a standardized interface for solving ordinary differential equations with events (abbreviated as "hybrid ODE").
In contrast to FMI for Co-Simulation, a Model Exchange FMU implements the model algorithm only, without the required solution method.</p>
</div>
<div class="paragraph">
<p>The importer controls the data exchange and the synchronization between FMUs.</p>
</div>
<div class="paragraph">
<p>The solver algorithm itself is not part of the FMI standard.</p>
</div>
<div class="paragraph">
<p>The solver algorithm is responsible for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>advancing the overall simulation time,</p>
</li>
<li>
<p>exchange input and output data,</p>
</li>
<li>
<p>computation of continuous state variables by time integration,</p>
</li>
<li>
<p>triggering of input clocks, and</p>
</li>
<li>
<p>handling events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In contrast to Co-Simulation, the FMU is evaluated only at a specific time instant and not from one communication point to the next.
A Model Exchange FMU might consist of discrete-time equations only, for example, describing a sampled-data controller.</p>
</div>
<div class="paragraph">
<p>FMI for Model Exchange enables the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>explicit or implicit integration algorithms with constant or variable step size,</p>
</li>
<li>
<p>dedicated <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, which allows computation of consistent initial conditions over <a href="#algebraic-loops">algebraic loops</a>,</p>
</li>
<li>
<p>exact localization of <a href="#state-event">state events</a> using <a href="#fmi3GetEventIndicators">event indicators</a>,</p>
</li>
<li>
<p>handling of <a href="#Clock">Clocks</a> and <a href="#EventMode">events</a>,</p>
</li>
<li>
<p>solution of algebraic loops involving input and output variables of this FMU (see <a href="#algebraic-loops">algebraic loops</a>),</p>
</li>
<li>
<p>selective computation of FMU variables required by the solver algorithm, e.g. outputs, event indicators, derivatives (see <a href="#selective-computation">Section 2.2.10</a>),</p>
</li>
<li>
<p>the ability of the FMU to provide <a href="#directionDerivatives">directional</a> and <a href="#adjointDerivatives">adjoint</a> partial derivatives.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Which of the features above are supported by a specific FMU is defined by <a href="#model-exchange-schema">capability flags</a>.</p>
</div>
<div class="sect2">
<h3 id="concepts-model-exchange"><a class="link" href="#concepts-model-exchange">3.1. Concepts</a></h3>
<div class="sect3">
<h4 id="localizationStateEvents"><a class="link" href="#localizationStateEvents">3.1.1. Localization of State Events</a></h4>
<div class="paragraph">
<p>Integration algorithms for differential equations assume continuous behavior of variables.
In hybrid ODEs, there are points during the simulation, when this assumption is violated.
A hybrid ODE solver must therefore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>locate exactly when such a discontinuity (event) happens and enter <a href="#EventMode"><strong>Event Mode</strong></a>.
This is trivial for <a href="#time-event">time events</a>.
For <a href="#state-event">state events</a> event indicators are used.</p>
</li>
<li>
<p>handle such events in <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</li>
<li>
<p>restart the integration algorithm when leaving <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="state-event"></a>An <a href="#fmi3GetEventIndicators">event indicator</a>, and only an event indicator, signals a <a href="#state-event">state event</a> with the domain change from \(\mathbf{z}_j &gt; 0\) to \(\mathbf{z}_j \leq 0\) or from \(\mathbf{z}_j \leq 0\) to \(\mathbf{z}_j &gt; 0\).<br>
<em>[This definition is slightly different from the usual standard definition of state events:</em> \(\mathbf{z}(t) \cdot \mathbf{z}(t_{i-1}) \leq 0\) <em>which has the severe drawback that the value of the event indicator at the previous event instant,</em> \(\mathbf{z}(t_{i-1}) \neq 0\), <em>must be non-zero and this condition cannot be guaranteed.</em>
<em>The often used term "zero-crossing function" for \(\mathbf{z}\) is misleading (and is therefore not used in this document), since a state event is defined by a domain change and not by a zero-crossing of a variable.]</em></p>
</div>
<div class="paragraph">
<p>The FMU must guarantee that after leaving <a href="#EventMode"><strong>Event Mode</strong></a> \(\mathbf{z}_j \neq 0\), for example, by shifting \(\mathbf{z}_j\) with a small value.<br>
<em>[All event indicators should be continuous between events.</em>
<em>Furthermore, \(\mathbf{z}_j\) should be scaled in the FMU with its nominal value (so all elements of the returned vector <code>eventIndicators</code> should be in the order of 1).]</em></p>
</div>
<div id="figure-events" class="imageblock text-center">
<div class="content">
<img src="images/Event.svg" alt="Event" width="60%">
</div>
<div class="title">Figure 45. An event occurs when the event indicator changes its domain from \(\mathbf{z}&gt;0\) to \(\mathbf{z} \leq 0\) or vice versa.</div>
</div>
<div id="frozen-relations" class="paragraph">
<p>During event localization the FMU might be evaluated after the switch of an event indicator.
Even when an event indicator switches, its corresponding relation must stay "frozen" to assure the continuity assumption of the integration algorithm.
This allows an integration algorithm to properly finish the current integration step.</p>
</div>
<div class="paragraph">
<p>In <a href="#table-variable-types">Table 4</a>, vector \(\mathbf{r}\) is used to label all relations.
In <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> all these relations are "frozen".
This is indicated in <a href="#updateRelations">the mathematical description</a> of <a href="#EventMode"><strong>Event Mode</strong></a> by computing \({}^\bullet\mathbf{r}\) when leaving <a href="#EventMode"><strong>Event Mode</strong></a> and using \({}^\bullet\mathbf{r}\) in the right-hand side of \({\mathbf{f}_{\mathit{cont}}}\) and \({\mathbf{f}_{\mathit{comp}}}\) in <a href="#table-math-model-exchange">mathematical description</a> of <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p><em>[Example:</em>
<em>An assignment of the form</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>y = ((x1 &gt; x2) || (x1 &lt; x3)) ? +1 : -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>can be implemented in the FMU as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>// event indicator computation:
z1 = x1 - x2;
z2 = x3 - x1;

// relations do not change in Continuous Time Mode
if Initialization Mode || Event Mode {
  r1 = z1 &gt; 0;
  r2 = z2 &gt; 0;
}
y = (r1 || r2) ? +1 : -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>Therefore, the original if-clause is evaluated in this form only during <a href="#InitializationMode"><strong>Initialization Mode</strong></a> and <a href="#EventMode"><strong>Event Mode</strong></a>.</em>
<em>A hysteresis should be added, in the FMU, for the event indicators to stabilize the event localization.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="state-machine-model-exchange"><a class="link" href="#state-machine-model-exchange">3.2. State Machine for Model Exchange</a></h3>
<div class="paragraph">
<p>The state machine in <a href="#figure-model-exchange-state-machine">Figure 46</a> defines the allowed calling sequences for FMI for Model Exchange.</p>
</div>
<div id="figure-model-exchange-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/state-machine-model-exchange.svg" alt="state machine model exchange" width="80%">
</div>
<div class="title">Figure 46. Calling sequence of Model Exchange C functions.</div>
</div>
<div class="paragraph">
<p>Common states are defined in <a href="#common-state-machine">Section 2.3</a>, such as super states <a href="#FMUStateSettable"><strong>FMU State Settable</strong></a> and  <a href="#Initialized"><strong>Initialized</strong></a>, states <a href="#Instantiated"><strong>Instantiated</strong></a>, <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a>, <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>, <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#Terminated"><strong>Terminated</strong></a>.</p>
</div>
<div class="sect3">
<h4 id="ContinuousTimeMode"><a class="link" href="#ContinuousTimeMode">3.2.1. State: Continuous-Time Mode</a></h4>
<div class="paragraph">
<p>The <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> is used to compute the values of all continuous-time variables between events by numerically solving ordinary differential and <a href="#algebraic-loops">algebraic equations</a>.
All discrete-time variables are fixed during this phase and the corresponding discrete-time equations are not evaluated.</p>
</div>
<div class="paragraph">
<p>In this state, the continuous-time equations are active and integrator steps are performed by the importer.</p>
</div>
<table id="table-math-model-exchange" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 72.7272%;">
<col style="width: 27.2728%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t := (\)<a href="#time"><code>time</code></a>\(, 0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetTime"><code>fmi3SetTime</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{c}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time <a href="#state">states</a> \(\mathbf{x}_{c}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetFloat64</code>, <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>\((\mathbf{y}_{c}, \mathbf{\dot{x}}_c, \mathbf{z}, \mathbf{w}_{c}) := \mathbf{f}_{\mathit{cont}}(\mathbf{x}_{c}, {}^\bullet\mathbf{x}_{d}, \mathbf{u}_{c}, {}^\bullet\mathbf{u}_{d}, \mathbf{p}, {}^\bullet\mathbf{r}, {}^\bullet\mathbf{b}, t)\)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a>,
<a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a>,
<a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Evaluate model equations with valid values for the right-hand side:<br>
\((\mathbf{y}_{c}, \mathbf{\dot{x}}_c, \mathbf{z}, \mathbf{w}_{c}, \mathbf{b},\)<a href="#enterEventMode"><code>enterEventMode</code></a>\()\) \(:= \mathbf{f}_{\mathit{comp}}(\mathbf{x}_{c}, {}^\bullet\mathbf{x}_{d}, \mathbf{u}_{c}, {}^\bullet\mathbf{u}_{d}, \mathbf{p}, {}^\bullet\mathbf{r}, {}^\bullet\mathbf{b}, t)\)</p>
</li>
<li>
<p>Update previous values of <a href="#buffers">buffers</a>: \({}^\bullet\mathbf{b} := \mathbf{b}\)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Evaluate \(\mathbf{f}_{\mathit{cont}}\), if no <code>fmi3GetXXX</code> function was called</p>
</li>
<li>
<p>Deactivate continuous-time equations \(\mathbf{f}_{\mathit{cont}}\)</p>
</li>
<li>
<p>Activate event equations \(\mathbf{f}_{\mathit{event}}\)</p>
</li>
<li>
<p>\(t := (t_{R}, 0)\)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
</dl>
</div>
<div id="fmi3SetTime" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3SetTime</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetTimeTYPE(fmi3Instance instance, fmi3Float64 time);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set a new value for the independent variable (typically a time instant).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="time"></a> Argument <code>time</code> is the new value for the real part \(t_{R}\) of \(t := (t_{R}, 0)\).
It refers to the unit of the <a href="#independent"><code>independent</code></a> variable.
<a href="#time"><code>time</code></a> must be larger or equal to:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#startTime"><code>startTime</code></a>,</p>
</li>
<li>
<p>the time at the second last call to <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a>,</p>
</li>
<li>
<p>the time at the last call to <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[This allows limited simulation backward in time.</em>
<em>As soon as an event occurs (<a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> was called), going back in time is impossible, because <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> / <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> can only compute the next discrete state, not the previous one.]</em></p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></dt>
<dd>
<p>Only for variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a>.</p>
</dd>
<dt class="hdlist1">Functions <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>Getting variables might trigger <a href="#selective-computation">computations</a>.</p>
</dd>
</dl>
</div>
<div id="fmi3SetContinuousStates" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3SetContinuousStates</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetContinuousStatesTYPE(fmi3Instance instance,
                                               const fmi3Float64 continuousStates[],
                                               size_t nContinuousStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set new continuous state values.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>continuousStates</code> contains the new values for each <a href="#state">continuous state</a>.
The order of the <code>continuousStates</code> vector must be the same as the ordered list of elements <a href="#ContinuousStateDerivative"><code>&lt;ContinuousStateDerivative&gt;</code></a> in <a href="#ModelStructure"><code>&lt;ModelStructure&gt;</code></a>.
Array variables are serialized as defined in <a href="#serialization-of-variables">Section 2.2.7.1</a>.
This order is also used in the arguments of the following functions: <a href="#fmi3GetNominalsOfContinuousStates"><code>fmi3GetNominalsOfContinuousStates</code></a>, <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>, and <a href="#fmi3GetContinuousStateDerivatives"><code>fmi3GetContinuousStateDerivatives</code></a>.</p>
</li>
<li>
<p>Argument <code>nContinuousStates</code> is the size of the <code>continuousStates</code> vector.</p>
<div class="paragraph">
<p><em>[<a href="#fmi3Discard"><code>fmi3Status = fmi3Discard</code></a> should be returned if the FMU rejects any of the state values because they, for example, violate min/max value restrictions.]</em></p>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Functions <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>Getting variables might trigger <a href="#selective-computation">computations</a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a></dt>
<dd>
<p>Returns the current continuous state vector.</p>
</dd>
</dl>
</div>
<div id="fmi3GetContinuousStateDerivatives" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3GetContinuousStateDerivatives</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetContinuousStateDerivativesTYPE(fmi3Instance instance,
                                                         fmi3Float64 derivatives[],
                                                         size_t nContinuousStates);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns the first-order derivatives with respect to the independent variable (usually time) of the continuous states.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Return argument <code>derivatives</code> contains the derivatives for each <a href="#state">continuous state</a> with the same convention for the order as defined for <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>.</p>
</li>
<li>
<p>Argument <code>nContinuousStates</code> is the size of the <code>derivatives</code> vector.</p>
<div class="paragraph">
<p><em>[<a href="#fmi3Discard"><code>fmi3Status = fmi3Discard</code></a> should be returned if the FMU was not able to compute the derivatives according to</em> \(\mathbf{f}_{\mathit{cont}}\) <em>because, for example, a numerical issue, such as division by zero, occurred.]</em></p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="fmi3GetEventIndicators" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3GetEventIndicators</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetEventIndicatorsTYPE(fmi3Instance instance,
                                              fmi3Float64 eventIndicators[],
                                              size_t nEventIndicators);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns the event indicators signaling <a href="#state-event">state events</a> by their sign changes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="eventIndicators"></a>Return argument <code>eventIndicators</code> contains the values for the event indicators in the order defined by the ordered list of XML elements <a href="#EventIndicator"><code>&lt;EventIndicator&gt;</code></a>.</p>
</li>
<li>
<p>Argument <code>nEventIndicators</code> is the current size of the <code>eventIndicators</code> vector (see <a href="#fmi3GetNumberOfEventIndicators"><code>fmi3GetNumberOfEventIndicators</code></a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[<a href="#fmi3Discard"><code>fmi3Status = fmi3Discard</code></a> should be returned if the FMU was not able to compute the event indicators according to</em> \(\mathbf{f}_{\mathit{cont}}\) <em>because, for example, a numerical issue, such as division by zero, occurred.]</em></p>
</div>
</dd>
</dl>
</div>
<div id="fmi3CompletedIntegratorStep" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3CompletedIntegratorStep</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3CompletedIntegratorStepTYPE(fmi3Instance instance,
                                                   fmi3Boolean  noSetFMUStatePriorToCurrentPoint,
                                                   fmi3Boolean* enterEventMode,
                                                   fmi3Boolean* terminateSimulation);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function is called after every completed step of the integrator provided the capability flag <code>needsCompletedIntegratorStep = true</code>.
The importer must have set valid values for <a href="#time"><code>time</code></a>, <a href="#continuous"><code>continuous</code></a> <a href="#input"><code>inputs</code></a> and <a href="#continuous"><code>continuous</code></a> <a href="#state">states</a> prior to calling this function to evaluate \(\mathbf{f}_{\mathit{comp}}\) with valid right-hand side data.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Argument <code>noSetFMUStatePriorToCurrentPoint = fmi3True</code> if <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> will no longer be called for time instants prior to current time in this simulation run.</p>
</li>
<li>
<p><a id="enterEventMode"></a> The return argument <code>enterEventMode</code> signals that the importer must call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> to handle a <a href="#step-event">step event</a>.</p>
</li>
<li>
<p><a id="terminateSimulationCIS"></a> When <a href="#terminateSimulationUDS"><code>terminateSimulation = fmi3True</code></a>, the FMU requests to stop the simulation and the importer must call <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>When the importer has reached valid values for the current integration step and one or more event indicators change sign (with respect to the previously completed integrator step), then the importer has to determine the time instant of the sign change that is closest to the previously completed integrator step.
This is usually performed by an iteration where time is varied and <a href="#state">state</a> variables are determined by interpolation.
Function <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> must be called after this <a href="#state-event">state event</a> location procedure.
The intended purpose of the function call is to indicate to the FMU that at this stage all <a href="#input"><code>inputs</code></a> and <a href="#state">state</a> variables have valid (accepted) values.
After <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> is called, it is still allowed to go back in time (calling <a href="#fmi3SetTime"><code>fmi3SetTime</code></a>) and inquire values of variables at previous time instants with <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> <em>[for example, to determine values of non-state variables at output points]</em>.
However, it is not allowed to go back in time over the previous <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> or the last <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> call.</p>
</div>
<div class="paragraph">
<p><em>[In this function the FMU might, for example:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Update delay buffers</em></p>
</li>
<li>
<p><em>Detect <a href="#step-event">step events</a> and request handling of <a href="#step-event">step events</a>:</em></p>
<div class="ulist">
<ul>
<li>
<p><em>for <a href="#dynamic-state-selection">dynamic state selection</a>: The FMU checks whether the dynamically selected states are still numerically appropriate.</em>
<em>If not, the function returns with <code>enterEventMode = fmi3True</code>, the importer will call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> and in <a href="#EventMode"><strong>Event Mode</strong></a> the new mapping is computed by the FMU.</em></p>
</li>
<li>
<p><em>for projection: FMUs that represent a DAE can project their continuous-time states onto the constraint manifold in <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>The new mapping or projection values might require a reinitialization of continuous-time states, which must be signaled to the importer by returning from <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a> with <a href="#valuesOfContinuousStatesChanged"><code>valuesOfContinuousStatesChanged = fmi3True</code></a>.</em></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>The function <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> is not used to detect <a href="#time-event">time events</a> or <a href="#state-event">state events</a>, for example, by comparing event indicators of the previous with the current call of <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a>.</em>
<em><a href="#time-event">Time events</a> and <a href="#state-event">state events</a> must be detected by the importer, which has to call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> in these cases, even if the returning from <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> with <code>enterEventMode = fmi3False</code>.]</em></p>
</div>
</dd>
</dl>
</div>
<div id="fmi3EnterEventMode" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3EnterEventMode</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterEventModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function changes the state to <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>The importer must call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> when any of the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>time has reached <a href="#nextEventTime"><code>nextEventTime</code></a> as returned by <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>, or</p>
</li>
<li>
<p>the signs of the event indicators signal an event according to <a href="#localizationStateEvents">Section 3.1.1</a>, or</p>
</li>
<li>
<p>the FMU returned with <a href="#enterEventMode"><code>enterEventMode = fmi3True</code></a> from <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> , or</p>
</li>
<li>
<p>the importer plans discrete changes to inputs, or</p>
</li>
<li>
<p>an <a href="#inputClock">input Clock</a> needs to be set.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_example"><a class="link" href="#_code_example">3.3. Code Example</a></h3>
<div class="paragraph">
<p>In the following example, the usage of the <code>fmi3XXX</code> functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
Furthermore, it is assumed that one FMU is directly integrated in a simulation environment.
If the FMU would be used inside another model, additional code is needed, especially initialization and event iteration have to be adapted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">    CALL(FMI3InstantiateModelExchange(S,
        INSTANTIATION_TOKEN, // instantiationToken
        resourcePath(),      // resourcePath
        fmi3False,           // visible
        fmi3False            // loggingOn
    ));

    // set the start time
    fmi3Float64 time = 0;

    // set start values
    CALL(applyStartValues(S));

    // initialize
    // determine continuous and discrete states
    CALL(FMI3EnterInitializationMode(S, fmi3False, 0.0, time, fmi3True, stopTime));

    CALL(applyContinuousInputs(S, false));
    CALL(applyDiscreteInputs(S));

    CALL(FMI3ExitInitializationMode(S));

    // intial event iteration
    while (discreteStatesNeedUpdate) {

        CALL(FMI3UpdateDiscreteStates(S,
            &amp;discreteStatesNeedUpdate,
            &amp;terminateSimulation,
            &amp;nominalsOfContinuousStatesChanged,
            &amp;valuesOfContinuousStatesChanged,
            &amp;nextEventTimeDefined,
            &amp;nextEventTime));

        if (terminateSimulation) {
            goto TERMINATE;
        }
    }

    CALL(FMI3EnterContinuousTimeMode(S));

#if NZ &gt; 0
    // initialize previous event indicators
    CALL(FMI3GetEventIndicators(S, previous_z, NZ));
#endif

#if NX &gt; 0
    // retrieve initial state x and
    // nominal values of x (if absolute tolerance is needed)
    CALL(FMI3GetContinuousStates(S, x, NX));
    CALL(FMI3GetNominalsOfContinuousStates(S, x_nominal, NX));
#endif

    // retrieve solution at t=Tstart, for example, for outputs
    // S-&gt;fmi3SetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

    CALL(recordVariables(S, outputFile));

    int steps = 0;

    while (!terminateSimulation) {

        // detect input and time events
        inputEvent = time &gt;= nextInputEventTime(time);
        timeEvent = nextEventTimeDefined &amp;&amp; time &gt;= nextEventTime;

        const bool eventOccurred = inputEvent || timeEvent || stateEvent || stepEvent;

        // handle events
        if (eventOccurred) {

            CALL(FMI3EnterEventMode(S));

            if (inputEvent) {
                CALL(applyContinuousInputs(S, true));
                CALL(applyDiscreteInputs(S));
            }

            nominalsOfContinuousStatesChanged = fmi3False;
            valuesOfContinuousStatesChanged   = fmi3False;

            // event iteration
            do {
                // set inputs at super dense time point
                // S-&gt;fmi3SetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

                fmi3Boolean nominalsChanged = fmi3False;
                fmi3Boolean statesChanged   = fmi3False;

                // update discrete states
                CALL(FMI3UpdateDiscreteStates(S, &amp;discreteStatesNeedUpdate, &amp;terminateSimulation, &amp;nominalsChanged, &amp;statesChanged, &amp;nextEventTimeDefined, &amp;nextEventTime));

                // get output at super dense time point
                // S-&gt;fmi3GetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

                nominalsOfContinuousStatesChanged |= nominalsChanged;
                valuesOfContinuousStatesChanged   |= statesChanged;

                if (terminateSimulation) {
                    goto TERMINATE;
                }

            } while (discreteStatesNeedUpdate);

            // enter Continuous-Time Mode
            CALL(FMI3EnterContinuousTimeMode(S));

            // retrieve solution at simulation (re)start
            CALL(recordVariables(S, outputFile));

#if NX &gt; 0
            if (valuesOfContinuousStatesChanged) {
                // the model signals a value change of states, retrieve them
                CALL(FMI3GetContinuousStates(S, x, NX));
            }

            if (nominalsOfContinuousStatesChanged) {
                // the meaning of states has changed; retrieve new nominal values
                CALL(FMI3GetNominalsOfContinuousStates(S, x_nominal, NX));
            }
#endif
        }

        if (time &gt;= stopTime) {
            goto TERMINATE;
        }

#if NX &gt; 0
        // compute continous state derivatives
        CALL(FMI3GetContinuousStateDerivatives(S, der_x, NX));
#endif
        // advance time
        time = ++steps * fixedStep;

        CALL(FMI3SetTime(S, time));

        // apply continuous inputs
        CALL(applyContinuousInputs(S, false));

#if NX &gt; 0
        // set states at t = time and perform one step
        for (size_t i = 0; i &lt; NX; i++) {
            x[i] += fixedStep * der_x[i]; // forward Euler method
        }

        CALL(FMI3SetContinuousStates(S, x, NX));
#endif

#if NZ &gt; 0
        stateEvent = fmi3False;

        if (eventOccurred) {
            // reset the previous event indicators
            CALL(FMI3GetEventIndicators(S, previous_z, NZ));
        } else {
            // get event indicators at t = time
            CALL(FMI3GetEventIndicators(S, z, NZ));

            for (size_t i = 0; i &lt; NZ; i++) {

                // check for zero crossings
                if (previous_z[i] &lt;= 0 &amp;&amp; z[i] &gt; 0) {
                    rootsFound[i] = 1;   // -\+
                } else  if (previous_z[i] &gt; 0 &amp;&amp; z[i] &lt;= 0) {
                    rootsFound[i] = -1;  // +/-
                } else {
                    rootsFound[i] = 0;   // no zero crossing
                }

                stateEvent |= rootsFound[i];

                previous_z[i] = z[i]; // remember the current value
            }
        }
#endif

        // inform the model about an accepted step
        CALL(FMI3CompletedIntegratorStep(S, fmi3True, &amp;stepEvent, &amp;terminateSimulation));

        // get continuous output
        CALL(recordVariables(S, outputFile));
    }

TERMINATE:
    return tearDown();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above errors are handled by the following definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">#define CALL(f) do { status = f; if (status &gt; FMIOK) goto TERMINATE; } while (0)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="model-exchange-schema"><a class="link" href="#model-exchange-schema">3.4. Description Schema</a></h3>
<div class="paragraph">
<p>XML elements and attributes common to all interface types are defined in <a href="#modelDescription.xml">FMI Description Schema</a>.
Additional elements and attributes are defined subsequently.
If the FMU implements the Model Exchange interface type, the element <code>&lt;ModelExchange&gt;</code> must be present.
It is defined as:</p>
</div>
<div id="figure-schema-ModelExchange" class="imageblock text-center">
<div class="content">
<img src="images/schema/ModelExchange.png" alt="ModelExchange" width="80%">
</div>
<div class="title">Figure 47. ModelExchange element.</div>
</div>
<div class="paragraph">
<p>The attribute in the following table is defined in addition to the <a href="#common-capability-flags">common attributes</a> and has the following meaning (all attributes are optional with exception of <a href="#modelIdentifier"><code>modelIdentifier</code></a>):</p>
</div>
<table id="table-ModelExchange-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. ModelExchange attribute details.</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>needsCompletedIntegratorStep</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the function <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> must be called after every completed integrator step.
If <code>false</code> and the function is called anyway, it has no effect.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="xml-example-model-exchange"><a class="link" href="#xml-example-model-exchange">3.4.1. Example Model Description File</a></h4>
<div class="paragraph">
<p>When generating an FMU from the hypothetical model <code>MyLibrary.SpringMassDamper</code>, the XML file may have the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription
  fmiVersion="3.0"
  modelName="MyLibrary.SpringMassDamper"
  instantiationToken="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2022-05-01T16:57:33Z"
  variableNamingConvention="structured"&gt;
  &lt;ModelExchange modelIdentifier="MyLibrary_SpringMassDamper"/&gt;
  &lt;UnitDefinitions&gt;
    &lt;Unit name="rad"&gt;
      &lt;BaseUnit rad="1"/&gt;
      &lt;DisplayUnit name="deg" factor="57.2957795130823"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="rad/s"&gt;
      &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="kg.m2"&gt;
      &lt;BaseUnit kg="1" m="2"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="N.m"&gt;
      &lt;BaseUnit kg="1" m="2" s="-2"/&gt;
    &lt;/Unit&gt;
  &lt;/UnitDefinitions&gt;
  &lt;TypeDefinitions&gt;
    &lt;Float64Type name="Modelica.Units.SI.Inertia" quantity="MomentOfInertia" unit="kg.m2" min="0.0"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.Torque" quantity="Torque" unit="N.m"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.AngularVelocity" quantity="AngularVelocity" unit="rad/s"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.Angle" quantity="Angle" unit="rad"/&gt;
  &lt;/TypeDefinitions&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;Float64 name="inertia1.J" valueReference="1073741824"
      description="Moment of load inertia" causality="parameter" variability="fixed"
      declaredType="Modelica.Units.SI.Inertia" start="1"/&gt;
    &lt;Float64 name="torque.tau" valueReference="536870912"
      description="Accelerating torque acting at flange (= -flange.tau)" causality="input"
      declaredType="Modelica.Units.SI.Torque" start="0"/&gt;
    &lt;Float64 name="inertia1.phi" valueReference="805306368"
      description="Absolute rotation angle of component" causality="output"
      declaredType="Modelica.Units.SI.Angle"/&gt;
    &lt;Float64 name="inertia1.w" valueReference="805306369"
      description="Absolute angular velocity of component (= der(phi))" causality="output"
      declaredType="Modelica.Units.SI.AngularVelocity"/&gt;
    &lt;Float64 name="x[1]" valueReference="0" initial="exact" start="0"/&gt;
    &lt;Float64 name="x[2]" valueReference="1" initial="exact" start="0"/&gt;
    &lt;Float64 name="der(x[1])" valueReference="2" derivative="0"/&gt;
    &lt;Float64 name="der(x[2])" valueReference="3" derivative="1"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Output valueReference="805306368"/&gt;
    &lt;Output valueReference="805306369"/&gt;
    &lt;ContinuousStateDerivative valueReference="2"/&gt;
    &lt;ContinuousStateDerivative valueReference="3"/&gt;
    &lt;InitialUnknown valueReference="805306368"/&gt;
    &lt;InitialUnknown valueReference="805306369"/&gt;
    &lt;InitialUnknown valueReference="2" dependencies="0 536870912"/&gt;
    &lt;InitialUnknown valueReference="3" dependencies="0 1"/&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-co-simulation"><a class="link" href="#fmi-for-co-simulation">4. FMI for Co-Simulation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FMI for Co-Simulation provides a standardized interface for execution of simulation models or tools in a co-simulation environment.
In contrast to FMI for Model Exchange, a Co-Simulation FMU implements not only the model algorithm, but also the required solution method.
The data exchange between FMUs is restricted to discrete communication points \(t_i\) (unless <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> is used).
In the time between two communication points (or between entering <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>), the subsystem inside an FMU is solved independently by internal means.
This leads to a delay for information "traveling through" the FMU, so there cannot be an immediate reaction (direct feedthrough) as in <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a> or <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a> of Model Exchange.
The co-simulation algorithm of the importer controls the data exchange and the synchronization between FMUs.</p>
</div>
<div class="paragraph">
<p>The co-simulation algorithm itself is not part of the FMI standard.</p>
</div>
<div class="paragraph">
<p>The co-simulation algorithm is responsible for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>advancing the overall simulation time,</p>
</li>
<li>
<p>exchange input and output data,</p>
</li>
<li>
<p>triggering of input clocks, and</p>
</li>
<li>
<p>handling events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For FMI for Co-Simulation the co-simulation algorithm is shielded from how the FMU advances time internally.
<em>[For example, FMUs containing ODEs and implementing FMI for Co-Simulation require to include an ODE solver inside the FMU to internally advance time between the communication points.</em>
<em>As another example, FMUs representing controller code, an internal scheduling algorithm can trigger computations at the correct time and order while advancing time to the next communication point.]</em></p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation enables the following features, allowing co-simulation algorithms of arbitrary sophistication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>variable or constant communication step sizes \(h_i\) (see <a href="#communicationStepSize"><code>communicationStepSize</code></a>),</p>
</li>
<li>
<p>reject and repeat communication steps (see <a href="#get-set-fmu-state">Section 2.2.7.4</a>), e.g. with reduced communication step size or a different set of input values,</p>
</li>
<li>
<p>update inputs and retrieve outputs at intermediate points within a communication step (see <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>),</p>
</li>
<li>
<p>return early from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> at \(t \leq t_{i+1}\), because, for example, an event influencing the environment was detected by the FMU (see <a href="#early-return">early return</a>),</p>
</li>
<li>
<p>dedicated <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, which allows computation of consistent initial conditions over <a href="#algebraic-loops">algebraic loops</a>,</p>
</li>
<li>
<p>handling of <a href="#Clock">Clocks</a> and <a href="#EventMode">events</a>,</p>
</li>
<li>
<p>the ability of the FMU to provide <a href="#derivative"><code>derivatives</code></a> of <a href="#output"><code>outputs</code></a> w.r.t. time, to allow approximation techniques (<a href="#getting-output-derivatives">Section 4.1.2</a>), and</p>
</li>
<li>
<p>the ability of the FMU to provide <a href="#directionDerivatives">directional</a> and <a href="#adjointDerivatives">adjoint</a> derivatives.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Which of the features above are supported by a specific FMU is defined by <a href="#model-exchange-schema">capability flags</a>.</p>
</div>
<div class="sect2">
<h3 id="concepts-co-simulation"><a class="link" href="#concepts-co-simulation">4.1. Concepts</a></h3>
<div class="sect3">
<h4 id="smoothness"><a class="link" href="#smoothness">4.1.1. Smoothness, Continuity and Discontinuity</a></h4>
<div class="paragraph">
<p>Since inputs are set at specific communication points by the importer, the FMU must make assumptions about the values between these communication points, including points of intermediate updates.</p>
</div>
<div class="paragraph">
<p>Between communication points, even in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>, all changes must be assumed to be continuous.
Changes to <a href="#continuous"><code>continuous</code></a> variables are only considered discrete in <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>If a <a href="#continuous"><code>continuous</code></a> input changes discontinuously (e.g. the actual input value deviates too much from the extrapolation polynomial), the co-simulation algorithm of the importer must raise an event (if supported) to indicate to the FMU a discontinuous change of a <a href="#continuous"><code>continuous</code></a> input.
In the case of Co-Simulation without <a href="#EventMode"><strong>Event Mode</strong></a> (see <a href="#eventModeUsed"><code>eventModeUsed</code></a> and <a href="#hasEventMode"><code>hasEventMode</code></a>), detecting discrete changes to continuous input variables (for instance to reset the integration algorithm within the FMU) requires heuristics.</p>
</div>
<div class="paragraph">
<p><a href="#discrete"><code>Discrete</code></a> inputs keep their values between communication points.
Furthermore, changing <a href="#discrete"><code>discrete</code></a> variables at communication points will likely require special handling within the FMU.</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-output-derivatives"><a class="link" href="#getting-output-derivatives">4.1.2. Getting Derivatives of Continuous Outputs</a></h4>
<div class="paragraph">
<p>In FMI for Co-Simulation, the n-th <a href="#derivative"><code>derivatives</code></a> with respect to time of continuous <a href="#output"><code>outputs</code></a> may be retrieved with <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a>, for example, to allow interpolation/extrapolation of connected input variables between communication points by the importer.<br></p>
</div>
<div class="paragraph">
<p>Whether the FMU is able to provide the <a href="#derivative"><code>derivatives</code></a> of <a href="#output"><code>outputs</code></a> is given by the capability flag <a href="#maxOutputDerivativeOrder"><code>maxOutputDerivativeOrder</code></a> that represents the maximum order of the <a href="#output"><code>output</code></a> <a href="#derivative"><code>derivatives</code></a>.
If the actual order is lower (because the order of integration algorithm is low), the retrieved value is 0.</p>
</div>
<div class="paragraph">
<p>The returned values correspond to the derivatives at the current time of the FMU.
For example, after a successful call to <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, the returned values are related to the end of the communication step.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3GetOutputDerivatives</code></dt>
</dl>
</div>
<div id="fmi3GetOutputDerivatives" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetOutputDerivativesTYPE(fmi3Instance instance,
                                                const fmi3ValueReference valueReferences[],
                                                size_t nValueReferences,
                                                const fmi3Int32 orders[],
                                                fmi3Float64 values[],
                                                size_t nValues);</code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>valueReferences</code> is a vector of value references that define the variables whose <a href="#derivative"><code>derivatives</code></a> shall be retrieved.
If multiple derivatives of a variable shall be retrieved, list the value reference multiple times.</p>
</li>
<li>
<p><code>nValueReferences</code> is the dimension of the arguments <code>valueReferences</code> and <code>orders</code>.</p>
</li>
<li>
<p><code>orders</code> contains the orders of the respective <a href="#derivative"><code>derivative</code></a> (1 means the first <a href="#derivative"><code>derivative</code></a>, 2 means the second <a href="#derivative"><code>derivative</code></a>, &#8230;&#8203;, 0 is not allowed).
If multiple derivatives of a variable shall be retrieved, its value reference must occur multiple times in <code>valueReferences</code> aligned with the corresponding <code>orders</code> array.</p>
</li>
<li>
<p><code>values</code> is a vector consisting of the <a href="#serialization-of-variables">serialized</a> values of these <a href="#derivative"><code>derivatives</code>&gt;:
The order of the <code>values</code> elements is derived from a twofold serialization: the outer level corresponds to the combination of a value reference (e.g., <code>valueReferences[k]</code>) and order (e.g., <code>orders[k]</code>), and the inner level to the serialization of variables as defined in &lt;&lt;serialization-of-variables</a>.
The inner level does not exist for scalar variables.</p>
</li>
<li>
<p><code>nValues</code> is the size of the argument <code>values</code>.
<code>nValues</code> only equals <code>nValueReferences</code> if all corresponding output variables are scalar variables.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p><em>[ Example:</em><br>
<em>Assuming an FMU has outputs \(y_1\)[2x3] with value reference 1, \(y_2\) with value reference 2, \( y_3\)[2] value reference 3, \(y_4\) with value reference 4 and <code>maxOutputDerivativeOrder = 2</code>.</em><br>
<em>With <code>valueReferences = [1, 1, 3, 3, 4, 4]</code>, and <code>orders = [1, 2, 1, 2, 1, 2]</code>, <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a> will provide first and second time derivatives of the outputs y1, y3, y4, which in <code>values</code> are serialized in the following way:</em>
<em>((array serialization of \(\dot y_1\)), (array serialization of \(\ddot y_1\)), (array serialization of \(\dot y_3\)), (array serialization of \(\ddot y_3\)), \(\dot y_4\), \(\ddot y_4\)).]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="early-return"><a class="link" href="#early-return">4.1.3. Early Return</a></h4>
<div class="paragraph">
<p>A Co-Simulation FMU is allowed to stop the execution of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> and return without reaching the predefined communication time, i.e. <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> <code>+</code> <a href="#communicationStepSize"><code>communicationStepSize</code></a>.
This mechanism is called <a href="#early-return">"early return"</a>.</p>
</div>
<div class="paragraph">
<p>Early return can be used to shorten a communication step because of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an event happened inside the FMU which influences its outputs non-continuously.</p>
</li>
<li>
<p>the importer requests the stop of the current communication step in <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>. <em>[E.g. the importer wants to stop a communication step because other parts of the simulation indicate the necessity.]</em></p>
</li>
<li>
<p>the FMU requests an additional communication point. <em>[E.g. the FMU wants to communicate extrema of outputs or prevent model inconsistencies, like negative pressure values, caused by extrapolation of inputs.]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For details see the argument <a href="#earlyReturn"><code>earlyReturn</code></a> of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.</p>
</div>
<div class="paragraph">
<p>The capability flag <a href="#canReturnEarlyAfterIntermediateUpdate"><code>canReturnEarlyAfterIntermediateUpdate</code></a> describes if the FMU supports early return after <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> if requested by the importer.</p>
</div>
<div class="paragraph">
<p>The argument <a href="#earlyReturnAllowed"><code>earlyReturnAllowed</code></a> of <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> signals to the FMU if the importer allows early return.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="state-machine-co-simulation"><a class="link" href="#state-machine-co-simulation">4.2. State Machine for Co-Simulation</a></h3>
<div class="paragraph">
<p>The state machine in <a href="#figure-co-simulation-state-machine">Figure 48</a> defines the allowed calling sequences for FMI for Co-Simulation.</p>
</div>
<div id="figure-co-simulation-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/state-machine-co-simulation.svg" alt="state machine co simulation" width="80%">
</div>
<div class="title">Figure 48. Calling sequence of Co-Simulation C functions.</div>
</div>
<div class="paragraph">
<p>Common states are defined in <a href="#common-state-machine">Section 2.3</a>, such as super states <a href="#FMUStateSettable"><strong>FMU State Settable</strong></a> and  <a href="#Initialized"><strong>Initialized</strong></a>, states <a href="#Instantiated"><strong>Instantiated</strong></a>, <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a>, <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>, <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a>, and <a href="#Terminated"><strong>Terminated</strong></a>.</p>
</div>
<div class="sect3">
<h4 id="StepMode"><a class="link" href="#StepMode">4.2.1. State: Step Mode</a></h4>
<div class="paragraph">
<p>The state <a href="#StepMode"><strong>Step Mode</strong></a> is used to compute the values of all variables between communication points and events and to advance time in the FMU.
If the FMU is connected in <a href="#algebraic-loops">algebraic loops</a> with other models, iterations over the FMU equations requires <a href="#get-set-fmu-state">setting the FMU to a state previously stored</a> (using <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a> and <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>) and repeating <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.</p>
</div>
<div class="paragraph">
<p>During <a href="#StepMode"><strong>Step Mode</strong></a>, <a href="#clocked-variable">clocked variables</a> can not be set or get because <a href="#Clock">Clocks</a> are only active during <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{\mathit{variability = tunable}}\) .</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set non-clocked, continuous-time and discrete-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{c+d-k}(t)\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get values of non-clocked variables \(\mathbf{v}_{-k}(t)\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get time derivatives of <a href="#continuous"><code>continuous</code></a> <a href="#output"><code>outputs</code></a> \(\mathbf{y}_c^{(j)}(t)\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>\((\mathbf{y}_{c+d-k}, \mathbf{y}_c^{(j)}, \mathbf{x}_{d-k}, \mathbf{w}_{c+d-k}, \mathbf{b}, t_{i+1}) := \mathbf{f}_{\mathit{doStep}}({}^{\bullet}\mathbf{x}_d, \mathbf{u}_{c+d}, {}^{\bullet}\mathbf{u}_{\mathit{c,u}}, \mathbf{p}, {}^{\bullet}\mathbf{b}, t_i, h_i)\)<br></p>
</li>
<li>
<p>Update previous values of non-clocked, discrete states: \({}^\bullet\mathbf{x}_{d-k} := \mathbf{x}_{d-k}\).</p>
</li>
<li>
<p>Update previous values of buffers: \({}^\bullet\mathbf{b} := \mathbf{b}\).</p>
</li>
<li>
<p>\(t := (t_{i+1}, 0)\)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3DoStep"><code>fmi3DoStep</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((\mathbf{v}_{u-k}, t_u) := \mathbf{f}_{\mathit{inter}}({}^{\bullet}\mathbf{x}_d, \mathbf{u}_{c+d}, {}^{\bullet}\mathbf{u}_{\mathit{c,u}}, \mathbf{p}, {}^{\bullet}\mathbf{b}, t_i, h_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activate event equations \(\mathbf{f}_{\mathit{event}}\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterEventModeCS"><code>fmi3EnterEventMode</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></dt>
<dd>
<p>sets the values of variables with:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, or</p>
</li>
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>at time \(t\).</p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>returns values for all variables at \(t\).
<a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> does not trigger an evaluation of \(\mathbf{f}_{\mathit{doStep}}\).
Therefore, <a href="#algebraic-loops">algebraic loops</a> at communication points cannot be handled by an appropriate sequence of <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> and <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> calls <em>[contrary to <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, <a href="#EventMode"><strong>Event Mode</strong></a> and <a href="#ContinuousTimeMode"><strong>Continuous-Time Mode</strong></a>]</em>.
Repeating a communication step requires to reset the FMU state to the previous communication point with <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> and repeating the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with new input values.</p>
<div class="paragraph">
<p>Calling <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> is not allowed after <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> without calling <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> in between.
<em>[This allows for more efficient FMU implementations that avoid double buffering and allows in-place operations.]</em></p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></dt>
<dd>
<p>See <a href="#getting-output-derivatives">Section 4.1.2</a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3DoStep"><code>fmi3DoStep</code></a></dt>
<dd>
<p>The importer requests the computation of the next time step with the following function:</p>
<div id="fmi3DoStep" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3DoStepTYPE(fmi3Instance instance,
                                  fmi3Float64 currentCommunicationPoint,
                                  fmi3Float64 communicationStepSize,
                                  fmi3Boolean noSetFMUStatePriorToCurrentPoint,
                                  fmi3Boolean* eventHandlingNeeded,
                                  fmi3Boolean* terminateSimulation,
                                  fmi3Boolean* earlyReturn,
                                  fmi3Float64* lastSuccessfulTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> can change the time of a Co-Simulation FMU from the outside (<a href="#advancing-time">time advances internally during <code>fmi3DoStep</code></a>).
Arguments referring to time inherit the unit of the <a href="#independent"><code>independent</code></a> variable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="currentCommunicationPoint"></a> <code>currentCommunicationPoint</code> is the current communication point of the importer (\(t_{i}\)).
At the first call of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> must be equal to the argument <a href="#startTime"><code>startTime</code></a> of <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>.</p>
</li>
<li>
<p><a id="communicationStepSize"></a> <code>communicationStepSize</code> is the communication step size (\(h_{i}\)).
<a href="#communicationStepSize"><code>communicationStepSize</code></a> must be \(&gt; 0.0\).
The FMU is expected to compute until time \(t_{i+1} = t_{i} + h_{i}\).
See <a href="#canHandleVariableCommunicationStepSize"><code>canHandleVariableCommunicationStepSize</code></a> for restrictions.</p>
<div class="paragraph">
<p><em>[Formally, argument <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> is not needed.</em>
<em>It is present in order to handle a potential mismatch between the importer&#8217;s and the FMU&#8217;s time representations and/or computations.</em>
<em>Both arguments <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> and <a href="#communicationStepSize"><code>communicationStepSize</code></a> allow computing of</em> \(t_{i+1}\) <em>by one addition, avoiding accumulation of numerical errors.]</em></p>
</div>
</li>
<li>
<p><a id="noSetFMUStatePriorToCurrentPoint"></a> <code>noSetFMUStatePriorToCurrentPoint = fmi3True</code> if <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> will no longer be called for time instants prior to <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> in this simulation run.</p>
<div class="paragraph">
<p><em>[The FMU can use this flag to flush a result buffer.]</em></p>
</div>
</li>
<li>
<p><a id="eventHandlingNeeded"></a> <a href="#eventHandlingNeeded"><code>eventHandlingNeeded = fmi3True</code></a> indicates that an event was encountered by the FMU at <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> and the importer has to enter <a href="#EventMode"><strong>Event Mode</strong></a> by calling <a href="#fmi3EnterEventModeCS"><code>fmi3EnterEventMode</code></a>.
<a href="#eventHandlingNeeded"><code>eventHandlingNeeded = fmi3True</code></a> must not be signalled, if the importer indicates to not support <a href="#EventMode"><strong>Event Mode</strong></a> by <a href="#eventModeUsed"><code>eventModeUsed = fmi3False</code></a>.
<em>[This is different from <a href="#earlyReturn"><code>earlyReturn</code></a> which only indicates that the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> did not complete the intended step up until <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> + <a href="#communicationStepSize"><code>communicationStepSize</code></a> and does not require event handling.]</em></p>
</li>
<li>
<p><a id="terminateSimulationDS"></a> When <a href="#terminateSimulationDS"><code>terminateSimulation = fmi3True</code></a>, the FMU requests to stop the simulation and the importer must call <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>.</p>
</li>
<li>
<p><a id="earlyReturn"></a> <code>earlyReturn</code> signals to the importer that the FMU returns at \(t_{i+1} &lt; t_i +\)<a href="#communicationStepSize"><code>communicationStepSize</code></a>.
<a href="#earlyReturn"><code>earlyReturn = fmi3True</code></a> is only allowed if <a href="#earlyReturnAllowed"><code>earlyReturnAllowed = fmi3True</code></a> in <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a>.
The time reached is specified in <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a>.
Reasons for <a href="#earlyReturn"><code>earlyReturn = fmi3True</code></a> are</p>
<div class="ulist">
<ul>
<li>
<p>expressed by the return arguments <a href="#eventHandlingNeeded"><code>eventHandlingNeeded</code></a> or <a href="#terminateSimulationDS"><code>terminateSimulation</code></a> of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, or</p>
</li>
<li>
<p>the FMU&#8217;s reaction to the importers request for <a href="#earlyReturn"><code>earlyReturn</code></a> by the return argument <a href="#earlyReturnRequested"><code>earlyReturnRequested = fmi3True</code></a> of <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a>, or</p>
</li>
<li>
<p>the FMU&#8217;s request for a communication point at <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> for any other reason.</p>
<div class="paragraph">
<p><a href="#earlyReturn"><code>earlyReturn = fmi3True</code></a> must not be used to signal that the requested step was not completed due to an error <em>[(e.g. integrator encountered division by zero)]</em>.
Instead, the function must return with an error code (<a href="#fmi3Error"><code>fmi3Error</code></a> or <a href="#fmi3Fatal"><code>fmi3Fatal</code></a>).
Alternatively, the function can return with <a href="#fmi3Discard"><code>fmi3Discard</code></a>, if the FMU is in the same state as before the call, i.e. the output argument values are undefined, but the computation may continue.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><a id="lastSuccessfulTime"></a> <code>lastSuccessfulTime</code> represents the internal time \(t_{i+1}\) of the FMU when <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> returns, for any value of <a href="#earlyReturn"><code>earlyReturn</code></a>.
It is possible that the <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> is equal to <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> when <a href="#earlyReturn"><code>earlyReturn = fmi3True</code></a> to indicate, for example, the detection of an event at <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a>.
Even if the FMU returns from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with <a href="#fmi3OK"><code>fmi3OK</code></a> and <a href="#earlyReturn"><code>earlyReturn = fmi3False</code></a>, it is allowed that <a href="#lastSuccessfulTime"><code>lastSuccessfulTime</code></a> deviates from the expected <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> <code>+</code> <a href="#communicationStepSize"><code>communicationStepSize</code></a>.
<em>[Examples:</em></p>
<div class="ulist">
<ul>
<li>
<p><em>A fixed-step integrator inside the FMU cannot reach the requested time exactly.</em>
<em><a href="#fixedInternalStepSize"><code>fixedInternalStepSize</code></a> was introduced to counter these effects.</em></p>
</li>
<li>
<p><em>A variable-step integrator with minimal step size is not able to land exactly at</em> \(t_{i+1}\)<em>.]</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a></dt>
<dd>
<p><a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a> switches the FMU itself into the <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.</p>
</dd>
</dl>
</div>
<div id="fmi3EnterEventModeCS" class="dlist">
<dl>
<dt class="hdlist1">Function <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterEventModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function changes the state to <a href="#EventMode"><strong>Event Mode</strong></a>.</p>
</div>
<div class="paragraph">
<p>The importer must call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> when any of the following conditions are met:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>time has reached <a href="#nextEventTime"><code>nextEventTime</code></a> as returned by <a href="#fmi3UpdateDiscreteStates"><code>fmi3UpdateDiscreteStates</code></a>, or</p>
</li>
<li>
<p>the FMU returned with <a href="#eventHandlingNeeded">eventHandlingNeeded = fmi3True</a> from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, or</p>
</li>
<li>
<p>the importer plans discrete changes to inputs, or</p>
</li>
<li>
<p>an <a href="#inputClock">input Clock</a> needs to be set.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>This function must not be called, if <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> signaled <a href="#eventModeUsed"><code>eventModeUsed = fmi3False</code></a>, which can be forced by the FMU with <a href="#hasEventMode"><code>hasEventMode = false</code></a>.</p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a></dt>
<dd>
<p><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> changes state to <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>.
<a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> must not be called if the FMU contains no <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a> (i.e. with <a href="#causality"><code>causality</code></a>= <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="IntermediateUpdateMode"><a class="link" href="#IntermediateUpdateMode">4.2.2. State: Intermediate Update Mode</a></h4>
<div class="paragraph">
<p><a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> can only be entered by the FMU itself using the callback function <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a>.
An FMU may enter <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> in order to exchange input and output values between communication points.
Furthermore, the <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> allows the importer to request an <a href="#early-return">early return</a> from the current <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> because of an event between communication points.</p>
</div>
<div class="paragraph">
<p>The importer cannot request entering <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> from the FMU and hence for some use cases (e.g. cooperative multitasking and setting of intermediate input values) the importer relies on the callbacks from the FMUs.</p>
</div>
<div class="paragraph">
<p><a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> enables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>enables advanced Co-Simulation with interpolation/extrapolation techniques of inputs and outputs (such as polynomial extrapolation, <a href="#transmission-line-modeling">Transmission Line Modeling</a> (<a href="#tlm">TLM</a>) co-simulation, anti-alias filtering, smoothing of input among others).</p>
</li>
<li>
<p>the same input approximation that was possible in FMI 2.0 with <code>fmi2SetInputDerivatives</code>, by evaluation of the approximation polynomial by the importer and not within the FMU as in FMI 2.0.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The FMU signals the support of <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> via the capability flag <a href="#providesIntermediateUpdate"><code>providesIntermediateUpdate</code></a>.
The co-simulation algorithm signals the support for <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> by providing a non-NULL callback-function pointer for <a href="#fmi3IntermediateUpdateCallback"><code>intermediateUpdate</code></a>.</p>
</div>
<div class="paragraph">
<p>Intermediate values for <a href="#continuous"><code>continuous</code></a> inputs are computed by the importer for example by an extrapolation polynomial build with the output derivatives of connected FMUs.
FMUs can signal with the optional attribute <a href="#recommendedIntermediateInputSmoothness"><code>recommendedIntermediateInputSmoothness</code></a> of value \(k\) to the co-simulation algorithm that best convergence rates can be achieved if these approximation functions are of smoothness \(C^{k}([t_i, t_{i+1}])\), that is k-time continuously differentiable, with \(C^{0}\) meaning continuous.<br>
<em>[This can increase simulation speed for higher order multi-step solvers that in this case do not have to reset at communication points.]</em></p>
</div>
<div class="paragraph">
<p>The importer must ensure that the input approximation function \(\mathbf{u}_u\) is consistent with the values of the input variable (\(\mathbf{u}_u(t_{i+1})= \mathbf{u}(t_{i+1})\)).</p>
</div>
<div class="paragraph">
<p>Due to the way FMU internal solvers may estimate and correct the approximation error, tentative states may occur and lead to tentative intermediate <a href="#output"><code>output</code></a> values (see <a href="#intermediateStepFinished"><code>intermediateStepFinished</code></a>).
If an FMU internal integration step has been completed successfully, the importer can forward intermediate outputs to other FMUs, where they can be used to approximate inputs.</p>
</div>
<div class="paragraph">
<p><a href="#figure-IntermediateUpdateMode">Figure 49</a> summarizes the above description.
It illustrates multiple intermediate internal solver steps, distinguishing between the final ones (with black-filled circles) and tentative ones (with white-filled circles).
It distinguishes the level of trust that can be placed in the tentative outputs (with dashed arrows) and in final outputs (with solid arrows).</p>
</div>
<div id="figure-IntermediateUpdateMode" class="imageblock text-center">
<div class="content">
<img src="images/intermediateupdate.svg" alt="intermediateupdate" width="65%">
</div>
<div class="title">Figure 49. Overview of solver states and intermediate update during a communication step</div>
</div>
<div class="paragraph">
<p>The FMU enters <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> by calling <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a> within <a href="#StepMode"><strong>Step Mode</strong></a> and leaves the state towards <a href="#StepMode"><strong>Step Mode</strong></a> when the function returns.</p>
</div>
<div id="fmi3IntermediateUpdateCallback" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void (*fmi3IntermediateUpdateCallback) (
    fmi3InstanceEnvironment instanceEnvironment,
    fmi3Float64  intermediateUpdateTime,
    fmi3Boolean  intermediateVariableSetRequested,
    fmi3Boolean  intermediateVariableGetAllowed,
    fmi3Boolean  intermediateStepFinished,
    fmi3Boolean  canReturnEarly,
    fmi3Boolean* earlyReturnRequested,
    fmi3Float64* earlyReturnTime);</code></pre>
</div>
</div>
<div id="intermediateUpdateTime" class="ulist">
<ul>
<li>
<p><a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> is the internal value of the <a href="#independent"><code>independent</code></a> variable <em>[typically simulation time]</em> of the FMU at which the callback has been called.
<a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> is restricted by the arguments of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> as follows:<br>
<a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> \(\leq\) <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> \(\leq\) (<a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> + <a href="#communicationStepSize"><code>communicationStepSize</code></a>).<br>
The FMU must not call the callback function <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a> with an <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> that is smaller than the <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> given in a previous call of <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a> with <code>intermediateStepFinished = fmi3True</code>.<br></p>
</li>
</ul>
</div>
<div id="intermediateVariableSetRequested" class="ulist">
<ul>
<li>
<p>If <a href="#intermediateVariableSetRequested"><code>intermediateVariableSetRequested = fmi3True</code></a>, the importer may provide intermediate values for continuous <a href="#input"><code>input</code></a> variables with <a href="#intermediateUpdate"><code>intermediateUpdate = true</code></a> by calling <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a>.
The set of variables for which the importer may provide intermediate values is declared through the <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> argument of <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a>.
If the importer does not provide a new value for any of the variables contained in the set it registered, the values set last remain.</p>
</li>
</ul>
</div>
<div id="intermediateVariableGetAllowed" class="ulist">
<ul>
<li>
<p>If <a href="#intermediateVariableGetAllowed"><code>intermediateVariableGetAllowed = fmi3True</code></a>, the importer may obtain intermediate output values by calling <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> for variables with <a href="#intermediateUpdate"><code>intermediateUpdate = true</code></a>.
The set of variables for which the importer may get values is defined by the <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> argument of <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a>.</p>
</li>
</ul>
</div>
<div id="intermediateStepFinished" class="ulist">
<ul>
<li>
<p>If <a href="#intermediateStepFinished"><code>intermediateStepFinished = fmi3False</code></a>, the intermediate output values of the FMU that the importer inquires with <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> resulting from tentative internal solver states and may still change for the same <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a> <em>[e.g., if the solver deems the tentative state to cause an unacceptable approximation error, it may go back in time and try to re-estimate the state using smaller internal time steps]</em>.<br>
If <a href="#intermediateStepFinished"><code>intermediateStepFinished = fmi3True</code></a>, intermediate output values inquired by the importer with <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> correspond to accepted internal solver steps.</p>
</li>
</ul>
</div>
<div id="canReturnEarly" class="ulist">
<ul>
<li>
<p>When <a href="#canReturnEarly"><code>canReturnEarly = fmi3True</code></a> the FMU signals to the importer its ability to return early from the current <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.</p>
</li>
</ul>
</div>
<div id="earlyReturnRequested" class="ulist">
<ul>
<li>
<p><code>earlyReturnRequested</code>: If and only if <a href="#canReturnEarly"><code>canReturnEarly = fmi3True</code></a>, the importer may request the FMU to return early from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> by setting <code>earlyReturnRequested = fmi3True</code>.</p>
</li>
</ul>
</div>
<div id="earlyReturnTime" class="ulist">
<ul>
<li>
<p><code>earlyReturnTime</code> is used to signal the FMU at which time to return early from the current <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, if <a href="#earlyReturnRequested"><code>earlyReturnRequested = fmi3True</code></a>.
If the <a href="#earlyReturnTime"><code>earlyReturnTime</code></a> is greater than the current <a href="#intermediateUpdateTime"><code>intermediateUpdateTime</code></a>, the FMU may compute up to <a href="#earlyReturnTime"><code>earlyReturnTime</code></a>.
<a href="#earlyReturnTime"><code>earlyReturnTime</code></a> is restricted by the arguments of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> as follows:<br>
<a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> \(\leq\) <a href="#earlyReturnTime"><code>earlyReturnTime</code></a> \(\leq\) (<a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> + <a href="#communicationStepSize"><code>communicationStepSize</code></a>).</p>
</li>
</ul>
</div>
<table id="table-math-intermediateUpdateMode" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. Mathematical description of <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a>.</caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get intermediate variable values \(\mathbf{v}_u(t_u)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get time derivatives of <a href="#continuous"><code>continuous</code></a> <a href="#output"><code>outputs</code></a> \(\mathbf{y}_{\mathit{c,u}}^{(j)}(t_u)\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set continuous intermediate input variables \(\mathbf{u}_{\mathit{c,u}}(t_u)\)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></dt>
<dd>
<p>This function can be called for intermediate variables, if <a href="#intermediateVariableGetAllowed"><code>intermediateVariableGetAllowed = fmi3True</code></a>.
Intermediate variables are variables that are marked with attribute <a href="#intermediateUpdate"><code>intermediateUpdate = true</code></a> in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> and have been included in the <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> argument of <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a>.</p>
</dd>
<dt class="hdlist1">Function <code>fmi3GetOutputDerivatives</code></dt>
<dd>
<p>For details on <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a> see <a href="#getting-output-derivatives">Section 4.1.2</a>.
Furthermore, calling <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a> is only allowed on variables as defined for <code>fmi3Get{VariableType}</code> above.</p>
</dd>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></dt>
<dd>
<p>This function can be called for intermediate input variables, if <a href="#intermediateVariableSetRequested"><code>intermediateVariableSetRequested = fmi3True</code></a>.
Intermediate input variables are input variables that are marked with attribute <a href="#intermediateUpdate"><code>intermediateUpdate = true</code></a> in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> and have been included in the <a href="#requiredIntermediateVariables"><code>requiredIntermediateVariables</code></a> argument of <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a>.
<a href="#discrete">Discrete</a> <a href="#input"><code>inputs</code></a> must not be set.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There is a defined order of calling these functions: first all <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> calls must be performed, then <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> may be called.<br>
<em>[This is analogous to the calling sequence of</em> <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> <em>and</em> <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> <em>calls in <a href="#StepMode"><strong>Step Mode</strong></a>.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_examples"><a class="link" href="#_code_examples">4.3. Code Examples</a></h3>
<div class="sect3">
<h4 id="_basic_co_simulation"><a class="link" href="#_basic_co_simulation">4.3.1. Basic Co-Simulation</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    CALL(FMI3InstantiateCoSimulation(S,
        INSTANTIATION_TOKEN, // instantiationToken
        resourcePath(),      // resourcePath
        fmi3False,           // visible
        fmi3False,           // loggingOn
        fmi3False,           // eventModeUsed
        fmi3False,           // earlyReturnAllowed
        NULL,                // requiredIntermediateVariables
        0,                   // nRequiredIntermediateVariables
        NULL                 // intermediateUpdate
    ));

    // set start values
    CALL(applyStartValues(S));

    // initialize the FMU
    CALL(FMI3EnterInitializationMode(S, fmi3False, 0.0, startTime, fmi3True, stopTime));

    CALL(FMI3ExitInitializationMode(S));

    for (int step = 0;; step++) {

        CALL(recordVariables(S, outputFile));

        // calculate the current time
        const fmi3Float64 time = step * h;

        CALL(applyContinuousInputs(S, false));
        CALL(applyDiscreteInputs(S));

        if (time &gt;= stopTime) {
            break;
        }

        // call instance s1 and check status
        CALL(FMI3DoStep(S, time, h, fmi3True, &amp;eventEncountered, &amp;terminateSimulation, &amp;earlyReturn, &amp;lastSuccessfulTime));

        if (terminateSimulation) {
            printf("The FMU requested to terminate the simulation.");
            break;
        }
    }

TERMINATE:
    return tearDown();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plot below shows the output for the <a href="https://github.com/modelica/Reference-FMUs">BouncingBall Reference FMU</a> with a communication step size of 0.1 s.
Note that the points where the ball hits the floor are missed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/BouncingBall_cs.svg" alt="BouncingBall cs" width="100%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_early_return"><a class="link" href="#_early_return">4.3.2. Early Return</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    CALL(FMI3InstantiateCoSimulation(S,
        INSTANTIATION_TOKEN, // instantiationToken
        NULL,                // resourcePath
        fmi3False,           // visible
        fmi3False,           // loggingOn
        fmi3False,           // eventModeUsed
        fmi3True,            // earlyReturnAllowed
        NULL,                // requiredIntermediateVariables
        0,                   // nRequiredIntermediateVariables
        NULL                 // intermediateUpdate
    ));

    // set start values
    CALL(applyStartValues(S));

    fmi3Float64 time = startTime;

    // initialize the FMU
    CALL(FMI3EnterInitializationMode(S, fmi3False, 0.0, time, fmi3True, stopTime));

    CALL(FMI3ExitInitializationMode(S));

    // communication step size
    const fmi3Float64 stepSize = 10 * FIXED_SOLVER_STEP;

    while (true) {

        // apply continuous and discrete inputs
        CALL(applyContinuousInputs(S, true));
        CALL(applyDiscreteInputs(S));

        // record variables
        CALL(recordVariables(S, outputFile));

        if (terminateSimulation || time &gt;= stopTime) {
            break;
        }

        // returns early on events
        CALL(FMI3DoStep(S,
            time,                 // currentCommunicationPoint
            stepSize,             // communicationStepSize
            fmi3True,             // noSetFMUStatePriorToCurrentPoint
            &amp;eventEncountered,    // eventEncountered
            &amp;terminateSimulation, // terminate
            &amp;earlyReturn,         // earlyReturn
            &amp;time                 // lastSuccessfulTime
        ));
    }

TERMINATE:
    return tearDown();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plot below shows the output for the <a href="https://github.com/modelica/Reference-FMUs">BouncingBall Reference FMU</a> with a communication step size of 0.1 s.
Note that the points where the ball hits the floor are available, but only the outputs after the events are recorded.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cs_early_return.svg" alt="cs early return" width="100%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_mode"><a class="link" href="#_event_mode">4.3.3. Event Mode</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    CALL(FMI3InstantiateCoSimulation(S,
        INSTANTIATION_TOKEN, // instantiationToken
        NULL,                // resourcePath
        fmi3False,           // visible
        fmi3False,           // loggingOn
        fmi3True,            // eventModeUsed
        fmi3True,            // earlyReturnAllowed
        NULL,                // requiredIntermediateVariables
        0,                   // nRequiredIntermediateVariables
        NULL                 // intermediateUpdate
    ));

    // set start values
    CALL(applyStartValues(S));

    fmi3Float64 time = startTime;

    // initialize the FMU
    CALL(FMI3EnterInitializationMode(S, fmi3False, 0.0, time, fmi3True, stopTime));

    // apply continuous and discrete inputs
    CALL(applyContinuousInputs(S, true));
    CALL(applyDiscreteInputs(S));

    CALL(FMI3ExitInitializationMode(S));

    // update discrete states
    do {
        CALL(FMI3UpdateDiscreteStates(S,
            &amp;discreteStatesNeedUpdate,
            &amp;terminateSimulation,
            &amp;nominalsChanged,
            &amp;statesChanged,
            &amp;nextEventTimeDefined,
            &amp;nextEventTime
        ));

        if (terminateSimulation) {
            goto TERMINATE;
        }
    } while (discreteStatesNeedUpdate);

    CALL(FMI3EnterStepMode(S));

    // communication step size
    const fmi3Float64 stepSize = 10 * FIXED_SOLVER_STEP;

    while (true) {

        CALL(recordVariables(S, outputFile));

        if (terminateSimulation || time &gt;= stopTime) {
            break;
        }

        CALL(FMI3DoStep(S,
            time,                 // currentCommunicationPoint
            stepSize,             // communicationStepSize
            fmi3True,             // noSetFMUStatePriorToCurrentPoint
            &amp;eventEncountered,    // eventEncountered
            &amp;terminateSimulation, // terminate
            &amp;earlyReturn,         // earlyReturn
            &amp;time                 // lastSuccessfulTime
        ));

        if (eventEncountered) {

            // record variables before event update
            CALL(recordVariables(S, outputFile));

            // enter Event Mode
            CALL(FMI3EnterEventMode(S));

            // apply continuous and discrete inputs
            CALL(applyContinuousInputs(S, true));
            CALL(applyDiscreteInputs(S));

            // update discrete states
            do {
                CALL(FMI3UpdateDiscreteStates(S,
                    &amp;discreteStatesNeedUpdate,
                    &amp;terminateSimulation,
                    &amp;nominalsChanged,
                    &amp;statesChanged,
                    &amp;nextEventTimeDefined,
                    &amp;nextEventTime
                ));

                if (terminateSimulation) {
                    break;
                }
            } while (discreteStatesNeedUpdate);

            // return to Step Mode
            CALL(FMI3EnterStepMode(S));
        }
    }

TERMINATE:
    return tearDown();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plot below shows the output for the <a href="https://github.com/modelica/Reference-FMUs">BouncingBall Reference FMU</a> with a communication step size of 0.1 s.
Note that the points where the ball hits the floor are available and the outputs before and after the event are recorded.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cs_event_mode.svg" alt="cs event mode" width="100%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_intermediate_update"><a class="link" href="#_intermediate_update">4.3.4. Intermediate Update</a></h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">void intermediateUpdate(fmi3InstanceEnvironment instanceEnvironment,
                           fmi3Float64 intermediateUpdateTime,
                           fmi3Boolean intermediateVariableSetRequested,
                           fmi3Boolean intermediateVariableGetAllowed,
                           fmi3Boolean intermediateStepFinished,
                           fmi3Boolean canReturnEarly,
                           fmi3Boolean *earlyReturnRequested,
                           fmi3Float64 *earlyReturnTime) {

    if (!instanceEnvironment) {
        return;
    }

    FMIInstance *S = (FMIInstance *)instanceEnvironment;

    S-&gt;time = intermediateUpdateTime;

    *earlyReturnRequested = fmi3False;
    *earlyReturnTime = 0;

    // if getting intermediate output variables is allowed
    if (intermediateVariableGetAllowed) {

        // Get the output variables at time == intermediateUpdateTime
        // fmi3Get{VariableType}();
        status = recordVariables(S, outputFile);

        // If integration step in FMU solver is finished
        if (intermediateStepFinished) {
            //Forward output variables to other FMUs or write to result files
        }
    }

    // if setting intermediate output variables is allowed
    if (intermediateVariableSetRequested) {
        // Compute intermediate input variables from output variables and
        // variables from other FMUs. Use latest available output
        // variables, possibly from get functions above.
        // inputVariables = ...

        // Set the input variables at time == intermediateUpdateTime
        // fmi3Set{VariableType}();
    }

    // Internal execution in FMU will now continue

    // TODO: handle status

    // log function call
    fprintf(logFile, "intermediateUpdate("
        "instanceEnvironment=0x%p, "
        "intermediateUpdateTime=%.16g, "
        "intermediateVariableSetRequested=%d, "
        "intermediateVariableGetAllowed=%d, "
        "intermediateStepFinished=%d, "
        "canReturnEarly=%d, "
        "earlyReturnRequested=%d, "
        "earlyReturnTime=%.16g)\n",
        instanceEnvironment,
        intermediateUpdateTime,
        intermediateVariableSetRequested,
        intermediateVariableGetAllowed,
        intermediateStepFinished,
        canReturnEarly,
        *earlyReturnRequested,
        *earlyReturnTime
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plot below shows the output for the <a href="https://github.com/modelica/Reference-FMUs">BouncingBall Reference FMU</a> with a communication step size of 0.1 s.
Note that the outputs at all intermediate steps are recorded, too.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cs_intermediate_update.svg" alt="cs intermediate update" width="100%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_connected_fmus"><a class="link" href="#_connected_fmus">4.3.5. Connected FMUs</a></h4>
<div class="paragraph">
<p>In the following example, the usage of the FMI functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
We consider two FMUs, where both have one <a href="#continuous"><code>continuous</code></a> floating point <a href="#input"><code>input</code></a> and one <a href="#continuous"><code>continuous</code></a> floating point <a href="#output"><code>output</code></a> which are connected in the following way:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-connection-of-FMUs.svg" alt="co simulation connection of FMUs" width="30%">
</div>
<div class="title">Figure 50. Connection graph of FMUs.</div>
</div>
<div class="paragraph">
<p>We assume no algebraic dependency between input and <a href="#output"><code>output</code></a> of each FMU.
The code demonstrates the simplest importer as shown in <a href="#state-machine-co-simulation">Section 4.2</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Constant communication step size.</p>
</li>
<li>
<p>No repeating of communication steps.</p>
</li>
<li>
<p>The error handling is implemented in a very rudimentary way.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">    ////////////////////////////
    // Initialization sub-phase

    // instantiate both FMUs
    s1 = M1-&gt;fmi3InstantiateCoSimulation("s1",          // instanceName
                                         guid,          // instantiationToken
                                         NULL,          // resourceLocation
                                         fmi3False,     // visible
                                         fmi3False,     // loggingOn
                                         fmi3False,     // eventModeUsed
                                         fmi3False,     // earlyReturnAllowed
                                         NULL,          // requiredIntermediateVariables
                                         0,             // nRequiredIntermediateVariables
                                         NULL,          // instanceEnvironment
                                         cb_logMessage, // logMessage
                                         NULL);         // intermediateUpdate

    s2 = M2-&gt;fmi3InstantiateCoSimulation("s2",          // instanceName
                                         guid,          // instantiationToken
                                         NULL,          // resourceLocation
                                         fmi3False,     // visible
                                         fmi3False,     // loggingOn
                                         fmi3False,     // eventModeUsed
                                         fmi3False,     // earlyReturnAllowed
                                         NULL,          // requiredIntermediateVariables
                                         0,             // nRequiredIntermediateVariables
                                         NULL,          // instanceEnvironment
                                         cb_logMessage, // logMessage
                                         NULL);         // intermediateUpdate

    if (s1 == NULL || s2 == NULL)
        return EXIT_FAILURE;

    // start and stop time
    startTime = 0;
    stopTime = 10;

    // communication step size
    h = 0.01;

    // set all variable start values (of "ScalarVariable / &lt;type&gt; / start")
    // s1_fmi3Set{VariableType}(s1, ...);
    // s2_fmi3Set{VariableType}(s2, ...);

    // initialize the FMUs
    M1-&gt;fmi3EnterInitializationMode(s1, fmi3False, 0.0, startTime, fmi3True, stopTime);
    M2-&gt;fmi3EnterInitializationMode(s2, fmi3False, 0.0, startTime, fmi3True, stopTime);

    // set the input values at time = startTime
    // fmi3Set{VariableType}(s1, ...);
    // fmi3Set{VariableType}(s2, ...);

    M1-&gt;fmi3ExitInitializationMode(s1);
    M2-&gt;fmi3ExitInitializationMode(s2);

    ////////////////////////
    // Simulation sub-phase
    time = startTime; // current time

    nSteps = 0;

    while ((time &lt; stopTime) &amp;&amp; (status == fmi3OK)) {

        // retrieve outputs
        // fmi3Get{VariableType}(s1, ..., 1, &amp;y1);
        // fmi3Get{VariableType}(s2, ..., 1, &amp;y2);

        // set inputs
        // fmi3Set{VariableType}(s1, ..., 1, &amp;y2);
        // fmi3Set{VariableType}(s2, ..., 1, &amp;y1);

        // call instance s1 and check status
        status = M1-&gt;fmi3DoStep(s1, time, h, fmi3True, &amp;eventEncountered, &amp;terminateSimulation, &amp;earlyReturn, &amp;lastSuccessfulTime);

        if (terminateSimulation) {
            break;  // Instance s1 requested to terminate simulation.
        }

        // call instance s2 and check status as above
        status = M2-&gt;fmi3DoStep(s2, time, h, fmi3True, &amp;eventEncountered, &amp;terminateSimulation, &amp;earlyReturn, &amp;lastSuccessfulTime);

        // ...

        // increment current time
        time = (++nSteps) * h;
     }

    //////////////////////////
    // Shutdown sub-phase
    if (status != fmi3Error &amp;&amp; status != fmi3Fatal) {
        M1-&gt;fmi3Terminate(s1);
        M2-&gt;fmi3Terminate(s2);
    }

    if (status != fmi3Fatal) {
        M1-&gt;fmi3FreeInstance(s1);
        M2-&gt;fmi3FreeInstance(s2);
    }

    return EXIT_SUCCESS;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="co-simulation-schema"><a class="link" href="#co-simulation-schema">4.4. Description Schema</a></h3>
<div class="paragraph">
<p>XML elements and attributes common to all interface types are defined in <a href="#modelDescription.xml">FMI Description Schema</a>.
Additional elements and attributes are defined subsequently.
If the FMU implements the Co-Simulation interface type, the element <code>&lt;CoSimulation&gt;</code> must be present.
It is defined as:</p>
</div>
<div id="figure-schema-CoSimulation" class="imageblock text-center">
<div class="content">
<img src="images/schema/CoSimulation.png" alt="CoSimulation" width="80%">
</div>
<div class="title">Figure 51. CoSimulation element.</div>
</div>
<div class="paragraph">
<p>The attributes in the following table are defined in addition to the <a href="#common-capability-flags">common attributes</a> and have the following meaning (all attributes are optional with the exception of <a href="#modelIdentifier"><code>modelIdentifier</code></a>):</p>
</div>
<table id="table-CoSimulation-details" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. CoSimulation attribute details.</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canHandleVariableCommunicationStepSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="canHandleVariableCommunicationStepSize"></a>If <code>canHandleVariableCommunicationStepSize = true</code>, then the communication step size (argument <a href="#communicationStepSize"><code>communicationStepSize</code></a> of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>) can vary for each call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fixedInternalStepSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="fixedInternalStepSize"></a>If the FMU has a fixed internal step size, this optional attribute communicates it.<br>
<em>[This information can be used by the importer to synchronize the communication interval with that fixed internal step size of the FMU.</em>
<em>The importer should use an integer multiple of this value as <a href="#communicationStepSize">communication step size</a>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxOutputDerivativeOrder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="maxOutputDerivativeOrder"></a>The FMU is able to provide <a href="#derivative"><code>derivatives</code></a> of <a href="#output"><code>outputs</code></a> up to the order of <code>maxOutputDerivativeOrder</code>.
Calling of <code>fmi3GetOutputDerivatives</code> is allowed up to the order defined by <code>maxOutputDerivativeOrder</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>recommendedIntermediateInputSmoothness</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="recommendedIntermediateInputSmoothness"></a>A value of \(k\) with \(k&gt;0\) signals to the importer, that it is beneficial for the solver within the FMU to receive intermediate inputs that are \(k\)-time continuously differentiable (\(C^k\)) on the current communication interval.
\(k = 0\) means continuous (see <a href="#smoothness">Section 4.1.1</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesIntermediateUpdate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="providesIntermediateUpdate"></a>The FMU supports <a href="#IntermediateUpdateMode"><strong>Intermediate Update Mode</strong></a> and will call <a href="#fmi3IntermediateUpdateCallback"><code>fmi3IntermediateUpdateCallback</code></a>, if provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mightReturnEarlyFromDoStep</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="mightReturnEarlyFromDoStep"></a>The FMU announces that it might <a href="#earlyReturn">return early</a> from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.
If this flag is <code>false</code>, the importer can assume that the FMU computes the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> as instructed up until <a href="#currentCommunicationPoint"><code>currentCommunicationPoint</code></a> + <a href="#communicationStepSize"><code>communicationStepSize</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canReturnEarlyAfterIntermediateUpdate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="canReturnEarlyAfterIntermediateUpdate"></a>If <code>true</code>, the FMU is able to return early from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> if the importer returns <a href="#earlyReturnRequested"><code>earlyReturnRequested = fmi3True</code></a> from the callback <a href="#intermediateUpdate"><code>intermediateUpdate</code></a>.
<code>canReturnEarlyAfterIntermediateUpdate</code> may only be <code>true</code>, if <a href="#providesIntermediateUpdate"><code>providesIntermediateUpdate</code></a> is <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hasEventMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="hasEventMode"></a>If <code>true</code> the FMU supports <a href="#EventMode"><strong>Event Mode</strong></a>.<br>
If the importer does not support <a href="#EventMode"><strong>Event Mode</strong></a>, then it must call <a href="#fmi3InstantiateCoSimulation"><code>fmi3InstantiateCoSimulation</code></a> with <a href="#eventModeUsed"><code>eventModeUsed = fmi3False</code></a> to force the FMU to detect and handle events internally.<br>
If <code>eventModeUsed = fmi3True</code>, the importer must actively trigger event handling at communication points in the FMU using <a href="#fmi3EnterEventModeCS"><code>fmi3EnterEventMode</code></a>.<br>
If the FMU has clocks, then <a href="#hasEventMode"><code>hasEventMode</code></a> must be <code>true</code>.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_example_model_description_file"><a class="link" href="#_example_model_description_file">4.4.1. Example Model Description File</a></h4>
<div class="sect4">
<h5 id="xml-example-co-simulation"><a class="link" href="#xml-example-co-simulation">4.4.1.1. Example Model Description File with Early Return</a></h5>
<div class="paragraph">
<p>The <a href="#xml-example-fmimodeldescription-cosimulation">Example <code>&lt;fmiModelDescription&gt;</code></a> below is the same as shown in <a href="#xml-example-model-exchange">Section 3.4.1</a> for a Model Exchange FMU.
The only differences are the replacement of the element <code>&lt;ModelExchange&gt;</code> with the element <code>&lt;CoSimulation&gt;</code> with additional Co-Simulation-specific attributes, and the removal of <a href="#local"><code>local</code></a> variables, which are associated with continuous <a href="#state">states</a> and their <a href="#derivative"><code>derivatives</code></a>.</p>
</div>
<div id="xml-example-fmimodeldescription-cosimulation" class="listingblock">
<div class="title">Example <code>&lt;fmiModelDescription&gt;</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;fmiModelDescription
  fmiVersion="3.0"
  modelName="MyLibrary.SpringMassDamper_Early_Return_example"
  instantiationToken="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2022-05-01T16:57:33Z"
  variableNamingConvention="structured"&gt;
  &lt;CoSimulation
    modelIdentifier="MyLibrary_SpringMassDamper"
    canHandleVariableCommunicationStepSize="true"
    providesIntermediateUpdate="true"
    canReturnEarlyAfterIntermediateUpdate="true"
    hasEventMode="true"/&gt;
  &lt;UnitDefinitions&gt;
    &lt;Unit name="rad"&gt;
      &lt;BaseUnit rad="1"/&gt;
      &lt;DisplayUnit name="deg" factor="57.2957795130823"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="rad/s"&gt;
      &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="kg.m2"&gt;
      &lt;BaseUnit kg="1" m="2"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="N.m"&gt;
      &lt;BaseUnit kg="1" m="2" s="-2"/&gt;
    &lt;/Unit&gt;
  &lt;/UnitDefinitions&gt;
  &lt;TypeDefinitions&gt;
    &lt;Float64Type name="Modelica.Units.SI.Inertia" quantity="MomentOfInertia" unit="kg.m2" min="0.0"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.Torque" quantity="Torque" unit="N.m"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.AngularVelocity" quantity="AngularVelocity" unit="rad/s"/&gt;
    &lt;Float64Type name="Modelica.Units.SI.Angle" quantity="Angle" unit="rad"/&gt;
  &lt;/TypeDefinitions&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;Float64 name="inertia1.J" valueReference="1073741824"
      description="Moment of load inertia" causality="parameter" variability="fixed"
      declaredType="Modelica.Units.SI.Inertia" start="1"/&gt;
    &lt;Float64 name="torque.tau" valueReference="536870912"
      description="Accelerating torque acting at flange (= -flange.tau)" causality="input"
      declaredType="Modelica.Units.SI.Torque" start="0"/&gt;
    &lt;Float64 name="inertia1.phi" valueReference="805306368"
      description="Absolute rotation angle of component" causality="output"
      declaredType="Modelica.Units.SI.Angle"/&gt;
    &lt;Float64 name="inertia1.w" valueReference="805306369"
      description="Absolute angular velocity of component (= der(phi))" causality="output"
      declaredType="Modelica.Units.SI.AngularVelocity"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Output valueReference="805306368"/&gt;
    &lt;Output valueReference="805306369"/&gt;
    &lt;InitialUnknown valueReference="805306368"/&gt;
    &lt;InitialUnknown valueReference="805306369"/&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-scheduled-execution"><a class="link" href="#fmi-for-scheduled-execution">5. FMI for Scheduled Execution</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Scheduled Execution interface provides support for concurrent computation of <a href="#model-partition">model partitions</a> on a single computational resource (e.g. CPU-core).
The FMU exposes model partitions defined by its associated Clocks while the <a href="#importer">importer</a> is enabled to explicitly schedule each model partition&#8217;s execution.
As mentioned in <a href="#advancing-time">Section 2.2.6</a>, it is the importer respectively its scheduler that controls how time is progressing.</p>
</div>
<div class="paragraph">
<p>The following use cases and requirements motivate the introduction of this interface type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The scheduler can execute a model partition at any time.
It can execute model partitions periodically (either according to virtual time or real time) or reacting to an <a href="#event">event</a>, e.g. an event of an external I/O or an event sent from an FMU (see below).</p>
</li>
<li>
<p>The scheduler can run model partitions of one FMU together with model partitions of other FMUs or model partitions provided by other sources such as other models or functions in a single process.</p>
</li>
<li>
<p>The scheduler respects <a href="#priority">priorities</a> of the model partitions defined by the FMU.</p>
</li>
<li>
<p>The Scheduled Execution interface allows the scheduler to preempt the execution of an FMU&#8217;s model partition.
The <a href="#importer">importer</a> is providing lock/unlock functions to the FMU to secure sections that should not be interrupted (e.g. the exchange of data between two model partitions of the same FMU).</p>
</li>
<li>
<p>The Scheduled Execution interface allows the FMU to send an event to the scheduler while a model partition is executed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A parallel computation of model partitions is not part of the FMI 3.0 API.
An FMU may still internally use parallel computation on multiple cores, but handling this is (currently) not part of the FMI standard.</p>
</div>
<div class="sect2">
<h3 id="concepts-scheduled-execution"><a class="link" href="#concepts-scheduled-execution">5.1. Concepts</a></h3>
<div class="sect3">
<h4 id="_activating_model_partitions"><a class="link" href="#_activating_model_partitions">5.1.1. Activating Model Partitions</a></h4>
<div class="paragraph">
<p>In Scheduled Execution the importer has to ensure that model partitions are scheduled according to their activation time and priorities.
This is realized in <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> by calling <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> triggering their respective Clocks.</p>
</div>
<div class="paragraph">
<p>The FMU may request to schedule another model partition even while currently a model partition is being executed.</p>
</div>
<div class="paragraph">
<p>In case more than one Clock ticks at the same time instant, the scheduler needs a priority to define the activation sequence of the associated model partitions.
This ordering is defined by the <a href="#priority"><code>priority</code></a> attributes of the Clock.
For Scheduled Execution this attribute is mandatory for every Clock.</p>
</div>
<div class="paragraph">
<p><em>[The Clock priorities are local to an FMU.</em>
<em>It is not possible for an FMU exporting tool to know in advance the priorities of other FMUs that will be connected to an FMU in a simulation setup.</em>
<em>It is the responsibility of the importer to derive a computational order for the computation of two or more distinct FMUs based on the local FMU Clock priorities and input-output relationships of connected FMUs.]</em></p>
</div>
<div class="paragraph">
<p><em>[For <a href="#periodic-clock"><code>periodic Clocks</code></a> it is recommended to derive the priorities based on a rate monotonic scheduling scheme (smallest period leads to highest priority, that is, has the smallest priority value.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="preemption-support"><a class="link" href="#preemption-support">5.1.2. Preemption Support</a></h4>
<div class="paragraph">
<p>If a model partition of lower <a href="#priority"><code>priority</code></a> is executed when a model partition of higher priority is activated, the scheduler must ensure that the execution of the latter one is not delayed and causing violations of timing constraints.
<em>[On a real-time simulator a violation of a timing constraint usually results in an overrun exception i.e. a model partition is supposed to be executed when an instance of the same model partition has not yet finished its execution.]</em></p>
</div>
<div class="paragraph">
<p>Preemption support means that the scheduler can immediately interrupt the current execution of a model partition in order to execute a model partition of higher priority.
The computation of the interrupted model partition is proceeded afterwards.
So by regarding priorities and supporting preemption the scheduler can ensure that most critical model partitions are never delayed by less important model parts.
<em>[This is particularly important for real-time simulators as the wall clock time is dictating the time for the next execution.]</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Same <a href="#priority"><code>priority</code></a>: The scheduler does not preempt the execution of a model partition in favor of a model partition of the same priority.
For model partitions with the same priority, the scheduler decides the execution order, e.g. based on configurations in the importer.</p>
</li>
<li>
<p>Different priorities: The scheduler preempts the execution of a model partition of a lower priority as soon as a model partition of higher priority partition needs to be computed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example for scheduling based on priorities and preempting model partitions is given in section <a href="#example-scheduled-execution">Section 5.3</a>.</p>
</div>
<div class="paragraph">
<p>It may be important for the FMU to secure particular sections of its code against being preempted.
Callback functions <a href="#preemption-support"><code>fmi3LockPreemptionCallback</code></a> and <a href="#preemption-support"><code>fmi3UnlockPreemptionCallback</code></a> are provided by the importer when instantiating the FMU via <a href="#fmi3InstantiateScheduledExecution"><code>fmi3InstantiateScheduledExecution</code></a> to allow the FMU to signal entering and exiting such critical code sections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void (*fmi3LockPreemptionCallback)   ();
typedef void (*fmi3UnlockPreemptionCallback) ();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FMU&#8217;s code has to be prepared to correctly handle preemption of</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>,</p>
</li>
<li>
<p><a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a>,</p>
</li>
<li>
<p><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a>,</p>
</li>
<li>
<p><a href="#fmi3GetClock"><code>fmi3GetClock</code></a></p>
</li>
<li>
<p>and <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general this means that the FMU&#8217;s code has to secure access to its global states and variables wherever data inconsistencies due to potential preemptions are anticipated.</p>
</div>
<div class="paragraph">
<p><em>[Note that depending on their implementation, <a href="#preemption-support"><code>fmi3CallbackLockPreemption</code></a> and <a href="#preemption-support"><code>fmi3CallbackUnlockPreemption</code></a> have a non-negligible overhead, as well as a strong impact on the scheduler and therefore their use should be as rare and short as possible.</em>
<em>In general it is recommended to reduce dependencies between different model partitions of one FMU by design.</em>
<em>In particular a unique assignment of the respective variables to model partitions via its associated <a href="#Clock">Clock</a> is strongly recommended.</em></p>
</div>
<div class="paragraph">
<p><em>One may also consider if the code can be preempted by other parts of the same FMU:</em>
<em>E.g. a model partition cannot be interrupted if it is the only model partition or if it holds the highest priority.</em>
<em>Similarly, a model partition, while it might be interrupted, might not need to guard data accesses if it is the only model partition of the FMU, or the one with the highest priority.</em>
<em>In such cases no locks may be necessary.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="state-machine-scheduled-execution"><a class="link" href="#state-machine-scheduled-execution">5.2. State Machine for Scheduled Execution</a></h3>
<div class="paragraph">
<p>The state machine in <a href="#figure-scheduled-execution-state-machine">Figure 52</a> defines the allowed calling sequences for FMI for Scheduled Execution.</p>
</div>
<div id="figure-scheduled-execution-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/state-machine-scheduled-execution.svg" alt="state machine scheduled execution" width="80%">
</div>
<div class="title">Figure 52. Calling sequence of Scheduled Execution C functions.</div>
</div>
<div class="paragraph">
<p>Common states are defined in <a href="#common-state-machine">Section 2.3</a>, such as super states <a href="#FMUStateSettable"><strong>FMU State Settable</strong></a> and  <a href="#Initialized"><strong>Initialized</strong></a>, states <a href="#Instantiated"><strong>Instantiated</strong></a>, <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a>, <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>, <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, and <a href="#Terminated"><strong>Terminated</strong></a>.</p>
</div>
<div class="paragraph">
<p>State changes are global to all model partitions, except to and from <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a>.
E.g. if any function call returns <a href="#fmi3Discard"><code>fmi3Discard</code></a> or <a href="#fmi3Error"><code>fmi3Error</code></a>, all active or preempted model partitions are in the same state.
In Scheduled Execution, <a href="#fmi3Discard"><code>fmi3Discard</code></a> must be treated like <a href="#fmi3Error"><code>fmi3Error</code></a>.</p>
</div>
<div class="paragraph">
<p>If the simulation algorithm intends to enter the state <a href="#Terminated"><strong>Terminated</strong></a>, it must ensure that all function calls related to model partitions of the FMU have returned.
If in states <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a>, <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a>, or <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a> a function returns <a href="#fmi3Fatal"><code>fmi3Fatal</code></a>, the importer may prematurely end all computations of model partitions of this FMU.
If in these states a function returns <a href="#fmi3Discard"><code>fmi3Discard</code></a> or <a href="#fmi3Error"><code>fmi3Error</code></a> the importer may wait until all other model partitions of this FMU have ended, but new model partitions must not be started and all other function calls for this FMU must return <a href="#fmi3Error"><code>fmi3Error</code></a> until the state <a href="#Terminated"><strong>Terminated</strong></a> is reached.</p>
</div>
<div class="sect3">
<h4 id="ClockActivationMode"><a class="link" href="#ClockActivationMode">5.2.1. State: Clock Activation Mode</a></h4>
<div class="paragraph">
<p>In <a href="#ClockActivationMode"><strong>Clock Activation Mode</strong></a> the scheduler of the importer activates model partitions according to their respective Clock and priority definitions.</p>
</div>
<div class="paragraph">
<p>An FMU of type Schedule Execution exposes its provided <a href="#model-partition">model partitions</a> by defining associated Clocks in its <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
The scheduler must activate the model partitions by calling <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> (as well as related <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> and <code>fmi3Set{VariableType}</code>) for each associated <a href="#Clock">Clock</a>, according to its properties, e.g. <a href="#intervalDecimal"><code>intervalDecimal</code></a> and <a href="#priority"><code>priority</code></a>.
By scheduling the exposed <a href="#model-partition">model partitions</a> of an FMU and executing them at dedicated points in time it is the scheduler that defines how time progresses, see <a href="#advancing-time">Section 2.2.6</a>.
The current time \(t_i\) is communicated to the FMU as <a href="#activationTime"><code>activationTime</code></a> argument of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.
<a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> must only be called once for the same Clock and time.</p>
</div>
<div class="paragraph">
<p>During the computation of a model partition of an <a href="#inputClock">input Clock</a>, the FMU may inform the importer that an <a href="#outputClock"><code>output Clock</code></a> ticked or a <a href="#countdown-aperiodic-clock">countdown Clock</a> is about to tick by changing to <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a> calling <a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a>.
The importer may then activate potential sinks (e.g. a model partition of another FMU) connected to this <a href="#outputClock"><code>output Clock</code></a> or must activate the model partition of the respective <a href="#countdown-aperiodic-clock">countdown Clock</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="#each-state-description">Equations and Actions</a></th>
<th class="tableblock halign-left valign-top">Functions Influencing Equations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{\mathit{variability = tunable}}\) .</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set discrete-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{d}(t)\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get values of variables \(\mathbf{v}(t)\).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When an input Clock \(k_i\) ticks, activate the corresponding model partition:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\((\mathbf{y}_{d,k_i}, \mathbf{x}_{d,k_i}, \mathbf{w}_{d,k_i}) := \mathbf{f}_{\mathit{activate}}({}^{\bullet}\mathbf{x}_{d}, \mathbf{w}_d, \mathbf{u}_{d}, \mathbf{p},k_i)\)<br></p>
</li>
<li>
<p>Update previous values of discrete states of the corresponding model partition: \({}^\bullet\mathbf{x}_{d,k_i} := \mathbf{x}_{d,k_i}\).</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a></p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Set{VariableTypeExclClock}</code></a></dt>
<dd>
<p>sets the values of variables with:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, or</p>
</li>
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This function can be called before scheduling a model partition for variables with the above properties and assigned to that model partition via its associated <a href="#Clock">Clock</a> and variables with the above properties and not associated with any <a href="#Clock">Clock</a>.</p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#get-and-set-variable-values"><code>fmi3Get{VariableTypeExclClock}</code></a></dt>
<dd>
<p>These functions can be called after the computation of a model partition for variables assigned to that model partition via its associated <a href="#Clock">Clock</a> and all variables not associated with any <a href="#Clock">Clock</a>.</p>
<div class="paragraph">
<p>Because of real-time constraints, the computational effort has to be predictable for all operations in Scheduled Execution.
Therefore, all computationally expensive operations to compute a model partition have to be contained within the <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function.
The importer can assume that <a href="#get-and-set-variable-values"><code>fmi3Get{VariableTypeExclClock}</code></a> and <a href="#get-and-set-variable-values"><code>fmi3Set{VariableTypeExclClock}</code></a> operations are not computationally expensive, compared to <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.</p>
</div>
<div class="paragraph">
<p>It is not allowed to call <a href="#get-and-set-variable-values"><code>fmi3Get{VariableTypeExclClock}</code></a> functions after <a href="#get-and-set-variable-values"><code>fmi3Set{VariableTypeExclClock}</code></a> functions without an <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call in between.</p>
</div>
<div class="paragraph">
<p><em>[It is recommended, to call <a href="#get-and-set-variable-values"><code>fmi3Set{VariableTypeExclClock}</code></a>, <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> and <a href="#get-and-set-variable-values"><code>fmi3Get{VariableTypeExclClock}</code></a> in a sequence.</em><br>
<em>The reason is to avoid different interpretations of the caching, since contrary to <a href="#fmi-for-model-exchange"><code>FMI for Model Exchange</code></a>, <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> will perform the actual calculation instead of <a href="#get-and-set-variable-values"><code>fmi3Get{VariableTypeExclClock}</code></a>, and therefore, algebraic loops at communication points cannot be handled by an appropriate sequence of <a href="#get-and-set-variable-values"><code>fmi3Get{VariableTypeExclClock}</code></a> and <a href="#get-and-set-variable-values"><code>fmi3Set{VariableTypeExclClock}</code></a> calls as for Model Exchange.</em><br>
<em>To avoid data inconsistencies and safeguard predictable behavior with <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a>, <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> a unique assignment of the respective variables to model partitions via its associated <a href="#Clock">Clock</a> is strongly recommended.]</em></p>
</div>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p>
</dd>
<dt class="hdlist1">Function <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a></dt>
<dd>
<p>See <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a>.</p>
</dd>
</dl>
</div>
<div id="fmi3ActivateModelPartition" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3ActivateModelPartition</code></dt>
<dd>
<p>Each <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call relates to one <a href="#inputClock"><code>input Clock</code></a> which triggers the computation of its associated model partition.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3ActivateModelPartitionTYPE(fmi3Instance instance,
                                                  fmi3ValueReference clockReference,
                                                  fmi3Float64 activationTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function has the following arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="clockReference"></a> <code>clockReference</code>: <a href="#valueReference"><code>valueReference</code></a> of the <a href="#inputClock"><code>input Clock</code></a> associated with the model partition which shall be activated.</p>
</li>
<li>
<p><a id="activationTime"></a> <code>activationTime</code>: value of the <a href="#independent"><code>independent</code></a> variable of the assigned <a href="#Clock">Clock</a> tick time \(t_i\) <em>[typically: simulation (i.e. virtual) time]</em> (which is known to the simulation algorithm).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function must not be called on <a href="#outputClock">output Clocks</a> of an FMU.<br>
<em>[Note, that other than <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> for Co-Simulation, <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> will compute the variables of the model partition for the current <code>activationTime</code>.]</em><br>
Consecutive calls to <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> for a <a href="#clockReference"><code>clockReference</code></a> must have strictly monotonically increasing <a href="#activationTime"><code>activationTime</code></a>.</p>
</div>
</dd>
<dt class="hdlist1">Functions <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> and <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a></dt>
<dd>
<p>These function calls are allowed for <a href="#tunable-clock"><code>tunable</code></a> and <a href="#changing-aperiodic-clock"><code>changing</code></a> aperiodic Clocks.</p>
</dd>
</dl>
</div>
<div id="fmi3ClockUpdateCallback" class="dlist">
<dl>
<dt class="hdlist1">Function <code>fmi3ClockUpdateCallback</code></dt>
<dd>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void (*fmi3ClockUpdateCallback) (
    fmi3InstanceEnvironment  instanceEnvironment);</code></pre>
</div>
</div>
<div id="activateClockReferences" class="paragraph">
<p><a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a> switches the FMU itself into the <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a>.
The callback may be called from several <a href="#model-partition">model partitions</a>.</p>
</div>
</dd>
<dt class="hdlist1">Functions <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>, <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a>, <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a>, <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a>, <a href="#fmi3DeserializeFMUState"><code>fmi3DeserializeFMUState</code></a></dt>
<dd>
<p>These functions must not be called if any model partition is currently active or preempted.
<em>[This is because these functions apply to the whole FMU and not only to a specific model partition.]</em></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ClockUpdateMode"><a class="link" href="#ClockUpdateMode">5.2.2. State: Clock Update Mode</a></h4>
<div class="paragraph">
<p>A model partition of a Scheduled Execution FMU calls <a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a> to signal that a <a href="#triggered"><code>triggered output</code></a> <a href="#Clock">Clock</a> ticked or a new interval for a <a href="#countdown-aperiodic-clock"><code>countdown</code></a> <a href="#Clock">Clock</a> is available.</p>
</div>
<div class="paragraph">
<p>This means that <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> must be called for gathering all <a href="#Clock">Clock</a> related information about ticking <a href="#outputClock">output Clocks</a> and <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> must be called for all <a href="#countdown-aperiodic-clock"><code>countdown</code></a> <a href="#Clock">Clocks</a> whose associated model partitions must be scheduled if a new interval is provided.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Functions</dt>
<dt class="hdlist1">Function <a href="#fmi3GetClock"><code>fmi3GetClock</code></a></dt>
<dd>
<p>The importer calls <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> to determine which <a href="#triggered">triggered output clock</a> is active.<br>
For an <a href="#outputClock"><code>output Clock</code></a> only the first call of <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> for a specific activation of this <a href="#Clock">Clock</a> signals <code>fmi3ClockActive</code>.
The FMU sets the reported activation state immediately back to <code>fmi3ClockInactive</code> for following <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> calls for that <a href="#Clock">Clock</a> until this <a href="#outputClock"><code>output Clock</code></a> is activated again.</p>
</dd>
<dt class="hdlist1">Functions <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> &amp; <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a></dt>
<dd>
<p>These function calls are allowed for <a href="#countdown-aperiodic-clock"><code>countdown</code></a> Clocks.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>[In Scheduled Execution it cannot be determined which model partition has called <a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a>, because multiple model partitions can be active at the same time.</em>
<em>Since all information about which model partition to activate is coded into its corresponding Clock, there is no need to know which potentially other model partition activated this Clock.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-scheduled-execution"><a class="link" href="#example-scheduled-execution">5.3. Code Example</a></h3>
<div class="paragraph">
<p>The FMU <code>ThreeInputClocks</code> sketches the usage of the Scheduled Execution.
The example consists of one FMU with three model partitions.
Two model partitions are associated with two <a href="#periodic-clock">periodic Clocks</a> <code>10msClock</code> and <code>50msClock</code> (periods 10 ms and 50 ms) and one is associated with an aperiodic <a href="#countdown-aperiodic-clock">countdown clock</a> <code>AperiodicClock</code>.</p>
</div>
<div class="paragraph">
<p>During the execution of the model partition of <a href="#Clock">Clock</a> <code>10msClock</code>, the FMU changes the <code>interval</code> for <a href="#countdown-aperiodic-clock">countdown clock</a> <code>AperiodicClock</code> and calls <a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a> to inform the importer that the interval has changed.
The importer retrieves this interval and activates the corresponding model partition.</p>
</div>
<div class="paragraph">
<p>In this example, the calls to <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> (as well as related <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> and <code>fmi3Set{VariableType}</code>) for each associated Clock are placed into a task.
A task can be thought of as a simple interface of the scheduler that allows to connect the FMU interface by implementing a void/void function and set up the priorities of the tasks as derived from the respective <a href="#Clock">Clock</a> configurations of the FMU.</p>
</div>
<div class="paragraph">
<p>As a result of the FMU&#8217;s configuration and implementation the following can be observed:
The task of <a href="#countdown-aperiodic-clock">countdown clock</a> <code>AperiodicClock</code> is waiting for the task of <a href="#Clock">Clock</a> <code>10msClock</code> to finish.
Likewise the task of <code>AperiodicClock</code> is suspended when the task of higher priority is scheduled again.
The example also depicts how a task associated with an even lower priority <a href="#Clock">Clock</a> (<code>50msClock</code>) is delayed several times by tasks of higher priority.
Note that the point in time when the task was scheduled is the <a href="#activationTime"><code>activationTime</code></a> of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> (&#8230;&#8203;Activate&#8230;&#8203;(<a href="#inputClock"><code>input Clock</code></a>, <a href="#activationTime"><code>activationTime</code></a>)).</p>
</div>
<div id="figure-scs_example" class="imageblock text-center">
<div class="content">
<img src="images/se_example.svg" alt="se example" width="90%">
</div>
<div class="title">Figure 53. Scheduled Execution Example <code>ThreeInputClocks</code></div>
</div>
<div class="sect3">
<h4 id="_simulation_algorithm_implementation"><a class="link" href="#_simulation_algorithm_implementation">5.3.1. Simulation Algorithm Implementation</a></h4>
<div class="paragraph">
<p>Depending on the particular configuration the simulation algorithm uses the interface of a scheduler to set up tasks for every <a href="#inputClock"><code>input Clock</code></a>.
Periodic tasks can be scheduled on initialization of the simulation application.
Aperiodic tasks are scheduled explicitly during the execution.
When executed, each task calls <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> (as well as related <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> and <code>fmi3Set{VariableType}</code>) for each associated Clock.
The <a href="#activationTime"><code>activationTime</code></a> is provided by the simulation algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">void ExecuteModelPartition10ms() {
    fmi3SetFloat64(fmu, AInputReferences, 2, AInput, 2);
    fmi3ActivateModelPartition(fmu, ClockReference10ms, ActivationTime);
    fmi3GetFloat64(fmu, AOutputReferences, 1, AOutput, 1);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FMU requests to schedule the model partition of <code>AperiodicClock</code>.
It calls <a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a> to enable the importer to check whether the FMU has defined a new interval for <code>AperiodicClock</code>.
By evaluating the returned values <a href="#qualifiers"><code>qualifiers</code></a> and <a href="#intervals"><code>intervals</code></a> of <a href="#fmi3GetInterval"><code>fmi3GetInterval</code></a> the simulation algorithms determines if the respective task has to be scheduled and which delay has to be applied.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">void CallbackClockUpdate(fmi3InstanceEnvironment instanceEnvironment) {
    fmi3Float64 interval[] = { 0.0 };
    fmi3IntervalQualifier intervalQualifier[] = { fmi3IntervalNotYetKnown };

    // ask FMU if countdown clock AperiodicClock is about to tick
    const fmi3ValueReference aperiodicClockReferences[] = { 6 };
    fmi3GetIntervalDecimal(fmu, aperiodicClockReferences, 1, interval, intervalQualifier);
    if (intervalQualifier[0] == fmi3IntervalChanged) {
        // schedule task for AperiodicClock with a delay
        ScheduleAperiodicTask(interval[0]);
    }
    // ask FMU if OutputClock has ticked
    fmi3ValueReference outputClockReferences[] = { 7 };
    fmi3Boolean clockActivationStates[] = { fmi3ClockInactive };
    fmi3GetClock(fmu, outputClockReferences, 1, clockActivationStates);
    if (clockActivationStates[0]) {
        // schedule some external task
        ScheduleExternalTask();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fmu_implementation"><a class="link" href="#_fmu_implementation">5.3.2. FMU Implementation</a></h4>
<div class="paragraph">
<p>The FMU implements <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> regarding every <a href="#inputClock"><code>input Clock</code></a> so the code might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi3Status fmi3ActivateModelPartition(fmi3Instance instance,
                                      fmi3ValueReference clockReference,
                                      fmi3Float64 activationTime) {
    switch (clockReference) {
    case 5:    // Input clock 10msClock
        activateModelPartition10ms(instance, activationTime);
        break;
    case 6:    // Input clock AperiodicClock
        activateModelPartitionAperiodic(instance, activationTime);
        break;
    case 8:    // Input clock 50msClock
        activateModelPartition50ms(instance, activationTime);
        break;
    // ...
    }
    return fmi3OK;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the task being executed every 10 ms, the FMU initiates the scheduling of a task by setting a new interval to <a href="#countdown-aperiodic-clock">countdown Clock</a> <code>AperiodicClock</code> and evoking <a href="#fmi3ClockUpdateCallback"><code>fmi3ClockUpdateCallback</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">void activateModelPartition10ms(fmi3Instance instance, fmi3Float64 activationTime) {
    ModelInstance * inst = (ModelInstance *) instance;

    fmi3Boolean conditionForCountdownClockMet = (inst-&gt;AIn1 &gt; inst-&gt;AIn2);
    if (conditionForCountdownClockMet) {
        inst-&gt;CountdownClockQualifier = fmi3IntervalChanged;
        inst-&gt;CountdownClockInterval = 0.0;
        // inform the simulation algorithm that countdown clock AperiodicClock is about to tick
        inst-&gt;callbackClockUpdate(inst-&gt;instanceEnvironment);
    }

    fmi3Boolean conditionForOutputClockMet = (inst-&gt;AIn2 &gt; 42.0);
    if (conditionForOutputClockMet) {
        // OutputClock ticks
        inst-&gt;OutputClockTicked = fmi3ClockActive;
        // inform the simulation algorithm that OutputClock has ticked
        inst-&gt;callbackClockUpdate(inst-&gt;instanceEnvironment);
    }
    inst-&gt;AOut = inst-&gt;AIn1 + inst-&gt;AIn2;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> the Clock&#8217;s interval qualifier is reset to <a href="#fmi3IntervalUnchanged"><code>fmi3IntervalUnchanged</code></a>.
To ensure consistency the FMU may need to prevent preemption.
In this example it is actually not needed since CallbackClockUpdate is only called from one model partition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi3Status fmi3GetIntervalDecimal(fmi3Instance instance,
                                  const fmi3ValueReference valueReferences[],
                                  size_t nValueReferences,
                                  fmi3Float64 interval[],
                                  fmi3IntervalQualifier qualifier[]) {
    ModelInstance * inst = (ModelInstance *) instance;

    for (int i = 0; i &lt; nValueReferences; i++) {
        switch (valueReferences[i]) {
        case 5:    // Input clock 10msClock
            interval[i] = 0.01;
            qualifier[i] = fmi3IntervalUnchanged;
            break;
        case 6:    // Input clock AperiodicClock
            env-&gt;lockPreemption(); // Optional: Preventing preemption is actually not needed here.
            interval[i] = inst-&gt;CountdownClockInterval;
            qualifier[i] = inst-&gt;CountdownClockQualifier;
            if (inst-&gt;CountdownClockQualifier == fmi3IntervalChanged) {
                inst-&gt;CountdownClockQualifier = fmi3IntervalUnchanged;
            }
            env-&gt;unlockPreemption();
            break;
        case 8:    // Input clock 50msClock
            interval[i] = 0.05;
            qualifier[i] = fmi3IntervalUnchanged;
        // ...
        }
    }
    return fmi3OK;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the aperiodic model partition the interval qualifier is reset to <a href="#fmi3IntervalNotYetKnown"><code>fmi3IntervalNotYetKnown</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">void activateModelPartitionAperiodic(fmi3Instance instance, fmi3Float64 activationTime) {
    ModelInstance* inst = (ModelInstance*)instance;
    inst-&gt;CountdownClockQualifier = fmi3IntervalNotYetKnown;
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> is called for a certain <a href="#outputClock"><code>output Clock</code></a> the <a href="#outputClock"><code>output Clock</code></a> is reset.
As for <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> it may be necessary for the FMU to ensure that the code is not preempted.
Here it is just as well not needed for the same reason.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi3Status fmi3GetClock(fmi3Instance instance,
                        const fmi3ValueReference valueReferences[],
                        size_t nValueReferences,
                        fmi3Clock values[]) {
    ModelInstance * inst = (ModelInstance *) instance;

    for (int i = 0; i &lt; nValueReferences; i++) {
        switch (valueReferences[i]) {
        case 7:    // OutputClock
            env-&gt;lockPreemption(); // Optional: Preventing preemption is actually not needed here.
            values[i] = inst-&gt;OutputClockTicked;
            inst-&gt;OutputClockTicked = fmi3ClockInactive;
            env-&gt;unlockPreemption();
            break;
        // ...
        }
    }
    return fmi3OK;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scheduled-execution-schema"><a class="link" href="#scheduled-execution-schema">5.4. Description Schema</a></h3>
<div class="paragraph">
<p>XML elements and attributes common to all interface types are defined in <a href="#modelDescription.xml">FMI Description Schema</a>.
Additional elements and attributes are defined subsequently.
If the FMU implements the Scheduled Execution interface type, the element <code>&lt;ScheduledExecution&gt;</code> must be present.
It is defined as:</p>
</div>
<div id="figure-schema-ScheduledExecution" class="imageblock text-center">
<div class="content">
<img src="images/schema/ScheduledExecution.png" alt="ScheduledExecution" width="80%">
</div>
<div class="title">Figure 54. ScheduledExecution element.</div>
</div>
<div class="paragraph">
<p>The element <code>&lt;ScheduledExecution&gt;</code> does not have any attributes other than defined as <a href="#common-capability-flags">common attributes</a>.</p>
</div>
<div class="sect3">
<h4 id="_example_model_description_file_2"><a class="link" href="#_example_model_description_file_2">5.4.1. Example Model Description File</a></h4>
<div class="paragraph">
<p>The simulation algorithm collects the information about the number and properties of <a href="#Clock"><code>Clocks</code></a> supported by the FMU via analyzing the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
For every <a href="#inputClock"><code>input Clock</code></a> the simulation algorithm identifies a model partition of the FMU.
The properties <a href="#intervalDecimal"><code>intervalDecimal</code></a> (or <a href="#intervalCounter"><code>intervalCounter</code></a>) and <a href="#priority"><code>priority</code></a> are defined based on the <a href="#inputClock">input clocks'</a> <a href="#intervalDecimal"><code>intervalDecimal</code></a> (or <a href="#intervalCounter"><code>intervalCounter</code></a>) and <a href="#priority"><code>priority</code></a> defined in the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.
The simulation algorithm can read from the <a href="#modelDescription.xml"><code>modelDescription.xml</code></a> that <a href="#outputClock"><code>output Clock</code></a> <code>OutClock</code> may tick triggered by <a href="#inputClock"><code>input Clock</code></a> <code>10msClock</code> and that <a href="#inputClock"><code>input Clock</code></a> <code>AperiodicClock</code> is triggered by <code>OutClock</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription fmiVersion="3.0" modelName="ThreeInputClocks" instantiationToken="ThreeInputClocks"&gt;
	&lt;ScheduledExecution modelIdentifier="ThreeInputClocks"/&gt;
	&lt;LogCategories&gt;
		&lt;Category name="logStatusError" description="Log error messages"/&gt;
	&lt;/LogCategories&gt;
	&lt;DefaultExperiment startTime="0" stopTime="6" stepSize="0.001"/&gt;
	&lt;ModelVariables&gt;
		&lt;!-- Variables related to input clock 10msClock  --&gt;
		&lt;Float64 name="AIn1" valueReference="0" causality="input" variability="discrete" clocks="5"
		start="0"/&gt;
		&lt;Float64 name="AIn2" valueReference="1" causality="input" variability="discrete" clocks="5"
		start="0"/&gt;
		&lt;Float64 name="AOut" valueReference="2" causality="output" variability="discrete" clocks="5"/&gt;

		&lt;!-- Variables related to input clock AperiodicClock  --&gt;
		&lt;Float64 name="BIn"  valueReference="3" causality="input" variability="discrete" clocks="6"
		start="0"/&gt;
		&lt;Float64 name="BOut" valueReference="4" causality="output" variability="discrete" clocks="6"/&gt;

		&lt;!-- Clock variables --&gt;
		&lt;!-- Periodic input clock --&gt;
		&lt;Clock name="10msClock" valueReference="5" causality="input" intervalVariability="constant"
		priority="1" intervalDecimal="0.01"/&gt;
		&lt;!-- Input clock that is triggered by 10msClock --&gt;
		&lt;Clock name="AperiodicClock" valueReference="6" causality="input" intervalVariability="countdown"
		priority="2" clocks="5"/&gt;
		&lt;!-- Output clock --&gt;
		&lt;Clock name="OutputClock" valueReference="7" causality="output" intervalVariability="triggered"
		clocks="5"/&gt;
		&lt;!-- Periodic input clock --&gt;
		&lt;Clock name="50msClock" valueReference="8" causality="input" intervalVariability="constant"
		priority="3" intervalDecimal="0.05"/&gt;
	&lt;/ModelVariables&gt;
	&lt;ModelStructure&gt;
		&lt;Output valueReference="2" dependencies="0 1 5"/&gt;
		&lt;Output valueReference="4" dependencies="3 6"/&gt;
		&lt;Output valueReference="7" dependencies="5"/&gt;
	&lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="link" href="#_references">References</a></h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="ABL12"></a>[ABL12] &#197;kesson J., Braun W., Lindholm P., and Bachmann B. (2012): <strong>Generation of Sparse Jacobians for the Functional Mockup Interface 2.0</strong>. 9th International Modelica Conference, Munich, 2012. <a href="https://ep.liu.se/ecp/076/018/ecp12076018.pdf" class="bare">https://ep.liu.se/ecp/076/018/ecp12076018.pdf</a></p>
</li>
<li>
<p><a id="BPRS15"></a>[BPRS15] Atilim Gunes Baydin, Barak A. Pearlmutter, Alexey Andreyevich Radul, Jeffrey Mark Siskind (2015): <strong>Automatic differentiation in machine learning: a survey</strong>. <a href="https://www.jmlr.org/papers/volume18/17-468/17-468.pdf" class="bare">https://www.jmlr.org/papers/volume18/17-468/17-468.pdf</a></p>
</li>
<li>
<p><a id="BCP10"></a>[BCP10] Benveniste A., Caillaud B., Pouzet M. (2010): <strong>The Fundamentals of Hybrid Systems Modelers</strong>. In 49th IEEE International Conference on Decision and Control (CDC), Atlanta, Georgia, USA, December 15-17. <a href="https://www.di.ens.fr/~pouzet/bib/cdc10.pdf" class="bare">https://www.di.ens.fr/~pouzet/bib/cdc10.pdf</a></p>
</li>
<li>
<p><a id="BOA11"></a>[BOA11] Blochwitz T., Otter M., Arnold M., Bausch C., Clau&#223; C., Elmqvist H., Junghanns A., Mauss J., Monteiro M., Neidhold T., Neumerkel D., Olsson H., Peetz J.-V., Wolf S. (2011): <strong>The Functional Mockup Interface for Tool independent Exchange of Simulation Models</strong>. 8th International Modelica Conference, Dresden 2011. <a href="https://ep.liu.se/ecp/063/013/ecp11063013.pdf" class="bare">https://ep.liu.se/ecp/063/013/ecp11063013.pdf</a></p>
</li>
<li>
<p><a id="BKF17"></a>[BKF17] Braun W., Kulshreshtha K., Franke R., Walther A., Bachmann B., Towards Adjoint and Directional Derivatives in FMI utilizing ADOL-C within OpenModelica, 12th International Modelica Conference, Prague, 2017. <a href="https://2017.international.conference.modelica.org/proceedings/html/submissions/ecp17132363_BraunKulshreshthaFrankeBachmannWalther.pdf" class="bare">https://2017.international.conference.modelica.org/proceedings/html/submissions/ecp17132363_BraunKulshreshthaFrankeBachmannWalther.pdf</a></p>
</li>
<li>
<p><a id="BOA12"></a>[BOA12] Blochwitz T., Otter M., &#197;kesson J., Arnold M., Clau&#223; C., Elmqvist H., Friedrich M., Junghanns A., Mauss J., Neumerkel D., Olsson H., Viel A. (2012): <strong>Functional Mockup Interface 2.0: The Standard for Tool independent Exchange of Simulation Models</strong>. 9th International Modelica Conference, Munich, 2012. <a href="https://ep.liu.se/ecp/076/017/ecp12076017.pdf" class="bare">https://ep.liu.se/ecp/076/017/ecp12076017.pdf</a></p>
</li>
<li>
<p><a id="KS00"></a>[KS00] K&#252;bler R., Schiehlen W. (2000): <strong>Two methods of simulator coupling</strong>. Mathematical and Computer Modeling of Dynamical Systems 6 pp. 93-113.</p>
</li>
<li>
<p><a id="LZ07"></a>[LZ07] Lee E.A., Zheng H. (2007): <strong>Leveraging Synchronous Language Principles for Heterogeneous Modeling and Design of Embedded Systems</strong>. EMSOFT'07, September 30-October 3, Salzburg, Austria. <a href="https://ptolemy.berkeley.edu/publications/papers/07/unifying/LeeZheng_SRUnifying.pdf" class="bare">https://ptolemy.berkeley.edu/publications/papers/07/unifying/LeeZheng_SRUnifying.pdf</a></p>
</li>
<li>
<p><a id="MS93"></a>[MS93] Mattsson S. E. and S&ouml;derlind G.: <strong>Index Reduction in Differential Algebraic Equations Using Dummy Derivatives</strong>. SIAM Journal on Scientific Computing, Vol. 14, No. 3,  pp. 677692, 1993.</p>
</li>
<li>
<p><a id="MLS12"></a>[MLS12] Modelica (2012): <strong>Modelica, A Unified Object-Oriented Language for Systems Modeling</strong>. Language Specification, Version 3.3, May 9, 2012. <a href="https://www.modelica.org/documents/ModelicaSpec33.pdf" class="bare">https://www.modelica.org/documents/ModelicaSpec33.pdf</a></p>
</li>
<li>
<p><a id="PZ06"></a>[PZ06] Pouzet M. (2006): <strong>Lucid Synchrone</strong>. Version 3.0, Tutorial and Reference Manual. <a href="https://www.di.ens.fr/~pouzet/lucid-synchrone/" class="bare">https://www.di.ens.fr/~pouzet/lucid-synchrone/</a></p>
</li>
<li>
<p><a id="CGM84"></a>[CGM84] Coleman, Garbow, Mor&#233; (1984): <strong>Software for estimating sparse Jacobian matrices, ACM Transactions on Mathematical Software</strong>. TOMS , vol. 10, no. 3, pp. 346-347</p>
</li>
<li>
<p><a id="PW13"></a>[PW13] Preston-Werner, T. (2013): <strong>Semantic Versioning 2.0.0</strong>.  <a href="https://semver.org/spec/v2.0.0.html" class="bare">https://semver.org/spec/v2.0.0.html</a></p>
</li>
<li>
<p><a id="FBH18"></a>[FBH18] Fritzson D., Braun R. and Hartford J. (2018): <strong>Composite modelling in 3-D mechanics utilizing Transmission Line Modelling (TLM) and Functional Mock-up Interface (FMI)</strong>. Modeling, Identification and Control, vol. 39, no. 3, pp. 179-190.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="glossary"><a class="link" href="#glossary">Appendix A: Glossary</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Term</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>argument</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refers to a function parameter.
Not to be confused with <em>parameter</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>capability flag</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capability flags are used to indicate to the importer what optional functionality the FMU supports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>clock</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable to report events or trigger events or model partitions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>clock tick</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the <a href="#Clock">Clock</a> ticks an event is present, otherwise the event is absent.
A <a href="#Clock">Clock</a> tick causes a <a href="#Clock">Clock</a> activation at that time instant, except for input <a href="#Clock">Clock</a> ticks in Scheduled Execution, which cause an activation of the associated model partition instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>communication points</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time grid for data exchange between importer and FMU(s) in a (co-)simulation environment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>communication step size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance between two subsequent <em>communication points</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>continuous-time instant</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#time-instant">time instant</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>co-simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coupling of several <em>simulation programs</em> in order to compute the global behavior of a system that consists of several subsystems.
The subsystems are coupled in the sense that the behavior of each subsystem depends on the behavior of the remaining subsystems, so that the co-simulation must be computed in a step-by-step fashion.
Each simulation program is responsible for computing the behavior of a subsystem, using the outputs produced by the other simulation programs.
Synonyms: dynamic mutual-exchange, simulator coupling, and coupled simulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>direct feedthrough</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct feedthrough describes that values of output variables depend directly on values of input variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>domain change</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used instead of zero-crossing.
Indicates the change of an event indicator from the domain \(\mathbf{z}_j &gt; 0\) to the domain \(\mathbf{z}_j \leq 0\) or from \(\mathbf{z}_j \leq 0\) to \(\mathbf{z}_j &gt; 0\).
See <a href="#localizationStateEvents">Section 3.1.1</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="dynamic-state-selection"></a><em>dynamic state selection</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic State Selection is a method to solve differential algebraic equations (DAEs).
The FMU checks whether the dynamically selected states are still numerically appropriate.
If not, a new mapping between states and variables is computed.
For details see <a href="#MS93">[MS93]</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ECU</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Electronic Control Unit (Microprocessor that is used to control a technical system).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="event"></a><em>event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Something that occurs instantaneously at a specific time or when a specific condition occurs.
At an event in Model Exchange, numerical integration is suspended and variables may change their values discontinuously.
In Co-Simulation, an event may interrupt a <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> to introduce an additional communication point.
Internal events occur inside the FMU and should be signaled to the environment without any delay (in CS using <a href="#early-return">early return</a>, in SE using <a href="#ClockUpdateMode"><strong>Clock Update Mode</strong></a>) and can cause event handling and/or the activation of an <a href="#outputClock">output Clock</a> or the scheduling of a <a href="#countdown-aperiodic-clock">countdown Clock</a>.
Input clocks are activated by the environment to inform the FMU about the point in time an event has to be handled by the FMU.
See also <a href="#state-event">state event</a>, <a href="#step-event">step event</a> and <a href="#time-event">time event</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="eventIndicator"></a><em>event indicator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A variable that changes sign exactly at an event.
See <a href="#state-event">event indicator</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="eventIteration"></a><em>event iteration</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An importer can iteratively call <a href="#get-and-set-variable-values"><code>fmi3Set{VariableType}</code></a> and <a href="#get-and-set-variable-values"><code>fmi3Get{VariableType}</code></a> e.g. to solve <em>algebraic loops</em> during an event and during a <em>super-dense time instant</em>.
When reaching a consistent state, changes to discrete variables may be triggered.
Such a discrete (state) change may require another solution of an algebraic loop in the next super-dense time instant.
These discontinuous changes can repeat until the participating FMUs or the master decide that no further iteration is needed.
An example for a system that can be simulated with event iteration is a powertrain with multiple clutches distributed in several FMUs.
The decision which clutch is open, which is closed and which is slipping can be determined with event iteration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>exporter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A program that creates an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>external scheduler</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <em>scheduler</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>feedthrough</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <em>direct feedthrough</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface:<br>
Interface of a functional mock-up in form of a model.
In analogy to the term digital mock-up (see <em>mock-up</em>), functional mock-up describes a computer-based representation of the functional behaviour of a system for all kinds of analyses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI functions</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The function of the FMI C-API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for Co-Simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface for Co-Simulation:<br>
It connects the <em>importer</em> with one or more <em>FMUs</em> using co-simulation algorithms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for Model Exchange</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface for Model Exchange:<br>
FMU type that externalizes the ODE/DAE solver to allow tightly coupling multiple FMUs and avoid co-simulation delays.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for Scheduled Execution</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface for Scheduled Execution:<br>
FMI type that externalizes the scheduler to run <em>model partitions</em>, potentially synchronized between more than one FMU and exchanging input and output variables accordingly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMU</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Unit:<br>
An FMU is one specific ZIP file containing an implementation of the FMI as defined in <a href="#fmu-distribution">Section 2.5</a>.
It may contain multiple FMI types, see <a href="#multipleInterfaceTypes">Section 2.5.2</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMU clock</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#Clock">Clock</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="importer"></a><em>importer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The tool that imports or loads one or more FMUs.
Also called simulation environment, environment, calling environment, (co-)simulation algorithm, target platform, target environment, integrator (in ME).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>independent variable</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All variables are a function of this <a href="#independent"><code>independent</code></a> variable, typically time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="input-event"></a><em>input event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An input event occurs when a discrete input variable changes, a continuous input variable has a discontinuity or a <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a> changes its value.
<em>[Note that if an FMU A is connected to an FMU B, and an event is triggered for A, then potentially all <a href="#output"><code>outputs</code></a> of A will be discontinuous at this time instant.</em>
<em>It is therefore advisable to move B into <a href="#EventMode"><strong>Event Mode</strong></a> at this time instant too if an <a href="#output"><code>output</code></a> of A is connected to B.</em>
<em>This means to call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> on B.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integration algorithm</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The numerical algorithm to solve differential equations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integrator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>software component</em>, which implements an <em>integration algorithm</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General: An abstraction of a <em>software component</em> that describes its behavior without dealing with the internal implementation.
<em>Software components</em> communicate with each other via interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>interface type</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the three FMI variants "Model Exchange", "Co-simulation" or "Scheduled execution"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>machine epsilon</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smallest floating point value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>mock-up</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A full-sized structural, but not necessarily functional model built accurately to scale, used chiefly for study, testing, or display.
In the context of computer aided design (CAD), a digital mock-up (DMU) means a computer-based representation of the product geometry with its parts, usually in 3-D, for all kinds of geometrical and mechanical analyses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A model is a mathematical or logical representation of a system of entities, phenomena, or processes.
Basically a model is a simplified abstract view of the complex reality.<br>
It can be used to compute its expected behavior under specified conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model description file</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The model description file is an XML file named <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>, which supplies a description of all properties of a <em>model</em> (for example, <a href="#input"><code>input</code></a> / <a href="#output"><code>output</code></a> variables).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Model Description Schema</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <em>XML</em> schema that defines how all relevant, non-executable, information about a "model class" (<em>FMU)</em> is stored in a text file in <em>XML</em> format.
Most important, data for every variable is defined (variable name, handle, data type, variability, unit, etc.), see <a href="#modelDescription.xml"><code>modelDescription.xml</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="model-partition"></a><em>model partition</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An FMU may consist of several algorithms computing subsets of variables.
A model partition is such an algorithm with <a href="#clocked-variable">variables</a> connected to a Clock.
The execution of a model partition is triggered by the activation of its Clock.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ODE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>Ordinary Differential Equation</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Ordinary Differential Equation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Differential equation containing one or more functions of one independent variable (typically time) and the derivatives of those functions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>output points</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tool internal time grid for saving output data to file (in some tools also known as "<em>communication points</em>" - but this term is used in a different way in FMI for Co-Simulation, see above).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>output step size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance between two subsequent <em>output points</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A quantity within a <em>model</em>, which remains constant during <em>simulation (<a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameter</code></a>) or may change at event instances (<a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a>)</em>.
Examples are a mass, stiffness, etc.
These parameters are different from <a href="#calculatedParameter">calculated parameters</a>, because they can be changed independently (according to their <a href="#variability"><code>variability</code></a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>runtime environment</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See co-simulation environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute the behavior of one or several <em>models</em> under specified conditions.<br>
(see also <em>co-simulation</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation model</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>model</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation program</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software to develop and/or solve simulation <em>models</em>.
The software includes a <em>solver</em>, may include a user interface and methods for post processing (see also: <em>simulation tool</em>, <em>simulation environment</em>).<br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation tool</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>simulation program</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A simulator can include one or more <em>simulation programs</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulator coupling</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <em>tool coupling</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>solver</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Software component,</em> which includes algorithms to solve <em>models</em>, for example, <em>integration algorithms</em> and <em>event handling</em> methods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>state</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The continuous <a href="#state">states</a> of a model are all variables that appear differentiated in the model and are independent from each other.<br>
The discrete-time states of a model are time-discrete variables that have two values in a model: The value of the variable from the previous <em>event</em> instant, and the value of the variable at the actual event instant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>state event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time of <a href="#state-event">state <em>events</em></a> is not known apriori.
<a href="#fmi3GetEventIndicators">Event indicators</a> are used to allow the importer finding the time of these state events precisely.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="step-event"></a><em>step event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that might occur at a completed integrator step signaled by calling <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a>.
Step events are, for example, used to change the mapping of the continuous states to variables (<a href="#dynamic-state-selection">dynamic state selection</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>structural parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A parameter that can be changed in <a href="#ConfigurationMode"><strong>Configuration Mode</strong></a>, i.e. prior to <a href="#InitializationMode"><strong>Initialization Mode</strong></a>, and, if tuneable, also in <a href="#ReconfigurationMode"><strong>Reconfiguration Mode</strong></a>.
Structural parameters can be used to influence the size and/or dimensionality of array variables of an FMU, for example.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="super-dense-time"></a><em>super-dense time</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A precise definition of time taking into account iterations at an event.
For an <em>FMU</em>, the <a href="#independent"><code>independent</code></a> variable time \(t \in \mathbb{T}\) is a tuple \(t = (t_R, t_I)\) where \(t_R \in \mathbb{R}, t_I \in \mathbb{N} = \{0,1,2,\ldots\}\).
The real part \(t_R\) of this tuple is the <a href="#independent"><code>independent</code></a> variable of the FMU for describing the continuous-time behavior of the model between events.
During continuous-time integration \(t_I = 0\).
The integer part \(t_I\) of this tuple is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(t_R\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>super-dense time instant</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#time-instant">time instant</a> and <a href="#super-dense-time">super-dense time</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="time-event"></a><em>time event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that is defined by a predefined time instant.
Since the time instant is known in advance, the integrator can select its step size so that the event point is directly reached.
Therefore, this event can be handled efficiently.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="time-instant"></a><em>time instant</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A moment in time, either a continuous-time instant \(t = t_R\), or a super-dense time instant \(t = (t_R, t_I)\), see also <a href="#super-dense-time">super-dense time</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="tlm"></a><em>TLM</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <a href="#transmission-line-modeling">Transmission Line Modeling</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="transmission-line-modeling"></a><em>Transmission Line Modeling</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A mathematical method which uses physically motivated time delays to decouple an equation system into independent parts during a specified time frame without compromising numerical stability.
Also known as the <em>bi-lateral delay line</em> method. For more details see <a href="#FBH18">[FBH18]</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The part of the simulation program that gives the user control over the simulation and allows watching results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XML</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eXtensible Markup Language (<a href="https://www.w3.org/XML/">www.w3.org/XML</a>, <a href="https://en.wikipedia.org/wiki/Xml">en.wikipedia.org/wiki/XML</a>) - An open standard to store information in text files in a structured form.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="link" href="#_acknowledgements">Appendix B: Acknowledgements</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Until Dec. 2011, this work was carried out within the ITEA2 MODELISAR project (project number: ITEA2-07006, <a href="https://itea3.org/project/modelisar.html" class="bare">https://itea3.org/project/modelisar.html</a>).</p>
</div>
<div class="paragraph">
<p>Daimler AG, DLR, ITI GmbH, Martin Luther University Halle-Wittenberg, QTronic GmbH and SIMPACK AG thank BMBF for partial funding of this work within MODELISAR (BMBF F&#246;rderkennzeichen: 01lS0800x).</p>
</div>
<div class="paragraph">
<p>Dassault Syst&#232;mes (Sweden) thanks the Swedish funding agency VINNOVA (2008-02291) for partial funding of this work within MODELISAR.</p>
</div>
<div class="paragraph">
<p>LMS Imagine and IFPEN thank DGCIS for partial funding of this work within MODELISAR.</p>
</div>
<div class="paragraph">
<p>Since Sept. 2012 until Nov. 2015, this work is partially carried out within the ITEA2 MODRIO project (project number: ITEA 2-11004, <a href="https://itea3.org/project/modrio.html" class="bare">https://itea3.org/project/modrio.html</a>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DLR, ITI GmbH, QTronic GmbH and SIMPACK AG thank BMBF for partial funding of this work within MODRIO (BMBF F&#246;rderkennzeichen: 01IS12022E).</p>
</li>
<li>
<p>Dassault Syst&#232;mes (Sweden), Link&#246;ping University and Modelon AB thank the Swedish funding agency VINNOVA (2012&#8212;&#8203;01157) for partial funding of this work within MODRIO.</p>
</li>
<li>
<p>Siemens PLM Software (France) and IFPEN thank DGCIS for partial funding of this work within MODRIO.</p>
</li>
<li>
<p>Contributions of ESI Group were carried out within the project FMI4BIM, funded by the German Federal Ministry for Economic Affairs and Energy.</p>
</li>
<li>
<p>Dassault Syst&#232;mes (France) and EDF (France) thank BPIFrance and Region Ile de France for partially funding this work within ModeliScale project.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributors"><a class="link" href="#_contributors">Appendix C: Contributors</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Modelica Association Project FMI was headed by Andreas Junghanns (Synopsys) and Torsten Blochwitz (ESI Group).
The FMI 3.0.x standard text is based on FMI 2.0 and FMI 1.0 and we wish to acknowledge their contributors as listed on <a href="https://github.com/modelica/fmi-standard/graphs/contributors">Github</a>.</p>
</div>
<div class="paragraph">
<p>Special thanks to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Andreas Junghanns (Synopsys) and Torsten Sommer (Dassault Syst&#232;mes) for the initial conversion of the FMI 2.0 Word document to AsciiDoc</p>
</li>
<li>
<p>Torsten Sommer (Dassault Syst&#232;mes) for the creation of the Reference FMUs and the Continuous Integration pipeline</p>
</li>
<li>
<p>Cl&#225;udio Gomes (Aarhus University) for the creation of the tooling to create the graphical representation of the XML schemas</p>
</li>
<li>
<p>Andreas Junghanns (Synopsys) and Torsten Blochwitz (ESI Group) for restructuring and re-writing the whole FMI standard text</p>
</li>
<li>
<p>all companies and organizations that participated in the FMI 3.0 Plugfests:</p>
<div class="ulist">
<ul>
<li>
<p>Aarhus University with VDMCheck</p>
</li>
<li>
<p>Altair with Activate</p>
</li>
<li>
<p>Augsburg University with FMI.jl</p>
</li>
<li>
<p>AVL List GmbH with Model.CONNECT&#8482;</p>
</li>
<li>
<p>Dassault Syst&#232;mes with Dymola, FMPy, and FMI Kit for Simulink</p>
</li>
<li>
<p>dSPACE GmbH with TargetLink, SystemDesk, ConfigurationDesk, and VEOS</p>
</li>
<li>
<p>ESI Group with SimulationX</p>
</li>
<li>
<p>ETAS GmbH with COSYM</p>
</li>
<li>
<p>Julia Computing with JuliaSim</p>
</li>
<li>
<p>Maplesoft with MapleSIM</p>
</li>
<li>
<p>OSMC</p>
</li>
<li>
<p>PMSF IT Consulting with FMI Bench</p>
</li>
<li>
<p>Synopsys with Silver</p>
</li>
<li>
<p>TLK-Thermo GmbH</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The essential parts of the design of this version were developed by (alphabetical list)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Christian Bertsch, Robert Bosch GmbH, Germany</p>
</li>
<li>
<p>Matthias Blesken, dSPACE GmbH, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ESI Group, Germany</p>
</li>
<li>
<p>Cl&#225;udio Gomes, Aarhus University, Denmark</p>
</li>
<li>
<p>Andreas Junghanns, Synopsys, Germany</p>
</li>
<li>
<p>Pierre R. Mai, PMSF IT Consulting, Germany</p>
</li>
<li>
<p>Masoud Najafi, Altair, France</p>
</li>
<li>
<p>Andreas Pillekeit, dSPACE GmbH, Germany</p>
</li>
<li>
<p>Klaus Schuch, AVL List GmbH, Austria</p>
</li>
<li>
<p>Christian Schulze, TLK-Thermo GmbH, Germany</p>
</li>
<li>
<p>Torsten Sommer, Dassault Syst&#232;mes, Germany</p>
</li>
<li>
<p>Karl Wernersson, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>Irina Zacharias, dSPACE GmbH, Germany</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally the following partners participated in FMI design meetings and contributed to the discussion (alphabetical list)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nick Battle, United Kingdom</p>
</li>
<li>
<p>Martin Benedikt, Virtual Vehicle, Austria</p>
</li>
<li>
<p>Jorge Bernal-Romero, ITK-Engineering, Germany</p>
</li>
<li>
<p>Thomas Beutlich, previously at ESI Group, Germany</p>
</li>
<li>
<p>Robert Braun, Link&#246;ping University, Sweden</p>
</li>
<li>
<p>Paul Filip, Synopsys, Romania</p>
</li>
<li>
<p>R&#252;diger Franke, ABB AG, Germany</p>
</li>
<li>
<p>Markus Friedrich, Dassault Syst&#232;mes, Germany</p>
</li>
<li>
<p>Thorsten Gehrmann, Fraunhofer IEM, Germany</p>
</li>
<li>
<p>Jan Niklas Jaeschke, TLK-Thermo, Germany</p>
</li>
<li>
<p>Oliver Kotte, Robert Bosch GmbH, Germany</p>
</li>
<li>
<p>Kaska Kowalalska, Maplesoft, Canada</p>
</li>
<li>
<p>Gunter Lantzsch, ESI Group, Germany</p>
</li>
<li>
<p>Timo Penndorf, ETAS GmbH, Germany</p>
</li>
<li>
<p>Tim Schenk, Siemens AG, Germany</p>
</li>
<li>
<p>Patrick T&#228;uber, dSPACE GmbH, Germany</p>
</li>
<li>
<p>Jean-Philipp Tavella, EDF, France</p>
</li>
<li>
<p>Adrian Tirea, Synopsys, Romania</p>
</li>
<li>
<p>Otto Tronarp, Wolfram MathCore, Sweden</p>
</li>
<li>
<p>Antoine Viel, Siemens PLM, France</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>