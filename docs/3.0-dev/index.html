<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<title>Functional Mock-up Interface for Model&#160;Exchange and Co-Simulation</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:30em;padding-right:0}
#toc.toc2{width:30em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

/* customizations */

body{
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
}

.toc-hidden {
  padding-left: 0 !important;
}

.imageblock {
  text-align: center;
}

.imageblock img {
  display: block;
  margin: auto;
}

.imageblock .title {
  display: inline-block;
  margin: auto;
}

.vertical-text {
	transform: rotate(-90deg) translate(-11em, 0);
	transform-origin: left top 0;
  float: left;
  display: inline-block;
  white-space: nowrap;
  width: 1em;
  height: 11em;
}

/* no alternating row colors */
table tr.even,table tr.alt,table tr:nth-of-type(even) {
  background:none
}

/* use parent text color for captions */
.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
  color: inherit;
}

a {
  text-decoration: none;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script>
// hide / show the Table of Contents (TOC)
function toggleTOC() {
  var toc = document.getElementById("toc");
  var body = document.getElementsByTagName("body")[0];

  if (toc.style.display === "none") {
      toc.style.display = "block";
      body.classList.remove("toc-hidden");
  } else {
      toc.style.display = "none";
      body.classList.add("toc-hidden");
  }
}

// toggle the TOC when "t" key is pressed
document.addEventListener('keydown', (event) => {
  if (event.key == 't') {
    toggleTOC();
  }
});
</script>

<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>
<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we neeed -->

<style>
.tocify-header {
    font-style: italic;
}

.tocify-subheader {
    font-style: normal;
    font-size: 90%;
}

.tocify ul {
    margin: 0;
 }

.tocify-focus {
    color: #7a2518;
    background-color: rgba(0, 0, 0, 0.1);
}

.tocify-focus > a {
    color: #7a2518;
}
</style>

<script type="text/javascript">
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            // don't hide the sections in the TOC
            showAndHide: false,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).size() > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5,h6",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>

<img style="display: block; margin: 2em auto; width: 30em;" src="images/FMI_logo_horizontal.svg" alt="FMI logo">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Functional Mock-up Interface for Model&#160;Exchange and Co-Simulation</h1>
<div class="details">
<span id="revnumber">version 3.0,</span>
<span id="revdate">unreleased</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#_properties_and_guiding_ideas">1.1. Properties and Guiding Ideas</a></li>
<li><a href="#_acknowledgements">1.2. Acknowledgements</a></li>
</ul>
</li>
<li><a href="#fmi-common-concepts">2. Common Concepts</a>
<ul class="sectlevel2">
<li><a href="#fmi-application-programming-interface">2.1. FMI Application Programming Interface</a>
<ul class="sectlevel3">
<li><a href="#header-files-and-naming-of-functions">2.1.1. Header Files and Naming of Functions</a></li>
<li><a href="#_platform_dependent_definitions_fmi3platformtypes_h">2.1.2. Platform Dependent Definitions (fmi3PlatformTypes.h)</a></li>
<li><a href="#status-returned-by-functions">2.1.3. Status Returned by Functions</a></li>
<li><a href="#inquire-platform-and-version-number">2.1.4. Inquire Platform and Version Number of Header Files</a></li>
<li><a href="#creation-destruction-and-logging">2.1.5. Creation, Destruction and Logging of FMU Instances</a></li>
<li><a href="#_configuration_initialization_termination_and_resetting_an_fmu">2.1.6. Configuration, Initialization, Termination, and Resetting an FMU</a></li>
<li><a href="#get-and-set-variable-values">2.1.7. Getting and Setting Variable Values</a></li>
<li><a href="#operation-on-clocks">2.1.8. Operation on Clocks</a>
<ul class="sectlevel4">
<li><a href="#clock-types-for-evaluation-of-clocked-model-partitions">2.1.8.1. Clock Types for Evaluation of Clocked Model Partitions</a>
<ul class="sectlevel5">
<li><a href="#_synchronous_clocks">2.1.8.1.1. Synchronous Clocks</a></li>
<li><a href="#_communication_point_clocks">2.1.8.1.2. Communication Point Clocks</a></li>
</ul>
</li>
<li><a href="#variants-of-clocks">2.1.8.2. Variants of Clocks</a>
<ul class="sectlevel5">
<li><a href="#_output_clocks">2.1.8.2.1. Output Clocks</a></li>
<li><a href="#_input_clocks">2.1.8.2.2. Input Clocks</a></li>
</ul>
</li>
<li><a href="#additional-clock-properties">2.1.8.3. Additional Clock Properties</a>
<ul class="sectlevel5">
<li><a href="#_periodic_clock_ticks">2.1.8.3.1. Periodic Clock Ticks</a></li>
<li><a href="#_clock_priority">2.1.8.3.2. Clock Priority</a></li>
<li><a href="#clock-relationships-for-communication-point-clocks">2.1.8.3.3. Clock Relationships for Communication Point Clocks</a></li>
</ul>
</li>
<li><a href="#connecting-clocked-fmus">2.1.8.4. Connecting Clocked FMUs</a></li>
</ul>
</li>
<li><a href="#fmi-api-setting-getting-clock-activation-state">2.1.9. FMI Application Programming Interface for setting/getting Clock activation state</a></li>
<li><a href="#get-set-fmu-state">2.1.10. Getting and Setting the Complete FMU State</a></li>
<li><a href="#_getting_partial_derivatives">2.1.11. Getting Partial Derivatives</a>
<ul class="sectlevel4">
<li><a href="#_directional_derivatives">2.1.11.1. Directional derivatives</a></li>
<li><a href="#_adjoint_derivatives">2.1.11.2. Adjoint derivatives</a></li>
</ul>
</li>
<li><a href="#_getting_number_of_event_indicators">2.1.12. Getting Number of Event Indicators</a></li>
<li><a href="#_getting_number_of_states">2.1.13. Getting Number of States</a></li>
<li><a href="#_getting_number_of_variable_dependencies_and_variable_dependencies">2.1.14. Getting Number of Variable Dependencies and Variable Dependencies</a></li>
</ul>
</li>
<li><a href="#fmi-description-schema">2.2. FMI Description Schema</a>
<ul class="sectlevel3">
<li><a href="#fmiModelDescription">2.2.1. Definition of an FMU (fmiModelDescription)</a></li>
<li><a href="#_definition_of_source_code_buildconfiguration">2.2.2. Definition of Source Code (BuildConfiguration)</a>
<ul class="sectlevel4">
<li><a href="#_sourcefileset">2.2.2.1. SourceFileSet</a>
<ul class="sectlevel5">
<li><a href="#_sourcefile">2.2.2.1.1. SourceFile</a></li>
<li><a href="#_preprocessordefinition">2.2.2.1.2. PreprocessorDefinition</a></li>
<li><a href="#_preprocessordefinitionoption">2.2.2.1.3. PreprocessorDefinition/Option</a></li>
<li><a href="#_includedirectory">2.2.2.1.4. IncludeDirectory</a></li>
<li><a href="#_library">2.2.2.1.5. Library</a></li>
<li><a href="#_examples">2.2.2.1.6. Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_definition_of_units_unitdefinitions">2.2.3. Definition of Units (UnitDefinitions)</a></li>
<li><a href="#definition-of-types">2.2.4. Definition of Types (TypeDefinitions)</a></li>
<li><a href="#definition-of-log-categories">2.2.5. Definition of Log Categories (LogCategories)</a></li>
<li><a href="#DefaultExperiment">2.2.6. Definition of a Default Experiment (DefaultExperiment)</a></li>
<li><a href="#_definition_of_terminals_terminals">2.2.7. Definition of Terminals (Terminals)</a>
<ul class="sectlevel4">
<li><a href="#_rationale">2.2.7.1. Rationale</a></li>
<li><a href="#_terminals">2.2.7.2. Terminals</a></li>
<li><a href="#_terminal_member_variable">2.2.7.3. Terminal Member Variable</a></li>
<li><a href="#_general_remark_on_signal">2.2.7.4. General remark on signal</a></li>
<li><a href="#_general_remark_on_inflow_and_outflow">2.2.7.5. General remark on inflow and outflow</a></li>
<li><a href="#_terminal_stream_member_variable">2.2.7.6. Terminal Stream Member Variable</a></li>
</ul>
</li>
<li><a href="#_definition_of_a_graphical_representation_graphicalrepresentation">2.2.8. Definition of a Graphical Representation (GraphicalRepresentation)</a>
<ul class="sectlevel4">
<li><a href="#_rationale_2">2.2.8.1. Rationale</a></li>
<li><a href="#_coordinatesystem">2.2.8.2. CoordinateSystem</a></li>
<li><a href="#_icon">2.2.8.3. Icon</a></li>
<li><a href="#_terminals_2">2.2.8.4. Terminals</a></li>
<li><a href="#_placement_extent_and_painting_order_of_graphical_items">2.2.8.5. Placement, Extent, and Painting Order of Graphical Items</a></li>
</ul>
</li>
<li><a href="#_definition_of_vendor_annotations_vendorannotations">2.2.9. Definition of Vendor Annotations (VendorAnnotations)</a></li>
<li><a href="#definition-of-model-variables">2.2.10. Definition of Model Variables (ModelVariables)</a></li>
<li><a href="#ModelStructure">2.2.11. Definition of the Model Structure (ModelStructure)</a></li>
<li><a href="#variableNamingConvention">2.2.12. Variable Naming Conventions (variableNamingConvention)</a></li>
</ul>
</li>
<li><a href="#fmu-distribution">2.3. FMU Distribution</a></li>
<li><a href="#common-concepts-cosim">2.4. Common Concepts for Co-Simulation</a>
<ul class="sectlevel3">
<li><a href="#math-intermediate-variable-access">2.4.1. Intermediate Variable Access Support</a></li>
<li><a href="#_overview_of_different_co_simulation_interfaces">2.4.2. Overview of Different Co-Simulation Interfaces</a></li>
<li><a href="#_common_co_simulation_application_programming_interface">2.4.3. Common Co-Simulation Application Programming Interface</a>
<ul class="sectlevel4">
<li><a href="#api-intermediate-variable-access">2.4.3.1. Intermediate Variable Access</a>
<ul class="sectlevel5">
<li><a href="#_pseudo_code_example_for_intermediate_variable_access">2.4.3.1.1. Pseudo-code Example for Intermediate Variable Access</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmi-for-model-exchange">3. FMI for Model Exchange</a>
<ul class="sectlevel2">
<li><a href="#math-model-exchange">3.1. Mathematical description</a>
<ul class="sectlevel3">
<li><a href="#basic-definitions-model-exchange">3.1.1. Basic definitions</a></li>
<li><a href="#computation-modes-model-exchange">3.1.2. Computation Modes</a>
<ul class="sectlevel4">
<li><a href="#_initialization_mode">3.1.2.1. Initialization Mode</a></li>
<li><a href="#_continuous_time_mode">3.1.2.2. Continuous-Time Mode</a></li>
<li><a href="#_event_mode">3.1.2.3. Event Mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_application_programming_interface">3.2. Application Programming Interface</a>
<ul class="sectlevel3">
<li><a href="#providing-independent-variables-and-re-initialization">3.2.1. Providing Independent Variables and Re-initialization of Caching</a></li>
<li><a href="#evaluation-of-model-equations">3.2.2. Evaluation of Model Equations</a></li>
<li><a href="#state-machine-model-exchange">3.2.3. State Machine of Calling Sequence</a></li>
<li><a href="#_code_example">3.2.4. Code Example</a></li>
<li><a href="#_clocks_api">3.2.5. Clocks API</a></li>
<li><a href="#_handling_of_clock_events">3.2.6. Handling of clock events</a></li>
</ul>
</li>
<li><a href="#_fmi_description_schema">3.3. FMI Description Schema</a>
<ul class="sectlevel3">
<li><a href="#ModelExchange">3.3.1. Model Exchange FMU (ModelExchange)</a></li>
<li><a href="#xml-example-model-exchange">3.3.2. Example XML Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmi-for-basic-co-simulation">4. FMI for Basic Co-Simulation</a>
<ul class="sectlevel2">
<li><a href="#math-basic-co-simulation">4.1. Mathematical Description</a>
<ul class="sectlevel3">
<li><a href="#_initialization_mode_2">4.1.1. Initialization Mode</a></li>
<li><a href="#_step_mode">4.1.2. Step Mode</a></li>
<li><a href="#_early_return_from_current_communication_step">4.1.3. Early Return from Current Communication Step</a></li>
</ul>
</li>
<li><a href="#_application_programming_interface_2">4.2. Application Programming Interface</a>
<ul class="sectlevel3">
<li><a href="#transfer-of-input-output-and-parameters">4.2.1. Variables access in fmi3CoSimulation</a></li>
<li><a href="#_computation_in_fmi3cosimulation">4.2.2. Computation in fmi3CoSimulation</a></li>
<li><a href="#retrieving-status-from-slave">4.2.3. Retrieving Status Information from the Slave in fmi3CoSimulation</a></li>
<li><a href="#state-machine-co-simulation">4.2.4. State Machine of Calling Sequence from Master to Slave in fmi3CoSimulation</a>
<ul class="sectlevel4">
<li><a href="#state-slave-setable-fmu-state-co-simulation">4.2.4.1. State: Slave Setable FMU State</a></li>
<li><a href="#state-slave-under-evaluation-co-simulation">4.2.4.2. State: Slave Under Evaluation</a></li>
<li><a href="#state-slave-initialized-co-simulation">4.2.4.3. State: Slave Initialized</a></li>
<li><a href="#state-instantiated-co-simulation">4.2.4.4. State: Instantiated</a></li>
<li><a href="#state-initialization-mode-co-simulation">4.2.4.5. State: Initialization Mode</a></li>
<li><a href="#state-step-mode-co-simulation">4.2.4.6. State: Step Mode</a></li>
<li><a href="#state-intermediate-update-mode-co-simulation">4.2.4.7. State: Intermediate Update Mode</a></li>
<li><a href="#state-reconfiguration-mode-co-simulation">4.2.4.8. State: Reconfiguration Mode</a></li>
<li><a href="#state-step-discarded-co-simulation">4.2.4.9. State: Step Discarded</a></li>
<li><a href="#state-terminated-co-simulation">4.2.4.10. State: Terminated</a></li>
<li><a href="#state-configuration-mode-co-simulation">4.2.4.11. State: Configuration Mode</a></li>
</ul>
</li>
<li><a href="#_code_example_for_fmi3cosimulation">4.2.5. Code Example for fmi3CoSimulation</a></li>
<li><a href="#earlyreturn-co-simulation">4.2.6. Early-return Requested by the Co-Simulation Master in fmi3CoSimulation</a></li>
</ul>
</li>
<li><a href="#basic-co-simulation-schema">4.3. Description Schema</a>
<ul class="sectlevel3">
<li><a href="#xml-example-co-simulation">4.3.1. Example XML Description File</a></li>
<li><a href="#_early_return_from_current_communication_step_2">4.3.2. Early Return from Current Communication Step</a>
<ul class="sectlevel4">
<li><a href="#_co_simulation_fmu">4.3.2.1. Co-Simulation FMU</a></li>
<li><a href="#_example_xml_description_file">4.3.2.2. Example XML Description File</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmi-for-hybrid-co-simulation">5. FMI for Hybrid Co-Simulation</a>
<ul class="sectlevel2">
<li><a href="#math-hybrid-co-simulation">5.1. Mathematical Description</a></li>
<li><a href="#hybrid-co-simulation-api">5.2. Application Programming Interface</a>
<ul class="sectlevel3">
<li><a href="#_communication_of_event_time_and_inputoutput_values">5.2.1. Communication of event time and input/output values</a></li>
<li><a href="#_handling_a_successful_early_return_by_the_co_simulation_master_in_fmi3hybridcosimulation">5.2.2. Handling a Successful Early-Return by the Co-Simulation Master in fmi3HybridCoSimulation</a></li>
<li><a href="#api-clocked-co-simulation">5.2.3. Co-Simulation with Clock Support in fmi3HybridCoSimulation</a>
<ul class="sectlevel4">
<li><a href="#transfer-of-input-output-and-parameters-clocked-co-simulation">5.2.3.1. Transfer of Input / Output Values and Parameters in fmi3HybridCoSimulation</a></li>
<li><a href="#computation-clocked-co-simulation">5.2.3.2. Computation in fmi3HybridCoSimulation</a></li>
</ul>
</li>
<li><a href="#state-machine-calling-sequence-clocked-co-simulation">5.2.4. State Machine of Calling Sequence from Master to Slave in fmi3HybridCoSimulation</a>
<ul class="sectlevel4">
<li><a href="#_state_slave_setable_fmu_state">5.2.4.1. State: Slave Setable FMU State</a></li>
<li><a href="#_state_slave_under_evaluation">5.2.4.2. State: Slave Under Evaluation</a></li>
<li><a href="#_state_slave_initialized">5.2.4.3. State: Slave Initialized</a></li>
<li><a href="#_state_instantiated">5.2.4.4. State: Instantiated</a></li>
<li><a href="#_state_configuration_mode">5.2.4.5. State: Configuration Mode</a></li>
<li><a href="#_state_initialization_mode">5.2.4.6. State: Initialization Mode</a></li>
<li><a href="#_state_event_mode">5.2.4.7. State: Event Mode</a></li>
<li><a href="#_state_step_mode">5.2.4.8. State: Step Mode</a></li>
<li><a href="#_state_intermediate_update_mode">5.2.4.9. State: Intermediate Update Mode</a></li>
<li><a href="#_state_reconfiguration_mode">5.2.4.10. State: Reconfiguration Mode</a></li>
<li><a href="#_state_step_discarded">5.2.4.11. State: Step Discarded</a></li>
<li><a href="#_state_terminated">5.2.4.12. State: Terminated</a></li>
</ul>
</li>
<li><a href="#code-example-clocked-co-simulation">5.2.5. Code Example for fmi3HybridCoSimulation</a></li>
</ul>
</li>
<li><a href="#hybrid-co-simulation-schema">5.3. Description Schema</a>
<ul class="sectlevel3">
<li><a href="#xml-flags-clocked-co-simulation">5.3.1. Capability Flags</a></li>
<li><a href="#xml-example-clocked-co-simulation">5.3.2. Example XML Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmi-for-scheduled-co-simulation">6. FMI for Scheduled Co-Simulation</a>
<ul class="sectlevel2">
<li><a href="#math-scheduled-co-simulation">6.1. Mathematical Description</a></li>
<li><a href="#scheduled-co-simulation-api">6.2. Application Programming Interface</a>
<ul class="sectlevel3">
<li><a href="#_transfer_of_input_output_values_and_parameters_in_scheduled_co_simulation">6.2.1. Transfer of Input / Output Values and Parameters in Scheduled Co-Simulation</a></li>
<li><a href="#_computation_in_scheduled_co_simulation">6.2.2. Computation in Scheduled Co-Simulation</a></li>
<li><a href="#_state_machine_for_scheduled_co_simulation">6.2.3. State Machine for Scheduled Co-Simulation</a>
<ul class="sectlevel4">
<li><a href="#_state_slave_settable_fmu_state">6.2.3.1. State: Slave Settable FMU State</a></li>
<li><a href="#_state_slave_under_evaluation_2">6.2.3.2. State: Slave Under Evaluation</a></li>
<li><a href="#_state_slave_initialized_2">6.2.3.3. State: Slave Initialized</a></li>
<li><a href="#_state_clock_activation_mode">6.2.3.4. State: Clock Activation Mode</a></li>
<li><a href="#_state_intermediate_update_mode_2">6.2.3.5. State: Intermediate Update Mode</a></li>
<li><a href="#_state_reconfiguration_mode_2">6.2.3.6. State: Reconfiguration Mode</a></li>
</ul>
</li>
<li><a href="#preemption-support">6.2.4. Preemption Support</a></li>
<li><a href="#_pseudo_code_example_for_scheduled_co_simulation">6.2.5. Pseudo-code Example for Scheduled Co-Simulation</a></li>
</ul>
</li>
<li><a href="#scheduled-co-simulation-schema">6.3. Description Schema</a>
<ul class="sectlevel3">
<li><a href="#_example_xml_description_file_2">6.3.1. Example XML Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_literature">7. Literature</a></li>
<li><a href="#_references">References</a></li>
<li><a href="#_fmi_revision_history">Appendix A: FMI Revision History</a>
<ul class="sectlevel2">
<li><a href="#_a_1_version_1_0_fmi_for_model_exchange">A.1 Version 1.0 - FMI for Model Exchange</a></li>
<li><a href="#_a_2_version_1_0_fmi_for_co_simulation">A.2 Version 1.0 - FMI for Co-Simulation</a></li>
<li><a href="#_a_3_version_2_0_fmi_for_model_exchange_and_co_simulation">A.3 Version 2.0 - FMI for Model Exchange and Co-Simulation</a>
<ul class="sectlevel3">
<li><a href="#_a_3_1_overview">A.3.1 Overview</a></li>
<li><a href="#_a_3_2_main_changes">A.3.2 Main changes</a></li>
<li><a href="#_a_3_3_contributors">A.3.3 Contributors</a></li>
</ul>
</li>
<li><a href="#_a_3_4_fmi_2_0_1_maintenane_release_changes_and_contributors">A.3.4 FMI 2.0.1 maintenane release: changes and contributors</a></li>
</ul>
</li>
<li><a href="#_glossary">Appendix B: Glossary</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document defines the Functional Mock-up Interface (FMI), version 3.0.
This is a major release with new features compared to FMI 2.0.</p>
</div>
<div class="paragraph">
<p>FMI is a tool-independent standard to support both model exchange and co-simulation of dynamic models using a combination of XML files and C code (either compiled in DLL/shared libraries or in source code).
The first version, FMI 1.0, was published in 2010.
The FMI development was initiated by Daimler AG with the goal to improve the exchange of simulation models between suppliers and OEMs.
As of today, development of the standard continues through the participation of many companies and research institutes.
FMI 2.0 is supported by over 100 tools and is used by automotive and non-automotive organizations throughout Europe, Asia and North America.</p>
</div>
<div class="paragraph">
<p>The downloads page (<a href="https://fmi-standard.org/downloads/" class="bare">https://fmi-standard.org/downloads/</a>) provides, this specification, as well as supporting C header and XML schema files, and an FMI compliance checker.
In addition, sample models (exported from different tools in FMI format) are provided to assist tool vendors to ensure compatibility with other tools, as well as a test suite to check whether connected FMUs (Function Mock-up Units) are appropriately handled by a tool.</p>
</div>
<div class="paragraph">
<p>Contact the FMI development group at <a href="mailto:contact@fmi-standard.org">contact@fmi-standard.org</a>.</p>
</div>
<div class="paragraph">
<p><em>History / Road Map</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Date</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-01-26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First version of FMI for Model Exchange</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-10-12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First version of FMI for Co-Simulation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014-07-25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Second version of FMI for Model Exchange and Co-Simulation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-10-31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bugfix/maintenance release of FMI for Model Exchange and Co-Simulation 2.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Third  version of FMI for Model Exchange and Co-Simulation</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Please report issues that you find with this specification to the public FMI issue tracking system: <a href="https://github.com/modelica/fmi-standard/issues/" class="bare">https://github.com/modelica/fmi-standard/issues/</a></p>
</div>
<div class="paragraph">
<p><strong>License of this document</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Copyright &#169;</dt>
<dd>
<p>2008-2011 MODELISAR consortium and<br>
2012-2020 Modelica Association Project "FMI"</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This document is provided "as is" without any warranty.
It is licensed under the CC-BY-SA (Creative Commons Attribution-Sharealike 4.0 International) license, which is the license used by Wikipedia.
Human-readable summary of the license text from <a href="http://creativecommons.org/licenses/by-sa/4.0/" class="bare">http://creativecommons.org/licenses/by-sa/4.0/</a> is as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">You are free to</p>
<p class="tableblock"><strong>Share</strong> - copy and redistribute the material in any medium or format</p>
<p class="tableblock"><strong>Remix</strong> - remix, transform, and build upon the material for any purpose, even commercially.</p>
<p class="tableblock">The licensor cannot revoke these freedoms as long as you follow the license terms.</p>
<p class="tableblock">Under the following terms:</p>
<p class="tableblock"><strong>Attribution</strong> - You must give appropriate credit, provide a link to the
license, and indicate if changes were made.
You may do so in any reasonable manner, but not in any way that suggests the licensor endorses you or your use.</p>
<p class="tableblock"><strong>Share Alike</strong> - If you remix, transform, or build upon the material, you must distribute your contributions under the same license as the original.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The legal license text and disclaimer is available at:</p>
</div>
<div class="paragraph">
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/legalcode" class="bare">http://creativecommons.org/licenses/by-sa/4.0/legalcode</a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Note</dt>
<dd>
<p>Article (3a) of this license requires that modifications of this work must clearly label, demarcate or otherwise identify that changes were made.</p>
</dd>
</dl>
</div>
<div class="paragraph indented2">
<p>The C header and XML-schema files that accompany this document are available under the BSD 2-Clause license (<a href="http://www.opensource.org/licenses/bsd-license.html" class="bare">http://www.opensource.org/licenses/bsd-license.html</a>).</p>
</div>
<div class="paragraph indented2">
<p>Attention is drawn to the possibility that some of the elements of this document may be the subject of patent rights.
Modelica Association shall not be held responsible for identifying such patent rights.<br>
If you have improvement suggestions, please send them to the FMI development group at <a href="mailto:contact@fmi-standard.org">contact@fmi-standard.org</a>.</p>
</div>
<div class="paragraph">
<p><strong>Abstract</strong></p>
</div>
<div class="paragraph">
<p>This document defines the Functional Mock-up Interface (FMI),
version 3.0 to (a) exchange dynamic models between tools and (b) define tool
coupling for dynamic system simulation environments.</p>
</div>
<div class="paragraph">
<p><em>FMI for Basic Co-Simulation (BCS) (<a href="#fmi-for-basic-co-simulation">Section 4</a>)</em></p>
</div>
<div class="paragraph">
<p>The intention is to provide an interface standard for coupling
of simulation models or tools in a co-simulation environment.
The data exchange between subsystems is largely restricted to discrete communication points.
In the time between two communication points,
the subsystems are solved independently by internal means, see below.
Master algorithms control the data exchange and the
synchronization between subsystems (FMUs).</p>
</div>
<div class="paragraph">
<p>Note that the master algorithm itself is not part of the FMI standard.</p>
</div>
<div class="paragraph">
<p><em>FMI for Hybrid Co-Simulation (HCS) (<a href="#fmi-for-hybrid-co-simulation">Section 5</a>)</em></p>
</div>
<div class="paragraph">
<p>The Hybrid Co-Simulation interface adds a number of features primarily to allow for more sophisticated master algorithms that aim at more efficient and robust simulations.
Such additional features are raising events between communication time points using synchronous and asynchronous clocks or sharing values between communication points to allow for improved interpolation of data.
The master algorithm is responsible for:
* advancing the overall simulation time, and
* triggering execution of synchronous and asynchronous external events for a set of FMUs, and
* handling events (e.g. clock ticks) signaled by the FMUs.</p>
</div>
<div class="paragraph">
<p>For both Basic Co-Simulation and Hybrid Co-Simulation the master algorithm is shielded from how the subsystem FMU advances time internally.
For example, FMUs containing ODEs and exposing either of the co-simulation interfaces require to include an ODE solver inside the FMU to internally advance time between the communication points.
Or, for controller code packaged as FMU, an internal scheduling algorithm will trigger tasks at the correct time and order while advancing time to the next communication point or event.</p>
</div>
<div class="paragraph">
<p><em>FMI for Model Exchange (ME) (<a href="#fmi-for-model-exchange">Section 3</a>)</em></p>
</div>
<div class="paragraph">
<p>The Model Exchange interface exposes an ODE to an external solver of an importing tool&#8217;s master algorithm.
Models are described by differential, algebraic and discrete equations with time-, state- and step-events.
That master algorithm, usually a DAE solver, is responsible to advance time, set states and handle events etc.</p>
</div>
<div class="paragraph">
<p><em>FMI for Scheduled Co-Simulation (SCS) (<a href="#fmi-for-scheduled-co-simulation">Section 6</a>)</em></p>
</div>
<div class="paragraph">
<p>The Scheduled Co-Simulation interface exposes individual parts of a model or tasks of a control algorithm to be called from an external scheduler of an importing tool&#8217;s master algorithm.
The master algorithm is responsible for:
* advancing the overall simulation time, and
* triggering execution of synchronous and asynchronous external events for all exposed model parts of a set of FMUs (e.g. tasks of a controller model), and
* handling events (e.g. clock ticks) signaled by the FMUs.</p>
</div>
<div class="paragraph">
<p>In many ways, the Scheduled Co-Simulation interface is the equivalent of the Model Exchange interface: the first externalizes a scheduling algorithm usually found in a controller algorithm and the second interface externalizes the ODE solver.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/fmi-types-overview.svg" alt="fmi types overview" width="50%">
</div>
</div>
<div class="paragraph">
<p>The following table gives an overview of the features of the different interfaces.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-center valign-top">Model Exchange</th>
<th class="tableblock halign-center valign-top">Basic Co-Simulation</th>
<th class="tableblock halign-center valign-top">Hybrid Co-Simulation</th>
<th class="tableblock halign-center valign-top">Scheduled Co-Simulation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Solver Included</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event Indicators</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Early Return</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intermediate Value Access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clocks</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct Feedthrough</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>FMI for Co-Simulation (xCS)</em></p>
</div>
<div class="paragraph">
<p>Any reference to all three Co-Simulation interfaces (BCS, HCS and SCS) are referred to as Co-Simulation interface, or xCS.
Writing lower-case co-simulation refers to the general concept of co-simulation.</p>
</div>
<div class="paragraph">
<p><em>FMI Common Concepts (<a href="#fmi-common-concepts">Section 2</a>)</em></p>
</div>
<div class="paragraph">
<p>The four interface standards have many parts in common.
In particular, it is possible to utilize several instances of a model and/or a co-simulation tool and to connect them together.
The interfaces are independent of the target environment because no header files are used that depend on the target environment (with exception of the data types of the target platform).
This allows generating one dynamic link library that can be utilized in any environment on the same platform.
A model, a co-simulation slave or the coupling part of a tool, is distributed in one ZIP file called FMU (Functional Mockup Unit) that contains several files:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An XML file contains the definitions of all exposed variables in the FMU and other static information.
It is then possible to run the FMU on a target system without this information, in other words with no unnecessary overhead.</p>
</li>
<li>
<p>All required model equations or the access to co-simulation tools are provided with a small set of easy-to-use C functions.
A new caching technique allows a more efficient evaluation of the model equations than in other approaches.
These C functions can either be provided in source and/or binary form.
Binary forms for different platforms can be included in the same FMU ZIP file.</p>
</li>
<li>
<p>The model equations or the co-simuation tool can be either provided directly in the FMU,
or the FMU contains only a generic communication module that communicates with an external tool that evaluates or simulates the model.
In the XML file, also information about the capabilities of the FMU are present, for example to characterize the ability of a Co-Simulation slave to support advanced master algorithms such as the usage of variable communication step sizes, higher order signal extrapolation, or others.</p>
</li>
<li>
<p>Further data can be included in the FMU ZIP file, especially a model icon (bitmap file), documentation files, maps and tables needed by the FMU, and/or all object libraries or dynamic link libraries that are utilized.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A <a href="https://www.fmi-standard.org/tools">growing set of tools</a> supports FMI.</p>
</div>
<div class="paragraph">
<p><strong>About FMI 2.0.1</strong></p>
</div>
<div class="paragraph">
<p>FMI 2.0.1 was a maintenance release with no new features compared to FMI 2.0.
FMUs created according to FMI 2.0.1 are valid FMUs according to FMI 2.0.</p>
</div>
<div class="paragraph">
<p><strong>About FMI 2.0</strong></p>
</div>
<div class="paragraph">
<p>FMI 2.0 was a major enhancement to FMI 1.0, that merged the FMI 1.0 Model Exchange and Co-Simulation standards and incorporates many improvements, often due to practical experience when using the FMI 1.0 standards.
New features are usually optional (need neither be supported by the tool that exports an FMU, nor by the tool that imports an FMU).
Details are provided in appendix A.3.1.</p>
</div>
<div class="paragraph">
<p><strong>Conventions used in this Document</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-normative text is given in square brackets in italic font: <em>[Especially examples are defined in this style.]</em></p>
</li>
<li>
<p>Arrays appear in two forms:</p>
<div class="ulist">
<ul>
<li>
<p>In the end-user/logical view, one- and two-dimensional arrays are used.
Here the convention of linear algebra, the control community and the most important tools in this area is utilized.
In other words the first element along one dimension starts at index one.
In all these cases, the starting index is also explicitly mentioned at the respective definition of the array.
For example, in the <code>modelDescription.xml</code> file, the set of exposed variables is defined as ordered sets where the first element is referenced with index one (these indices are, for example, used to define the sparseness structure of partial derivative matrices).</p>
</li>
<li>
<p>In the implementation view, one-dimensional C arrays are used.
In order to access an array element the C convention is used.
For example, the first element of input argument <code>x</code> for function <code>setContinuousStates</code> is <code>x[0]</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The key words <strong>MUST</strong>, <strong>MUST NOT</strong>, <strong>REQUIRED</strong>, <strong>SHALL</strong>, <strong>SHALL NOT</strong>, <strong>SHOULD</strong>, <strong>SHOULD NOT</strong>, <strong>RECOMMENDED</strong>, <strong>NOT RECOMMENDED</strong>, <strong>MAY</strong>, and <strong>OPTIONAL</strong> in this document are to be interpreted as described in <a href="https://tools.ietf.org/html/rfc2119">RFC 2119</a>.</p>
</li>
<li>
<p><code>{VariableType}</code> is used as a placeholder for all variable type names without the <code>fmi3</code> prefix (e.g. <code>fmi3Get{VariableType}</code> stands for <code>fmi3GetUInt8</code> etc.).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>FMI 2.0 Implementation Help</strong></p>
</div>
<div class="paragraph">
<p>If you plan to export or import models in FMI 2.0 format, you may find the following tools/models helpful for your development (available from <a href="https://fmi-standard.org/downloads" class="bare">https://fmi-standard.org/downloads</a>):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">FMU Compliance Checker</dt>
<dd>
<p>Free software to check whether an FMI model is compliant to the FMI standard.</p>
</dd>
<dt class="hdlist1">FMUs from other tools</dt>
<dd>
<p>In order to test the import of FMI models from other vendors in your tool, a set of test FMUs is provided.</p>
</dd>
<dt class="hdlist1">Library to test connected FMUs</dt>
<dd>
<p>Free Modelica library to test difficult cases of connected FMI models.</p>
</dd>
<dt class="hdlist1">FMU Software Development Kit</dt>
<dd>
<p>Free software development kit by QTronic to demonstrate basic use of FMI.</p>
</dd>
<dt class="hdlist1">FMI Library</dt>
<dd>
<p>Free software package by Modelon that enables integration of FMI models in applications.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The FMI (Functional Mock-up Interface) defines an interface to
be implemented by an executable called an FMU (Functional Mock-up Unit).
The FMI functions are used (called) by a simulation environment to
create one or more instances of the FMU and to simulate them,
typically together with other models.
An FMU may either have its own solvers
(FMI for Basic Co-Simulation, <a href="#fmi-for-basic-co-simulation">Section 4</a>)
or require the simulation environment to perform numerical integration
(FMI for Model Exchange, <a href="#fmi-for-model-exchange">Section 3</a>).
The goal of this interface is that the calling of an FMU
in a simulation environment is reasonably simple.
No provisions are provided in this document for how to generate an FMU from a modeling environment.</p>
</div>
<div class="paragraph">
<p>The FMI for Model Exchange interface defines an interface to the model
of a dynamic system described by differential,
algebraic and discrete-time equations.
It provides an interface to evaluate these
equations as needed in different simulation environments,
as well as in embedded control systems,
with explicit or implicit integrators, and fixed or variable step-size.
The interface is designed to allow the
description of large models.</p>
</div>
<div class="paragraph">
<p>The FMI for Basic Co-Simulation interface is designed both for the coupling of simulation tools
(simulator coupling, tool coupling),
and coupling with subsystem models,
which have been exported by their
simulators together with its solvers as runnable code.
The goal is to compute the solution of time-dependent
coupled systems consisting of subsystems that are continuous in time (model components
that are described by differential-algebraic equations) or are time-discrete (model components that are
described by difference equations, for example discrete controllers) or both.
In a block representation of the coupled system,
the subsystems are represented by blocks with (internal) <a href="#state"><code>state</code></a> variables <code>x(t)</code> that are
connected to other subsystems (blocks) of the coupled problem
by subsystem inputs <code>u(t)</code> and subsystem outputs <code>y(t)</code>.</p>
</div>
<div class="paragraph">
<p>In case of tool coupling,
the modular structure of coupled problems is exploited in all stages of the
simulation process beginning with the separate model setup and pre-processing for the individual
subsystems in different simulation tools.
During time integration, the simulation is again performed independently for all
subsystems restricting the data exchange between subsystems to discrete communication points.
Finally, the visualization and post-processing of simulation data can be done
individually for each subsystem in its own native simulation tool or by the simulation environment.</p>
</div>
<div class="paragraph">
<p>The two interfaces have large parts in common.
These parts are defined in <a href="#fmi-common-concepts">Section 2</a>.
In particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI Application Programming Interface (C)<br>
All required equations or tool coupling computations are evaluated by calling standardized C functions.
C is used
because it is the most portable programming language today and is the only
programming language that can be utilized in all embedded control systems.</p>
</li>
<li>
<p>FMI Description Schema (XML)<br>
The schema defines the structure and content of an XML file generated by a modeling environment.
This XML file contains the definition of all variables of the FMU in a standardized way.
It is then
possible to run the C code in an embedded system without the overhead of the variable definition
(the alternative would be to store this information in the C code and access it via function calls,
but this is neither practical for embedded systems nor for large models).
Furthermore, the variable definition is a complex data structure and tools should
be free to determine how to represent this data structure in their programs.
The selected approach allows a tool to store and access the variable definitions
(without any memory or efficiency overhead of standardized access functions) in the programming
language of the simulation environment,
such as C++, C#, Java, or Python. Note that there are many free and commercial libraries
in different programming languages to read XML files into an appropriate data structure.
See for example <a href="http://en.wikipedia.org/wiki/XML#Parsers" class="bare">http://en.wikipedia.org/wiki/XML#Parsers</a>
and especially the efficient open source parser SAX (<a href="http://sax.sourceforge.net/" class="bare">http://sax.sourceforge.net/</a>,
<a href="http://en.wikipedia.org/wiki/Simple_API_for_XML" class="bare">http://en.wikipedia.org/wiki/Simple_API_for_XML</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An FMU (in other words a model without integrators,
a runnable model with integrators,
or a tool coupling interface) is distributed in one ZIP file.
The ZIP file contains (more details are given in <a href="#fmu-distribution">Section 2.3</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The FMI Description File (in XML format).</p>
</li>
<li>
<p>The C sources of the FMU,
including the needed run-time libraries used in the model,
and/or binaries for one or several target machines,
such as Windows dynamic link libraries (.dll) or
Linux shared object libraries (.so).
The latter solution is especially used if the FMU provider
wants to hide the source code to secure the contained know-how or to allow a fully automatic
import of the FMU in another simulation environment.
An FMU may contain physical parameters or geometrical dimensions,
which should not be open.
On the other hand,
some functionality requires source code.</p>
</li>
<li>
<p>Additional FMU data (such as tables or maps) in FMU specific file formats.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A schematic view of an FMU is shown in <a href="#figure-data-flow">Figure 1</a>:</p>
</div>
<div id="figure-data-flow" class="imageblock text-center">
<div class="content">
<img src="images/enclosing_model.svg" alt="enclosing model" width="60%">
</div>
<div class="title">Figure 1. Data flow between the environment and an FMU.</div>
</div>
<div class="paragraph">
<p>For details, see <a href="#fmi-for-model-exchange">Section 3</a> and <a href="#fmi-for-basic-co-simulation">Section 4</a>.
<span class="blue">Blue</span> arrows: Information provided by the FMU.
<span class="red">Red</span> arrows: Information provided to the FMU.</p>
</div>
<div class="paragraph">
<p>Publications for FMI are available from <a href="https://fmi-standard.org/literature/" class="bare">https://fmi-standard.org/literature/</a>, especially <a href="#BOA11">[BOA11]</a> and <a href="#BOA12">[BOA12]</a>.</p>
</div>
<div class="sect2">
<h3 id="_properties_and_guiding_ideas">1.1. Properties and Guiding Ideas</h3>
<div class="paragraph">
<p>In this section,
properties are listed and some principles are defined that guided the low-level design of
the FMI.
This shall increase self consistency of the interface functions.
The listed issues are sorted,
starting from high-level properties to low-level implementation issues.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Expressivity</dt>
<dd>
<p>The FMI provides the necessary features that Modelica&#174;, Simulink&#174; and SIMPACK&#174; models can transform to an FMU.
<em>[Modelica is a registered trademark of the Modelica Association, Simulink is a registered trademark of the MathWorks Inc., SIMPACK is a registered trademark of SIMPACK AG.]</em></p>
</dd>
<dt class="hdlist1">Stability</dt>
<dd>
<p>The FMI is expected to be supported by many simulation tools worldwide.
Implementing such support is a major investment for tool vendors.
Stability and backwards compatibility of the FMI has therefore high priority.
To support this, the FMI defines "capability flags" that will be used by future versions of the FMI to extend and improve the FMI in a backwards compatible way, whenever feasible.</p>
</dd>
<dt class="hdlist1">Implementation</dt>
<dd>
<p>FMUs can be written manually or can be generated automatically from a modeling environment.
Existing manually coded models can be transformed manually to a model according to the FMI standard.</p>
</dd>
<dt class="hdlist1">Processor independence</dt>
<dd>
<p>It is possible to distribute an FMU without knowing the target processor.
This allows an FMU to run on a PC, a Hardware-in-the-Loop simulation platform or as part of the controller software of an ECU, for example, as part of an AUTOSAR SWC.
Keeping the FMU independent of the target processor increases the usability of the FMU and is even required by the AUTOSAR software component model.
Implementation: Using a textual FMU (distribute the C source of the FMU).</p>
</dd>
<dt class="hdlist1">Simulator independence</dt>
<dd>
<p>It is possible to compile, link and distribute an FMU without knowing the target simulator.
Reason: The standard would be much less attractive otherwise, unnecessarily restricting the later use of an FMU at compile time and forcing users to maintain simulator specific variants of an FMU.
Implementation: Using a binary FMU.
When generating a binary FMU such as a Windows dynamic link library (.dll) or a Linux shared object library (.so), the target operating system and eventually the target processor must be known.
However, no run-time libraries, source files or header files of the target simulator are needed to generate the binary FMU.
As a result, the binary FMU can be executed by any simulator running on the target platform (provided the necessary licenses are available, if required from the model or from the used run-time libraries).</p>
</dd>
<dt class="hdlist1">Small run-time overhead</dt>
<dd>
<p>Communication between an FMU and a target simulator through the FMI does not introduce significant run-time overhead.
This is achieved by a new caching technique (to avoid computing the same variables several times) and by exchanging multiple quantities with one call.</p>
</dd>
<dt class="hdlist1">Small footprint</dt>
<dd>
<p>A compiled FMU (the executable) is small.
Reason: An FMU may run on an ECU (Electronic Control Unit, for example, a microprocessor), and ECUs have strong memory limitations.
This is achieved by storing signal attributes (names, units, etc.) and all other static information not needed for model evaluation in a separate text file (= Model Description File) that is not needed on the microprocessor where the executable might run.</p>
</dd>
<dt class="hdlist1">Hide data structure</dt>
<dd>
<p>The FMI for Model Exchange does not prescribe a data structure (a C struct) to represent a model.
Reason: the FMI standard shall not unnecessarily restrict or prescribe a certain implementation of FMUs or simulators (whichever contains the model data) to ease implementation by different tool vendors.</p>
</dd>
<dt class="hdlist1">Support many and nested FMUs</dt>
<dd>
<p>A simulator may run many FMUs in a single simulation run and/or multiple instances of one FMU.
The inputs and outputs of these FMUs can be connected with direct feedthrough.
Moreover, an FMU may contain nested FMUs.</p>
</dd>
<dt class="hdlist1">Numerical Robustness</dt>
<dd>
<p>The FMI standard allows that problems which are numerically critical (for example, time and state events, multiple sample rates, stiff problems) can be treated in a robust way.</p>
</dd>
<dt class="hdlist1">Hide cache</dt>
<dd>
<p>A typical FMU will cache computed results for later reuse.
To simplify usage and to reduce error possibilities by a simulator, the caching mechanism is hidden from the usage of the FMU.
Reason: First, the FMI should not force an FMU to implement a certain caching policy.
Second, this helps to keep the FMI simple.</p>
</dd>
<dt class="hdlist1">Implementation</dt>
<dd>
<p>The FMI provides explicit methods (called by the FMU environment) for setting properties that invalidate cached data.
An FMU that chooses to implement a cache may maintain a set of "dirty" flags, hidden from the simulator.
A get method, for example to a state, will then either trigger a computation, or return cached data, depending on the value of these flags.</p>
</dd>
<dt class="hdlist1">Support numerical solvers</dt>
<dd>
<p>A typical target simulator will use numerical solvers.
These solvers require vectors for <a href="#state"><code>states</code></a>, <a href="#derivative"><code>derivatives</code></a> and zero-crossing functions.
The FMU directly fills the values of such vectors provided by the solvers.
Reason: minimize execution time.
The exposure of these vectors conflicts somewhat with the "hide data structure" requirement, but the efficiency gain justifies this.</p>
</dd>
<dt class="hdlist1">Explicit signature</dt>
<dd>
<p>The intended operations, argument types and return values are made explicit in the signature.
For example, an operator (such as <code>compute_derivatives</code>) is not passed as an int argument but a special function is called for this.
The <code>const</code> prefix is used for any pointer that should not be changed, including <code>const char*</code> instead of <code>char*</code>.
Reason: the correct use of the FMI can be checked at compile time and allows calling of the C code in a C++ environment (which is much stricter on <code>const</code> than C is).
This will help to develop FMUs that use the FMI in the intended way.</p>
</dd>
<dt class="hdlist1">Few functions</dt>
<dd>
<p>The FMI consists of a few, "orthogonal" functions, avoiding redundant functions that could be defined in terms of others.
Reason: This leads to a compact, easy-to-use, and hence attractive API with a compact documentation.</p>
</dd>
<dt class="hdlist1">Error handling</dt>
<dd>
<p>All FMI methods use a common set of methods to communicate errors.</p>
</dd>
<dt class="hdlist1">Allocator must free</dt>
<dd>
<p>All memory (and other resources) allocated by the FMU are freed (released) by the FMU.
Likewise, resources allocated by the simulator are released by the simulator.
Reason: this helps to prevent memory leaks and run-time errors due to incompatible run-time environments for different components.</p>
</dd>
<dt class="hdlist1">Immutable strings</dt>
<dd>
<p>All strings passed as arguments or returned are read-only and must not be modified by the receiver.
Reason: This eases the reuse of strings.</p>
</dd>
<dt class="hdlist1">Named list elements</dt>
<dd>
<p>All lists defined in the <code>fmi3ModelDescription.xsd</code> XML schema file have a String attribute <code>name</code> to a list element.
This attribute must be unique with respect to all other <code>name</code> attributes of the same list.</p>
</dd>
<dt class="hdlist1">Use C</dt>
<dd>
<p>The FMI is encoded using C, not C++.
Reason: Avoid problems with compiler and linker dependent behavior.
Run FMU on embedded target.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This version of the functional mock-up interface does not have the following desirable properties.
They might be added in a future version.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The FMI for Model Exchange is for ordinary differential equations (ODEs) in state space form.
It is not for a general differential-algebraic equation system.
However, algebraic equation systems inside the FMU are supported (for example, the FMU can report to the environment to re-run the current step with a smaller step size since a solution could not be found for an algebraic equation system).</p>
</li>
<li>
<p>Special features that might be useful for multibody system programs, like SIMPACK, are not included.</p>
</li>
<li>
<p>The interface is for simulation and for embedded systems.
Properties that might be additionally needed for trajectory optimization, for example, derivatives of the model with respect to parameters during continuous integration are not included.</p>
</li>
<li>
<p>No explicit definition of the variable hierarchy in the XML file.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgements">1.2. Acknowledgements</h3>
<div class="paragraph">
<p>Until Dec. 2011, this work was carried out within the ITEA2 MODELISAR project (project number: ITEA2-07006, <a href="https://itea3.org/project/modelisar.html" class="bare">https://itea3.org/project/modelisar.html</a>).</p>
</div>
<div class="paragraph">
<p>Daimler AG, DLR, ITI GmbH, Martin Luther University Halle-Wittenberg, QTronic GmbH and SIMPACK AG thank BMBF for partial funding of this work within MODELISAR (BMBF F&#246;rderkennzeichen: 01lS0800x).</p>
</div>
<div class="paragraph">
<p>Dassault Syst&#232;mes (Sweden) thanks the Swedish funding agency VINNOVA (2008-02291) for partial funding of this work within MODELISAR.</p>
</div>
<div class="paragraph">
<p>LMS Imagine and IFPEN thank DGCIS for partial funding of this work within MODELISAR.</p>
</div>
<div class="paragraph">
<p>Since Sept. 2012 until Nov. 2015, this work is partially carried out within the ITEA2 MODRIO project (project number: ITEA 2-11004, <a href="https://itea3.org/project/modrio.html" class="bare">https://itea3.org/project/modrio.html</a>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DLR, ITI GmbH, QTronic GmbH and SIMPACK AG thank BMBF for partial funding of this work within MODRIO (BMBF F&#246;rderkennzeichen: 01IS12022E).</p>
</li>
<li>
<p>Dassault Syst&#232;mes (Sweden), Link&#246;ping University and Modelon AB thank the Swedish funding agency VINNOVA (2012&#8212;&#8203;01157) for partial funding of this work within MODRIO.</p>
</li>
<li>
<p>Siemens PLM Software (France) and IFPEN thank DGCIS for partial funding of this work within MODRIO.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-common-concepts">2. Common Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The concepts defined in this chapter are defined that are common for Model Exchange and Co-Simulation interface types.
In both cases, FMI defines an input/output block of a dynamic model where the distribution of the block, the platform dependent header file, several access functions, as well as the schema files are identical.
The definitions that are specific to the particular cases are defined in <a href="#fmi-for-model-exchange">Section 3</a> and <a href="#fmi-for-basic-co-simulation">Section 4</a>.</p>
</div>
<div class="paragraph">
<p>Below, the term <em>FMU</em> (Functional Mock-up Unit) will be used as common term for a model following the interface type FMI for Model Exchange, or a co-simulation slave following all or any subset of the Co-Simulation interface types (Basic Co-Simulation, Hybrid Co-Simulation or Scheduled Co-Simulation).
Note that the standard supports several interface types to co-exist inside one FMU.</p>
</div>
<div class="sect2">
<h3 id="fmi-application-programming-interface">2.1. FMI Application Programming Interface</h3>
<div class="paragraph">
<p>This section contains the common interface definitions to execute functions of an FMU from a C program.</p>
</div>
<div class="paragraph">
<p>Note that the following general properties hold for an FMU:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI functions of one instance do not need to be thread-safe.<br>
<em>[For example, if the functions of one instance of an FMU are accessed from more than one thread;
the multi-threaded environment that uses the FMU must guarantee that the calling sequences of functions defined in <a href="#state-machine-model-exchange">Section 3.2.3</a> and <a href="#state-machine-co-simulation">Section 4.2.4</a>. are used.
The FMU itself does not implement any services to support this.]</em></p>
</li>
<li>
<p>FMI functions must not change global settings which affect other processes/threads.
An FMI function may change settings of the thread in which it is called (such as floating point control registers), provided these changes are restored before leaving the function or before a callback function is called.<br>
<em>[This property ensures that functions of different FMU instances can be called safely in any order.</em>
<em>Additionally, they can be called in parallel provided the functions are called in different process/threads.</em>
<em>If an FMI function changes for example the floating point control word of the CPU, it must restore the previous value before return of the function.</em>
<em>For x86 CPUs, the floating point control word is set using the <code>fldcw</code> instruction.</em>
<em>This can be used to switch on additional exceptions such as floating point division by zero.</em>
<em>An FMU might temporarily change the floating point control word and get notified on floating point exceptions internally, but has to restore the flag and clear the floating point status word before return of the respective FMI function.]</em></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="header-files-and-naming-of-functions">2.1.1. Header Files and Naming of Functions</h4>
<div class="paragraph">
<p>Three header files are provided that define the interface of an FMU.
In all header files the convention is used that all C function and type definitions start with the prefix <code>fmi3</code>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3PlatformTypes.h</code></dt>
<dd>
<p>contains the type definitions of the <a href="#input"><code>input</code></a> and output arguments of the functions as well as some C preprocessor macro defintions for constants.
This header file must
be used both by the FMU and by the target simulator.
<em>[Example of a definition in this header file:</em></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef double fmi3Float64;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</dd>
<dt class="hdlist1"><code>fmi3FunctionTypes.h</code></dt>
<dd>
<p>contains <code>typedef</code> definitions of all function prototypes of an FMU as well as enumerations for constants.
This header file includes <code>fmi3PlatformTypes.h</code>.
When dynamically loading an FMU, these definitions can be used to type-cast the function pointers to the respective function definition.</p>
<div class="paragraph">
<p><em>[Example of a definition in this header file:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SetTimeTYPE(fmi3Instance, fmi3Float64);</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
</dd>
<dt class="hdlist1"><code>fmi3Functions.h</code></dt>
<dd>
<p>contains the function prototypes of an FMU that can be accessed in simulation environments and that are defined in <a href="#fmi-common-concepts">Section 2</a>, <a href="#fmi-for-model-exchange">Section 3</a> and <a href="#fmi-for-basic-co-simulation">Section 4</a>.</p>
<div class="paragraph">
<p>This header file includes <code>fmi3PlatformTypes.h</code> and <code>fmi3FunctionTypes.h</code>.
The header file version number for which the model was compiled, can be inquired in the target simulator with <a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a> (see <a href="#inquire-platform-and-version-number">Section 2.1.4</a>).<br></p>
</div>
<div class="paragraph">
<p><em>[Example of a definition in this header file:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">FMI3_Export fmi3SetTimeTYPE fmi3SetTime;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>For Microsoft and Cygwin compilers <code>FMI3_Export</code> is defined as</em> <code>__declspec(dllexport)</code> <em>and for Gnu-Compilers as</em> <code>__attribute__ ( ( visibility("default") ) )</code> <em>in order to export the name for dynamic loading.</em>
<em>Otherwise it is an empty definition.]</em></p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The goal is that both textual and binary representations of FMUs are supported and that several FMUs might be present at the same time in an executable (for example, FMU A may use an FMU B).
In order for this to be possible, the names of the functions in different FMUs must be different, or function pointers must be used.
To support the first variant macros are provided in <code>fmi3Functions.h</code> to build the actual function names by using a function prefix that depends on how the FMU is shipped.</p>
</div>
<div class="paragraph">
<p><em>[These macros can be defined differently in a target specific variant of <code>fmi3Functions.h</code> to adjust them to the requirements of the supported compilers and platforms of the importing tool.]</em></p>
</div>
<div class="paragraph">
<p>An FMU C-file must include at the beginning a <code>define</code> of <code>FMI3_FUNCTION_PREFIX</code> with the same value as the value of the <code>modelIdentifier</code> attribute defined in <code>&lt;fmiModelDescription&gt;&lt;ModelExchange&gt;</code> or <code>&lt;fmiModelDescription&gt;&lt;CoSimulation&gt;</code> together with <code>_</code> at the end (see <a href="#ModelExchange">Section 3.3.1</a> and <a href="#basic-co-simulation-schema">Section 4.3</a>).</p>
</div>
<div class="paragraph">
<p>This <code>define</code> must be directly followed with an <code>#include "fmi3Functions.h"</code> statement.</p>
</div>
<div class="paragraph">
<p>Typically, FMU functions are used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">// FMU is shipped with C source code, or with static link library
#define FMI3_FUNCTION_PREFIX MyModel_
#include "fmi3Functions.h"
&lt; usage of the FMU functions e.g. MyModel_fmi3SetTime &gt;

// FMU is shipped with DLL/SharedObject
#include "fmi3FunctionTypes.h"
fmi3SetTimeTYPE *myname_setTime = &lt; load symbol "fmi3SetTime" from DLL/SharedObject &gt;;
&lt; usage of the FMU function pointers, e.g. myname_setTime &gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function that is defined as <code>fmi3GetFloat64</code> is changed by the macros to a function name as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the FMU is shipped with C source code or with static link library:<br>
The constructed function name is <code>MyModel_fmi3GetFloat64</code>.
In other words the function name is prefixed with the model name and an <code>_</code>.
A simulation environment can therefore construct the relevant function names by generating code for the actual function call.
In case of a static link library, the name of the library is <code>MyModel.lib</code> on Windows and <code>libMyModel.a</code> on Linux; in other words the <code>modelIdentifier</code> attribute is used to create the library name.</p>
</li>
<li>
<p>If the FMU is shipped with DLL/SharedObject:<br>
The constructed function name is <code>fmi3GetFloat64</code>, in other words, it is not changed.
<em>[This can be realized in the case of a source code FMU with a target-specific version of <code>fmi3Functions.h</code> that does not use FMI3_FUNCTION_PREFIX to construct the function names.]</em>
A simulation environment will then dynamically load this library and will explicitly import the function symbols by providing the FMI function names as strings.
The name of the library is <code>MyModel.dll</code> on Windows or <code>MyModel.so</code> on Linux; in other words the <code>modelIdentifier</code> attribute is used as library name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[An FMU can be optionally shipped so that it basically contains only the communication to another tool (<code>needsExecutionTool = true</code>, see <a href="#fmi-for-basic-co-simulation">Section 4</a>).</em>
<em>This is particularily common for co-simulation tasks.</em>
<em>In this tool coupling case one DLL/Shared Object can be used for all models due to no function prefixing.]</em></p>
</div>
<div class="paragraph">
<p>Since <code>modelIdentifier</code> is used as prefix of a C-function name it must fulfill the restrictions on C-function
names (only letters, digits and/or underscores are allowed).
<em>[For example, if <code>modelName = "A.B.C"</code>, then <code>modelIdentifier</code> might be "A_B_C".]</em>
Since <code>modelIdentifier</code> is also used as name in a file system, it must also fulfill the restrictions of the targeted operating system.
Basically, this means that it should be short.
For example, the Windows API only supports full path-names of a file up to 260 characters (see: <a href="http://msdn.microsoft.com/en-us/library/aa365247%28VS.85%29.aspx" class="bare">http://msdn.microsoft.com/en-us/library/aa365247%28VS.85%29.aspx</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_platform_dependent_definitions_fmi3platformtypes_h">2.1.2. Platform Dependent Definitions (fmi3PlatformTypes.h)</h4>
<div class="paragraph">
<p>To simplify porting, no C types are used in the function interfaces, but the alias types are defined in this section.
All definitions in this section are provided in the header file <code>fmi3PlatformTypes.h</code>.
It is required to use this definition for all binary FMUs.
<em>[Only for source code FMUs, a change might be useful in some cases.]</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef void*           fmi3Instance;             /* Pointer to FMU instance */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to an FMU specific data structure that contains the information needed to process the model equations or to process the co-simulation of the respective slave.
This data structure is implemented by the environment that provides the FMU; in other words, the calling environment does not know its content, and the code to process it must be provided by the FMU generation environment and must be shipped with the FMU.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef void*           fmi3InstanceEnvironment;  /* Pointer to FMU environment */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to a data structure in the simulation environment that calls the FMU.
Using this pointer, data from the <code>modelDescription.xml</code> file <em>[for example, mapping of <a href="#valueReference"><code>valueReference</code></a>s to variable names]</em> can be transferred between the simulation environment and the <a href="#logMessage"><code>logMessage</code></a> function (see <a href="#creation-destruction-and-logging">Section 2.1.5</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef void*           fmi3FMUState;             /* Pointer to internal FMU state */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to a data structure in the FMU that saves the internal FMU state of the actual or a previously saved time instant.
This allows to restart a simulation from a saved FMU state (see <a href="#get-set-fmu-state">Section 2.1.10</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef unsigned int    fmi3ValueReference;       /* Handle to the value of a variable */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a handle to a (base type) variable value of the model.
A handle uniquely identifies the value of a variable.
Variables that have the same handle, always have identical values, but other parts of the variable definition might be different <em>[for example, min/max attributes]</em>.</p>
</div>
<div class="paragraph">
<p>Structured entities, such as records, must be flattened into a set of values (scalars or arrays) of type <code>fmi3Float64</code>, <code>fmi3Int32</code> etc.
Arrays may be flattened into a set of scalars or represented directly as array values.
An <code>fmi3ValueReference</code> references one such value (scalar or array).
The coding of <code>fmi3ValueReference</code> is a "secret" of the environment that generated the FMU.
The interface to the equations only provides access to variables via this handle.
Extracting concrete information about a variable is specific to the used environment that reads the Model Description File in which the value handles are defined.
If a function in the following sections is called with a wrong <code>fmi3ValueReference</code> value <em>[for example, setting a constant with a call to <code>fmi3SetFloat64</code>]</em>, then the function has to return with an error ( <code>fmi3Status = fmi3Error</code>, see <a href="#status-returned-by-functions">Section 2.1.3</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef           float fmi3Float32;  /* Single precision floating point (32-bit) */
typedef          double fmi3Float64;  /* Double precision floating point (64-bit) */
typedef          int8_t fmi3Int8;     /* 8-bit signed integer */
typedef         uint8_t fmi3UInt8;    /* 8-bit unsigned integer */
typedef         int16_t fmi3Int16;    /* 16-bit signed integer */
typedef        uint16_t fmi3UInt16;   /* 16-bit unsigned integer */
typedef         int32_t fmi3Int32;    /* 32-bit signed integer */
typedef        uint32_t fmi3UInt32;   /* 32-bit unsigned integer */
typedef         int64_t fmi3Int64;    /* 64-bit signed integer */
typedef        uint64_t fmi3UInt64;   /* 64-bit unsigned integer */
typedef             int fmi3Boolean;  /* Data type to be used with fmi3True and fmi3False */
typedef            char fmi3Char;     /* Data type for one character */
typedef const fmi3Char* fmi3String;   /* Data type for character strings
                                         ('\0' terminated, UTF-8 encoded) */
typedef            char fmi3Byte;     /* Smallest addressable unit of the machine
                                         (typically one byte) */
typedef const fmi3Byte* fmi3Binary;   /* Data type for binary data
                                         (out-of-band length terminated) */
typedef             int fmi3Clock ;   /* Data type to be used with fmi3ClockActive and
                                         fmi3ClockInactive */

/* Values for fmi3Boolean */
#define fmi3True  1
#define fmi3False 0

/* Values for fmi3Clock */
#define fmi3ClockActive   1
#define fmi3ClockInactive 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>These data types are the base types used in the interfaces of the C functions.</p>
</div>
<div class="paragraph">
<p>The data types <code>fmi3Float32</code>, <code>fmi3Float64</code>, <code>fmi3Int8</code>, <code>fmi3UInt8</code>, <code>fmi3Int16</code>, <code>fmi3UInt16</code>, <code>fmi3Int32</code>, <code>fmi3UInt32</code>, <code>fmi3Int64</code>, <code>fmi3UInt64</code> and <code>fmi3Boolean</code> are called "numeric types" in the following.</p>
</div>
<div class="paragraph">
<p>If an <code>fmi3String</code> or an <code>fmi3Binary</code> variable is passed as <code>input</code> argument to an FMI function and the FMU needs to use the string/binary later,
the FMI function must copy the string/binary before it returns and store it in the internal FMU memory,
because there is no guarantee for the lifetime of the string/binary after the function has returned.</p>
</div>
<div class="paragraph">
<p>If an <code>fmi3String</code> or an <code>fmi3Binary</code> variable is passed as <code>output</code> argument from an FMI function and the string/binary shall be used in the target environment,
the target environment must copy the whole string/binary (not only the pointer).
The memory of this string/binary may be deallocated by the next call to any of the FMI interface functions (the string/binary memory might also be just a buffer, that is reused).</p>
</div>
</div>
<div class="sect3">
<h4 id="status-returned-by-functions">2.1.3. Status Returned by Functions</h4>
<div class="paragraph">
<p>This section defines the <code>status</code> flag (an enumeration of type <code>fmi3Status</code> defined in file <code>fmi3FunctionTypes.h</code> ) that is returned by all functions to indicate the success of the function call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef enum {
    fmi3OK,
    fmi3Warning,
    fmi3Discard,
    fmi3Error,
    fmi3Fatal,
} fmi3Status;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Status returned by functions.
The status has the following meaning</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3OK</code></dt>
<dd>
<p>all well.</p>
</dd>
<dt class="hdlist1"><code>fmi3Warning</code></dt>
<dd>
<p>things are not quite right, but the computation can continue.
Function <a href="#logMessage"><code>logMessage</code></a> was called in the model (see below), and it is expected that
this function has shown the prepared information message to the user.</p>
</dd>
<dt class="hdlist1"><code>fmi3Discard</code></dt>
<dd>
<p>this return status is only possible if explicitly defined for the corresponding function.
<em>[Functions <code>fmi3Set{VariableType}</code> are usually not performing calculations but just store the passed values in internal buffers.</em>
<em>The actual calculation is performed by <code>fmi3Get{VariableType}</code> functions.</em>
<em>Still <code>fmi3Set{VariableType}</code> functions could check whether the input arguments are in their validity range.</em>
<em>If not, these functions could return with <code>fmi3Discard</code>.]</em>
(Model Exchange: <code>fmi3Set{VariableType}</code>, <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>, <code>fmi3Get{VariableType}</code>, <a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a>, <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>, <a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>; Co-Simulation: <code>fmi3Set{VariableType}</code>, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>):</p>
<div class="paragraph">
<p>For Model Exchange: It is recommended to perform a smaller step size and evaluate the model equations again, for example because an iterative solver in the model did not converge or because a function is outside of its domain <em>[for example, <code>sqrt(&lt;negative number&gt;)</code>]</em>.
If this is not possible, the simulation has to be terminated.</p>
</div>
<div class="paragraph">
<p>For Co-Simulation: <code>fmi3Discard</code> is returned also if the slave is not able to return the required status information.
The master has to decide if the simulation run can be continued.<br>
In both cases, function <a href="#logMessage"><code>logMessage</code></a> was called in the FMU (see below), and it is expected that this function has shown the prepared information message to the user if the FMU was called in debug mode (<code>loggingOn = fmi3True</code>).
Otherwise, <a href="#logMessage"><code>logMessage</code></a> should not show a message.</p>
</div>
</dd>
<dt class="hdlist1"><code>fmi3Error</code></dt>
<dd>
<p>the FMU encountered an error.
The simulation cannot be continued with this FMU instance.
If one of the functions returns <code>fmi3Error</code>, it can be tried to restart the simulation from a formerly stored FMU state by calling <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>.
This can be done if the capability flag <code>canGetAndSetFMUState = true</code> and <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a> was called before in non-erroneous state.
If not, the simulation cannot be continued and <a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a> or <a href="#fmi3Reset"><code>fmi3Reset</code></a> <span class="underline">must</span> be called afterwards.
<em>[Typically, <code>fmi3Error</code> return is for non-numerical reasons, like "disk full".</em>
<em>There may be cases where the environment can fix such errors (possibly with the help of the user), and the simulation can continue at the last consistent state set with <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>.]</em><br>
Further processing is possible after this call; especially other FMU instances are not affected.
Function <a href="#logMessage"><code>logMessage</code></a> was called in the FMU (see below), and it is expected that this function has shown the prepared information message to the user.</p>
</dd>
<dt class="hdlist1"><code>fmi3Fatal</code></dt>
<dd>
<p>the model computations are irreparably corrupted for all FMU instances.
<em>[For example, due to a run-time exception such as access violation or integer division by zero during the execution of an fmi function]</em>.
Function <a href="#logMessage"><code>logMessage</code></a> was called in the FMU (see below), and it is expected that this function has shown the prepared information message to the user.
It is not possible to call any other function for any of the FMU instances.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="inquire-platform-and-version-number">2.1.4. Inquire Platform and Version Number of Header Files</h4>
<div class="paragraph">
<p>This section documents functions to inquire information about the header files used to compile its functions.</p>
</div>
<div id="fmi3GetVersion" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef const char* fmi3GetVersionTYPE(void);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns the version of the <code>fmi3Functions.h</code> header file which was used to compile the functions of the FMU.
The function returns <code>fmi3Version</code> which is defined in this header file.
The standard header file as documented in this specification has version <code>"3.0"</code> (so this function usually returns <code>"3.0"</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="creation-destruction-and-logging">2.1.5. Creation, Destruction and Logging of FMU Instances</h4>
<div class="paragraph">
<p>This section documents functions that deal with instantiation, destruction and logging of FMUs.</p>
</div>
<div id="fmi3Instantiate" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Instance fmi3InstantiateModelExchangeTYPE(
    fmi3String                 instanceName,
    fmi3String                 instantiationToken,
    fmi3String                 resourceLocation,
    fmi3Boolean                visible,
    fmi3Boolean                loggingOn,
    fmi3InstanceEnvironment    instanceEnvironment,
    fmi3CallbackLogMessage     logMessage,
    fmi3CallbackAllocateMemory allocateMemory,
    fmi3CallbackFreeMemory     freeMemory);

typedef fmi3Instance fmi3InstantiateBasicCoSimulationTYPE(
    fmi3String                     instanceName,
    fmi3String                     instantiationToken,
    fmi3String                     resourceLocation,
    fmi3Boolean                    visible,
    fmi3Boolean                    loggingOn,
    fmi3Boolean                    intermediateVariableGetRequired,
    fmi3Boolean                    intermediateInternalVariableGetRequired,
    fmi3Boolean                    intermediateVariableSetRequired,
    fmi3InstanceEnvironment        instanceEnvironment,
    fmi3CallbackLogMessage         logMessage,
    fmi3CallbackAllocateMemory     allocateMemory,
    fmi3CallbackFreeMemory         freeMemory,
    fmi3CallbackIntermediateUpdate intermediateUpdate);

typedef fmi3Instance fmi3InstantiateHybridCoSimulationTYPE(
    fmi3String                     instanceName,
    fmi3String                     instantiationToken,
    fmi3String                     resourceLocation,
    fmi3Boolean                    visible,
    fmi3Boolean                    loggingOn,
    fmi3Boolean                    intermediateVariableGetRequired,
    fmi3Boolean                    intermediateInternalVariableGetRequired,
    fmi3Boolean                    intermediateVariableSetRequired,
    fmi3InstanceEnvironment        instanceEnvironment,
    fmi3CallbackLogMessage         logMessage,
    fmi3CallbackAllocateMemory     allocateMemory,
    fmi3CallbackFreeMemory         freeMemory,
    fmi3CallbackIntermediateUpdate intermediateUpdate);

typedef fmi3Instance fmi3InstantiateScheduledCoSimulationTYPE(
    fmi3String                     instanceName,
    fmi3String                     instantiationToken,
    fmi3String                     resourceLocation,
    fmi3Boolean                    visible,
    fmi3Boolean                    loggingOn,
    fmi3Boolean                    intermediateVariableGetRequired,
    fmi3Boolean                    intermediateInternalVariableGetRequired,
    fmi3Boolean                    intermediateVariableSetRequired,
    fmi3InstanceEnvironment        instanceEnvironment,
    fmi3CallbackLogMessage         logMessage,
    fmi3CallbackAllocateMemory     allocateMemory,
    fmi3CallbackFreeMemory         freeMemory,
    fmi3CallbackIntermediateUpdate intermediateUpdate,
    fmi3CallbackLockPreemption     lockPreemption,
    fmi3CallbackUnlockPreemption   unlockPreemption);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function returns a new instance of an FMU.
If a null pointer is returned, then instantiation failed.
In that case, <code>functions&#8594;logMessage</code> is called with detailed information about the reason.
An FMU can be instantiated many times (provided capability flag <code>canBeInstantiatedOnlyOncePerProcess = false</code>).</p>
</div>
<div class="paragraph">
<p>This function must be called successfully before any of the following functions can be called.</p>
</div>
<div class="paragraph">
<p>Argument <code>instanceName</code> is a unique identifier for the FMU instance.
It is used to name the instance, for example, in error or information messages generated by one of the <code>fmi3XXX</code> functions.
It is not allowed to provide a null pointer and this string must be non-empty (in other words, must have at least one character that is no white space).
<em>[If only one FMU is simulated, as <code>instanceName</code> attribute <code>modelName</code> or <code>&lt;ModelExchange/CoSimulation modelIdentifier=".."&gt;</code> from the XML schema <code>fmi3ModelDescription</code> might be used.]</em></p>
</div>
<div class="paragraph">
<p>Argument <code>fmuType</code> defines the type of the FMU:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3ModelExchange</code></dt>
<dd>
<p>FMU with initialization and events; between events simulation of continuous systems is performed with external integrators from the environment (see <a href="#fmi-for-model-exchange">Section 3</a>).
The modelDescription has to include the Element with name <code>ModelExchange</code> to be allowed to set the <code>fmuType</code> to <code>fmi3ModelExchange</code>.</p>
</dd>
<dt class="hdlist1"><code>fmi3CoSimulation</code></dt>
<dd>
<p>Black box interface for Basic Co-Simulation (see <a href="#fmi-for-basic-co-simulation">Section 4</a>).
The modelDescription has to include the Element with name <code>CoSimulation</code> to be allowed to set the <code>fmuType</code> to <code>fmi3CoSimulation</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Argument <code>fmuInstantiationToken</code> can be used by the FMU to check that the <code>modelDescription.xml</code> file (see <a href="#fmu-distribution">Section 2.3</a>) is compatible with the implementation of the FMU.
It is an opaque string generated by the FMU exporter that is stored in the xml file as mandatory attribute instantiationToken (see <a href="#fmiModelDescription">Section 2.2.1</a>).
It must be passed unchanged to the FMU, this argument must not be null.</p>
</div>
<div class="paragraph">
<p>Argument <code>fmuResourceLocation</code> is a URI according to the <a href="http://datatracker.ietf.org/doc/rfc3986/">IETF RFC3986</a> syntax to indicate the location to the <code>resources</code> directory of the unzipped FMU archive.
The following schemes must be understood by the FMU:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mandatory: <code>file</code> with absolute path (either including or omitting the authority component)</p>
</li>
<li>
<p>Optional: <code>http</code>, <code>https</code>, <code>ftp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[Example: An FMU is unzipped in directory <code>C:\temp\MyFMU</code>, then <code>fmuResourceLocation</code> = <code><a href="file:///C:/temp/MyFMU/resources" class="bare">file:///C:/temp/MyFMU/resources</a></code> or <code>file:/C:/temp/MyFMU/resources</code>.</em>
<em>Function <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a> is then able to read all needed resources from this directory, for example maps or tables used by the FMU.]</em></p>
</div>
<div class="paragraph">
<p>Argument <code>functions</code> provides callback functions to be used from the FMU functions to utilize resources from the environment (see type <a href="#fmi3CallbackFunctions"><code>fmi3CallbackFunctions</code></a> below).</p>
</div>
<div class="paragraph">
<p>Argument <code>visible = fmi3False</code> defines that the interaction with the user should be reduced to a minimum (no application window, no plotting, no animation, etc.).
In other words, the FMU is executed in batch mode.
If <code>visible = fmi3True</code>, the FMU is executed in interactive mode, and the FMU might require to explicitly acknowledge start of simulation / instantiation / initialization (acknowledgment is non-blocking).</p>
</div>
<div class="paragraph">
<p>If <code>loggingOn = fmi3False</code>, then any logging is disabled and the logger function is not called by the FMU.
If <code>loggingOn = fmi3True</code>, the FMU enables a vendor defined set of LogCategories.
This set should typically contain categories for messages that explain execution errors, like <code>fmi3Discard</code>, <code>fmi3Error</code> and <code>fmi3Fatal</code>.
The function <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a> gives more detailed control about required LogCategories (see <a href="#definition-of-log-categories">Section 2.2.5</a>).</p>
</div>
<div class="paragraph">
<p>Argument <code>fmuCoSimulationConfiguration</code> is used to configure Co-Simulation features used by the Co-Simulation master.
It is only used if <code>fmuType = fmi3CoSimulation</code>.
It is NULL for fmuType <code>fmi3ModelExchange</code>.</p>
</div>
<div id="fmi3CallbackFunctions" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef void  (*fmi3CallbackLogMessage)     (fmi3InstanceEnvironment instanceEnvironment,
                                             fmi3String instanceName,
                                             fmi3Status status,
                                             fmi3String category,
                                             fmi3String message);
typedef void* (*fmi3CallbackAllocateMemory) (fmi3InstanceEnvironment instanceEnvironment,
                                             size_t nobj,
                                             size_t size);
typedef void  (*fmi3CallbackFreeMemory)     (fmi3InstanceEnvironment instanceEnvironment,
                                             void* obj);</code></pre>
</div>
</div>
<div class="paragraph">
<p>These function pointers are provided by the environment to be used by the FMU.
It is not allowed to change these functions between <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a> and <a href="#fmi3Terminate"><code>fmi3Terminate</code></a> calls.
Additionally, a pointer to the environment is provided (instanceEnvironment) that needs to be passed to all of the callback functions, in order that those functions can utilize data from the environment, such as mapping a <a href="#valueReference"><code>valueReference</code></a> to a string, or assigning memory to a certain FMU instance.</p>
</div>
<div class="paragraph">
<p>The <code>instanceEnvironment</code> pointer is also passed to the <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> function in order that the environment can provide an efficient way to identify the slave that called <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>.</p>
</div>
<div class="paragraph">
<p>In the default <code>fmi3FunctionTypes.h</code> file, typedefs for the function definitions are present to simplify the usage; this is non-normative.
The functions have the following meaning:</p>
</div>
<div id="logMessage" class="dlist">
<dl>
<dt class="hdlist1">Function <code>logMessage</code></dt>
<dd>
<p>Pointer to a function that is called in the FMU, usually if an <code>fmi3XXX</code> function does not behave as desired.
If <a href="#logMessage"><code>logMessage</code></a> is called with <code>status = fmi3OK</code>, then the message is a pure information message.
<code>instanceName</code> is the instance name of the model that calls this function.
<code>category</code> is the category of the message.
The meaning of <code>category</code> is defined by the modeling environment that generated the FMU.
Depending on this modeling environment, none, some or all allowed values of <code>category</code> for this FMU are defined in the <code>modelDescription.xml</code> file via element <code>&lt;fmiModelDescription&gt;&lt;LogCategories&gt;</code>, see <a href="#definition-of-log-categories">Section 2.2.5</a>.
Only messages are provided by function <a href="#logMessage"><code>logMessage</code></a> that have a category according to a call to <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a> (see below).
Argument <code>message</code> is a string that contains the message.
<em>[Typically, this function prints the message and stores it optionally in a log file.]</em></p>
<div class="paragraph">
<p>All string-valued arguments passed by the FMU to the <a href="#logMessage"><code>logMessage</code></a> may be deallocated by the FMU directly after function <a href="#logMessage"><code>logMessage</code></a> returns.
The environment must therefore create copies of these strings if it needs to access these strings later.<br>
The <a href="#logMessage"><code>logMessage</code></a> function will append a line break to each message when writing messages after each other to a terminal or a file (the messages may also be shown in other ways, for example, as separate text-boxes in a GUI).
The caller may include line-breaks (using "\n") within the message, but should avoid trailing line breaks.<br>
Variables can be referenced in a message with <code>#&lt;ValueReference&gt;#</code>.
If the character <code>#</code> shall be included in the message, it has to be prefixed with <code>#</code>, so <code>#</code> is an escape character.</p>
</div>
<div class="paragraph">
<p><em>[Example: The message <code>#1365# must be larger than zero (used in IO channel ##4)</code> might be changed by the <a href="#logMessage"><code>logMessage</code></a> function to <code>body.m must be larger than zero (used in IO channel #4)</code> if <code>body.m</code> is the name of the variable with value reference 1365.]</em></p>
</div>
</dd>
</dl>
</div>
<div id="allocateMemory" class="dlist">
<dl>
<dt class="hdlist1">Function <code>allocateMemory</code></dt>
<dd>
<p>Pointer to a function that is called in the FMU if memory needs to be allocated.
If attribute <code>canNotUseMemoryManagementFunctions = true</code> in <code>&lt;fmiModelDescription&gt;&lt;ModelExchange / CoSimulation&gt;</code>, then function <a href="#allocateMemory"><code>allocateMemory</code></a> is not used in the FMU and a null pointer can be provided.
If this attribute has a value of <code>false</code> (which is the default), the FMU must not use <code>malloc</code>, <code>calloc</code> or other memory allocation functions.
One reason is that these functions might not be available for embedded systems on the target machine.
Another reason is that the environment may have optimized or specialized memory allocation functions.
<a href="#allocateMemory"><code>allocateMemory</code></a> returns a pointer to space for a vector of <code>nobj</code> objects, each of size <code>size</code> or <code>NULL</code>, if the request cannot be satisfied.
The space is initialized to zero bytes <em>[(a simple implementation is to use <code>calloc</code> from the C standard library)]</em>.</p>
</dd>
</dl>
</div>
<div id="freeMemory" class="dlist">
<dl>
<dt class="hdlist1">Function <code>freeMemory</code></dt>
<dd>
<p>Pointer to a function that must be called in the FMU if memory is freed that has been allocated with <a href="#allocateMemory"><code>allocateMemory</code></a>.
If a null pointer is provided as input argument <code>obj</code>, the function shall perform no action <em>[(a simple implementation is to use free from the C standard library; in ANSI C89 and C99, the null pointer handling is identical as defined here)]</em>.
If attribute <code>canNotUseMemoryManagementFunctions = true</code> in <code>&lt;fmiModelDescription&gt;&lt;ModelExchange / CoSimulation&gt;</code>, then function <a href="#freeMemory"><code>freeMemory</code></a> is not used in the FMU and a null pointer can be provided.</p>
</dd>
</dl>
</div>
<div id="intermediateUpdate" class="dlist">
<dl>
<dt class="hdlist1">Function <code>intermediateUpdate</code></dt>
<dd>
<p>This callback allows internal events of different types (e.g. associated to <a href="#outputClock"><code>output clock</code></a> ticks or intermediate variable access) to be signaled from an FMU to the Co-Simulation master.
For Hybrid Co-Simulation and Scheduled Co-Simulation or if any of the intermediate variable access modes is set to <code>true</code>, the callback function <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> must be passed to <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>.
In other cases a <code>NULL</code> can be assigned to the <code>intermediateUpdate</code> callback.</p>
</dd>
<dt class="hdlist1">Function <code>lockPreemption</code> and <code>unlockPreemption</code></dt>
<dd>
<p>To provide more options to secure the code against unwanted preemption these callback functions are defined.
They can be used to prevent preemption for certain code parts enclosed by <code>lockPreemption</code> and <code>unlockPreemption</code> in Scheduled Co-Simulation.
Even if the Co-Simulation master does not support preemption, at least an empty implementation of these callback functions must be provided to allow the reuse of code for different modes together with an efficient preemption.</p>
</dd>
</dl>
</div>
<div id="fmi3FreeInstance" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef void fmi3FreeInstanceTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Disposes the given instance, unloads the loaded model, and frees all the allocated memory and other resources that have been allocated by the functions of the FMU interface.
If a null pointer is provided for <code>c</code>, the function call is ignored (does not have an effect).</p>
</div>
<div id="fmi3SetDebugLogging" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status  fmi3SetDebugLoggingTYPE(fmi3Instance instance,
                                            fmi3Boolean loggingOn,
                                            size_t nCategories,
                                            const fmi3String categories[]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function controls debug logging that is output via the logger function callback.</p>
</div>
<div class="paragraph">
<p>If <code>loggingOn = fmi3True</code>, debug logging is enabled, otherwise it is switched off.
If <code>loggingOn = fmi3True</code> and <code>nCategories = 0</code>, then all debug messages shall be output.
If <code>loggingOn = fmi3True</code> and <code>nCategories &gt; 0</code>, then only debug messages according to the <code>categories</code> argument shall be printed via the <a href="#logMessage"><code>logMessage</code></a> function.
Vector <code>categories</code> has <code>nCategories</code> elements.
The allowed values of <code>categories</code> are defined by the modeling environment that generated the FMU.
Depending on the generating modeling environment, none, some or all allowed values for <code>categories</code> for this FMU are defined in the <code>modelDescription.xml</code> file via element <code>fmiModelDescription.LogCategories</code>, see <a href="#definition-of-log-categories">Section 2.2.5</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_initialization_termination_and_resetting_an_fmu">2.1.6. Configuration, Initialization, Termination, and Resetting an FMU</h4>
<div class="paragraph">
<p>This section documents functions that deal with configuration, initialization, termination, and resetting of an FMU.</p>
</div>
<div id="fmi3SetupExperiment" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SetupExperimentTYPE(fmi3Instance instance,
                                           fmi3Boolean toleranceDefined,
                                           fmi3Float64 tolerance,
                                           fmi3Float64 startTime,
                                           fmi3Boolean stopTimeDefined,
                                           fmi3Float64 stopTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Informs the FMU to setup the experiment.
This function must be called after <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a> and before <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> is called.
Arguments <code>toleranceDefined</code> and <code>tolerance</code> depend on the FMU type:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fmuType = fmi3ModelExchange</code></dt>
<dd>
<p>If <code>toleranceDefined = fmi3True</code>, then the model is called with a numerical integration scheme where the step size is controlled by using <code>tolerance</code> for error estimation (usually as relative 'tolerance').
In such a case all numerical algorithms used inside the model (for example, to solve non-linear algebraic equations) should also operate with an error estimation of an appropriate smaller relative tolerance.</p>
</dd>
<dt class="hdlist1"><code>fmuType = fmi3CoSimulation</code></dt>
<dd>
<p>If <code>toleranceDefined = fmi3True</code>, then the communication step size of the slave is controlled by error estimation.
In case the slave utilizes a numerical integrator with variable step size and error estimation, it is suggested to use <code>tolerance</code> for the error estimation of the internal integrator (usually as relative tolerance).<br>
An FMU for Co-Simulation might ignore this argument.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The arguments <code>startTime</code> and <code>stopTime</code> can be used to check whether the model is valid within the given boundaries or to allocate memory which is necessary for storing results.
Argument <code>startTime</code> is the <a href="#fixed"><code>fixed</code></a> <a href="#initial"><code>initial</code></a> value of the <a href="#independent"><code>independent</code></a> variable <em>[(that is defined with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a> in the <code>modelDescription.xml</code>]</em>). <em>[If the <a href="#independent"><code>independent</code></a> variable is <code>time</code>, <code>startTime</code> is the starting time of initializaton.]</em>
If <code>stopTimeDefined = fmi3True</code>, then <code>stopTime</code> is the defined final value of the <a href="#independent"><code>independent</code></a> variable.
<em>[If the <a href="#independent"><code>independent</code></a> variable is <code>time</code>, <code>stopTime</code> is the stop time of the simulation.]</em>
If the environment tries to compute past <code>stopTime</code> the FMU has to return <code>fmi3Status = fmi3Error</code>.
If <code>stopTimeDefined = fmi3False</code>, then no final value of the <a href="#independent"><code>independent</code></a> variable is defined and argument <code>stopTime</code> is meaningless.</p>
</div>
<div id="fmi3EnterConfigurationMode" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3EnterConfigurationModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Informs the FMU to enter the <strong>Configuration Mode</strong> or <strong>Reconfiguration Mode</strong>.</p>
</div>
<div id="fmi3ExitConfigurationMode" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3ExitConfigurationModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Informs the FMU to exit the <strong>Configuration Mode</strong> or <strong>Reconfiguration Mode</strong>.</p>
</div>
<div id="fmi3EnterInitializationMode" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3EnterInitializationModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Informs the FMU to enter <strong>Initialization Mode</strong>.
Before calling this function, all variables with attribute <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a> can be set with the <code>fmi3Set{VariableType}</code> functions (the variable attributes are defined in the Model Description File, see <a href="#definition-of-model-variables">Section 2.2.10</a>).
Setting other variables is not allowed.
Furthermore, <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a> must be called at least once before calling <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, in order that <code>startTime</code> is defined.</p>
</div>
<div id="fmi3ExitInitializationMode" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3ExitInitializationModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Informs the FMU to exit <strong>Initialization Mode</strong>.
For <code>fmuType = fmi3ModelExchange</code>, this function switches off all initialization equations, and the FMU enters <strong>Event Mode</strong> implicitly; that is, all continuous-time and active discrete-time equations are available.</p>
</div>
<div id="fmi3Terminate" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3TerminateTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Informs the FMU that the simulation run is terminated.
After calling this function, the final values of all variables can be inquired with the <code>fmi3Get{VariableType}</code> functions.
It is not allowed to call this function after one of the functions returned with a status flag of <code>fmi3Error</code> or <code>fmi3Fatal</code>.</p>
</div>
<div id="fmi3Reset" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3ResetTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Is called by the environment to reset the FMU after a simulation run.
The FMU goes into the same state as if <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a> would have been called.
All variables have their default values.
Before starting a new run, <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a> and <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> have to be called.</p>
</div>
</div>
<div class="sect3">
<h4 id="get-and-set-variable-values">2.1.7. Getting and Setting Variable Values</h4>
<div class="paragraph">
<p>All variables of an FMU are identified with a handle called "value reference".
The handle is defined in the <code>modelDescription.xml</code> file as attribute <a href="#valueReference"><code>valueReference</code></a> in variable elements.
Each variable must have a unique <a href="#valueReference"><code>valueReference</code></a>.</p>
</div>
<div class="paragraph">
<p>Variables can be scalar or array variables.
When getting or setting the values of array variables, the serialization of array variable values used in C-API function calls, as well as in the XML <a href="#start"><code>start</code></a> attributes is defined as row major - i.e. dimension order from left to right for the C-API (e.g. <code>array[dim1][dim2]&#8230;&#8203;[dimN]</code>), and document order in the XML attributes.
For this serialization of array variables the sparsity pattern of the array is not taken into account.
All elements of the array, including structural zeros, are serialized.</p>
</div>
<div class="paragraph">
<p><em>[Example: A 2D matrix</em></p>
</div>
<div class="stemblock">
<div class="content">
\[A = \left( \begin{array}{cc} a_{11}&amp;a_{12}\\
                             a_{21}&amp;a_{22}\\
                             a_{31}&amp;a_{32}\\
            \end{array} \right)\]
</div>
</div>
<div class="paragraph">
<p><em>is serialized as follows:</em></p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[0][0]=a11</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[0][1]=a12</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+1</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[1][0]=a21</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+2</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[1][1]=a22</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+3</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[2][0]=a31</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+4</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[2][1]=a32</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+5</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>The actual values of the variables that are defined in the <code>modelDescription.xml</code> file can be inquired after calling <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> with the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetFloat32TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Float32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetFloat64TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Float64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt8TYPE   (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt8TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt16TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt16TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt32TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt32TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetInt64TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Int64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetUInt64TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3UInt64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetBooleanTYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3Boolean values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetStringTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      fmi3String values[],
                                      size_t nValues);

typedef fmi3Status fmi3GetBinaryTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      size_t sizes[],
                                      fmi3Binary values[],
                                      size_t nValues);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Get actual values of variables by providing their variable references.
<em>[These functions are especially used to get the actual values of output variables if a model is connected with other models.
Since state derivatives are also variables, it is possible to get the value of a state derivative.
This is useful when connecting FMUs together.
Furthermore, the actual value of every variable defined in the <code>modelDescription.xml</code> file can be determined at the actually defined time instant (see <a href="#definition-of-model-variables">Section 2.2.10</a>).]</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>valueReferences</code> is a vector of <code>nValueReferences</code> value handles that define the variables that shall be inquired.</p>
</li>
<li>
<p>Argument <code>values</code> is a vector with the actual values of these variables.</p>
</li>
<li>
<p>Argument <code>sizes</code> is a vector with the actual sizes of the values for binary variables.</p>
</li>
<li>
<p>Argument <code>nValues</code> provides the number of values in the <code>values</code> vector (and <code>sizes</code> vector, where applicable) which is only equal to <code>nValueReferences</code> if all <a href="#valueReference"><code>valueReference</code></a>s point to scalar variables.</p>
</li>
<li>
<p>The strings returned by <code>fmi3GetString</code>, as well as the binary values returned by <code>fmi3GetBinary</code>, must be copied in the target environment because the allocated memory for these strings might be deallocated by the next call to any of the fmi3 interface functions or it might be an internal string buffer that is reused.</p>
</li>
<li>
<p>For Model Exchange: <code>fmi3Status = fmi3Discard</code> is possible for <code>fmi3GetFloat32</code> and <code>fmi3GetFloat64</code> only, but not for <code>fmi3Get*Int*</code>, <code>fmi3GetBoolean</code>, <code>fmi3GetString</code>, <code>fmi3GetBinary</code>, because these are discrete-time variables and their values can only change at an event instant where <code>fmi3Discard</code> does not make sense.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to set the values of certain variables at particular instants in time using the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SetFloat32TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Float32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetFloat64TYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Float64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt8TYPE   (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt8TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt8 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt16TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt16TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt16 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt32TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt32TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt32 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetInt64TYPE  (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Int64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetUInt64TYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3UInt64 values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetBooleanTYPE(fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3Boolean values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetStringTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const fmi3String values[],
                                      size_t nValues);

typedef fmi3Status fmi3SetBinaryTYPE (fmi3Instance instance,
                                      const fmi3ValueReference valueReferences[],
                                      size_t nValueReferences,
                                      const size_t sizes[],
                                      const fmi3Binary values[],
                                      size_t nValues);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set <a href="#parameter"><code>parameters</code></a>, <a href="#input"><code>inputs</code></a>, and <a href="#start"><code>start</code></a> values, and re-initialize caching of variables that depend on these variables (see <a href="#definition-of-model-variables">Section 2.2.10</a> for the exact rules on which type of variables <code>fmi3Set{VariableType}</code> can be called, as well as <a href="#state-machine-model-exchange">Section 3.2.3</a> in case of Model Exchange and <a href="#state-machine-co-simulation">Section 4.2.4</a> in case of Co-Simulation).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>valueReferences</code> is a vector of <code>nValueReferences</code> value handles that define the variables that shall be set.</p>
</li>
<li>
<p>Argument <code>values</code> is a vector with the actual values of these variables.</p>
</li>
<li>
<p>Argument <code>sizes</code> is a vector with the actual sizes of the values of binary variables.</p>
</li>
<li>
<p>Argument <code>nValues</code> provides the number of values in the <code>values</code> vector (and <code>sizes</code> vector, where applicable) which is only equal to <code>nValueReferences</code> if all <a href="#valueReference"><code>valueReference</code></a>s point to scalar variables.</p>
</li>
<li>
<p>All strings passed as arguments to <code>fmi3SetString</code>, as well as all binary values passed as arguments to <code>fmi3SetBinary</code>, must be copied inside these functions, because there is no guarantee of the lifetime of strings or binary values, when these functions return.</p>
</li>
<li>
<p>Note, <code>fmi3Status = fmi3Discard</code> is possible for the <code>fmi3Set{VariableType}</code> functions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Co-Simulation FMUs, additional functions are defined in <a href="#transfer-of-input-output-and-parameters">Section 4.2.1</a> to set and inquire <a href="#derivative"><code>derivatives</code></a> of variables with respect to time in order to allow interpolation.</p>
</div>
<div class="paragraph">
<p>The value of a variable may only be accessed with the respective <code>fmi3Get/Set{VariableType}</code> for its type.</p>
</div>
</div>
<div class="sect3">
<h4 id="operation-on-clocks">2.1.8. Operation on Clocks</h4>
<div class="paragraph">
<p>In the following section the operations on <a href="#clock"><code>clocks</code></a> are described.
Clocks are defined for the evaluation of <strong>clocked model partitions</strong> and the related definition of suitable <strong>communication points</strong>.
Two types of <a href="#clock"><code>clocks</code></a> are available, designed to address similar use cases with differences in details.
One <a href="#clock"><code>clock</code></a> type (Synchronous Clocks) complies with the limitations imposed by the synchronous clock theory, the other clock type (Communication Point Clocks) is a general purpose co-simulation clock for providing suitable communication points for the timed evaluation of model partitions.
The term <a href="#clock"><code>clock</code></a> and clocked is therefore used for both <a href="#clock"><code>clock</code></a> types.
Both clock types can handle two different variants, the <a href="#inputClock"><code>input clocks</code></a> and the <a href="#outputClock"><code>output clocks</code></a>.
First the two different clock types are presented with the mathematical definition of their use cases.
After that the two clock variants are described. The section ends with a short description of connecting clocked FMUs.</p>
</div>
<div class="sect4">
<h5 id="clock-types-for-evaluation-of-clocked-model-partitions">2.1.8.1. Clock Types for Evaluation of Clocked Model Partitions</h5>
<div class="sect5">
<h6 id="_synchronous_clocks">2.1.8.1.1. Synchronous Clocks</h6>
<div class="paragraph">
<p>A set of equations that are associated to a <a href="#clock"><code>clock</code></a> and are executed when the corresponding <a href="#clock"><code>clock</code></a> is active, is called a clocked partition.
A clocked partition is mathematically defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\[x_j=\begin{cases}
    x_{j-1} &amp; \text{if subactive}\\
    f_j(x_{j-1},u_j,t_j) &amp; \text{else}
    \end{cases}\]
</div>
</div>
<div class="stemblock">
<div class="content">
\[y_j=g_j(x_{j-1},u_j,t_j);\]
</div>
</div>
<div class="stemblock">
<div class="content">
\[\text{mit } j=0,1,2,...;x_{-1}=x_{start}\]
</div>
</div>
<div class="paragraph">
<p>Variables \(x_j\) are called <code>states of a clocked partition</code>, or <code>discrete-time states</code> and \(j\) is the \(j+1\)th tick of the associated <a href="#clock"><code>clock</code></a>.
Variables \(u_j\) are the (external or <a href="#local"><code>local</code></a>) <a href="#input"><code>inputs</code></a> and \(y_j\) are the (external or <a href="#local"><code>local</code></a>) <a href="#output"><code>outputs</code></a> of a clocked partition.
A discrete-time <a href="#state"><code>state</code></a> can be from any type of a variable (with exception of a <a href="#clock"><code>clock</code></a>) such as of type <code>fmi3Float64</code> or <code>fmi3Boolean</code>.
A clocked partition is not executed during <strong>Initialization Mode</strong>, but it is executed the first time at its first <a href="#clock"><code>clock</code></a> tick.
The associated <a href="#clock"><code>clock</code></a> of the model partion is synchronous to its discrete-time <a href="#state"><code>states</code></a>.
Discrete-time <a href="#state"><code>states</code></a> are listed in the ModelStructure and have the variable xml-attribute <a href="#previous"><code>previous</code></a> referring to the variable holding the previous value of the <a href="#state"><code>state</code></a>.
They can have initial values defined by xml-attributes <a href="#initial"><code>initial</code></a> and <a href="#start"><code>start</code></a>, or the initial values are computed internally as a function of parameters.</p>
</div>
<div class="paragraph">
<p>There are two kinds of evaluation modes:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Regular evaluation for an active <a href="#clock"><code>clock</code></a>: <a href="#state"><code>state</code></a> and <a href="#output"><code>output</code></a> equations are evaluated.
States get updated.</p>
</li>
<li>
<p>Partly evaluation for a subactive <a href="#clock"><code>clock</code></a>: <a href="#state"><code>states</code></a> are left unmodified.
<em>[Modelica uses this mode for the first tick in clocked continuous equations.</em>
<em>This mode can also be requested by the calling environment with <a href="#fmi3SetClock"><code>fmi3SetClock</code></a>, e.g. to form partial derivatives</em> \(\partial y_j / \partial x_{j-1}\) <em>.]</em></p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_communication_point_clocks">2.1.8.1.2. Communication Point Clocks</h6>
<div class="paragraph">
<p>In addition to the above definition also a simplified <a href="#clock"><code>clock</code></a> definition used only in FMI for Basic Co-Simulation is available that can be used to define the communication points of model partitions of the model (in the following such partitions are called model partitions).
Such <a href="#clock"><code>clocks</code></a> are called Communication Point Clocks.
These <a href="#clock"><code>clocks</code></a> are not compatible to synchronous clocks theory and must not be used together with synchronous clocks in one model.</p>
</div>
<div class="paragraph">
<p>A model partition is mathematically defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\[x_j=f_j(x_{j-1},u_j,t_j)\]
</div>
</div>
<div class="stemblock">
<div class="content">
\[y_j=g_j(x_{j-1},u_j,t_j)\]
</div>
</div>
<div class="paragraph">
<p>Communication Point Clocks can also be defined for continuous or piecewise continuous parts of the model.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="variants-of-clocks">2.1.8.2. Variants of Clocks</h5>
<div class="paragraph">
<p>This section gives a definition of the two clock variants.</p>
</div>
<div class="sect5">
<h6 id="_output_clocks">2.1.8.2.1. Output Clocks</h6>
<div class="paragraph">
<p>An <a href="#outputClock"><code>output clock</code></a> is a general <a href="#clock"><code>clock</code></a> that ticks when a time-, state- or step-event occurs in the continuous-model partition of the FMU (for Communication Point Clocks these <a href="#outputClock"><code>output clock</code></a> tick events can occour in all model partitions) and are identified based on their <a href="#clockReference"><code>clockReference</code></a> (see <a href="#operation-on-clocks">Section 2.1.8</a>).
It can be periodic or non-periodic.
<em>[Example: If</em> \(b = x &gt; 0\) <em>, and a state event is defined when b changes from <code>false</code> to <code>true</code>, and b is defined as <a href="#outputClock"><code>output clock</code></a>, then this <a href="#clock"><code>clock</code></a> is active whenever x changes from negative to positive values.]</em></p>
</div>
<div class="paragraph">
<p>Since <a href="#outputClock"><code>output clocks</code></a> are ticking based on model internal information it is required in case of FMI for Co-Simulation to signal the ticking of an <a href="#outputClock"><code>output clock</code></a> to the simulation environment during a <code>fmi3DoStep</code> computation.
In most cases the signaling of an <a href="#outputClock"><code>output clock</code></a> tick is a <code>strong event</code> that requires creating a communication point for exchanging additional information (i.e. variable values) with the simulation environment.
Additional cases need to be handled if a <a href="#clock"><code>clock</code></a> tick is not associated to an event that requires the creation of a communication point for the model partition that generated the event.</p>
</div>
<div class="paragraph">
<p><em>[Outside of the FMU it is not known in advance when this <a href="#clock"><code>clock</code></a> ticks.</em>
<em>Instead, only when the <a href="#clock"><code>clock</code></a> is activated by the FMU, then the environment is informed that the <a href="#clock"><code>clock</code></a> ticks at this time instant.</em>
<em>It is the task of the environment to handle the messaged events appropriately based on the <a href="#clockReference"><code>clockReference</code></a> information.</em>
<em>Example:</em>
<em>]</em></p>
</div>
</div>
<div class="sect5">
<h6 id="_input_clocks">2.1.8.2.2. Input Clocks</h6>
<div class="paragraph">
<p>An <a href="#inputClock"><code>input clock</code></a> is a periodic or non-periodic <a href="#clock"><code>clock</code></a> that is defined directly or indirectly by a <a href="#clock"><code>clock</code></a> outside of the FMU.
Its interval is initialized by the environment.</p>
</div>
<div class="paragraph">
<p><em>[Inside of the FMU it is not known in advance when this <a href="#clock"><code>clock</code></a> ticks.</em>
<em>Instead, only when the <a href="#clock"><code>clock</code></a> is activated by the environment of the FMU, then the FMU is informed that the <a href="#clock"><code>clock</code></a> ticks at this time instant.</em>
<em>Example:</em>
<em>A clocked PI controller can be defined as an FMU and the input and output signal of the controller can be defined to be on the same <a href="#inputClock"><code>input clock</code></a>.</em>
<em>In such a case, the environment deduces the <a href="#clock"><code>clock</code></a> ticks from the components that are connected to the PI controller (e.g. a component connected to the input, or to the output may define the relevant <a href="#clock"><code>clock</code></a>).]</em></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="additional-clock-properties">2.1.8.3. Additional Clock Properties</h5>
<div class="paragraph">
<p>This section gives a definition of additional clock properties.</p>
</div>
<div class="sect5">
<h6 id="_periodic_clock_ticks">2.1.8.3.1. Periodic Clock Ticks</h6>
<div class="paragraph">
<p>Either <a href="#output"><code>output</code></a> or <a href="#input"><code>input</code></a>, a periodic <a href="#clock"><code>clock</code></a> ticks at equidistant sample time points that are known a priori (defined in <code>modelDescription.xml</code>) or are alternatively determined by the environment in case of <a href="#inputClock"><code>input clocks</code></a>.
Mathematically, the next <a href="#clock"><code>clock</code></a> tick at time instant ti is defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}
t_0 &amp;:= t_{start} + t_{offset} \\
t_i &amp;:= t_{i-1} + \Delta T, i = 1,2,3,{...}
\end{align*}\]
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_0\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time instant in seconds at which the <a href="#clock"><code>clock</code></a> ticks the first time (= the base <a href="#clock"><code>clock</code></a> starts at the start of the simulation tstart or when the controller is switched on plus an offset time toffset (xml-attributes <code>shiftCounter</code> and <code>resolution</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_{i-1}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The previous time instant in seconds, where the <a href="#clock"><code>clock</code></a> ticked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\Delta T &gt; 0\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The constant time interval from the previous <a href="#clock"><code>clock</code></a> tick to the current <a href="#clock"><code>clock</code></a> tick.
It is defined as a rational number based on <code>intervalCounter</code> and <code>resolution</code> via <a href="#clock"><code>clock</code></a> variable attributes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The interval \(\Delta T\) and \(t_{offset}\) must be defined for periodic <a href="#clock"><code>clocks</code></a> in the XML file.
In case of periodic <a href="#inputClock"><code>input clocks</code></a> these values are the start interval values if they are not given by the simulation master.
<em>[This information can be used for emulating periodic <a href="#inputClock"><code>input clocks</code></a> in the interface <code>fmi3CoSimulation</code>]</em>.</p>
</div>
<div class="paragraph">
<p>If \(\Delta T\) is fixed for an FMU and cannot be changed it is a strictly periodic <a href="#clock"><code>clock</code></a>.
The <a href="#clock"><code>clock</code></a> is periodic, if \(\Delta T\) can be defined before calling <code>fmi3EnterInitializationMode</code> via <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> or <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a>.
The <a href="#clock"><code>clock</code></a> is aperiodic if \(\Delta T\) is not constant during a simulation run (<a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> or <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a> can be called for that <a href="#clock"><code>clock</code></a> during <strong>Event Mode</strong>).</p>
</div>
</div>
<div class="sect5">
<h6 id="_clock_priority">2.1.8.3.2. Clock Priority</h6>
<div class="paragraph">
<p>The <a href="#clock"><code>clocks</code></a> are ordered descending based on their priorities.
It is nevertheless possible to define multiple <a href="#clock"><code>clocks</code></a> with the same priority.
No ordering is defined for <a href="#clock"><code>clocks</code></a> of the same priority.
If a computational order information is needed, different priorities for <a href="#clock"><code>clocks</code></a> have to be defined.
The priority of a <a href="#clock"><code>clock</code></a> has to be defined in the <code>modelDescription.xml</code> via the <a href="#clock"><code>clock</code></a> variable integer attribute <code>priority</code> - smaller values have a higher priority.
For periodic <a href="#clock"><code>clocks</code></a> it is recommended to derive the priorities based on a rate monotonic scheduling scheme (smallest period leads to highest priority (smallest priority value)).</p>
</div>
<div class="paragraph">
<p>_[The clock priorities are local to an FMU.
It is not possible for an FMU exporting tool to know in advance the priorities of other FMUs that will be connected to an FMU in a simulation setup.
It is the task of the simulation master to derive a computational order for the computation of two or more distinct FMUs based on the local FMU clock priorities and input-output relationships of connected FMUs.</p>
</div>
<div class="paragraph">
<p>For real-time computation use cases i.e. in Scheduled Co-Simulation the priority information is used also for task preemption configurations.
It is therefore important to restrict the number of distinct priority levels for an FMU to available priority levels on the target platform.
A common number of different priority levels is e.g. 100 (0 to 99) as defined in Linux based operating systems.
Nevertheless, restricting the number of used distinct priority levels as much as possible is recommended to avoid unnecessary computational overhead.]_</p>
</div>
</div>
<div class="sect5">
<h6 id="clock-relationships-for-communication-point-clocks">2.1.8.3.3. Clock Relationships for Communication Point Clocks</h6>
<div class="paragraph">
<p>If <a href="#outputClock"><code>output clocks</code></a> and <a href="#inputClock"><code>input clocks</code></a> are defined it is possible to define a tick relationship from an <a href="#outputClock"><code>output clock</code></a> to an <a href="#inputClock"><code>input clock</code></a>.
This is needed to allow for an external resource management to achieve an optimal control of model partitions.
The <a href="#outputClock"><code>output clocks</code></a> and the associated <a href="#inputClock"><code>input clocks</code></a> define a union of <a href="#clock"><code>clocks</code></a>.
In that sense, if an <a href="#outputClock"><code>output clock</code></a> ticks the associated <a href="#inputClock"><code>input clock</code></a> ticks at the same time instant in such a union.
It is only meaningful to combine one or multiple <a href="#outputClock"><code>output clocks</code></a> with a single aperiodic <a href="#inputClock"><code>input clock</code></a> in such a union.
It is possible to define multiple unions of <a href="#clock"><code>clocks</code></a>, with the maximum number defined by the number of available aperiodic <a href="#inputClock"><code>input clocks</code></a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Input clock variant</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Output clock variant</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aperiodic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aperiodic, periodic, strictly periodic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">periodic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">strictly periodic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A clock union can be defined based on the <a href="#clockReference"><code>clockReference</code></a> attribute of <a href="#inputClock"><code>input clock</code></a> variables.</p>
</div>
<div id="ExampleUseCase" class="imageblock">
<div class="content">
<img src="images/example_usecase.png" alt="example usecase">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="connecting-clocked-fmus">2.1.8.4. Connecting Clocked FMUs</h5>
<div class="paragraph">
<p>When connecting imported FMUs together, <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a> variables can readily be connected together only when they are defined on a <a href="#clock"><code>clock</code></a> with identical properties.
If this is not possible, an explicit cast of one <a href="#clock"><code>clock</code></a> to another <a href="#clock"><code>clock</code></a> is typically defined in the environment.</p>
</div>
<div class="paragraph">
<p>The environment can evaluate required <a href="#clock"><code>clock</code></a> adaptions/casts for connections basing on the <a href="#clockReference"><code>clockReference</code></a> attribute of assigned variables <em>[i.e. the variables that are assigned to a <a href="#clock"><code>clock</code></a> based on <code>modelDescription.xml</code> information]</em>.</p>
</div>
<div class="paragraph">
<p><em>[Example: Elementary blocks like a PI controller will have all variables on an <a href="#inputClock"><code>input clock</code></a> with identical properties.</em>
<em>Connecting such blocks together will therefore be possible without computationally expensive clock cast operations (and the environment can readily do the computation of assigned variables of the connected blocks based on the same <a href="#clock"><code>clock</code></a>).]</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fmi-api-setting-getting-clock-activation-state">2.1.9. FMI Application Programming Interface for setting/getting Clock activation state</h4>
<div class="paragraph">
<p>A <a href="#clock"><code>clock</code></a> is activated by the environment for the current time instant by the function <a href="#fmi3SetClock"><code>fmi3SetClock</code></a>, and the status of a <a href="#clock"><code>clock</code></a> can be inquired with the function <a href="#fmi3GetClock"><code>fmi3GetClock</code></a>:</p>
</div>
<div id="fmi3SetClock" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SetClockTYPE(fmi3Instance instance,
                                    const fmi3ValueReference valueReferences[],
                                    size_t nValueReferences,
                                    const fmi3Clock values[],
                                    const fmi3Boolean subactive[]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sets the <a href="#clock"><code>clock</code></a> activation status by providing the value references of the corresponding <a href="#clock"><code>clock</code></a> variables and their values.
A <a href="#clock"><code>clock</code></a> with <a href="#valueReference"><code>valueReference</code></a>s[i] is activated at the current time instant if values[i] is set to <code>fmi3ClockActive</code>, otherwise the <a href="#clock"><code>clock</code></a> is deactivated.
The clocked partition is evaluated in subactive mode (only output equations) if the argument subactive is non NULL and <code>subactive[i] = fmi3True</code>.
The <a href="#parameter"><code>parameter</code></a> <code>subactive</code> has no meaning for Communication Point Clocks and is ignored for such <a href="#clock"><code>clocks</code></a>.
It is not allowed to call this function within the callback function <code>fmi3IntermediateUpdate()</code>.</p>
</div>
<div id="fmi3GetClock" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetClockTYPE(fmi3Instance instance,
                                    const fmi3ValueReference valueReferences[],
                                    size_t nValueReferences,
                                    fmi3Clock values[]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inquires whether a set of <a href="#clock"><code>clocks</code></a> is active by providing the value references of the corresponding <a href="#clock"><code>clock</code></a> varaibels.
A <a href="#clock"><code>clock</code></a> with <a href="#valueReference"><code>valueReference</code></a>s[i] is active at the current time instant if <code>values[i] = fmi3ClockActive</code>, otherwise the <a href="#clock"><code>clock</code></a> is not active. It is allowed to call this function within the callback function <code>fmi3IntermediateUpdate()</code>.
It is required for an FMU to directly internally set back the activation <a href="#state"><code>state</code></a> of an <a href="#outputClock"><code>output clock</code></a> \(i\) to <code>fmi3ClockInactive</code>, if the function <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> is called for a <a href="#clock"><code>clock</code></a> \(i\) and the interface is Scheduled Co-Simulation`.
<em>[This is required to allow preemption.]</em></p>
</div>
<div class="paragraph">
<p>A <a href="#clock"><code>clock</code></a> interval is set by the environment for the current time instant by the function <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> or <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a>, and it can be inquired with the function <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> or <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a>:</p>
</div>
<div id="fmi3SetIntervalDecimal" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SetIntervalDecimalTYPE(fmi3Instance instance,
                                              const fmi3ValueReference valueReferences[],
                                              size_t nValueReferences,
                                              const fmi3Float64 interval[]);</code></pre>
</div>
</div>
<div id="fmi3SetIntervalFraction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SetIntervalFractionTYPE(fmi3Instance instance,
                                               const fmi3ValueReference valueReferences[],
                                               size_t nValueReferences,
                                               const fmi3UInt64 intervalCounter[],
                                               const fmi3UInt64 resolution[]);</code></pre>
</div>
</div>
<div id="fmi3GetIntervalDecimal" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetIntervalDecimalTYPE(fmi3Instance instance,
                                              const fmi3ValueReference valueReferences[],
                                              size_t nValueReferences,
                                              fmi3Float64 interval[]);</code></pre>
</div>
</div>
<div id="fmi3GetIntervalFraction" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetIntervalFractionTYPE(fmi3Instance instance,
                                               const fmi3ValueReference valueReferences[],
                                               size_t nValueReferences,
                                               fmi3UInt64 intervalCounter[],
                                               fmi3UInt64 resolution[]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both functions inquire the interval value for the provided <a href="#clock"><code>clocks</code></a> (periodic or non-periodic).
If the <a href="#clock"><code>clocks</code></a> are non-periodic, the interval has to be inquired at every <a href="#clock"><code>clock</code></a> tick, to define the follow-up <a href="#clock"><code>clock</code></a> tick.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the use of the API functions by the environment for different kind of <a href="#clock"><code>clocks</code></a>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>API function</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#outputClock"><code>Output clock</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#inputClock"><code>Input clock</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi3GetClock</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call during <strong>Event Mode</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call during <strong>Event Mode</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi3SetClock</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call only if recomputations of clock state are needed during <strong>Event Mode</strong>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call after entering <strong>Event Mode</strong>.
Repeated calls if recomputations of clock state are needed during <strong>Event Mode</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi3GetIntervalDecimal</em> <em>fmi3GetIntervalFraction</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call during <strong>Event Mode</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call during <strong>Event Mode</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi3SetIntervalDecimal</em> <em>fmi3SetIntervalFraction</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t call.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call after first <a href="#clock"><code>clock</code></a> activation.
(only for periodic <a href="#clock"><code>clocks</code></a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="get-set-fmu-state">2.1.10. Getting and Setting the Complete FMU State</h4>
<div class="paragraph">
<p>The FMU has an internal state consisting of all values that are needed to continue a simulation.
This internal state consists especially of the values of the continuous-time states, iteration variables, <a href="#parameter"><code>parameter</code></a> values, <a href="#input"><code>input</code></a> values, delay buffers, file identifiers, and FMU internal status information.
With the functions of this section, the internal FMU state can be copied and the pointer to this copy is returned to the environment.
The FMU state copy can be set as actual FMU state, in order to continue the simulation from it.</p>
</div>
<div class="paragraph">
<p><em>[Examples for using this feature:</em></p>
</div>
<div class="paragraph">
<p><em>For variable step-size control of co-simulation master algorithms (get the FMU state for every accepted communication step; if the follow-up step is not accepted, restart co-simulation from this FMU state).</em></p>
</div>
<div class="paragraph">
<p><em>For nonlinear Kalman filters (get the FMU state just before initialization; in every sample period, set new continuous states from the Kalman filter algorithm based on measured values; integrate to the next sample instant and inquire the predicted continuous states that are used in the Kalman filter algorithm as basis to set new continuous states).</em></p>
</div>
<div class="paragraph">
<p><em>For nonlinear model predictive control (get the FMU state just before initialization; in every sample period, set new continuous states from an observer, initialize and get the FMU state after initialization.</em>
<em>From this state, perform many simulations that are restarted after the initialization with new input signals proposed by the optimizer).]</em></p>
</div>
<div class="paragraph">
<p>Furthermore, the FMU state can be serialized and copied in a byte vector:
<em>[This can be, for example, used to perform an expensive steady-state initialization, copy the received FMU state in a byte vector and store this vector on file.</em>
<em>Whenever needed, the byte vector can be loaded from file and deserialized, and the simulation can be restarted from this FMU state, in other words, from the steady-state initialization.]</em></p>
</div>
<div id="fmi3GetFMUState" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetFMUStateTYPE (fmi3Instance instance, fmi3FMUState* FMUState);</code></pre>
</div>
</div>
<div id="fmi3SetFMUState" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SetFMUStateTYPE (fmi3Instance instance, fmi3FMUState  FMUState);</code></pre>
</div>
</div>
<div id="fmi3FreeFMUState" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3FreeFMUStateTYPE(fmi3Instance instance, fmi3FMUState* FMUState);</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a> makes a copy of the internal FMU state and returns a pointer to this copy (<code>FMUState</code>).
If on entry <code>*FMUState == NULL</code>, a new allocation is required.
If <code>*FMUState != NULL</code>, then <code>*FMUState</code> points to a previously returned <code>FMUState</code> that has not been modified since.
In particular, <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a> had not been called with this <code>FMUState</code> as an argument.
<em>[Function <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a> typically reuses the memory of this <code>FMUState</code> in this case and returns the same pointer to it, but with the actual <code>FMUState</code>.]</em></p>
</div>
<div class="paragraph">
<p><a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> copies the content of the previously copied <code>FMUState</code> back and uses it as actual new FMU state.
The <code>FMUState</code> copy still exists.</p>
</div>
<div class="paragraph">
<p><a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a> frees all memory and other resources allocated with the <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a> call for this <code>FMUState</code>.
The input argument to this function is the <code>FMUState</code> to be freed.
If a null pointer is provided, the call is ignored.
The function returns a null pointer in argument <code>FMUState</code>.</p>
</div>
<div class="paragraph">
<p>These functions are only supported by the FMU, if the optional capability flag <code>canGetAndSetFMUState</code> in <code>&lt;fmiModelDescription&gt; &lt;ModelExchange / CoSimulation&gt;</code> in the XML file is explicitly set to <code>true</code> (see <a href="#ModelExchange">Section 3.3.1</a> and <a href="#fmi-for-basic-co-simulation">Section 4</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SerializedFMUStateSizeTYPE(fmi3Instance instance,
                                                  fmi3FMUState  FMUState,
                                                  size_t* size);

typedef fmi3Status fmi3SerializeFMUStateTYPE     (fmi3Instance instance,
                                                  fmi3FMUState  FMUState,
                                                  fmi3Byte serializedState[],
                                                  size_t size);

typedef fmi3Status fmi3DeSerializeFMUStateTYPE   (fmi3Instance instance,
                                                  const fmi3Byte serializedState[],
                                                  size_t size,
                                                  fmi3FMUState* FMUState);</code></pre>
</div>
</div>
<div id="fmi3SerializedFMUStateSize" class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3SerializedFMUStateSize</code></dt>
<dd>
<p>returns the <code>size</code> of the byte vector, in order that <code>FMUState</code> can be stored in it.
With this information, the environment has to allocate an <code>fmi3Byte</code> vector of the required length <code>size</code>.</p>
</dd>
</dl>
</div>
<div id="fmi3SerializeFMUState" class="dlist">
<dl>
<dt class="hdlist1"><a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a></dt>
<dd>
<p>serializes the data which is referenced by pointer <code>FMUState</code> and copies this data in to the byte vector <code>serializedState</code> of length <code>size</code>, that must be provided by the environment.</p>
</dd>
</dl>
</div>
<div id="fmi3DeSerializeFMUState" class="paragraph">
<p><code>fmi3DeSerializeFMUState</code> deserializes the byte vector <code>serializedState</code> of length <code>size</code>, constructs a copy of the FMU state and returns <code>FMUState</code>, the pointer to this copy.
<em>[The simulation is restarted at this state, when calling <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a> with <code>FMUState</code>.]</em></p>
</div>
<div class="paragraph">
<p>These functions are only supported by the FMU, if the optional capability flags <code>canGetAndSetFMUState</code> and <code>canSerializeFMUState</code> in <code>&lt;fmiModelDescription&gt;&lt;ModelExchange / CoSimulation&gt;</code> in the XML file are explicitly set to <code>true</code> (see <a href="#ModelExchange">Section 3.3.1</a> and <a href="#fmi-for-basic-co-simulation">Section 4</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_partial_derivatives">2.1.11. Getting Partial Derivatives</h4>
<div class="paragraph">
<p>It is optionally possible to provide evaluation of partial derivatives for an FMU.
For Model Exchange, this means computing the partial derivatives at a particular time instant.
For co-simulation, this means to compute the partial derivatives at a particular communication point.</p>
</div>
<div class="paragraph">
<p>The partial derivatives refer are defined as partial derivatives of certain variables of the FMU w.r.t. to other variables:</p>
</div>
<div class="paragraph">
<p>An FMU has different states and in every state an FMU might be described by different equations and different unknowns.
The precise definitions are given in the mathematical descriptions of Model Exchange (<a href="#math-model-exchange">Section 3.1</a>) and Co-Simulation (<a href="#math-basic-co-simulation">Section 4.1</a>).
In every state, the general form of the FMU equations are:</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{v}_{unknown} = \mathbf{h}(\mathbf{v}_{known}, \mathbf{v}_{rest}),\]
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\mathbf{v}_{unknonwn}\) is the vector of unknown floating point variables computed in the actual state:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Initialization Mode</strong>: The exposed unknowns listed as elements <code>&lt;ModelStructure&gt;&lt;InitialUnknown&gt;</code> that have a floating point type.</p>
</li>
<li>
<p><strong>Continuous-Time Mode</strong> (Model Exchange): The continuous-time outputs and state derivatives (= the variables listed as elements <code>&lt;ModelStructure&gt;&lt;Output&gt;</code> with a floating point type and <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a> and the variables listed as elements <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code>).</p>
</li>
<li>
<p><strong>Event Mode</strong> (Model Exchange): The same variables as in the <strong>Continuous-Time Mode</strong> and additionally variables listed as elements <code>&lt;ModelStructure&gt;&lt;Output&gt;</code> with a floating point type and <a href="#variability"><code>variability</code></a> = <a href="#discrete"><code>discrete</code></a>.</p>
</li>
<li>
<p><strong>Step Mode</strong> (Basic Co-Simulation and Hybrid Co-Simulation): The variables listed as elements <code>&lt;ModelStructure&gt;&lt;Output&gt;</code> with a floating point type and <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a> or <a href="#discrete"><code>discrete</code></a>.
Each state derivative variable listed as elements <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code>, if present.</p>
</li>
</ul>
</div>
</li>
<li>
<p>\(\mathbf{v}_{known}\) is the vector of known floating point <a href="#input"><code>input</code></a> variables of function <strong>h</strong> that changes its value in the actual state.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Details are described in the description of element <a href="#dependencies"><code>dependencies</code></a> in <a href="#ModelStructure">Section 2.2.11</a>.
<em>[For example continuous-time <a href="#input"><code>inputs</code></a> in <strong>Continuous-Time Mode</strong>.</em>
<em>If a variable with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a> is explicitly defined under <code>ModelVariables</code>, a directional derivative with respect to this variable can be computed.</em>
<em>If such a variable is not defined, the directional derivative with respect to the <a href="#independent"><code>independent</code></a> variable cannot be calculated].</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>\({\mathbf{v}_{rest}}\) is the set of <a href="#input"><code>input</code></a> variables of function <strong>h</strong> that either changes its value in the actual state but are non-floating point variables, or do not change their values in this state, but change their values in other states <em>[for example, discrete-time <a href="#input"><code>inputs</code></a> in <strong>Continuous-Time Mode</strong>]</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[The variable relationships are different in different states.</em>
<em>For example, during <strong>Continuous-Time Mode</strong>, a continuous-time output y does not depend on discrete-time <a href="#input"><code>inputs</code></a> (because they are held constant between events).</em>
<em>However, at <strong>Event Mode</strong>, y depends on discrete-time <a href="#input"><code>inputs</code></a>.</em>
<em>The function may compute the directional derivatives by numerical differentiation taking into account the sparseness of the equation system, or (preferred) by analytic derivatives.]</em></p>
</div>
<div class="paragraph">
<p>There are two access functions for partial derivatives:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> to compute the directional derivatives \(\mathbf{v}_{sensitivity} = \mathbf{J} \cdot \mathbf{v}_{seed}\), and</p>
</li>
<li>
<p><a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a> to calculate the adjoint derivatives \(\mathbf{v}_{sensitivity}^T = \mathbf{v}_{seed}^T \cdot \mathbf{J}\)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>with the Jacobian</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{J}
=
\begin{bmatrix}
\frac{\partial h_1}{\partial v_{knwon,1}} &amp; \cdots &amp; \frac{\partial h_1}{\partial v_{knwon, n}} \\
\vdots &amp; \ddots &amp; \vdots \\
\frac{\partial h_m}{\partial v_{known, 1}} &amp; \cdots &amp; \frac{\partial h_m}{\partial v_{known, n}}
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p>where \(\mathbf{v}_{known}\) are the \(n\) knowns, and \(\mathbf{h}\) are the \(m\) functions to calculate the \(m\) unknwon variables \(\mathbf{v}_{unknwon}\)  from the knowns.</p>
</div>
<div class="paragraph">
<p>Both functions can also be used to construct the partial derivative matrices.
The functions may only be called if their availability is indicated by the attributes <code>providesDirectionalDerivative</code> and <code>providesAdjointDerivative</code> respectively.</p>
</div>
<div id="fmi3GetDirectionalDerivative" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetDirectionalDerivativeTYPE(fmi3Instance instance,
                                                    const fmi3ValueReference unknowns[],
                                                    size_t nUnknowns,
                                                    const fmi3ValueReference knowns[],
                                                    size_t nKnowns,
                                                    const fmi3Float64 seed[],
                                                    size_t nSeed,
                                                    fmi3Float64 sensitivity[],
                                                    size_t nSensitivity);</code></pre>
</div>
</div>
<div id="fmi3GetAdjointDerivative" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetAdjointDerivativeTYPE(fmi3Instance instance,
                                                const fmi3ValueReference unknowns[],
                                                size_t nUnknowns,
                                                const fmi3ValueReference knowns[],
                                                size_t nKnowns,
                                                const fmi3Float64 seed[],
                                                size_t nSeed,
                                                fmi3Float64 sensitivity[],
                                                size_t nSensitivity);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both functions have the same parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>unknowns</code>: value references to the unknowns</p>
</li>
<li>
<p><code>nUnknowns</code>: length of <code>unknowns</code></p>
</li>
<li>
<p><code>knowns</code>:value references of the knowns</p>
</li>
<li>
<p><code>nKnowns</code>: length of <code>knowns</code></p>
</li>
<li>
<p><code>seed</code>: seed values</p>
</li>
<li>
<p><code>nSeed</code>: length of <code>seed</code></p>
</li>
<li>
<p><code>sensitivity</code>: the sensitivities</p>
</li>
<li>
<p><code>nSensitivity</code>: length of <code>sensitivity</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[Note that array variables will be serialized, so <code>nSeed</code> is only equal to <code>nKnowns</code> in the case of directional derivatives resp. equal to <code>nUnknowns</code> in the case of adjoint derivatives, if all value references of <code>knowns</code> resp. <code>unknowns</code> point to scalar variables.</em>
<em>Likewise <code>nSensitivity</code> is only equal to <code>nUnknowns</code> resp. <code>nKnowns</code> if all value references of <code>unknowns</code> resp. <code>knowns</code> point to scalar variables.]</em></p>
</div>
<div class="sect4">
<h5 id="_directional_derivatives">2.1.11.1. Directional derivatives</h5>
<div class="paragraph">
<p><em>[Example 1</em><br>
<em>Assume an FMU has the output equations</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{bmatrix}
y_1
\\
y_2
\end{bmatrix}
=
\begin{bmatrix}
g_1(x, u_1, u_3, u_4)
\\
g_2(x, u_1)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>and this FMU is connected, so that \({y_1, u_1, u_3}\) appear in an algebraic loop.</em>
<em>Then the nonlinear solver needs a Jacobian and this Jacobian can be computed (without numerical differentiation) provided the partial derivative of \({y_1}\) with respect to \({u_1}\) and \({u_3}\) is available.</em>
<em>Depending on the environment where the FMUs are connected, these <a href="#derivative"><code>derivatives</code></a> can be provided</em></p>
</div>
<div class="paragraph">
<p>(a) <em>with one wrapper function around function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> to compute the directional derivatives with respect to these two variables (in other words, \({v_{unknown} = y_1}\), \({v_{known} = \left \{ u_1, u_3 \right \}}\)), and then the environment calls this wrapper function with \({v_{seed} = \left \{ 1, 0 \right \}}\) to compute the partial derivative with respect to \({u_1}\) and \({v_{seed} = \left \{ 0, 1 \right \}}\) to compute the partial derivative with respect to \({u_3}\), or</em></p>
</div>
<div class="paragraph">
<p>(b) <em>with two direct function calls of <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> (in other words, \({v_{unknown} = y_1, v_{known} = u_1, v_{seed} = 1}\); and \({v_{unknown} = y_1, v_{known} = u_3, v_{seed} = 1}\)).</em></p>
</div>
<div class="paragraph">
<p><em>Note that a direct implementation of this function with analytic derivatives:</em></p>
</div>
<div class="paragraph">
<p>(a) <em>Provides the directional derivative for all <a href="#input"><code>input</code></a> variables; so in the above example: \({\Delta y_1 = \frac{\partial g_1}{\partial x} \cdot \Delta x + \frac{\partial g_1}{\partial u_1} \cdot \Delta u_1 + \frac{\partial g_1}{\partial u_3} \cdot \Delta u_3 + \frac{\partial g_1}{\partial u_4} \cdot \Delta u_4}\)</em></p>
</div>
<div class="paragraph">
<p>(b) <em>Initializes all seed-values to zero; so in the above example: \({\Delta x = \Delta u_1 = \Delta u_3 = \Delta u_4 = 0}\)</em></p>
</div>
<div class="paragraph">
<p>(c) <em>Computes the directional derivative with the seed-values provided in the function arguments; so in the above example: \({v_{sensitivity} = \Delta y_1 (\Delta x = 0, \Delta u_1 = 1, \Delta u_3 = 0, \Delta u_4 = 0)}\)] and \({v_{sensitivity} = \Delta y_1 (\Delta x = 0, \Delta u_1 = 0, \Delta u_3 = 1, \Delta u_4 = 0)}\)]</em></p>
</div>
<div class="paragraph">
<p><em>[Note, function <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> can be utilized for the following purposes:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Numerical integrators of stiff methods need matrix \({\frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\).</em></p>
</li>
<li>
<p><em>If the FMU is connected with other FMUs, the partial derivatives of the state derivatives and outputs with respect to the continuous states and the <a href="#input"><code>inputs</code></a> are needed in order to compute the Jacobian for the system of the connected FMUs.</em></p>
</li>
<li>
<p><em>If the FMU shall be linearized, the same <a href="#derivative"><code>derivatives</code></a> as in the previous item are needed.</em></p>
</li>
<li>
<p><em>If the FMU is used as the model for an extended Kalman filter, \({\frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\) and \({\frac{\partial \mathbf{g}}{\partial \mathbf{x}}}\) are needed.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>If a dense matrix shall be computed, the columns of the matrix can be easily constructed by successive calls of <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</em>
<em>For example, constructing the system Jacobian \({\mathbf{A} = \frac{\partial \mathbf{f}}{\partial \mathbf{x}}}\) as dense matrix can be performed in the following way:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">// from the XML file:
//   nx       number of states
//   vr_x[]   value references of continuous states
//   vr_xd[]  value references of state derivatives
//
// variables:
//   m        model instance
//   x[]      continuous states
//   dk = 1   delta knowns
//   J[][]    Jacobian (transposed for simplicity)

// set time, states and inputs
fmi3SetTime(m, time);
fmi3SetContinuousStates(m, x, nx);
// fmi3SetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

// if required at this step, compute the Jacobian as a dense matrix
for (i = 0; i &lt; nx; i++) {
    // construct the Jacobian matrix column wise
    fmi3GetDirectionalDerivative(m, vr_dx, nx, &amp;vr_x[i], 1, &amp;dk, 1, &amp;J[i][0], nx);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>If the sparsity of a matrix shall be taken into account, then the matrix can be constructed in the following way:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>The incidence information of the matrix (whether an element is zero or not zero) is extracted from the XML file from element <code>&lt;ModelStructure&gt;</code>.</em></p>
</li>
<li>
<p><em>A so called graph coloring algorithm is employed to determine the columns of the matrix that can be computed by one call of fmi2GetDirectionalDerivative.</em>
<em>Efficient graph coloring algorithms are freely available, such as library <a href="https://cscapes.cs.purdue.edu/coloringpage/">ColPack</a> written in C/C++ (LGPL), or the routines by <a href="#CGM84">[CGM84]</a>.</em>
<em>See e.g. <a href="http://www.netlib.org/toms/618" class="bare">http://www.netlib.org/toms/618</a>.</em></p>
</li>
<li>
<p><em>For the columns determined in (2), one call to <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> is made.</em>
<em>After each such call, the elements of the resulting directional derivative vector are copied into their correct locations of the partial derivative matrix.</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>_More details and implementational notes are available from <a href="#ABL12">[ABL12]</a>.</p>
</div>
<div class="paragraph">
<p><em>Example 2</em></p>
</div>
<div class="paragraph">
<p><em>Directional derivatives for higher dimension variables are almost treated in the same way.
Consider, for example, an FMU which calculates its output \({Y}\) by multiplying its 2x2 input \({U}\) with a 3x2 constant gain \({K}\), with</em></p>
</div>
<div class="stemblock">
<div class="content">
\[K=
\begin{bmatrix}
a, b
\\
c, d
\\
e, f
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>The output \({Y=K U}\) is a matrix of size 3x2.</em>
<em>The directional derivative of an output element \({Y(i,j)}\) with respect to the input \({U}\) and the seed \({\Delta U}\) is:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\Delta Y(i,j) =
\frac{\partial Y(i,j)}{\partial U(1,1)} \cdot \Delta U(1,1) +
\frac{\partial Y(i,j)}{\partial U(1,2)} \cdot \Delta U(1,2) +
\frac{\partial Y(i,j)}{\partial U(2,1)} \cdot \Delta U(2,1) +
\frac{\partial Y(i,j)}{\partial U(2,2)} \cdot \Delta U(2,2)\]
</div>
</div>
<div class="stemblock">
<div class="content">
\[\Delta \mathbf{Y} =
\begin{bmatrix}
a \Delta U(1,1)+b \Delta U(2,1), a \Delta U(1,2)+ b \Delta U(2,2)
\\
c \Delta U(1,1)+d \Delta U(2,1), c \Delta U(1,2)+ d \Delta U(2,2)
\\
e \Delta U(1,1)+f \Delta U(2,1), e \Delta U(1,2)+ f \Delta U(2,2)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>To get the directional derivative of \({Y}\) with respect to \({U(2,1)}\) the command <code>fmi3GetDirectionalDerivative(m, vr_Y, 1, vr_U, 1, {0.0, 0.0, 1.0, 0.0}, 4, dd, 6)</code> can be used where <code>vr_Y</code> and <code>vr_U</code> are references of the variable \({Y}\) and \({U}\), respectively.</em>
<em>Note that in order to get the directional derivative of \({Y}\) with respect to \({U(2,1)}\), the seed value <code>{0, 0, 1.0, 0}</code> has been used.</em>
<em>The retrieved directional derivative <code>dd</code> is stored in a matrix of size 3x2, so <code>nSensitivity</code> is 6.</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_adjoint_derivatives">2.1.11.2. Adjoint derivatives</h5>
<div class="paragraph">
<p><em>[Adjoint derivatives are beneficial in several contexts:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>in artifical intelligence (AI) frameworks the adjoint derivatives are called "vector gradient products" (VJPs).</em>
<em>There adjoint derivatives are used in the backpropagation process to perform gradient-based optimization of parameters using reverse mode automatic differentiation (AD), see, e.g., <a href="#BPRS15">[BPRS15]</a>.</em></p>
</li>
<li>
<p><em>in pararameter estimation (see <a href="#BKF17">[BKF17]</a>)</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Typically, reverse mode automatic differentiatian (AD) is more efficient for these use cases than forward mode AD, as explained in the cited references.</em></p>
</div>
<div class="paragraph">
<p><em>If one would like to construct the full Jacobian matrix, one can use either <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> (to column-wise construct it) or <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a> (to row-wise construct it, possibly improved with coloring methods as mentioned above).</em>
<em>However in the applications motivating the adjoint derivatives, one does not need the full Jacobian matrix \(\mathbf{J}\), but vector  \(\mathbf{v}^T\) multiplied from the left to the Jacobian, i.e. \(\mathbf{v}^T\mathbf{J}\).</em>
<em>For computing the full Jacobian matrix the column-wise construct is generally more efficient.]</em></p>
</div>
<div class="paragraph">
<p><em>Example:</em><br>
<em>Assume an FMU has the output equations</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{bmatrix}
y_1
\\
y_2
\end{bmatrix}
=
\begin{bmatrix}
h_1(u_1, u_2)
\\
h_2(u_1, u_2)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>and \(\left( w_1,  w_2 \right)^T \cdot \mathbf{ \frac{\partial h}{\partial u} }\) for some vector \(\left( w_1,  w_2 \right)^T\) is needed.</em>
<em>Then one can get this with one function call of <a href="#fmi3GetAdjointDerivative"><code>fmi3GetAdjointDerivative</code></a> (with arguments</em> \(\mathbf{v}_{unknown} = \text{valueReferences of} \left \{ y_1, y_2 \right \},  \mathbf{v}_{knwon} = \text{valueReferences of} \left \{ u_1, u_2 \right \},  \mathbf{v}_{seed} = \left( w_1, w_2 \right)^T\) <em>), while with <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a> at least two calls would be necessary to first construct the Jacobian column-wise and then multiplying from the right with</em> \(\left( w_1,  w_2 \right)^T\) <em>]</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getting_number_of_event_indicators">2.1.12. Getting Number of Event Indicators</h4>
<div class="paragraph">
<p>The number of event indicators can change during simulation if it depends on one or more <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a> and can be retrieved after instantiating the FMU by calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetNumberOfEventIndicatorsTYPE(fmi3Instance instance, size_t* nz);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of event indicators.
The dependency of the number of event indicators on <a href="#structuralParameter"><code>structural parameters</code></a> is implicitly given in the <code>modelDescription.xml</code> file.
<em>[All event indicator variables are listed as elements <code>EventIndicator</code> in <code>ModelStructure</code>.</em>
<em>If the event indicator variable is an array variable and the <code>Dimension</code> element maps to a dependent variable than this dependent variable is a dependency for the number of event indicators.]</em>
If all <a href="#structuralParameter"><code>structural parameters</code></a> are unchanged then this dependency information can be used to calculate the initial number of states just using information given in the XML file without the need to call this C-API function.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>nz</code> points to the <code>size_t</code> variable that will receive the number of event indicators.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_getting_number_of_states">2.1.13. Getting Number of States</h4>
<div class="paragraph">
<p>The number of <a href="#state"><code>states</code></a> can change during simulation if it depends on one or more <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a> and can be retrieved after instantiating the FMU by calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetNumberOfContinuousStatesTYPE(fmi3Instance instance, size_t* nx);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of <a href="#state"><code>states</code></a>.
The dependency of the number of states on <a href="#structuralParameter"><code>structural parameters</code></a> is implicitly given in the <code>modelDescription.xml</code> file.
<em>[All state derivative variables are listed as elements <code>Derivative</code> in <code>ModelStructure</code>.</em>
<em>Each state derivative variable maps to the corresponding state variable by the <code>derivative</code> attribute.</em>
<em>If the state variable is an array variable and the <code>Dimension</code> element maps to a dependent variable than this dependent variable is a dependency for the number of states.]</em>
If all <a href="#structuralParameter"><code>structural parameters</code></a> are unchanged then this dependency information can be used to calculate the initial number of states just using information given in the XML file without the need to call this C-API function.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>nz</code> points to the <code>size_t</code> variable that will receive the number of <a href="#state"><code>states</code></a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_getting_number_of_variable_dependencies_and_variable_dependencies">2.1.14. Getting Number of Variable Dependencies and Variable Dependencies</h4>
<div class="paragraph">
<p>The sparseness information within arrays is not given in the xml description.
The sparseness muss be retrieved during run-time using the C-API functions.
Zeros in the Jacobian are not necessarily due to the structure of the model.
Zero in the Jacobian might be due to the current operating point (current <a href="#state"><code>state</code></a>, current <a href="#input"><code>inputs</code></a>) and not due to a structural independence.</p>
</div>
<div class="paragraph">
<p>The variable dependency information in the XML description does not resolve to dependencies of individual array elements, nor does it take into account changing dependencies due to resizing of arrays via <a href="#structuralParameter"><code>structural parameters</code></a>.
An FMU can indicate via the <code>providesPerElementDependencies</code> capability flag that it is able to provide detailed dependency information at runtime through the following C-API.
Note that these functions are only defined if the <code>providesPerElementDependencies</code> capability flag = <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The number of dependencies of a given variable, which may change if <a href="#structuralParameter"><code>structural parameters</code></a> are changed, can be retrieved by calling the following function:</p>
</div>
<div id="fmi3GetNumberOfVariableDependencies" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetNumberOfVariableDependenciesTYPE(fmi3Instance instance,
                                                           fmi3ValueReference valueReference,
                                                           size_t* nDependencies);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of <a href="#dependencies"><code>dependencies</code></a> for a given variable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>valueReference</code> specifies the <a href="#valueReference"><code>valueReference</code></a> of the variable for which the number of <a href="#dependencies"><code>dependencies</code></a> should be returned.</p>
</li>
<li>
<p>Argument <code>nDependencies</code> points to the <code>size_t</code> variable that will receive the number of <a href="#dependencies"><code>dependencies</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The actual <a href="#dependencies"><code>dependencies</code></a> (of type <code>fmi3DependencyKind</code>) can be retrieved by calling the function <code>fmi3GetVariableDependencies</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef enum {
    /* fmi3Independent = 0, not needed but reserved for future use */
    fmi3Constant  = 1,
    fmi3Fixed     = 2,
    fmi3Tunable   = 3,
    fmi3Discrete  = 4,
    fmi3Dependent = 5
} fmi3DependencyKind;

typedef fmi3Status fmi3GetVariableDependenciesTYPE(fmi3Instance instance,
                                                   fmi3ValueReference dependent,
                                                   size_t elementIndicesOfDependent[],
                                                   fmi3ValueReference independents[],
                                                   size_t elementIndicesOfIndependents[],
                                                   fmi3DependencyKind dependencyKinds[],
                                                   size_t nDependencies);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the dependency information for a single variable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>dependent</code> specifies the <a href="#valueReference"><code>valueReference</code></a> of the variable for which the dependencies should be returned.</p>
</li>
<li>
<p>Argument <code>nDependencies</code> specifies the number of dependencies that the calling environment allocated space for in the result buffers, and should correspond to the returned by calling <a href="#fmi3GetNumberOfVariableDependencies"><code>fmi3GetNumberOfVariableDependencies</code></a>.</p>
</li>
<li>
<p>Argument <code>elementIndicesOfDependent</code> must point to a buffer of <code>size_t</code> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the element index of the dependent variable that dependency information is provided for.
The element indices start with 1. Using the element index 0 means all elements of the variable.
(Note: If an array has more than one dimension the indices are serialized in the same order as defined for values).</p>
</li>
<li>
<p>Argument <code>independents</code> must point to a buffer of <code>fmi3ValueReference</code> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the value reference of the <a href="#independent"><code>independent</code></a> variable that this dependency entry is dependent upon.</p>
</li>
<li>
<p>Argument <code>elementIndicesIndependents</code> must point to a buffer of <code>size_t</code> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the element index of the <a href="#independent"><code>independent</code></a> variable that this dependency entry is dependent upon.
The element indices start with 1.
Using the element index 0 means all elements of the variable.
(Note: If an array has more than one dimension the indices are serialized in the same order as defined for values).</p>
</li>
<li>
<p>Argument <code>dependencyKinds</code> must point to a buffer of <code>fmi3DependencyKind</code> values of size <code>nDependencies</code> allocated by the calling environment.
It is filled in by this function with the enumeration value describing the dependency of this dependency entry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this function is called before the <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> call, it returns the initial dependencies.
If this function is called after the <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> call, it returns the run-time dependencies.
The retrieved dependency information of one variable becomes invalid as soon as a <a href="#structuralParameter"><code>structural parameter</code></a> linked to the variable or to any of its depending variables are set.
As a consequence, if you change <a href="#structuralParameter"><code>structural parameters</code></a> affecting B or A, the dependency of B becomes invalid.
The dependency information must change only if <a href="#structuralParameter"><code>structural parameters</code></a> are changed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fmi-description-schema">2.2. FMI Description Schema</h3>
<div class="paragraph">
<p>All static information related to an FMU is stored in the text file <code>modelDescription.xml</code> in XML format.
Especially, the FMU variables and their attributes such as name, unit, default <a href="#initial"><code>initial</code></a> value, etc. are stored in this file.</p>
</div>
<div class="paragraph">
<p>It is not allowed to change the <code>modelDescription.xml</code> file.
<em>[Reason: The <code>modelDescription.xml</code> file has to be consistent with the binary or source code implementations.</em>
<em>Specifically, changes to the start values are not allowed.]</em></p>
</div>
<div class="paragraph">
<p>The structure of this XML file is defined with the schema file <code>fmi3ModelDescription.xsd</code>.
This schema file utilizes several helper schema files.</p>
</div>
<div class="paragraph">
<p>In this section these schema files are discussed.
The normative definition are the above mentioned schema files.
Below, optional elements are marked with a dashed box.
The required data types (like: <code>xs:normalizedString</code>) are defined in <a href="https://www.w3.org/TR/xmlschema-2/">XML Schema Part 2: Datatypes Second Edition</a>.
The types used in the FMI schema files are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XML</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description (<a href="http://www.w3.org/TR/xmlschema-2/" class="bare">http://www.w3.org/TR/xmlschema-2/</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Mapping to C</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE 754 double-precision 64-bit floating point type <em>[An IEEE 754 double-precision floating point value can have up to 17 significant digits in its decimal representation.
In order to not loose precision, either an appropriate minimal printer algorithm should be used, or alternatively a number of this type should be stored in XML files with at least 17 significant digits.]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>single</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE 754 single-precision 32-bit floating point type <em>[An IEEE 754 single-precision floating point value can have up to 9 significant digits in its decimal representation.
In order to not loose precision, either an appropriate minimal printer algorithm should be used, or alternatively a number of this type should be stored in XML files with at least 9 significant digits.]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>float</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 127 and minimum value -128 (8 bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int8_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedByte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 255 and minimum value 0 (8 bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint8_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>short</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 32767 and minimum value -32768 (16 bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int16_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedShort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 65535 and minimum value 0 (16 bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint16_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 2147483647 and minimum value -2147483648 (32 bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int32_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedInt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 4294967295 and minimum value 0 (32 bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint32_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 9223372036854775807 and minimum value -9223372036854775808 (64 bit signed integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int64_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unsignedLong</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 18446744073709551615 and minimum value 0 (64 bit unsigned integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uint64_t</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean number. Legal literals: <code>false</code>, <code>true</code>, <code>0</code>, <code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any number of characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>normalizedString</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String without carriage return, line feed, and tab characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hexBinary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrary hex-encoded binary data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date, time and time zone (for details see the link above).
Example: <code>2002-10-23T12:00:00Z</code> (noon on October 23, 2002, Greenwich Mean Time)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tool specific</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first line of an XML file, such as <code>modelDescription.xml</code>, must contain the encoding scheme of the XML file.
It is required that the encoding scheme is always UTF-8:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FMI schema files (<code>fmi3*.xsd</code>) are also stored in UTF-8.<br>
<em>[Note that the definition of an encoding scheme is a prerequisite in order for the XML file to contain letters outside of the 7 bit ANSI ASCII character set, such as German umlauts, or Asian characters.</em>
<em>Furthermore, note the FMI calling interface requires that strings are encoded in UTF-8.</em>
<em>Since the XML files are also required to be encoded in UTF-8, string variables need not to be transformed when reading from the XML files in to C string variables.].</em></p>
</div>
<div class="paragraph">
<p>The special values <code>NaN</code>, <code>+INF</code>, <code>-INF</code> for variables values are not allowed in the FMI XML files.</p>
</div>
<div class="paragraph">
<p><em>[Note that child information items, such as elements in a sequence are ordered lists according to document order, whereas attribute information items are unordered sets (see <a href="http://www.w3.org/TR/XML-infoset/#infoitem.element" class="bare">http://www.w3.org/TR/XML-infoset/#infoitem.element</a>).</em>
<em>The FMI schema is based on ordered lists in a sequence and therefore parsing must preserve this order.</em>
<em>For example, the information stored in <code>&lt;ModelVariables&gt;&lt;Derivative&gt;</code> is only correct if this property is fulfilled.]</em></p>
</div>
<div class="sect3">
<h4 id="fmiModelDescription">2.2.1. Definition of an FMU (fmiModelDescription)</h4>
<div class="paragraph">
<p>This is the root-level schema file and contains the following definition (the figure below contains all elements in the schema file.
Data is defined by attributes to these elements):</p>
</div>
<div id="system_overview" class="imageblock">
<div class="content">
<img src="images/schema/fmiModelDescription.png" alt="fmiModelDescription" width="70%">
</div>
</div>
<div class="paragraph">
<p>On the top level, the schema consists of the following elements (see <a href="#system_overview">figure above</a>).
<em>[Note that elements <code>&lt;ModelVariables&gt;</code> and <code>&lt;ModelStructure&gt;</code> are mandatory, whereas <code>&lt;UnitDefinitions&gt;</code>, <code>&lt;TypeDefinitions&gt;</code>, <code>&lt;LogCategories&gt;</code>, <code>&lt;DefaultExperiment&gt;</code>, and <code>&lt;VendorAnnotation&gt;</code> are optional.</em>
<em>If an optional element is present and defines a list (such as <code>&lt;UnitDefinitions&gt;</code>), the list must have at least one element (such as <code>&lt;Unit&gt;</code>).]</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element-Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModelExchange</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on FMI for Model Exchange <em>[(in other words, the FMU includes the model or the communication to a tool that provides the model, and the environment provides the simulation engine)]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BasicCoSimulation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on FMI for Basic Co-Simulation <em>[(in other words, the FMU includes the model and the simulation engine, or a communication to a tool that provides the model and the simulation engine, and the environment provides the master algorithm to run coupled FMU Co-Simulation slaves together)]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HybridCoSimulation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on FMI for Hybrid Co-Simulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ScheduledCoSimulation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on FMI for Scheduled Co-Simulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BuildConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, instructs how to compile sources of a C-code FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UnitDefinitions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of unit and display unit definitions <em>[for example, to convert display units into the units used in the model equations]</em>.
These definitions are used in the XML element <code>ModelVariables</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TypeDefinitions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of type definitions that are utilized in <code>ModelVariables</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LogCategories</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of log categories that can be set to define the log information that is supported from the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DefaultExperiment</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Providing default settings for the integrator, such as stop time and relative tolerance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Terminals</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, this allows combining input and output signals into logical groups to ease connections on a system level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GraphicalRepresentation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, contains information for authoring tools to draw graphical representations of the FMU in a system view.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VendorAnnotations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional data that a vendor might want to store and that other vendors might ignore.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModelVariables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The central FMU data structure defining all variables of the FMU that are visible/accessible via the FMU functions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModelStructure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the structure of the model.
Especially, the ordered lists of <a href="#output"><code>outputs</code></a>, continuous-time <a href="#state"><code>states</code></a>, initial unknowns (the unknowns during <strong>Initialization Mode</strong>) and the event indicators are defined here.
For more details on ModelStructure, see <a href="#ModelStructure">Section 2.2.11</a>.
Furthermore, the dependency of the unknowns from the knowns can be optionally defined for <a href="#output"><code>outputs</code></a>, continuous-time <a href="#state"><code>states</code></a> and initial unknowns.
<em>[This information can be, for example, used to compute efficiently a sparse Jacobian for simulation, or to utilize the <a href="#input"><code>input</code></a> / <a href="#output"><code>output</code></a> dependency in order to detect that in some cases there are actually no algebraic loops when connecting FMUs together]</em>.
Dependencies for event indicators are not provided.
<em>[The calculation of derivatives of event indicators is not provided.]</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At least one element of <code>ModelExchange</code> or <code>CoSimulation</code> must be present to identify the type of the FMU.
If both elements are defined, different types of models are included in the FMU.
The details of these elements are defined in <a href="#ModelExchange">Section 3.3.1</a> and <a href="#fmi-for-basic-co-simulation">Section 4</a>.</p>
</div>
<div class="paragraph">
<p>The XML attributes of <code>fmiModelDescription</code> are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute-Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmiVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of FMI that was used to generate the XML file.
The value for this version is <code>3.0</code>.
Future minor revisions are denoted as <code>3.1</code>, <code>3.2</code> &#8230;&#8203;</p>
<p class="tableblock"><em>[During development prototype FMU implementations can indicate compliance with a certain development version based on the tags available at <a href="https://github.com/modelica/fmi-standard/tags" class="bare">https://github.com/modelica/fmi-standard/tags</a>.</em>
<em>For example the value for the FMI 3.0 Alpha 2 release is <code>3.0-alpha.2</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the model as used in the modeling environment that generated the XML file, such as <code>Modelica.Mechanics.Rotational.Examples.CoupledClutches</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>instantiationToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The instantiationToken is a string that can be used by the FMU to check that the XML file is compatible with the implementation of the FMU.
For this purpose the importing tool must pass the instantiationToken from the <code>modelDescription.xml</code> to the <code>fmi3Instantiate</code> function call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional string with a brief description of the model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>author</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional string with the name and organization of the model author.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional version of the model <em>[for example <code>1.0</code>]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>copyright</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional information on the intellectual property copyright for this FMU <em>[for example <code>&#169; My Company 2011</code>]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>license</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional information on the intellectual property licensing
for this FMU <em>[for example <code>BSD license &lt;license text or link to license&gt;</code>]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generationTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional name of the tool that generated the XML file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generationDateAndTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional date and time when the XML file was generated.
The format is a subset of <code>dateTime</code> and should be: <code>YYYY-MM-DDThh:mm:ssZ</code> (with one <code>T</code> between date and time; <code>Z</code> characterizes the Zulu time zone, in other words, Greenwich meantime) <em>[for example <code>2009-12-08T14:33:22Z</code>]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>variableNamingConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines whether the variable names in <code>ModelVariables</code> and in <code>TypeDefinitions</code> follow a particular convention.
For the details, see <a href="#variableNamingConvention">Section 2.2.12</a>. Currently standardized are:</p>
<p class="tableblock">- <code>flat</code>: A list of strings (the default).</p>
<p class="tableblock">- <code>structured</code>: Hierarchical names with <code>.</code> as hierarchy separator, and with array elements and derivative characterization.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_definition_of_source_code_buildconfiguration">2.2.2. Definition of Source Code (BuildConfiguration)</h4>
<div class="paragraph">
<p>The <code>BuildConfiguration</code> provides the necessary information to compile and link the contained sources of the model into a dynamic library or as part of an executable.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelIdentifier</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>modelIdentifier</code> of the <code>ModelExchange</code> or <code>CoSimulation</code> elements this build configuration is associated with.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">platform</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Platform tuple of the platform the build configuration is intended for (e.g. <code>x86_64-linux</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the build configuration</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_sourcefileset">2.2.2.1. SourceFileSet</h5>
<div class="paragraph">
<p>The <code>SourceFileSet</code> element groups source files that can be compiled with the same compiler and compiler options. Every build configuration must contain at least one <code>SourceFileSet</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">language</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Language of the source files (e.g. <code>C99</code>, <code>C++11</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compiler</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The compiler to compile the sources (e.g. <code>VisualC</code>, <code>gcc</code>, <code>clang++</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compilerOptions</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The compiler flags that have to be used when compiling the sources (e.g. <code>-fno-rtti</code>, <code>/Od</code>)</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_sourcefile">2.2.2.1.1. SourceFile</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Path of the source file relative to the <code>sources</code> directory</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_preprocessordefinition">2.2.2.1.2. PreprocessorDefinition</h6>
<div class="paragraph">
<p>The <code>PreprocessorDefinition</code> element defines a preprocessor definition that needs to be passed to the compiler when compiling the source files in the <code>SourceFileSet</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the preprocessor definition</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Value of the preprocessor definition</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Determines wether the definition is optional (default is <code>false</code>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the preprocessor definition</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_preprocessordefinitionoption">2.2.2.1.3. PreprocessorDefinition/Option</h6>
<div class="paragraph">
<p>The <code>Option</code> element defines a possible value for the <code>PreprocessorDefinition</code>. If a <code>PreprocessorDefinition</code> contains <code>Option</code> elements, its default value must be contained in the options.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Value of the preprocessor definition option</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the preprocessor definition option</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_includedirectory">2.2.2.1.4. IncludeDirectory</h6>
<div class="paragraph">
<p>The <code>IncludeDirectory</code> element defines the include directories that need to be passed to the compiler when compiling the source files in the <code>SourceFileSet</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Path of the include directory relative to the <code>sources</code> directory</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_library">2.2.2.1.5. Library</h6>
<div class="paragraph">
<p>The <code>Library</code> element defines a static library required to link the model binary.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Name of the library</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Version specifier of the library as defined in <a href="https://www.python.org/dev/peps/pep-0440/#version-specifiers">PEP 440</a>.
The characters <code>&gt;</code> (greater-than) and <code>&lt;</code> (less-than) must be escaped as <code>&gt;</code> and <code>&lt;</code>.
 <em>[For example <code>2.5</code>, <code>&gt;=2.0,&lt;3.0</code> or <code>&gt;=1.0,!=1.2</code>]</em>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>external</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Boolean attribute that determines wether the library is contained in the <code>binaries/&lt;platform_tuple&gt;</code> directory (<code>false</code>) or if it has to be provided by the environment (<code>true</code>). The default is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Description of the library definition option</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_examples">2.2.2.1.6. Examples</h6>
<div class="listingblock">
<div class="title">A minimal build configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;BuildConfiguration modelIdentifier="PIDContoller"&gt;
  &lt;SourceFileSet&gt;
    &lt;SourceFile name="all.c"/&gt;
  &lt;/SourceFileSet&gt;
&lt;/BuildConfiguration&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Multiple complex build configurations</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;BuildConfiguration modelIdentifier="PlantModel" description="Build configuration for desktop platforms"&gt;
  &lt;SourceFileSet language="C99"&gt;
    &lt;SourceFile name="fmi3Functions.c"/&gt;
    &lt;SourceFile name="solver.c"/&gt;
  &lt;/SourceFileSet&gt;
  &lt;SourceFileSet language="C++11"&gt;
    &lt;SourceFile name="model.c"/&gt;
    &lt;SourceFile name="logging/src/logger.c"/&gt;
    &lt;PreprocessorDefinition name="FMI_VERSION" value="3"/&gt;
    &lt;PreprocessorDefinition name="LOG_TO_FILE" optional="true"/&gt;
    &lt;PreprocessorDefinition name="LOG_LEVEL" value="0" optional="true"&gt;
      &lt;Option value="0" description="Log infos, warnings and errors"/&gt;
      &lt;Option value="1" description="Log warnings and errors"/&gt;
      &lt;Option value="2" description="Log only errors"/&gt;
    &lt;/PreprocessorDefinition&gt;
    &lt;IncludeDirectory name="logging/include"/&gt;
  &lt;/SourceFileSet&gt;
  &lt;Library name="hdf5" version="&amp;gt;=1.8,!=1.8.17,&amp;lt;1.10" external="true" description="HDF5"/&gt;
&lt;/BuildConfiguration&gt;
&lt;BuildConfiguration modelIdentifier="PlantModel" platform="aarch64-linux"&gt;
  &lt;SourceFileSet language="C99"&gt;
    &lt;SourceFile name="fmi3Functions.c"/&gt;
  &lt;/SourceFileSet&gt;
  &lt;SourceFileSet language="C++11" compiler="clang++" compilerOptions="-fno-rtti"&gt;
    &lt;SourceFile name="model.c"/&gt;
    &lt;PreprocessorDefinition name="NO_FILE_SYSTEM"/&gt;
  &lt;/SourceFileSet&gt;
  &lt;Library name="libm.a" description="OpenLibm math library"/&gt;
&lt;/BuildConfiguration&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_units_unitdefinitions">2.2.3. Definition of Units (UnitDefinitions)</h4>
<div class="paragraph">
<p><em>[In this section, the units of the variables are (optionally) defined.</em>
<em>Unit support is important for technical systems since otherwise it is very easy for errors to occur.</em>
<em>Unit handling is a difficult topic, and there seems to be no method available that is really satisfactory for all applications, such as unit check, unit conversion, unit propagation or dimensional analysis.</em>
<em>In FMI, a pragmatic approach is used that takes into account that every software system supporting units has potentially its own specific technique to describe and utilize units.</em>
<em>The approach used here is slightly different than FMI 1.0 to reduce the need for standardized string representations.]</em></p>
</div>
<div class="paragraph">
<p>Element <code>UnitDefinitions</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/schema/UnitDefinitions.png" alt="UnitDefinitions" width="90%">
</div>
</div>
<div class="paragraph">
<p>It consists of zero or more <code>Unit</code> definitions.
<em>[If no units are defined, element <code>&lt;UnitDefinitions&gt;</code> must not be present.</em>
<em>If 1 or more units are defined, this element must be present.]</em>
A <code>Unit</code> is defined by its <code>name</code> attribute such as <code>N.m</code> or <code>N*m</code> or <code>Nm</code>, which must be unique with respect to all other defined elements of the <code>UnitDefinitions</code> list.
If a variable is associated with a <code>Unit</code>, then the value of the variable has to be provided with the <code>fmi3Set{VariableType}</code> functions or else is returned by the <code>fmi3Get{VariableType}</code> functions with respect to this <code>Unit</code>.
<em>[The purpose of the name is to uniquely identify a unit and, for example, use it to display the unit in menus or in plots.</em>
<em>Since there is no standard to represent units in strings, and there are different ways how this is performed in different tools, no specific string representation of the unit is required.]</em></p>
</div>
<div class="paragraph">
<p>Optionally, a value given in unit <code>Unit</code> can be converted to a value with respect to unit <code>BaseUnit</code> utilizing the conversion <code>factor</code> and <code>offset</code> attributes:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/BaseUnit.png" alt="BaseUnit" width="50%">
</div>
</div>
<div class="paragraph">
<p>Besides <code>factor</code> and <code>offset</code>, the <code>BaseUnit</code> definition consists of the exponents of the 7 SI base units <code>kg</code>, <code>m</code>, <code>s</code>, <code>A</code>, <code>K</code>, <code>mol</code>, <code>cd</code>, and of the exponent of the SI derived unit <code>rad</code>.
<em>[Depending on the analysis/operation carried out, the SI derived unit <code>rad</code> is or is not utilized, see discussion below.</em>
<em>The additional <code>rad</code> base unit helps to handle the often occurring quantities in technical systems that depend on an angle.]</em></p>
</div>
<div class="paragraph">
<p>A value with respect to <code>Unit</code> (abbreviated as <code>Unit_value</code>) is converted with respect to <code>BaseUnit</code> (abbreviated as <code>BaseUnit_value</code>) by the equation:</p>
</div>
<div class="paragraph">
<p><code>BaseUnit_value = factor * Unit_value + offset</code></p>
</div>
<div class="paragraph">
<p><em>[For example, if</em> \(\color{blue}{p_{bar}}\) <em>is a pressure value in unit <code>bar</code>, and</em> \(\color{blue}{p_{Pa}}\) <em>is the pressure value in <code>BaseUnit</code>, then</em></p>
</div>
<div class="paragraph">
<p>\(\color{blue}{p_{Pa} = 10^5 p_{bar}}\)</p>
</div>
<div class="paragraph">
<p><em>and therefore, <code>factor = 1.0e5</code> and <code>offset = 0.0</code>.</em></p>
</div>
<div class="paragraph">
<p><em>In the following table several unit examples are given (Note that if in column <code>exponents</code> the definition "\(\color{blue}{kgm^2 / s^2}\)" is present, then the attributes of <code>BaseUnit</code> are: <code>kg=1, m=2, s=-2</code>):</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock"><strong>Quantity</strong></p></td>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock"><strong>Unit.name</strong><br>
(examples)</p></td>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>Unit.BaseUnit</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>exponents</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>factor</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>offset</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Torque</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N.m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\color{blue}{kg \cdot m^2 / s^2}\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Energy</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>J</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\color{blue}{kg \cdot m^2 / s^2}\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Pressure</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bar</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\color{blue}{\frac{kg}{m \cdot s^2}}\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0e5</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Angle</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>deg</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.01745329251994330 (= pi/180)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Angular velocity</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Angular velocity</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rpm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.1047197551196598 (=2*pi/60)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Frequency</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hz</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>6.283185307179586</code><br>
<code>(= 2*pi)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Temperature</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&#176;F</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>K</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.5555555555555556</code><br>
<code>(= 5/9)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>255.3722222222222</code><br>
<code>(= 273.15-32*5/9)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Per cent by length</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>%/m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1/m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.01</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Parts per million</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ppm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0e-6</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Length</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>km</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Length</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>yd</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.9144</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Note that <code>Hz</code> is typically used as <code>Unit.name</code> for a frequency quantity, but it can also be used as <code>DisplayUnit</code> for an angular velocity quantity (since <code>revolution/s</code>).]</em></p>
</div>
<div class="paragraph">
<p><em>The <code>BaseUnit</code> definitions can be utilized for different purposes (the following application examples are optional and a tool may also completely ignore the <code>Unit</code> definitions):</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Signal connection check</dt>
<dd>
<div class="paragraph">
<p><em>When two signals v1 and v2 are connected together, and on at least one of the signals no <code>BaseUnit</code> element is defined, then the connection equation "v2 = v1" holds (if v1 is an <a href="#output"><code>output</code></a> of an FMU and v2 is an <a href="#input"><code>input</code></a> of another FMU, with <code>fmi3Get{VariableType}</code> the value of v1 is inquired and used as value for v2 by calling <code>fmi3Set{VariableType}</code>).</em></p>
</div>
<div class="paragraph">
<p><em>When two signals v1 and v2 are connected together, and for both of them <code>BaseUnit</code> elements are defined, then they must have identical exponents of their <code>BaseUnit</code>.</em>
<em>If <code>factor</code> and <code>offset</code> are also identical, again the connection equation <code>v2 = v1</code> holds.</em>
<em>If <code>factor</code> and <code>offset</code> are not identical, the tool may either trigger an error or, if supported, perform a conversion; in other words, use the connection equation (in this case the <code>relativeQuantity</code> of the <code>TypeDefinition</code>, see below, has to be taken into account in order to determine whether <code>offset</code> shall or shall not be utilized):</em></p>
</div>
<div class="paragraph">
<p><code>factor(v1) * v1 + offset(v1) = factor(v2) * v2 + offset(v2)</code></p>
</div>
<div class="paragraph">
<p><em>As a result, wrong connections can be detected (for example, connecting a force with an angle signal would trigger an error) and conversions between, say, US and SI units can be either automatically performed or, if not supported, an error is triggered as well.</em></p>
</div>
<div class="paragraph">
<p><em>[Note that this approach is not satisfactory for variables belonging to different quantities that have, however, the same <code>BaseUnit</code>, such as quantities <code>Energy</code> and <code>Torque</code>, or <code>AngularVelocity</code> and <code>Frequency</code>.</em>
<em>To handle such cases, quantity definitions have to be taken into account (see <code>TypeDefinitions</code>) and quantity names need to be standardized.]</em></p>
</div>
<div class="paragraph">
<p><em>This approach allows a general treatment of units, without being forced to standardize the grammar and allowed values for units (for example, in FMI 1.0, a unit could be defined as <code>N.m</code> in one FMU and as <code>N*m</code> in another FMU, and a tool would have to reject a connection, since the units are not identical. In FMI 2.0, the connection would be accepted, provided both elements have the same <code>BaseUnit</code> definition).</em></p>
</div>
</dd>
<dt class="hdlist1">Dimensional analysis of equations</dt>
<dd>
<div class="paragraph">
<p><em>In order to check the validity of equations in a modeling language, the defined units can be used for dimensional analysis, by using the <code>BaseUnit</code> definition of the respective unit.</em>
<em>For this purpose, the <code>BaseUnit</code> <code>rad</code> has to be treated as <code>1</code>.</em>
<em>Example:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}
J \cdot \alpha = \tau \rightarrow [kg.m^2]*[rad/s^2] = [kg.m^2/s^2] &amp; \quad \text{// o.k. ("rad" is treated as "1")} \\
J \cdot \alpha = f \rightarrow [kg.m^2]*[rad/s^2] = [kg.m/s^2] &amp; \quad \text{// error, since dimensions do not agree}
\end{align*}\]
</div>
</div>
</dd>
<dt class="hdlist1">Unit propagation</dt>
<dd>
<div class="paragraph">
<p><em>If unit definitions are missing for signals, they might be deduced from the equations where the signals are used.</em>
<em>If no unit computation is needed, <code>rad</code> is propagated.</em>
<em>If a unit computation is needed and one of the involved units has <code>rad</code> as a <code>BaseUnit</code>, then unit propagation is not possible.</em>
<em>Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>a = b + c, and <code>Unit</code> of c is provided, but not <code>Unit</code> of a and b:</em><br>
<em>The Unit definition of <code>c</code> (in other words, <code>Unit.name</code>, <code>BaseUnit</code>, <code>DisplayUnit</code>) is also used for <code>a</code> and <code>b</code>.</em>
<em>For example, if BaseUnit(c) = <code>rad/s</code>, then BaseUnit(a) = BaseUnit(b) = <code>rad/s</code>.</em></p>
</li>
<li>
<p><em>a = b*c, and <code>Unit</code> of a and of c is provided, but not <code>Unit</code> of b:</em><br>
<em>If <code>rad</code> is either part of the <code>BaseUnit</code> of <code>a</code> and/or of <code>c</code>, then the <code>BaseUnit</code> of <code>b</code> cannot be deduced (otherwise it can be deduced).</em>
<em>Example: If <code>BaseUnit(a) = kg.m/s2</code> and <code>BaseUnit(c) = m/s2</code>, then the <code>BaseUnit(b) can be deduced to be `kg</code>.</em>
<em>In such a case <code>Unit.name</code> of b cannot be deduced from the <code>Unit.name</code> of <code>a</code> and <code>c</code>, and a tool would typically construct the <code>Unit.name</code> of <code>b</code> from the deduced <code>BaseUnit</code>.</em></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>Additionally to the unit definition, optionally a set of display units can be defined that can be utilized for <a href="#input"><code>input</code></a> / <a href="#output"><code>output</code></a> of a value:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/DisplayUnit.png" alt="DisplayUnit" width="60%">
</div>
</div>
<div class="paragraph">
<p>A <code>DisplayUnit</code> is defined by <code>name</code>, <code>factor</code> and <code>offset</code>.
The attribute <code>name</code> must be unique with respect to all other <code>names</code> of the <code>DisplayUnit</code> definitions of the same <code>Unit</code> [(different <code>Unit</code> elements may have the same <code>DisplayUnit</code> names)].
A value with respect to Unit (abbreviated as <code>Unit_value</code>) is converted with respect to <code>DisplayUnit</code> (abbreviated as <code>DisplayUnit_value</code>) by the equation:</p>
</div>
<div class="paragraph">
<p><code>DisplayUnit_value = factor * Unit_value + offset</code></p>
</div>
<div class="paragraph">
<p><em>[<code>offset</code> is, for example, needed for temperature units.]</em></p>
</div>
<div class="paragraph">
<p><em>[For example, if \(\color{blue}{T_K}\) is the temperature value of <code>Unit.name</code> (in <code>K</code>) and \(\color{blue}{T_F}\) is the temperature value of <code>DisplayUnit</code> (in <code>&#176;F</code>), then</em></p>
</div>
<div class="stemblock">
<div class="content">
\[T_F = (9/5) * (T_K - 273.15) + 32\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, <code>factor = 1.8 (=9/5)</code> and <code>offset = -459.67 (= 32 - 273.15*9/5)</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Both the <code>DisplayUnit.name</code> definitions as well as the <code>Unit.name</code> definitions are used in the variable elements.</em>
<em>Example of a definition:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;Unit name="rad/s"&gt;
    &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;DisplayUnit name="deg/s" factor="57.29577951308232"/&gt;
    &lt;DisplayUnit name="rev/min" factor="9.549296585513721"/&gt;
&lt;/Unit&gt;
 &lt;Unit name="bar"&gt;
    &lt;BaseUnit kg="1" m="-1" s="-2" factor="1e5" offset="0"/&gt;
&lt;/Unit&gt;
 &lt;Unit name="Re"&gt;
    &lt;BaseUnit/&gt; &lt;!-- unit="1" --&gt;
                &lt;!-- (dimensionless, all exponents of BaseUnit are zero) --&gt;
 &lt;/Unit&gt;
 &lt;Unit name="Euro/PersonYear"/&gt;  &lt;!-- no mapping to BaseUnit defined --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>The schema definition is present in a separate file <code>fmi3Unit.xsd</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="definition-of-types">2.2.4. Definition of Types (TypeDefinitions)</h4>
<div class="paragraph">
<p>Element <code>TypeDefinitions</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/TypeDefinitions.png" alt="TypeDefinitions" width="70%">
</div>
</div>
<div class="paragraph">
<p>This element consists of a set of <code>SimpleType</code> definitions according to schema <code>fmi3SimpleType</code> in file <code>fmi3Type.xsd</code>.
One <code>SimpleType</code> has a type <code>name</code> and <code>description</code> as attributes.
Attribute <code>name</code> must be unique with respect to all other elements of the <code>TypeDefinitions</code> list.
Furthermore, <code>name</code> of a <code>SimpleType</code> must be different to all <code>name</code> attributes of variables <em>[if the same names would be used, then this would nearly always give problems when importing the FMU in an environment such as Modelica, where a type name cannot be used as instance name]</em>.
Additionally, one variable type element must be present.
Each variable type has its own attributes which can be consulted in the schema.
The following are representative examples:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Float64.png" alt="Float64" width="60%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Int32.png" alt="Int32" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Boolean.png" alt="Boolean" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Binary.png" alt="Binary" width="70%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Enumeration.png" alt="Enumeration" width="75%">
</div>
</div>
<div class="paragraph">
<p>These definitions are used as default values in variable elements <em>[in order that, say, the definition of a <code>Torque</code> type does not have to be repeated over and over again]</em>.
The attributes and elements have the following meaning:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quantity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical quantity of the variable. <em>[For example, <code>Angle</code>, or <code>Energy</code>.
The quantity names are not standardized]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit of the variable defined with <code>UnitDefinitions.Unit.name</code> that is used for the model equations.
<em>[For example, <code>N.m</code>: in this case a <code>Unit.name = `N.m</code> must be present under <code>UnitDefinitions</code>.]</em>
<em>[Note that for variables that are without a unit, the element should not have a <code>unit</code> attribute.]</em>
<em>[Giving an empty string as a <code>unit</code> attribute specifies a valid unit that needs to be defined among the unit definitions.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="displayUnit"></a> displayUnit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default display unit. The conversion to the <code>unit</code> is defined with the element <code>&lt;fmiModelDescription&gt;&lt;UnitDefinitions&gt;</code>.
If the corresponding <code>displayUnit</code> is not defined under <code>&lt;UnitDefinitions&gt; &lt;Unit&gt; &lt;DisplayUnit&gt;</code>, then <code>displayUnit</code> is ignored.
It is an error if <code>displayUnit</code> is defined as variable type element, but <code>unit</code> is not, or unit is not defined under <code>&lt;UnitDefinitions&gt;&lt;Unit&gt;</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mimeType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the type of data passed as a binary.
Defaults to <code>application/octet-stream</code>, which is unspecific.
Implementations can use this information to provide guidance to the user about valid/useful connections.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relativeQuantity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this attribute is <code>true</code>, then the <code>offset</code> of <code>displayUnit</code> must be ignored.
<em>[For example, 10 degree Celsius = 10 Kelvin if <code>relativeQuantity = true</code> and not 283.15 Kelvin.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum value of variable (variable value \(\geq\) <code>min</code>).
If not defined, the minimum is the largest negative number that can be represented on the machine.
The <code>min</code> definition is information from the FMU to the environment defining the region in which the FMU is designed to operate, see also comment after this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum value of variable (variable value \(\leq\) <code>max</code>).
If not defined, the maximum is the largest positive number that can be represented on the machine.
The <code>max</code> definition is information from the FMU to the environment defining the region in which the FMU is designed to operate, see also comment after this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nominal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nominal value of variable.
If not defined and no other information about the nominal value is available, then nominal = 1 is assumed.<br>
<em>[The nominal value of a variable can be, for example, used to determine the absolute tolerance for this variable as needed by numerical algorithms:</em><br>
<code>absoluteTolerance = nominal * tolerance * 0.01</code><br>
<em>where <code>tolerance</code> is, for example, the relative tolerance defined in <code>&lt;DefaultExperiment&gt;</code>, see <a href="#DefaultExperiment">Section 2.2.6</a>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unbounded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, indicates that during time integration, the variable gets a value much larger than its nominal value <code>nominal</code>.
<em>[Typical examples are the monotonically increasing rotation angles of crank shafts and the longitudinal position of a vehicle along the track in long distance simulations.</em>
<em>This information can, for example, be used to increase numerical stability and accuracy by setting the corresponding bound for the relative error to zero (relative tolerance = 0.0), if the corresponding variable is a continuous <a href="#state"><code>state</code></a> variable.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Items of an enumeration has a sequence of <code>name</code> and <code>value</code> pairs.
The values can be any integer number but must be unique within the same enumeration (in order that the mapping between <code>name</code> and <code>value</code> is bijective).
An <code>Enumeration</code> element must have at least one Item.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Attributes <code>min</code> and <code>max</code> can be set for variables of numeric type or Enumeration.</em>
<em>The question is how <code>fmi3Set{VariableType}</code>, <code>fmi3Get{VariableType}</code> shall utilize this definition.</em>
<em>There are several conflicting requirements:</em><br>
<em>Avoiding forbidden regions (for example, if <code>u</code> is an <a href="#input"><code>input</code></a> and "sqrt(u)" is computed in the FMU, <code>min = 0</code> on <code>u</code> shall guarantee that only values of <code>u</code> in the allowed regions are provided).</em>
<em>Numerical algorithms (ODE-solver, optimizers. nonlinear solvers) do not guarantee constraints.</em>
<em>If a variable is outside of the bounds, the solver tries to bring it back into the bounds.</em>
<em>As a consequence, calling <code>fmi3Get{VariableType}</code> during an iteration of such a solver might return values that are not in the defined min/max region.</em>
<em>After the iteration is finalized, it is only guaranteed that a value is within its bounds up to a certain numerical precision.</em><br>
<em>In debug mode checks on min/max should be performed.</em>
<em>For maximum performance on a real-time system the checks might not be performed.</em><br>
<em>The approach in FMI is therefore that min/max definitions are an information from the FMU to the environment defining the region in which the FMU is designed to operate.</em>
<em>The environment is free to utilize this information (typically, in debug mode of the environment the min/max is checked in the cases as stated above).</em>
<em>In any case, it is expected that the FMU handles variables appropriately where the region definition is critical.</em>
<em>For example, dividing by an <a href="#input"><code>input</code></a> (so the <a href="#input"><code>input</code></a> should not be in a small range of zero) or taking the square root of an <a href="#input"><code>input</code></a> (so the <a href="#input"><code>input</code></a> should not be negative) may either result in <code>fmi3Error</code>, or the FMU is able to handle this situation in other ways.</em></p>
</div>
<div class="paragraph">
<p><em>If the FMU is generated so that min/max shall be checked whenever meaningful (for example, for debug purposes), then the following strategy should be used:</em></p>
</div>
<div class="paragraph">
<p><em>If <code>fmi3Set{VariableType}</code> is called violating the min/max attribute settings of the corresponding variable, the following actions are performed:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>On a <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a> <code>fmi3Status = fmi3Discard</code> is returned.</em></p>
</li>
<li>
<p><em>On an <a href="#input"><code>input</code></a>, the FMU decides what to return (If no computation is possible, it could return <code>fmi3Status = fmi3Discard</code>, in other situations it may return <code>fmi3Warning</code> or <code>fmi3Error</code>, or <code>fmi3OK</code>, if it is uncritical).</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>If an FMU defines min/max values for integer types and Enumerations (<a href="#local"><code>local</code></a> and <a href="#output"><code>output</code></a> variables), then the expected behavior of the FMU is that <code>fmi3Get{VariableType}</code> functions return values in the defined range.</em></p>
</div>
<div class="paragraph">
<p><em>If an FMU defines min/max values for numeric types, then the expected behavior of the FMU is that <code>fmi3Get{VariableType}</code> returns values at the solution (accepted steps of the integrators) in the defined range with a certain uncertainty related to the tolerances of the numerical algorithms.]</em></p>
</div>
<div class="paragraph">
<p><strong>Clock Type Definition</strong> <a id="clock-type-definition"></a></p>
</div>
<div class="paragraph">
<p>Clocks are integrated in the element <code>ModelVariables</code> of fmiModelDescription as a variable element with the base type <code>fmi3Clock</code>.
The variable sub type <code>fmi3Clock</code> provides additional attributes for defining <a href="#clock"><code>clocks</code></a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Attribute-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clockType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of <a href="#clock"><code>clocks</code></a> is defined based on the mandatory attribute <code>clockType</code>.
If the properties of a <a href="#clock"><code>clock</code></a> adhere to synchronous clock theory it is defined with <code>clockType = synchronousTime</code>.
As an additional option for FMI for Hybrid Co-Simulation and FMI for Scheduled Co-Simulation discrete parts (that do not necessarily apply to synchronous clock theory) or continuous parts of the FMU can be associated to model partitions via <a href="#clock"><code>clocks</code></a> whose ticks define the sampling points (i.e. communication points) for the variables of these model partitions.
Clocks that are defined for such cases have <code>clockType = communicationPoint</code> and have to be ignored for Model Exchange.
It is not allowed to include <a href="#clock"><code>clocks</code></a> of different <code>clockType</code> in one FMU.
<code>clockType</code> is a required attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>priority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="#clock"><code>clocks</code></a> are ordered descending based on their priorities.
The priority of a <a href="#clock"><code>clock</code></a> has to be defined via the unsigned integer attribute <code>priority</code> - smaller values have a higher priority.
It is possible to define multiple <a href="#clock"><code>clocks</code></a> with the same priority.
No ordering is defined for <a href="#clock"><code>clocks</code></a> of the same priority.
If a computational order information is needed, different priorities have to be defined.</p>
<p class="tableblock"><em>[For periodic <a href="#clock"><code>clocks</code></a> it is recommended to derive the priorities based on a rate monotonic scheduling scheme (smallest period leads to highest priority (smallest priority value)).]</em></p>
<p class="tableblock"><code>priority</code> is a required attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>periodic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clocks can be periodic or non-periodic. If a <a href="#clock"><code>clock</code></a> is periodic the attribute <code>periodic = true</code>.</p>
<p class="tableblock"><code>periodic</code> is an optional attribute. The default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strict</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a periodic <a href="#clock"><code>clock</code></a> is strictly periodic, the <code>strict</code> attribute is <code>true</code>.
If the optional attribute <code>strict</code> is set to <code>true</code>, then the FMU and the simulation master have to respect the predefined interval and offset.
If the optional attribute <code>strict</code> is set to <code>false</code> another interval or offset can be used, derived from the current simulation setup.</p>
<p class="tableblock"><code>strict</code> is an optional attribute. The default value is <code>false</code>.
It is not allowed to set <code>strict</code> to <code>true</code> if <code>periodic = false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intervalCounter</code>, <code>shiftCounter</code>, <code>resolution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interval of <a href="#output"><code>output</code></a> or <a href="#input"><code>input</code></a> periodic <a href="#clock"><code>clocks</code></a> is a rational number defined with unsignedLong valued <code>intervalCounter</code> and <code>resolution</code></p>
<p class="tableblock"><code>interval = intervalCounter / resolution</code>.</p>
<p class="tableblock">The initial tick of periodic <a href="#clock"><code>clocks</code></a> may be delayed by defining a <code>shiftCounter</code> (default value 0). This results in the actual</p>
<p class="tableblock"><code>offset = interval * shiftCounter / resolution</code>.</p>
<p class="tableblock">More information about clock intervals:
 <a href="#additional-clock-properties">Section 2.1.8.3</a>.</p>
<p class="tableblock">The attributes <code>intervalCounter</code>, <code>shiftCounter</code> and <code>resolution</code> are interval <a href="#start"><code>start</code></a> values for periodic <a href="#clock"><code>clocks</code></a> and must not be used together with non-periodic <a href="#clock"><code>clocks</code></a>.
If <code>strict = true</code> it is required to provide values for <code>intervalCounter</code>, <code>shiftCounter</code> and <code>resolution</code>.</p>
<p class="tableblock"><code>intervalCounter</code> and <code>resolution</code> have no default value.</p></td>
</tr>
</tbody>
</table>
<div id="TypeDefinitions" class="imageblock text-center">
<div class="content">
<img src="images/schema/Clock.png" alt="Clock" width="55%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="definition-of-log-categories">2.2.5. Definition of Log Categories (LogCategories)</h4>
<div class="paragraph">
<p>Element <code>LogCategories</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/LogCategories.png" alt="LogCategories" width="80%">
</div>
</div>
<div class="paragraph">
<p><code>LogCategories</code> defines an unordered set of category strings that can be utilized to define the log output via function <a href="#logMessage"><code>logMessage</code></a>, see <a href="#creation-destruction-and-logging">Section 2.1.5</a>.
A tool is free to use any <code>normalizedString</code> for a category value.
The <code>name</code> attribute of <code>Category</code> must be unique with respect to all other elements of the <code>LogCategories</code> list.</p>
</div>
<div class="paragraph">
<p>There are the following standardized names for <code>Category</code> and these names should be used if a tool supports the corresponding log category.
If a tool supports one of these log categories and wants to expose it, then an element Category with this name should be added to <code>LogCategories</code> <em>[To be clear, only the Category names listed under <code>LogCategories</code> in the XML file are known to the environment in which the FMU is called.]</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Category name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logEvents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log all events (during initialization and simulation).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logSingularLinearSystems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the solution of linear systems of equations if the solution is singular (and the tool picked one solution of the infinitely many solutions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logNonlinearSystems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the solution of nonlinear systems of equations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logDynamicStateSelection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the dynamic selection of <a href="#state"><code>states</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusWarning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <code>fmi3Warning</code> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusDiscard</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <code>fmi3Discard</code> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <code>fmi3Error</code> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusFatal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning <code>fmi3Fatal</code> status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logAll</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log all messages.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The optional attribute <code>description</code> shall contain a description of the respective log category.
<em>[Typically, this string can be shown by a tool if more details for a log category shall be presented.]</em></p>
</div>
<div class="paragraph">
<p><em>[This approach to define <code>LogCategories</code> has the following advantages:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>A simulation environment can present the possible log categories in a menu and the user can select the desired one (in the FMI 1.0 approach, there was no easy way for a user to figure out from a given FMU what log categories could be provided).</em><br>
<em>Note that since element <code>LogCategories</code> is optional, an FMU does not need to expose its log categories.</em></p>
</li>
<li>
<p><em>The log output is drastically reduced, because via <a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a> exactly the categories are set that shall be logged and therefore the FMU only has to print the messages with the corresponding categories to the <a href="#logMessage"><code>logMessage</code></a> function.</em>
<em>In FMI 1.0, it was necessary to provide all log output of the FMU to the <a href="#logMessage"><code>logMessage</code></a> and then a filter in the <a href="#logMessage"><code>logMessage</code></a> could select what to show to the end-user.</em>
<em>The approach introduced in FMI 2.0 is therefore much more efficient.]</em></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="DefaultExperiment">2.2.6. Definition of a Default Experiment (DefaultExperiment)</h4>
<div class="paragraph">
<p>Element <code>DefaultExperiment</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/DefaultExperiment.png" alt="DefaultExperiment" width="60%">
</div>
</div>
<div class="paragraph">
<p><code>DefaultExperiment</code> consists of the optional default start time, stop time, relative tolerance, and step size for the first simulation run.
A tool may ignore this information.
However, it is convenient for a user that <code>startTime</code>, <code>stopTime</code>, <code>tolerance</code> and <code>stepSize</code> have already a meaningful default value for the model at hand.
Furthermore, for Co-Simulation FMUs the <code>stepSize</code> defines the preferred <code>communicationStepSize</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_terminals_terminals">2.2.7. Definition of Terminals (Terminals)</h4>
<div class="sect4">
<h5 id="_rationale">2.2.7.1. Rationale</h5>
<div class="paragraph">
<p>Terminals are fully optional and can be ignored by any importing tool.</p>
</div>
<div class="paragraph">
<p>Definition <code>Terminal</code>: A terminal is&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a structured interface for connections to other models</p>
</li>
<li>
<p>intended to be used for signal flow between models, parameter propagation, and compatibility checks of the model configuration</p>
</li>
<li>
<p>a sequence of references to variables with connection meta data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Predefined rules for variable matching in a connection are given below.
Predefined variable kinds are used to describe how the member variables have to be handled.
Domain specific connection rules, terminals and their member variables can be provided by other standards.</p>
</div>
<div class="paragraph">
<p><em>[Co-simulation errors are not addressed by the terminals.</em>
<em>The co-simulation algorithm has to be chosen and implemented by the importing tool.</em>
<em>Features that might be required for specific co-simulation algorithms had to be implemented by the FMU exporting tool.</em></p>
</div>
<div class="paragraph">
<p><em>Algebraic loops in systems of connected Model Exchange FMUs are not addressed or resolved by the terminals.</em>
<em>It is not required that the <a href="#causality"><code>causality</code></a> of the terminal member variables in connected terminals match.</em></p>
</div>
<div class="paragraph">
<p><em>The SSP standard refers to a <code>connectorKind</code>.</em>
<em>This <code>connectorKind</code> is not related to the <code>terminalKind</code> or <code>variableKind</code> described in the following sections.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_terminals">2.2.7.2. Terminals</h5>
<div class="paragraph">
<p>Element <code>Terminals</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Terminals.png" alt="Terminals" width="80%">
</div>
</div>
<div class="paragraph">
<p>All instances of <code>Terminal</code> have the type <code>fmi3Terminal</code> and are listed in the <code>Terminals</code> sequence.</p>
</div>
<div class="paragraph">
<p>The normalized string attribute <code>name</code> of the <code>Terminal</code> element is the instance name of the terminal. The terminal name must be unique on each level.</p>
</div>
<div class="paragraph">
<p>The normalized string attribute <code>matchingRule</code> describes the rules for variable matching in a connection.
There are three predefined matching rules: plug, bus, and sequence.
Other standards may define new matching rules.
<em>[It is recommended that vendor specific rules start with <code>_vendorName</code> or <code>_toolName</code> to avoid namespace clashes.]</em></p>
</div>
<div class="paragraph">
<p>There is a sequence of terminal member variables, terminal stream member variables, and nested terminals in the <code>Terminal</code> element.
The member variables are the exchanged variables.
The type of the nested terminals is <code>fmi3Terminal</code>, and they can be used to implement structured terminals.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>matchingRule</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em>

<a id="plug"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matching of the variables is based on <code>memberName</code>.
An importing tool should connect terminals only if all member variables are present and match.</p>
<p class="tableblock"><a id="bus"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matching of the variables is based on <code>memberName</code>.
An importing tool may connect terminals if some or no terminal member variables are present.</p>
<p class="tableblock"><a id="sequence"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sequence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matching of the variables is based on the order of the terminal member variables.
An importing tool should connect terminals only if the number of member variables matches.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The normalized string <code>terminalKind</code> is an optional attribute. Other standards may define terminal kinds.
It is intended that the <code>terminalKind</code> is used to define domain specific member variable sequences, member names and order, or high level restrictions for connections.</p>
</div>
<div class="paragraph">
<p><em>[Other terminal kinds should refer to the predefined matchingRules.</em>
<em>Vendor specific terminal kinds should start with <code>_vendorName</code> or <code>_toolName</code> to avoid namespace clashes.</em></p>
</div>
<div class="paragraph">
<p><em>Examples for <code>terminalKind</code>: <code>StandardXXX_Mechanical_Translational</code>, <code>Modelica.Mechanics.Translational.Interfaces.Flange_a</code>, <code>vendorNameA_customTypeA</code>, <code>_vendorNameB_customLibrary_customTypeB</code>.</em></p>
</div>
<div class="paragraph">
<p><em>The structured naming convention of the <code>ModelVariables</code> is <a href="#independent"><code>independent</code></a> from the terminal names and member variable names.</em></p>
</div>
<div class="paragraph">
<p><em>A tool may choose to connect terminals with a different or unknown <code>terminalKind</code>, if the <code>matchingRule</code> matches.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_terminal_member_variable">2.2.7.3. Terminal Member Variable</h5>
<div class="paragraph">
<p>The <code>TerminalMemberVariable</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/TerminalMemberVariable.png" alt="TerminalMemberVariable" width="70%">
</div>
</div>
<div class="paragraph">
<p>The normalized string <code>variableKind</code> is used to provide general information about the variable.
This information defines how the connection of this variable has to be implemented (e.g. Kirchhoff&#8217;s current law or common signal flow).</p>
</div>
<div class="paragraph">
<p>The normalized string <code>memberName</code> is the representation in tools which apply name-based matching in connections.
The member name has to be unique in a terminal.</p>
</div>
<div class="paragraph">
<p>The normalized string <code>variableName</code> is used to identify the terminal member variable in the list of <code>ModelVariables</code>.
<em>[The <code>name</code> attribute of the model variable is equal to the <code>variableName</code> of the <code>TerminalMemberVariable</code>.</em>
<em>An importing tool may use the <code>variableName</code> attribute to identify a specific alias to get additional information, such as minimum, maximum, and nominal values.]</em></p>
</div>
<div class="paragraph">
<p>One variable can be part of several terminals.</p>
</div>
<div class="paragraph">
<p><em>[Tools which apply sequence based matching should also provide unique member names, so that all importing tools which use name based matching use the same member names.</em></p>
</div>
<div class="paragraph">
<p><em>The suggested variable naming scheme for the structured naming convention is &lt;ModelVariable name&gt; = &lt;terminalName&gt;.&lt;memberName&gt;</em>.</p>
</div>
<div class="paragraph">
<p><em>Not all <code>ModelVariables</code> which have the prefix "&lt;terminalName&gt;." are a member variable, and there may exist member variables which don&#8217;t have this prefix.</em></p>
</div>
<div class="paragraph">
<p><em>Example 1 (suggested scheme): &lt;ModelVariable name&gt; is <code>portA.U</code>, &lt;terminalName&gt; is <code>portA</code>, &lt;memberName&gt; is <code>U</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Example 2 (suggested scheme): &lt;ModelVariable name&gt; is <code>hierarchConn.innerConn.U</code>, &lt;outer terminal name&gt; is <code>hierarchConn</code>, &lt;inner terminal name&gt; is <code>innerConn</code>, &lt;memberName&gt; is <code>U</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Example 3 (no prefix): &lt;ModelVariable name&gt; is <code>u</code>, &lt;terminalName&gt; is <code>portA</code>, &lt;memberName&gt; is <code>u</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Example 4 (prefix but not a member): &lt;ModelVariable name&gt; is <code>portA.u</code>, there is a terminal with &lt;terminalName&gt; <code>portA</code>, but this variable is not a terminal member.</em></p>
</div>
<div class="paragraph">
<p><em>The suggested variable naming scheme for the non-structured naming convention is: &lt;ModelVariable name&gt; = &lt;memberName&gt;</em></p>
</div>
<div class="paragraph">
<p><em>Matching is not restricted by <a href="#variability"><code>variability</code></a>, <a href="#causality"><code>causality</code></a> or variable type.</em>
<em>Example: A <a href="#fixed"><code>fixed</code></a> variable may be connected to a <a href="#tunable"><code>tunable</code></a> variable, a variable of type <code>fmi3Float64</code> may be connected to a variable of type <code>fmi3Int32</code>.</em>
<em>However, it is recommended that the variable types and variabilities are equal.</em></p>
</div>
<div class="paragraph">
<p><em>The <code>matchingRule</code> refers to the <code>TerminalMemberVariables</code> on the same level only. Nested terminals can have different <code>matchingRules</code>.</em></p>
</div>
<div class="paragraph">
<p><em>There is no special handling of <a href="#derivative"><code>derivatives</code></a>.</em>
<em>If a <a href="#derivative"><code>derivative</code></a> is a terminal member variable then it is considered as normal member variable.</em>
<em>However, if a <a href="#derivative"><code>derivative</code></a> of a terminal member variable is not terminal member, then this <a href="#derivative"><code>derivative</code></a> information may be used by an importing tool.]</em></p>
</div>
<div class="paragraph">
<p>The predefined variable kinds are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>variableKind</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em>

<a id="signal"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>signal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The values in connected terminals are intended to be equal.
Restricted to <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a> and <a href="#calculatedParameter"><code>calculatedParameter</code></a>.
<em>[Example: Signal flow, parameter propagation, equality checks]</em></p>
<p class="tableblock"><a id="inoutflow"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inflow</code> / <code>outflow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variables which fulfill Kirchhoff&#8217;s current law.
Restricted to <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a> and <a href="#calculatedParameter"><code>calculatedParameter</code></a>.
<em>[Example: Electric current]</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_general_remark_on_signal">2.2.7.4. General remark on signal</h5>
<div class="paragraph">
<p><em>[The signal <code>variableKind</code> can be applied for different use cases.</em>
<em>The first use case is a signal flow from an <a href="#output"><code>output</code></a> of one FMU to an <a href="#input"><code>input</code></a> of another FMU. The <a href="#output"><code>output</code></a> value has to be forwarded to the <a href="#input"><code>input</code></a>.</em></p>
</div>
<div class="paragraph">
<p><em>The signal flow can cause algebraic loops.</em>
<em>If variables in connected terminals have the <a href="#causality"><code>causality</code></a> <a href="#output"><code>output</code></a>, then an importing tool may iterate an undefined <a href="#input"><code>input</code></a> of an FMU to ensure that the connected output values are equal.</em></p>
</div>
<div class="paragraph">
<p><em>Another use case is the parameter propagation.</em>
<em>If a variable in both connected terminals has the <a href="#causality"><code>causality</code></a> <a href="#parameter"><code>parameter</code></a>, then an importing tool could ask the user for the value of one of those <a href="#parameter"><code>parameters</code></a> only, and propagate this value to the other FMU.</em>
<em>If only one of the variables has <a href="#causality"><code>causality</code></a> <a href="#parameter"><code>parameter</code></a>, and the other is a <a href="#constant"><code>constant</code></a> <a href="#output"><code>output</code></a> or <a href="#calculatedParameter"><code>calculatedParameter</code></a>, then the importing tool could also propagate the <a href="#parameter"><code>parameter</code></a> value without presenting a parameter to the user.</em>
<em>One example of use would be the name of a substance flowing through a pipe.</em>
<em>If the fluid flows from one pipe FMU to another, the substance should be the same.</em>
<em>This substance name could be propagated over several FMUs.</em></p>
</div>
<div class="paragraph">
<p><em>Finally the <code>variableKind</code> <code>signal</code> can be applied to implement compatibility checks.</em>
<em>If for example the <a href="#variability"><code>variability</code></a> of the variables in connected terminals are <a href="#constant"><code>constant</code></a>, then the importing tool can implement an equality assertion.</em>
<em>This is also possible with <a href="#calculated"><code>calculated</code></a> <a href="#parameter"><code>parameters</code></a>.</em>
<em>One example of use would be the cross sectional flow area in pipes which is calculated from geometry parameters.</em>
<em>A change in the cross sectional flow area is relevant for the momentum equation, and therefore the connection has to be deemed incompatible if these variables are present and unequal.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_general_remark_on_inflow_and_outflow">2.2.7.5. General remark on inflow and outflow</h5>
<div class="paragraph">
<p><em>[Flow variables have a direction and must fulfill a zero sum constraint i.e. the sum of all flow variables connected together must be zero (Kirchhoff&#8217;s current law).</em>
<em>In addition because different tools might have different direction definitions both, <code>inflow</code> and <code>outflow</code> <code>variableKinds</code> are available.</em>
<em>For variables with <code>inflow</code> a positive value means that the flow is inwards, and for <code>outflow</code> a positive value means that the flow is outwards.</em>
<em>For the sake of simplicity in the following \(\dot{m}_i\) denotes an inflowing quantity:</em></p>
</div>
<div class="paragraph">
<p>\(0 = \sum{\dot{m}_i}\)</p>
</div>
<div class="paragraph">
<p><em>Connecting a single <a href="#output"><code>output</code></a> <code>outflow</code> to a single <a href="#input"><code>input</code></a> <code>inflow</code>, or vice versa automatically fulfills the flow constraint, while connecting two single signals of the same flow type requires a negation of the signal.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_terminal_stream_member_variable">2.2.7.6. Terminal Stream Member Variable</h5>
<div class="paragraph">
<p>The <code>TerminalStreamMemberVariable</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/TerminalStreamMemberVariable.png" alt="TerminalStreamMemberVariable" width="80%">
</div>
</div>
<div class="paragraph">
<p>This element is used for variables which fulfill the balance equation for transported quantities.
It is restricted to <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a>, <a href="#parameter"><code>parameter</code></a> and <a href="#calculatedParameter"><code>calculatedParameter</code></a>.</p>
</div>
<div class="paragraph">
<p>The Stream concept is described in the appendix D.3 of the Modelica specification.
Only one terminal member variable with the <code>variableKind</code> <code>inflow</code> or <code>outflow</code> per terminal is allowed, if a TerminalStreamMemberVariable is present.
<em>[More sophisticated structures can be implemented using hierarchical terminals.]</em></p>
</div>
<div class="paragraph">
<p>The attribute <code>inStreamVariableName</code> and <code>outStreamVariableName</code> are used to identify the <code>ModelVariables</code>.
If the referenced model variables are arrays, then the size of the <code>inStreamVariableName</code> and <code>outStreamVariableName</code> has to be equal.
A terminal may have more than one TerminalStreamMemberVariable.
The <code>inStreamMemberName</code> and <code>outStreamMemberName</code> describe the terminal member name for matching purposes, similar to the <code>memberName</code> attribute in the <code>TerminalMemberVariable</code>.</p>
</div>
<div class="paragraph">
<p><em>[An example of use for an array of stream variables is a gas mixture flow.</em>
<em>The gas composition could be implemented as a mass fraction vector.</em>
<em>The <code>outStreamVariableName</code> refers to</em> \(portA.q_\textit{outStream}\textit{[]}\) <em>and the <code>inStreamVariableName</code> refers to</em>  \(portA.q_\textit{inStream}\textit{[]}\) <em>.</em>
<em>The <code>inStreamMemberName</code> and <code>outStreamMemberName</code> are "</em> \(q_\textit{inStream}\textit{[]}\) <em>" and "</em> \(q_\textit{outStream}\textit{[]}\) <em>".</em></p>
</div>
<div class="paragraph">
<p><em>Balance equation for transported quantities:</em></p>
</div>
<div class="paragraph">
<p><em>\(0 = \sum{q_i\dot{m}_i}\)</em></p>
</div>
<div class="paragraph">
<p><em>\(0 = \sum{\dot{m}_i}\cdot
\left\{\begin{array}{ll}
q_{\textit{$i$, outStream}} &amp;\textit{if $\dot{m}$ is outflowing through terminal $i$}\\
q_{\textit{$i$, inStream}} &amp;\textit{if $\dot{m}$ is inflowing through terminal $i$}
\end{array}\right.\)</em></p>
</div>
<div class="paragraph">
<p><em>The</em> \(q_\textit{$i$, outStream}\) <em>is the convective quantity in case the matter flows out of the FMU.</em>
\(q_\textit{$i$, inStream}\) <em>is the convective quantity in case the matter flows into the FMU. Both variables are present in the terminal.</em>
<em>The outStream variable has the <a href="#causality"><code>causality</code></a> <a href="#output"><code>output</code></a> or <a href="#calculatedParameter"><code>calculatedParameter</code></a> because this information has to be provided by each FMU.</em>
<em>The inStream variable has the <a href="#causality"><code>causality</code></a> <a href="#input"><code>input</code></a> or <a href="#parameter"><code>parameter</code></a>.</em>
<em>To display the actual value in an importing tool, this actual value has to be selected depending on the sign of the terminal member variable with <code>variableKind</code> <code>inflow</code> or <code>outflow</code>.</em>
<em>However, calculating the actual value is not necessary.</em></p>
</div>
<div class="paragraph">
<p><em>If only two terminals with a variable are connected and their <a href="#causality"><code>causality</code></a> matches, then the values of the outStream variables can be forwarded to the corresponding inStream values.</em></p>
</div>
<div class="paragraph">
<p><em>In Modelica the inStream variable is not directly visible, the value can only be accessed using "inStream()", therefore an additional ModelVariable has to be added during the export.</em>
<em>It is suggested that Modelica tools exporting an FMU derive the member name for the inStream variable according to the scheme "&lt;outStream name&gt;_inStream".</em>
<em>E.g. if the outStream name is "h_outflow" then the inStream name should be "h_outflow_inStream".]</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_a_graphical_representation_graphicalrepresentation">2.2.8. Definition of a Graphical Representation (GraphicalRepresentation)</h4>
<div class="sect4">
<h5 id="_rationale_2">2.2.8.1. Rationale</h5>
<div class="paragraph">
<p>The graphical representation of the FMU and terminals are needed in order to more easily comprehend the meaning of connected FMUs and to help an importing tool to display the terminals and the FMU icon in the way the exporter intended.</p>
</div>
<div class="paragraph">
<p>The graphical representation is fully optional.
The graphical representation of terminals is separate from the terminal definitions in the <code>Terminals</code> element.</p>
</div>
<div class="paragraph">
<p>There are three optional elements in the <code>GraphicalRepresentation</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>CoordinateSystem</code> defines the extent of the whole icon (graphical items may exceed that rectangle).</p>
</li>
<li>
<p>The <code>Icon</code> defines an image source for the FMU.</p>
</li>
<li>
<p>The <code>Terminal</code> sequence contains the graphical representation of the visible terminals.</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/GraphicalRepresentation.png" alt="GraphicalRepresentation" width="100%">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_coordinatesystem">2.2.8.2. CoordinateSystem</h5>
<div class="paragraph">
<p>The <code>CoordinateSystem</code> element and its defined extent is used as reference for other graphical items. It also provides a scaling factor to millimeter.</p>
</div>
<div class="paragraph">
<p>The coordinate system is defined by the coordinates of two points, the lower left (<code>x1</code>, <code>y1</code>) corner and the upper right (<code>x2</code>, <code>y2</code>) corner, where the coordinates of the first point shall be less than the coordinates of the second point <em>[a first quadrant coordinate system]</em>.
The x-axis directed to the right, the y-axis is directed upwards.</p>
</div>
<div class="paragraph">
<p><em>[The exporting tool should define how the coordinate system unit relates to mm display or print out size.</em>
<em>However, an importing tool might choose to use the factor from the default coordinate system extent to the actual coordinate system extent to calculate a scaling factor, to match the default icon size in the importing tool.</em></p>
</div>
<div class="paragraph">
<p><em>The area defined by the coordinate system suggested to be used as "clickable icon size" in other tools.</em>
<em>A <code>Terminal</code> might be placed outside of this area, so the visible bounding box has to be determined by the importing tool.]</em></p>
</div>
<div class="paragraph">
<p>The coordinate system default is <code>x1=-100, y1=-100, x2=100, y2=100</code>. This extent is used if the <code>CoordinateSystem</code> element is missing.
The default <code>suggestedScalingFactorTo_mm</code> is 0.1.
So the default coordinate system display size should be 20 mm width and 20 mm height.</p>
</div>
<div class="paragraph">
<p>The FMU icon and all graphical representations provide the position and extent with the attributes <code>x1</code>, <code>y1</code>, <code>x2</code>, <code>y2</code>.
The values of these attributes directly relate to this coordinate system and are not normalized.
Flipping of the FMU icon or a terminal can be realized by setting its attributes <code>x2 &lt; x1</code> or <code>y2 &lt; y1</code> without changing the coordinate system.</p>
</div>
</div>
<div class="sect4">
<h5 id="_icon">2.2.8.3. Icon</h5>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/ModelStructure.png" alt="ModelStructure" width="80%">
</div>
</div>
<div class="paragraph">
<p>The extent and position of the FMU icon are defined in the <code>Icon</code> element.
The optional image file of the FMU icon is placed at the path <code>icon/icon.png</code> in ZIP archive of the FMU. The terminals should not be visible in the image.
Optionally an SVG file can be provided if also the PNG file is present.
This enables high quality rendering and printing in importing tools.
This SVG file has to be placed at the path <code>icon/icon.svg</code> in the ZIP archive.</p>
</div>
<div class="paragraph">
<p>The point (<code>x1</code>, <code>y1</code>) maps to the left lower corner of the PNG image or SVG viewport.
The point (<code>x2</code>, <code>y2</code>) maps to the right upper corner of the PNG image or SVG viewport.</p>
</div>
</div>
<div class="sect4">
<h5 id="_terminals_2">2.2.8.4. Terminals</h5>
<div class="paragraph">
<p>For <code>fmi3Terminals</code> (terminals which are listed in the <code>Terminals</code> element) the name of the terminal in the <code>GraphicalRepresentation</code> is equal to the name of the terminal in the <code>Terminals</code> element (e.g. <code>port_a</code>).
<em>[If the graphical representation is used for an <a href="#input"><code>input</code></a> or <a href="#output"><code>output</code></a> (e.g. a <code>fmi3Float64</code> <a href="#input"><code>input</code></a> <code>u</code>), then a <code>Terminal</code> has to be added to the <code>Terminals</code> element which has one <code>TerminalMemberVariable</code>.</em>
<em>The name of the <code>Terminal</code> and the name of the <code>TerminalMemberVariable</code> should be equal to the name of the <a href="#input"><code>input</code></a> / <a href="#output"><code>output</code></a>.]</em></p>
</div>
<div class="paragraph">
<p>The <code>iconBaseName</code> attribute is mandatory.
This attribute defines the base name of the image file as a relative URI according to RFC 3986.
The base URI that this relative URI is resolved against is the URI of the <code>icon</code> folder in the FMU ZIP archive.
Implementations are only REQUIRED to support relative URIs, excluding relative URIs that move beyond the baseURI (i.e. go "up" a level via ..).
Implementations are NOT REQUIRED to support any absolute URIs and any specific URI schemes.
The PNG file with the extension '.png' has to be provided. An additional SVG file with extension '.svg' is optional.</p>
</div>
<div class="paragraph">
<p><em>[Note that this specification is functionally equivalent to looking up image sources from the icon folder of the FMU ZIP Archive after dot removal from the path as per section 5.2.4 of RFC 3986.]</em></p>
</div>
<div class="paragraph">
<p>The default connection stroke size and color can be provided, to define the intended connection line layout in the importing tool. The stroke size is given relative to the coordinate system extent.
The stroke color is given in RGB values from 0 to 255. E.g.: <code>255 255 0</code>.</p>
</div>
<div class="paragraph">
<p>The VendorAnnotations element can be used by vendors to store additional information for the graphical representation.
<em>[It is suggested that Modelica tools store the Modelica annotation of the connector under the tool name <code>Modelica3Annotation</code> in the attribute <code>annotation</code> of an element <code>connector</code>.</em>
<em>The attribute <code>name</code> of the connector element is equal to the <code>name</code> attribute of the referenced <code>fmi3Terminal</code>.]</em></p>
</div>
<div class="paragraph">
<p><em>[Only terminals from the <code>Terminals</code> element can have a graphical representation.</em>
<em>For simple <a href="#input"><code>inputs</code></a> / <a href="#output"><code>outputs</code></a> a terminal with one member has to be added.]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_placement_extent_and_painting_order_of_graphical_items">2.2.8.5. Placement, Extent, and Painting Order of Graphical Items</h5>
<div class="imageblock text-center">
<div class="content">
<img src="images/GraphicalRepresentation.svg" alt="GraphicalRepresentation" width="70%">
</div>
</div>
<div class="paragraph">
<p>The clickable icon size is defined by the CoordinateSystem element.
The FMU icon itself may exceed this extent (or bounding box).
The bounding box of the terminals is given by the extent in the terminals element.
Their location is neither limited to the extent of the icon nor the extent of the coordinate system.
<em>[An importing tool has to determine the outer bounding box enclosing all graphical items.]</em></p>
</div>
<div class="paragraph">
<p>Transparent SVG or PNG files are allowed and wanted. The order of the elements in the XML file defines the order of painting.
The first element in the GraphicalRepresentation is painted first and therefore behind the others, the last element is painted on top of the others and because of that in front of them.
<em>[So the FMU icon should be placed first in the XML file, terminal below.]</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_vendor_annotations_vendorannotations">2.2.9. Definition of Vendor Annotations (VendorAnnotations)</h4>
<div class="paragraph">
<p>Element <code>VendorAnnotations</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/VendorAnnotations.png" alt="VendorAnnotations" width="80%">
</div>
</div>
<div class="paragraph">
<p><code>VendorAnnotations</code> consist of an ordered set of annotations that are identified by the name of the tool that can interpret the <code>any</code> element.
The <code>any</code> element can be an arbitrary XML data structure defined by the tool.
The attribute <code>name</code> must be unique with respect to all other elements of the <code>VendorAnnotation</code> list.</p>
</div>
</div>
<div class="sect3">
<h4 id="definition-of-model-variables">2.2.10. Definition of Model Variables (ModelVariables)</h4>
<div class="paragraph">
<p>The <code>ModelVariables</code> element of <code>fmiModelDescription</code> is the central part of the model description.
It provides the static information of all exposed variables and is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/ModelVariables.png" alt="ModelVariables" width="60%">
</div>
</div>
<div class="paragraph">
<p>The <code>ModelVariables</code> element consists of an ordered set of variable elements (see figure above).
Variable elements can uniformly represent variables of primitive (atomic) types, like single floating point or integer variables, or as well as arrays of an arbitrary (but fixed) number of dimensions. The schema definition is present in a separate file <code>fmi3Variable.xsd</code>.</p>
</div>
<div class="paragraph">
<p>Variable elements representing array variables must contain at least one <code>Dimension</code> element.
Each <code>Dimension</code> element specifies the size of one dimension of the array:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <a href="#start"><code>start</code></a> attribute of the <code>Dimension</code> element is present, it defines a constant unsigned 64-bit integer size for this dimension.
The <a href="#variability"><code>variability</code></a> of the dimension size is <a href="#constant"><code>constant</code></a> in this case.</p>
</li>
<li>
<p>If the <a href="#valueReference"><code>valueReference</code></a> attribute of the <code>Dimension</code> element is present, it defines the size of this dimension to be the value of the variable with the value reference given by the <a href="#valueReference"><code>valueReference</code></a> attribute.
The referenced variable must be a variable of type <code>UInt64</code>, and must either be a constant (i.e. with <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>) or a <a href="#structuralParameter"><code>structural parameter</code></a>(i.e. with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a>).
The <a href="#variability"><code>variability</code></a> of the dimension size is in this case the <a href="#variability"><code>variability</code></a> of the referenced variable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two options are mutually exclusive, i.e. for each <code>Dimension</code> element either a <a href="#start"><code>start</code></a> attribute or an <a href="#valueReference"><code>valueReference</code></a> attribute can be supplied, but not both.
However different dimension sizes can be specified using different mechanisms and can have differing <a href="#variability"><code>variability</code></a> attributes.</p>
</div>
<div class="paragraph">
<p>All initial dimension sizes (i.e. prior to any configuration or reconfiguration) must be positive integers (i.e. not zero), so that no dimension is initially vanished.
Changes to dimension sizes are constrained by the <code>min</code>/<code>max</code> attributes of the referenced <a href="#structuralParameter"><code>structural parameters</code></a>, which can be any non-negative integer, including zero.
Specifying a minimum size of zero on a <a href="#structuralParameter"><code>structural parameter</code></a>allows any related dimension sizes to be changed to zero in <strong>Configuration Mode</strong> or <strong>Reconfiguration Mode</strong>, thus causing the respective array size to go to zero, which leaves the respective array variable without any active elements.</p>
</div>
<div class="paragraph">
<p>The actual dimension sizes of arrays are also constrained by the FMU platform, due to memory and addressing constraints:
Since the API functions to access variables and their values are constrained to <code>size_t</code> individual elements, platforms with addresses of less than 64-bit width will not be able to access elements beyond their addressing limits, neither will they be able to allocate enough memory or address space to represent such arrays.
For these reasons implementations must take platform-specific constraints into account when changing dimension sizes, and must be prepared to handle the inability of the FMU to adjust to the desired sizes during <strong>Configuration Mode</strong> or <strong>Reconfiguration Mode</strong>.</p>
</div>
<div class="paragraph">
<p>Changing any dimension of a variable in <strong>Configuration Mode</strong> or <strong>Reconfiguration Mode</strong> invalidates the variable&#8217;s current value (including its <a href="#start"><code>start</code></a> value).
It should be noted that changing a <a href="#structuralParameter"><code>structural parameter</code></a> might affect dimension sizes of several variables.</p>
</div>
<div class="paragraph">
<p>It is not possible to use a variable of type <code>Clock</code> in arrays, since array elements do not have individual <a href="#valueReference"><code>valueReference</code></a> and the access to <a href="#clock"><code>clocks</code></a> requires a unique <a href="#valueReference"><code>valueReference</code></a> information.</p>
</div>
<div class="paragraph">
<p>A variable can have any number of <code>&lt;Alias&gt;</code> elements that define a variable alias.
Each variable alias has a required attribute <code>name</code> whose value must be unique among all variables and variable aliases and an optional attribute <code>description</code>.
Variable aliases of floating point variables may additionally have a <a href="#displayUnit"><code>displayUnit</code></a> that follows the same rules as for variables.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs"> &lt;Float64 name="engine.torque" valueReference="1" unit="N.m"&gt;
   &lt;Alias name="engine.torqueLbfFt" description="Engine torque in pound-foot"
     displayUnit="lbf.ft"/&gt;
 &lt;/Float64&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The attributes of variables are:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/fmi3VariableBase.png" alt="fmi3VariableBase" width="80%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Attribute-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The full, unique name of the variable.
Every variable is uniquely identified within an FMU instance by this name.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueReference</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="valueReference" class="paragraph">
<p>A handle of the variable to efficiently identify the variable value in the model interface and for references within the <code>modelDescription.xml</code>.
This handle is a secret of the tool that generated the C functions.
It is required to be unique for an FMU.
This attribute is <code>required</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An optional description string describing the meaning of the variable.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>causality</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="causality" class="paragraph">
<p>Enumeration that defines the causality of the variable.
Allowed values of this enumeration:</p>
</div>
<div id="parameter" class="ulist">
<ul>
<li>
<p><code>parameter</code>: <a href="#independent"><code>independent</code></a> parameter (a data value that is constant during the simulation and is provided by the environment and cannot be used in connections).
<a href="#variability"><code>variability</code></a> must be <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a>.
<a href="#initial"><code>initial</code></a> must be <a href="#exact"><code>exact</code></a> or not present (meaning <a href="#exact"><code>exact</code></a>).</p>
</li>
</ul>
</div>
<div id="calculatedParameter" class="ulist">
<ul>
<li>
<p><code>calculatedParameter</code>: A data value that is constant during the simulation and is computed during initialization or when <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> change.
<a href="#variability"><code>variability</code></a> must be <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a>.
<a href="#initial"><code>initial</code></a> must be <a href="#approx"><code>approx</code></a>, <a href="#calculated"><code>calculated</code></a> or not present (meaning <a href="#calculated"><code>calculated</code></a>).</p>
</li>
</ul>
</div>
<div id="input" class="ulist">
<ul>
<li>
<p><code>input</code>: The variable value can be provided from another model or slave.
It is not allowed to define <a href="#initial"><code>initial</code></a>.</p>
</li>
</ul>
</div>
<div id="output" class="ulist">
<ul>
<li>
<p><code>output</code>: The variable value can be used by another model or slave.
The algebraic relationship to the <a href="#input"><code>inputs</code></a> is defined via the <a href="#dependencies"><code>dependencies</code></a> attribute of <code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;&lt;Output&gt;</code>.</p>
</li>
</ul>
</div>
<div id="local" class="ulist">
<ul>
<li>
<p><code>local</code>: Local variable that is calculated from other variables or is a continuous-time <a href="#state"><code>state</code></a> or an event indicator (see <a href="#ModelStructure">Section 2.2.11</a>).
It is not allowed to use the variable value in another model or slave.</p>
</li>
</ul>
</div>
<div id="independent" class="ulist">
<ul>
<li>
<p><code>independent</code>: The independent variable (usually <code>time</code>).
All variables are a function of this <a href="#independent"><code>independent</code></a> variable.
<a href="#variability"><code>variability</code></a> must be <a href="#continuous"><code>continuous</code></a>.
At most one variable of an FMU can be defined as <a href="#independent"><code>independent</code></a>.
If no variable is defined as <a href="#independent"><code>independent</code></a>, it is implicitly present with name = <code>time</code> and <code>unit = s</code>.
If one variable is defined as <a href="#independent"><code>independent</code></a>, it must be defined with a floating point type without a <a href="#start"><code>start</code></a> attribute.
It is not allowed to call function <code>fmi3Set{VariableType}</code> on an <a href="#independent"><code>independent</code></a> variable.
Instead, its value is initialized with <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a> and after initialization set by <a href="#fmi3SetTime"><code>fmi3SetTime</code></a> for Model Exchange and by arguments <code>currentCommunicationPoint</code> and <code>communicationStepSize</code> of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> for Co-Simulation FMUs.
<em>[The actual value can be inquired with <code>fmi3Get{VariableType}</code>.]</em></p>
</li>
</ul>
</div>
<div id="structuralParameter" class="ulist">
<ul>
<li>
<p><a href="#structuralParameter"><code>structuralParameter</code></a>: <a href="#independent"><code>independent</code></a> parameter (a data value that is constant during the simulation and is provided by the environment and cannot be used in connections). <a href="#variability"><code>variability</code></a> must be <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a>. <a href="#initial"><code>initial</code></a> must be <a href="#exact"><code>exact</code></a> or not present (meaning <a href="#exact"><code>exact</code></a>).
This <a href="#causality"><code>causality</code></a> requires the variable not to have a <code>Dimension</code> element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[</em>
<em>Example:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="XML" class="language-XML hljs">&lt;Variable name="spD" valueReference="126" causality="structuralParameter" variability="fixed"&gt;
  &lt;Integer start="3"/&gt;
&lt;/Variable&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p><a href="#structuralParameter"><code>structural parameters</code></a> that are referenced in <code>Dimension</code> elements may have a <code>min</code> attribute with 0 but the <a href="#start"><code>start</code></a> attribute, which is mandatory for <a href="#structuralParameter"><code>structural parameters</code></a>, must have a value larger than 0 for <a href="#structuralParameter"><code>structural parameters</code></a> used in <code>Dimension</code> elements. [This allows importing tools to ignore <a href="#structuralParameter"><code>structural parameters</code></a> because that <a href="#start"><code>start</code></a> value reflects the internal default setting of that <a href="#structuralParameter"><code>structural parameter</code></a>].</p>
</div>
<div id="inputClock" class="ulist">
<ul>
<li>
<p><code>input</code>: the variable defines an <a href="#inputClock"><code>input clock</code></a> that is controlled by the master.
Variability must be <a href="#clock"><code>clock</code></a>.
Only a variable of type <code>Clock</code> can have this <a href="#causality"><code>causality</code></a>.</p>
</li>
</ul>
</div>
<div id="outputClock" class="ulist">
<ul>
<li>
<p><code>output</code>: the variable defines an <a href="#outputClock"><code>output clock</code></a> that is controlled by the FMU.
Variability must be <a href="#clock"><code>clock</code></a>.
Only a variable of type <code>Clock</code> can have this <a href="#causality"><code>causality</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default of <a href="#causality"><code>causality</code></a> is <a href="#local"><code>local</code></a>.<br>
A continuous-time <a href="#state"><code>state</code></a> or a event indicator must have <a href="#causality"><code>causality</code></a> = <a href="#local"><code>local</code></a> or <a href="#output"><code>output</code></a>, see also <a href="#ModelStructure">Section 2.2.11</a>.</p>
</div>
<div class="paragraph">
<p><em>[<a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a> and <a href="#causality"><code>causality</code></a> = <a href="#local"><code>local</code></a> with <a href="#variability"><code>variability</code></a> = <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> are similar.</em>
<em>The difference is that a <a href="#calculatedParameter"><code>calculatedParameter</code></a> can be used in another model or slave, whereas a <a href="#local"><code>local</code></a> variable cannot.</em>
<em>For example, when importing an FMU in a Modelica environment, a <a href="#calculatedParameter"><code>calculatedParameter</code></a> should be imported in a <code>public</code> section as <code>final parameter</code>, whereas a <a href="#local"><code>local</code></a> variable should be imported in a <code>protected</code> section of the model.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>variability</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="variability" class="paragraph">
<p>Enumeration that defines the time dependency of the variable, in other words, it defines the time instants when a variable can change its value.
<em>[The purpose of this attribute is to define when a result value needs to be inquired and to be stored.</em>
<em>For example, <a href="#discrete"><code>discrete</code></a> variables change their values only at event instants (ME) or at a communication point (xCS) and it is therefore only necessary to inquire them with <code>fmi3Get{VariableType}</code> and store them at event times.]</em>
Allowed values of this enumeration:</p>
</div>
<div id="constant" class="ulist">
<ul>
<li>
<p><code>constant</code>: The value of the variable never changes.</p>
</li>
</ul>
</div>
<div id="fixed" class="ulist">
<ul>
<li>
<p><code>fixed</code>: The value of the variable is fixed after initialization, in other words, after <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> was called the variable value does not change anymore.</p>
</li>
</ul>
</div>
<div id="tunable" class="ulist">
<ul>
<li>
<p><code>tunable</code>: The value of the variable is constant between external events (ME) and between communication points (xCS) due to changing variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> or <a href="#input"><code>input</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>.
Whenever a <a href="#parameter"><code>parameter</code></a> or <a href="#input"><code>input</code></a> signal with <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> changes, an event is triggered externally (ME), or the change is performed at the next communication point (xCS) and the variables with <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> and <a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a> or <a href="#output"><code>output</code></a> must be newly computed.</p>
</li>
</ul>
</div>
<div id="discrete" class="ulist">
<ul>
<li>
<p><code>discrete</code>:<br>
Model Exchange: The value of the variable is constant between external and internal events (= time, state, step events defined implicitly in the FMU).<br>
Co-Simulation: By convention, the variable is from a real sampled data system and its value is only changed at communication points (also inside the slave).</p>
</li>
</ul>
</div>
<div id="continuous" class="ulist">
<ul>
<li>
<p><code>continuous</code>: Only a variable of <code>type = fmi3GetFloat32</code> or <code>type = fmi3GetFloat64</code> can be <a href="#continuous"><code>continuous</code></a>.<br>
Model Exchange: No restrictions on value changes.<br>
Co-Simulation: By convention, the variable is from a differential</p>
</li>
</ul>
</div>
<div id="clock" class="ulist">
<ul>
<li>
<p><code>clock</code>: Only a variable of type <code>Clock</code> can have this variability.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default is <a href="#continuous"><code>continuous</code></a> for variables of type <code>Float32</code> and <code>Float64</code>, and <a href="#discrete"><code>discrete</code></a> for all other types.</p>
</div>
<div class="paragraph">
<p><em>[Note that the information about continuous <a href="#state"><code>states</code></a> is defined with elements <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code>.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initial</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="initial" class="paragraph">
<p>Enumeration that defines how the variable is initialized.
It is not allowed to provide a value for <a href="#initial"><code>initial</code></a> if <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> or <a href="#independent"><code>independent</code></a>:</p>
</div>
<div id="exact" class="ulist">
<ul>
<li>
<p>= <code>exact</code>: The variable is initialized with the <a href="#start"><code>start</code></a> value (provided under the variable type element).</p>
</li>
</ul>
</div>
<div id="approx" class="ulist">
<ul>
<li>
<p>= <code>approx</code>: The variable is an iteration variable of an algebraic loop and the iteration at initialization starts with the <a href="#start"><code>start</code></a> value.</p>
</li>
</ul>
</div>
<div id="calculated" class="ulist">
<ul>
<li>
<p>= <code>calculated</code>: The variable is calculated from other variables during initialization.
It is not allowed to provide a <a href="#start"><code>start</code></a> value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <a href="#initial"><code>initial</code></a> is not present, it is defined by the table below based on <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a>.
If <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a>, or <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, a <a href="#start"><code>start</code></a> value must be provided.
If <a href="#initial"><code>initial</code></a> = <a href="#calculated"><code>calculated</code></a>, or <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>, it is not allowed to provide a <a href="#start"><code>start</code></a> value.</p>
</div>
<div class="paragraph">
<p><em>[The environment decides when to use the <a href="#start"><code>start</code></a> value of a variable with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>.
Examples: (a) automatic tests of FMUs are performed, and the FMU is tested by providing the <a href="#start"><code>start</code></a> value as <a href="#constant"><code>constant</code></a> <a href="#input"><code>input</code></a>.
(b) For a Model Exchange FMU, the FMU might be part of an algebraic loop.
If the <a href="#input"><code>input</code></a> variable is iteration variable of this algebraic loop, then initialization starts with its <a href="#start"><code>start</code></a> value.]</em></p>
</div>
<div class="paragraph">
<p>If <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> the value for <a href="#initial"><code>initial</code></a> has to be set to <a href="#exact"><code>exact</code></a> and it is required to provide a <a href="#start"><code>start</code></a> value for describing the expected initial contidion of master <a href="#clock"><code>clocks</code></a> for that FMU.
If an <a href="#inputClock"><code>input clock</code></a> has <code>fmi3True</code> as an <a href="#start"><code>start</code></a> value the master should activate the <a href="#clock"><code>clock</code></a> the first time it enters <strong>Event Mode</strong>.
The master can nevertheless choose different <a href="#start"><code>start</code></a> values if it is not possible to fulfill the conditions in a simulation setup.</p>
</div>
<div class="paragraph">
<p>If <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> the <a href="#initial"><code>initial</code></a> attribute value is set to <a href="#calculated"><code>calculated</code></a> and no <a href="#start"><code>start</code></a> value is provided.</p>
</div>
<div class="paragraph">
<p>If <code>fmi3Set{VariableType}</code> is not called on a variable with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, then the FMU must use the <a href="#start"><code>start</code></a> value as value of this <a href="#input"><code>input</code></a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canHandleMultipleSetPerTimeInstant</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="canHandleMultipleSetPerTimeInstant" class="paragraph">
<p>Only for Model Exchange (if only a Co-Simulation FMU, this attribute must not be present.
If both Model Exchange and Co-Simulation FMU, this attribute is ignored for co-simulation):<br>
Only for variables with <a href="#variability"><code>variability</code></a> = <a href="#input"><code>input</code></a> :<br>
If present with value equals <code>false</code>, then only one <code>fmi3Set{VariableType}</code> call is allowed at one super-dense time instant (model evaluation) on this variable.
That is, this <a href="#input"><code>input</code></a> is not allowed to appear in a (real) algebraic loop requiring multiple calls of <code>fmi3Set{VariableType}</code> on this variable <em>[for example, due to a Newton iteration]</em>.<br>
<em>[This flag must be set by FMUs where (internal) discrete-time <a href="#state"><code>states</code></a> are directly updated when assigned (xd := f(xd) instead of xd = f(previous(xd)), and at least one <a href="#output"><code>output</code></a> depends on this <a href="#input"><code>input</code></a> and on discrete <a href="#state"><code>states</code></a>.</em><br>
<em>It is strongly recommended that such an FMU checks the fulfillment of the requirement by itself during run-time, because an environment might not be able to check it; usually, there is a generic mechanism to import an FMU in an environment, but the mechanism to connect FMUs together is unrelated to the import mechanism.</em>
<em>For example, there is no mechanism in the Modelica language to formulate connection restrictions for C functions (the FMU) called in a Modelica model.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clockReference</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="clockReference" class="paragraph">
<p>The optional attribute <a href="#clockReference"><code>clockReference</code></a> is used to define the <a href="#clock"><code>clocks</code></a> this variable is assigned to.
This attribute can be used in all variable sub types with restrictions based on the <code>clockType</code>  attribute.
The <a href="#clockReference"><code>clockReference</code></a> holds only <a href="#valueReference"><code>valueReference</code></a> information for variables with base type <code>fmi3Clock</code>.</p>
</div>
<div class="paragraph">
<p>Clock (<code>clockType = STClock</code>): If present, the variable is a clocked variable associated uniquely with the <a href="#clock"><code>clock</code></a> referenced by <a href="#valueReference"><code>valueReference</code></a> and defined in element ModelVariables.
It is not possible to associate more than one <a href="#clock"><code>clock</code></a> to a variable.</p>
</div>
<div class="paragraph">
<p>Communication Point Clock (<code>clockType = communicationPoint</code>): If present, the variable is associated with the <a href="#clock"><code>clock</code></a> referenced by <a href="#valueReference"><code>valueReference</code></a> and defined in element <code>ModelVariables</code>.
It is possible to associate multiple <a href="#clock"><code>clocks</code></a> to a variable.
Variables that are assigned to a Communication Point Clock are not necessarily <code>clocked</code> in the sense of synchronous time clock theory. Such variables can also be continuous-time or discrete-time variables.</p>
</div>
<div class="paragraph">
<p>If <a href="#outputClock"><code>output clocks</code></a> and <a href="#inputClock"><code>input clocks</code></a> of <code>clockType = communicationPoint</code> are defined in the <code>modelDescription.xml</code> it is possible to define a tick relationship from a <a href="#outputClock"><code>output clock</code></a> to an aperiodic <a href="#inputClock"><code>input clock</code></a> based on <a href="#clockReference"><code>clockReference</code></a> (<a href="#clock-relationships-for-communication-point-clocks">Section 2.1.8.3.3</a>).
This is done for aperiodic <a href="#inputClock"><code>input clocks</code></a> that have the <code>clockType = communicationPoint</code> via providing a list of <a href="#valueReference"><code>valueReference</code></a> of <a href="#outputClock"><code>output clocks</code></a> of the same FMU.
If a <a href="#outputClock"><code>output clock</code></a> of this <a href="#valueReference"><code>valueReference</code></a> list ticks the master has to create a tick for the associated aperiodic <a href="#inputClock"><code>input clock</code></a> at the same time instant.
It is not allowed to combine <a href="#outputClock"><code>output clocks</code></a> with periodic or strict periodic <a href="#inputClock"><code>input clocks</code></a> based on <a href="#clockReference"><code>clockReference</code></a>.</p>
</div>
<div class="paragraph">
<p>The attribute <a href="#clockReference"><code>clockReference</code></a> must not be used if <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> for a variable.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>previous</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="previous" class="paragraph">
<p>If present, this variable is a discrete-time <a href="#state"><code>state</code></a> <code>xd</code>.
The value of <code>xd</code> at the previous super-dense time instant is stored in the variable with <a href="#valueReference"><code>valueReference</code></a> <a href="#previous"><code>previous</code></a>.
The <a href="#previous"><code>previous</code></a> variable must have <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> and a <a href="#start"><code>start</code></a> value defined.
<em>[For example, if there are 10 variables and <a href="#previous"><code>previous</code></a> equals 3 for variable 8, then at a super-dense time instant variable 8 holds the value of this discrete <a href="#state"><code>state</code></a> at the actual time instant and variable 3 holds the value of this <a href="#state"><code>state</code></a> from the previous super-dense time instant.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intermediateAccess</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="intermediateAccess" class="paragraph">
<p>If this boolean attribute is <code>true</code>, the variable can be accessed during a communication step.
Variables with <a href="#causality"><code>causality</code></a> <a href="#parameter"><code>parameter</code></a> must not be marked with <a href="#intermediateAccess"><code>intermediateAccess</code></a> = <code>true</code>.
This attribute is only used for Basic Co-Simulation and Hybrid Co-Simulation. The default value of this attribute is <code>false</code>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>fmi3Set{VariableType}</strong> can be called on any variable with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> <strong>before initialization</strong> (before calling <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a> <em>[in order to set the corresponding <a href="#start"><code>start</code></a> value.]</em>
<em>[Note that this prevents any changes to the input before <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> is called.]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>fmi3Set{VariableType}</strong> can be called on any variable with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> <strong>during initialization</strong> (after calling <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> and before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> <em>[in order to set the corresponding <a href="#start"><code>start</code></a> value]</em>, or</p>
</li>
<li>
<p>if <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> <em>[in order to provide new values for <a href="#input"><code>inputs</code></a>]</em>,</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>fmi3Set{VariableType}</strong> can be called on any variable for <strong>Model Exchange at an event instant</strong> (after calling <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> and before <a href="#fmi3EnterContinuousTimeMode"><code>fmi3EnterContinuousTimeMode</code></a> is called), and <strong>for Co-Simulation at every communication point</strong>,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> <em>[in order to change the value of the <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a> at an event instant or at a communication point]</em>, or</p>
</li>
<li>
<p>if <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> <em>[in order to provide new values for <a href="#input"><code>inputs</code></a>]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>fmi3Set{VariableType}</strong> can be called on any variable for <strong>Model Exchange in Continuous-Time Mode</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a><br>
<em>[in order to provide new values for <a href="#input"><code>inputs</code></a> during continuous integration]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <a href="#initial"><code>initial</code></a> is not present, its value is defined by the following tables based on the values of <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3337%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3" rowspan="2"></td>
<td class="tableblock halign-center valign-top" colspan="9"><p class="tableblock"><a href="#causality"><code>causality</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>structual</strong> <a href="#parameter"><code>parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#parameter"><code>parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#calculated"><code>calculated</code></a> <a href="#parameter"><code>parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#output"><code>output</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#local"><code>local</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#independent"><code>independent</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#output"><code>output</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="7"><p class="tableblock"><a href="#variability"><code>variability</code></a></p></td>
<td class="tableblock halign-center valign-top" rowspan="3"><p class="tableblock">data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#constant"><code>constant</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A) or --</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#fixed"><code>fixed</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#tunable"><code>tunable</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">signals</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#discrete"><code>discrete</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="aqua">(D)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#continuous"><code>continuous</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="aqua">(D)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="purple">(E)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#clock"><code>clocks</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#clock"><code>clock</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="brown">(F)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="brown">(G)</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>with</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><a href="#initial"><code>initial</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>default</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>possible values</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="green">exact</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="green">exact</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="maroon">calculated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="maroon">approx,</span><br>
 <span class="maroon">calculated</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#calculated"><code>calculated</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#exact"><code>exact</code></a>,<br>
<a href="#approx"><code>approx</code></a>,<br>
<a href="#calculated"><code>calculated</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="aqua">(D)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="aqua">---</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="aqua">---</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="purple">(E)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="purple">---</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="purple">---</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="brown">(F)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="brown">exact</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="brown">exact</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="brown">(G)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="brown">calculated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="brown">calculated</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Note: (1) If <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>, it is neither allowed to define a value for <a href="#initial"><code>initial</code></a> nor a value for start.</em>
<em>(2) If <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, it is not allowed to define a value for <a href="#initial"><code>initial</code></a> and a value for <a href="#start"><code>start</code></a> must be defined.</em>
<em>(3) If (C) and <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>, then the variable is explicitly defined by its <a href="#start"><code>start</code></a> value in <strong>Initialization Mode</strong> (so directly after calling <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, the value of the variable is either the <a href="#start"><code>start</code></a> value stored in a variable element <code>&lt;XXX start=YYY/&gt;</code> or the value provided by <code>fmi3Set{VariableType}</code>, if this function was called on this variable).]</em></p>
</div>
<div class="paragraph">
<p>The following combinations of <a href="#variability"><code>variability</code></a>/<a href="#causality"><code>causality</code></a> settings are allowed:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3337%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3" rowspan="2"></td>
<td class="tableblock halign-center valign-top" colspan="9"><p class="tableblock"><a href="#causality"><code>causality</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>structural</strong> <a href="#parameter"><code>parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#parameter"><code>parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#calculated"><code>calculated</code></a> <a href="#parameter"><code>parameter</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#output"><code>output</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#local"><code>local</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#independent"><code>independent</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#input"><code>input</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#output"><code>output</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="6"><p class="tableblock"><a href="#variability"><code>variability</code></a></p></td>
<td class="tableblock halign-center valign-top" rowspan="3"><p class="tableblock">data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#constant"><code>constant</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (a)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (a)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (a)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(7)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(10)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (c)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#fixed"><code>fixed</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(16)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(1)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(3)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (d)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (e)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(11)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (c)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#tunable"><code>tunable</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(17)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(2)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(4)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (d)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (e)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(12)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (c)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">signals</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#discrete"><code>discrete</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(5)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(8)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(13)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--(c)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#continuous"><code>continuous</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(6)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(9)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(14)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(15)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">clocks</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#clock"><code>clock</code></a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">18</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">18</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Discussion of the combinations that are not allowed:</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Explanation why this combination is not allowed</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(a)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The combinations <a href="#constant"><code>constant</code></a> / <a href="#parameter"><code>parameter</code></a>, <a href="#constant"><code>constant</code></a> / <a href="#calculatedParameter"><code>calculatedParameter</code></a> and <a href="#constant"><code>constant</code></a> / <a href="#input"><code>input</code></a> do not make sense, since <a href="#parameter"><code>parameters</code></a> and <a href="#input"><code>inputs</code></a> are set from the environment, whereas a constant has always a value.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(b)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The combinations <a href="#discrete"><code>discrete</code></a> / <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#discrete"><code>discrete</code></a> / <a href="#parameter"><code>parameter</code></a>, <a href="#discrete"><code>discrete</code></a> / <a href="#calculatedParameter"><code>calculatedParameter</code></a> , <a href="#continuous"><code>continuous</code></a> / <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#continuous"><code>continuous</code></a> / <a href="#parameter"><code>parameter</code></a> and <a href="#continuous"><code>continuous</code></a> / <a href="#calculatedParameter"><code>calculatedParameter</code></a> do not make sense, since <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a>, <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#calculatedParameter"><code>calculatedParameter</code></a> define variables that do not depend on time, whereas <a href="#discrete"><code>discrete</code></a> and <a href="#continuous"><code>continuous</code></a> define variables where the values can change during simulation.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(c)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>For an <a href="#independent"><code>independent</code></a> variable only <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a> makes sense.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(d)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#input"><code>input</code></a> has exactly the same properties as a <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a>.</em>
<em>For simplicity, only <a href="#fixed"><code>fixed</code></a> and <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> shall be defined.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(e)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#output"><code>output</code></a> has exactly the same properties as a <a href="#fixed"><code>fixed</code></a> or <a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a>.</em>
<em>For simplicity, only <a href="#fixed"><code>fixed</code></a> and <a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameters</code></a> shall be defined.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Discussion of the combinations that are allowed</em>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 25%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><em>Setting</em></th>
<th class="tableblock halign-left valign-top"><em>Example</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(1)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Non-<a href="#tunable"><code>tunable</code></a> <a href="#independent"><code>independent</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(2)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>Tunable</code></a> <a href="#independent"><code>independent</code></a> <a href="#parameter"><code>parameter</code></a> (changing such a <a href="#parameter"><code>parameter</code></a> triggers an external event (ME) or takes effect at the next communication point (xCS), and <a href="#tunable"><code>tunable</code></a> <a href="#calculatedParameter"><code>calculatedParameter</code></a>/<a href="#output"><code>output</code></a>/<a href="#local"><code>local</code></a> variables might change their values).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(3)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#dependenciesKind"><code>dependent</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Non-<a href="#tunable"><code>tunable</code></a> <a href="#dependenciesKind"><code>dependent</code></a> <a href="#parameter"><code>parameter</code></a> (variable that is computed directly or indirectly from constants or <a href="#parameter"><code>parameters</code></a>).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(4)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#dependenciesKind"><code>dependent</code></a> <a href="#parameter"><code>parameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>Tunable</code></a> <a href="#dependenciesKind"><code>dependent</code></a> <a href="#parameter"><code>parameter</code></a> (changing an <a href="#independent"><code>independent</code></a> <a href="#parameter"><code>parameter</code></a> triggers an external event (ME) or takes effect at the next communication point (xCS), and <a href="#tunable"><code>tunable</code></a> <a href="#dependenciesKind"><code>dependent</code></a> <a href="#parameter"><code>parameters</code></a> and <a href="#tunable"><code>tunable</code></a> <a href="#local"><code>local</code></a> variables might change their values).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(5)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>discrete</code></a> <a href="#input"><code>input</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>Discrete</code></a> <a href="#input"><code>input</code></a> variable from another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(6)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#input"><code>input</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>Continuous</code></a> <a href="#input"><code>input</code></a> variable from another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(7)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#constant"><code>constant</code></a> <a href="#output"><code>output</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable where the value never changes and that can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(8)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>discrete</code></a> <a href="#output"><code>output</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>Discrete</code></a> variable that is computed in the FMU.</em>
<em>Can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(9)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#output"><code>output</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>Continuous</code></a> variable that is computed in the FMU and can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(10)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#constant"><code>constant</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable where the value never changes.</em>
<em>Cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(11)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local variable that depends on <a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameters</code></a> only and is computed in the FMU.</em>
<em>Cannot be used in another model.</em>
<em>After initialization, the value of this <a href="#local"><code>local</code></a> variable cannot change.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(12)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local variable that depends on <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> only and is computed in the FMU.</em>
<em>Cannot be used in another model.</em>
<em>The value of this <a href="#local"><code>local</code></a> variable can only change during initialization and at event instants, provided a <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a> was changed.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(13)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>discrete</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#discrete"><code>Discrete</code></a> variable that is computed in the FMU and cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(14)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#local"><code>local</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>Continous</code></a> variable that is computed in the FMU and cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(15)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#continuous"><code>continuous</code></a> <a href="#independent"><code>independent</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>All variables are a function of the continuous-time variable marked as <a href="#independent"><code>independent</code></a>.</em>
<em>Usually, this is `time`</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(16)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#fixed"><code>fixed</code></a> structual <a href="#parameter"><code>parameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#parameter"><code>Paramter</code></a> used in  <code>Dimension</code> element;  can be changed before initialization in *Configuration Mode*</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(17)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#tunable"><code>tunable</code></a> structual <a href="#parameter"><code>parameter</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#parameter"><code>Parameter</code></a> used in  <code>Dimension</code> element;  can be changed before initialization in <strong>Configuration Mode</strong> and in in *Reconfiguration Mode*</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(18)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em><a href="#clock"><code>clock</code></a></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable that defines a <a href="#clock"><code>clock</code></a></em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>How to treat <a href="#tunable"><code>tunable</code></a> variables:</em></p>
</div>
<div class="paragraph">
<p><em>A <a href="#parameter"><code>parameter</code></a> p is a variable that does not change its value during simulation, in other words, dp/dt = 0.</em>
<em>If the <a href="#parameter"><code>parameter</code></a> p is changing, then Dirac impulses are introduced since dp/dt of a discontinuous <a href="#constant"><code>constant</code></a> variable <code>p</code> is a Dirac impulse.</em>
<em>Even if this Dirac impulse would be modeled correctly by the modeling environment, it would introduce unwanted <code>vibrations</code>.</em>
<em>Furthermore, in many cases the model equations are derived under the assumption of a <a href="#constant"><code>constant</code></a> value (like mass or capacity), and the model equations would be different if <code>p</code> would be time varying.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Model Exchange:</em><br>
<em>Therefore, "tuning a (structural) <a href="#parameter"><code>parameter</code></a>" during simulation does not mean to "change the parameter online" during simulation.</em>
<em>Instead, this is a short hand notation for:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Stop the simulation at an event instant (usually, a step event, in other words, after a successful integration step).</em></p>
</li>
<li>
<p><em>Change the values of the <a href="#tunable"><code>tunable</code></a> (structural) <a href="#parameter"><code>parameters</code></a>. For <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a>, the <strong>Reconfiguration Mode</strong> must be entered before and left afterwards.</em></p>
</li>
<li>
<p><em>Compute all <a href="#parameter"><code>parameters</code></a> (and sizes of variables, <a href="#state"><code>states</code></a>, <a href="#derivative"><code>derivatives</code></a>, event indicators, &#8230;&#8203;) that depend on the <a href="#tunable"><code>tunable</code></a> (structural) <a href="#parameter"><code>parameters</code></a>.</em></p>
</li>
<li>
<p><em>Newly start the simulation using as initial values the current values of all <a href="#previous"><code>previous</code></a> variables and the new values of the <a href="#parameter"><code>parameters</code></a>.</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Basically this means that a new simulation run is started from the previous FMU state with changed <a href="#parameter"><code>parameter</code></a> values.</em>
<em>With this interpretation, changing <a href="#parameter"><code>parameters</code></a> online is "clean", as long as these changes appear at an event instant.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Basic Co-Simulation and FMI for Hybrid Co-Simulation:</em>
<em>Changing of <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> is allowed before an <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> call (so, whenever an <a href="#input"><code>input</code></a> can be set with <code>fmi3Set{VariableType}</code>) and before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called (that is before and during <strong>Initialization Mode</strong>).</em>
<em>The FMU internally carries out event handling if necessary.]</em></p>
</div>
<div class="paragraph">
<p>Type specific properties are defined in the required choice element, where exactly one of the numeric types or an Enumeration must be present in the XML file.
The following are representative examples:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Variable_Float64.png" alt="Variable Float64" width="70%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Variable_Int32.png" alt="Variable Int32" width="70%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Variable_Boolean.png" alt="Variable Boolean" width="70%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Variable_Binary.png" alt="Variable Binary" width="70%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/Variable_Enumeration.png" alt="Variable Enumeration" width="70%">
</div>
</div>
<div class="paragraph">
<p>The attributes are defined in <a href="#definition-of-types">Section 2.2.4</a> (<code>TypeDefinitions</code>), except:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Attribute-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>declaredType</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If present, name of type defined with <code>TypeDefinitions / SimpleType</code>.
The value defined in the corresponding <code>TypeDefinition</code> (see <a href="#definition-of-types">Section 2.2.4</a>) is used as default.
<em>[For example, if <code>min</code> is present both in variable type element of <code>TypeDefinition</code> and in the concrete variable type element of the variable, then the <code>min</code> of the variable is actually used.]</em>
For numeric types and <code>String</code>, this attribute is optional.
For <code>Enumeration</code> it is required, because the Enumeration items are defined in <code>TypeDefinitions / SimpleType</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="start" class="paragraph">
<p>Initial or guess value of variable.
<strong>This value is also stored in the C functions</strong>.
<em>[Therefore, calling</em> <code>fmi3Set{VariableType}</code> <em>to set <a href="#start"><code>start</code></a> values is only necessary, if a different value as stored in the XML file is desired.</em>
<em>It is not allowed to change the start values in the <code>modelDescription.xml</code> file of an FMU, as this would break the consistency with the hard-coded start values in the C-Code.</em>
<em>This could lead to unpredictable behavior of the FMU in different importing tools, as it is not mandatory to call <code>fmi3Set{VariableType}</code> to set start values during initialization.</em>
<em>Instead it is recommended to use the SSP Standard (<a href="https://ssp-standard.org/" class="bare">https://ssp-standard.org/</a>) to handle modified parameters of FMUs or different parameter sets.]</em></p>
</div>
<div class="paragraph">
<p>The interpretation of <a href="#start"><code>start</code></a> is defined by variable attribute <a href="#initial"><code>initial</code></a>.
A different <a href="#start"><code>start</code></a> value can be provided with an <code>fmi3Set{VariableType}</code> function before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called (but not for variables with <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>).</p>
</div>
<div class="paragraph">
<p><em>[The standard approach is to set the <a href="#start"><code>start</code></a> value before <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>.</em>
<em>However, if the initialization shall be modified in the calling environment (for example, changing from initialization of states to steady-state initialization), it is also possible to use the <a href="#start"><code>start</code></a> value as iteration variable of an algebraic loop: using an additional condition in the environment, such as</em> \(\color{blue}{\dot{x} = 0}\) <em>, the actual <a href="#start"><code>start</code></a> value is determined.]</em></p>
</div>
<div class="paragraph">
<p>If <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a> or <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, a <a href="#start"><code>start</code></a> value must be provided.</p>
</div>
<div class="paragraph">
<p>If <a href="#initial"><code>initial</code></a> = <a href="#calculated"><code>calculated</code></a> or <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>, it is not allowed to provide a <a href="#start"><code>start</code></a> value.</p>
</div>
<div class="paragraph">
<p>Variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> or <a href="#input"><code>input</code></a>, as well as variables with <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>, must have a <a href="#start"><code>start</code></a> value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a>, the start-value is the value of it.</p>
</li>
<li>
<p>If <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, the <a href="#start"><code>start</code></a> value is used by the model as value of the <a href="#input"><code>input</code></a>, if the <a href="#input"><code>input</code></a> is not set by the environment.</p>
</li>
<li>
<p>If <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a>, the <a href="#start"><code>start</code></a> value is the value of the constant.</p>
</li>
<li>
<p>If <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> or <a href="#local"><code>local</code></a>, then the <a href="#start"><code>start</code></a> value is either an <a href="#initial"><code>initial</code></a> or a <code>guess</code> value, depending on the setting of attribute <a href="#initial"><code>initial</code></a>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>derivative</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="derivative" class="paragraph">
<p>If present, this variable is the derivative of variable with value reference <code>derivative</code>.
<em>[For example, if there are 10 variables and <code>derivative = 3</code> for variable 8, then variable 8 is the derivative of variable 3 with respect to the <a href="#independent"><code>independent</code></a> variable (usually time).</em>
<em>This information might be especially used if an <a href="#input"><code>input</code></a> or an <a href="#output"><code>output</code></a> is the derivative of another <a href="#input"><code>input</code></a> or <a href="#output"><code>output</code></a>, or to define the <a href="#state"><code>states</code></a>.]</em></p>
</div>
<div class="paragraph">
<p>The <a href="#state"><code>state</code></a> <a href="#derivative"><code>derivatives</code></a> of an FMU are listed as elements <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code>.
All variables listed in this element must have attribute <code>derivative</code> (in order that the continuous-time <a href="#state"><code>states</code></a> are uniquely defined).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reinit</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Only for Model Exchange (if only a Co-Simulation FMU, this attribute must not be present.
If both Model Exchange and a Co-Simulation FMU, this attribute is ignored for co-simulation):<br>
Can only be present for a continuous-time <a href="#state"><code>state</code></a>.<br>
If <code>true</code>, <a href="#state"><code>state</code></a> can be reinitialized at an event by the FMU.<br>
If <code>false</code>, <a href="#state"><code>state</code></a> will not be reinitialized at an event by the FMU.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min / max</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The optional attributes <code>min</code> and <code>max</code> in element <code>Enumeration</code> restrict the allowed values of the enumeration.
The <code>min/max</code> definitions are information from the FMU to the environment defining the region in which the FMU is designed to operate, see also comment in <a href="#definition-of-types">Section 2.2.4</a>.
<em>[If, for example, an <code>Enumeration</code> is defined with <code>name1 = -4</code>, <code>name2 = 1</code>, <code>name3 = 5</code>, <code>name4 = 11</code> and <code>min = -2</code>, <code>max = 5</code>, then only <code>name2</code> and <code>name3</code> are allowed.]</em></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With element <code>Annotations</code> additional, tool specific data can be defined:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/schema/Annotations.png" alt="Annotations" width="80%">
</div>
</div>
<div class="paragraph">
<p>With <code>Tool.name</code> the name of the tool is defined that can interpret the <code>any</code> element.
The <code>any</code> element can be an arbitrary XML data structure defined by the tool.
<em>[Typically, additional data is defined here how to build up the menu for the variable, including the graphical layout and enabling/disabling an input field based on the values of other <a href="#parameter"><code>parameters</code></a>.]</em>
The attribute <code>name</code> must be unique with respect to all other elements of the <code>Annotations</code> list.</p>
</div>
</div>
<div class="sect3">
<h4 id="ModelStructure">2.2.11. Definition of the Model Structure (ModelStructure)</h4>
<div class="paragraph">
<p>The structure of the model is defined in element <code>ModelStructure</code> within <code>fmiModelDescription</code>.
This structure is with respect to the underlying model equations, independently how these model equations are solved.
<em>[For example, when exporting a model in more than one FMI format; then the model structure is identical in all cases.</em>
<em>E.g. a Basic Co-Simulation FMU has either an integrator included that solves the model equations, or the discretization formula of the integrator and the model equations are solved together ("inline integration").</em>
<em>In all cases the model has the same continuous-time <a href="#state"><code>states</code></a>.</em>
<em>In the case of a Model-Exchange FMU, the internal implementation is a discrete-time system, but from the outside this is still a continuous-time model that is solved with an integration method.]</em></p>
</div>
<div class="paragraph">
<p>The required part defines an ordering of the <a href="#output"><code>outputs</code></a>, the (exposed) <a href="#derivative"><code>derivatives</code></a>, the event indicators and defines the unknowns that are available during Initialization <em>[Therefore, when linearizing an FMU, every tool will use the same ordering for the <a href="#output"><code>outputs</code></a>, <a href="#state"><code>states</code></a>, and <a href="#derivative"><code>derivatives</code></a> for the linearized model.
The ordering of the <a href="#input"><code>inputs</code></a> should be performed in this case according to the ordering in <code>ModelVariables</code>.]</em>
A Model Exchange FMU must expose all <a href="#derivative"><code>derivatives</code></a> of its continuous-time <a href="#state"><code>states</code></a> in elements <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code> and must expose all event indicators in elements <code>EventIndicator</code>.
A Co- Simulation FMU does not need to expose these state derivatives and event indicators.
<em>[If a Basic Co-Simulation FMU exposes its state derivatives, they are usually not utilized for the co-simulation, but, for example, to linearize the FMU at a communication point.]</em></p>
</div>
<div class="paragraph">
<p>The optional part defines in which way <a href="#derivative"><code>derivatives</code></a>, <a href="#output"><code>outputs</code></a> and unitial unknowns depend on <a href="#input"><code>inputs</code></a>, and continuous-time <a href="#state"><code>states</code></a> at the current super-dense time instant (ME) or at the current communication point (xCS).
<em>[The listed <a href="#dependencies"><code>dependencies</code></a> declare the dependencies between whole (multi-dimensional-)variables and not individual elements of the variables.]</em>
<em>[A simulation environment can utilize this information to improve the efficiency, for example, when connecting FMUs together, or when computing the partial derivative of the <a href="#derivative"><code>derivatives</code></a> with respect to the <a href="#state"><code>states</code></a> in the simulation engine.]</em></p>
</div>
<div class="paragraph">
<p><code>ModelStructure</code> has the following definition:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/schema/ModelStructure.png" alt="ModelStructure" width="90%">
</div>
</div>
<div class="paragraph">
<p>Note that attribute <a href="#dependenciesKind"><code>dependenciesKind</code></a> for element <a href="#InitialUnknown"><code>InitialUnknown</code></a> has less enumeration values as <a href="#dependenciesKind"><code>dependenciesKind</code></a> in the other lists, see below.</p>
</div>
<div class="paragraph">
<p><code>ModelStructure</code> consists of the following elements (see also figures above; the symbols of the mathematical equations describing the dependency are defined in <a href="#math-model-exchange">Section 3.1</a>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Element-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Output</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordered list of all outputs, in other words, a list of value references where every corresponding variable must have <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> (and <strong>every variable with <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> must be listed here</strong>).
<em>[Note that all <a href="#output"><code>output</code></a> variables are listed here, especially <a href="#discrete"><code>discrete</code></a> and <a href="#continuous"><code>continuous</code></a> <a href="#output"><code>outputs</code></a>.</em>
<em>The ordering of the variables in this list is defined by the exporting tool.</em>
<em>Usually, it is best to order according to the declaration order in the source model, since then the <code>&lt;Output&gt;</code> list does not change if the declaration order of <a href="#output"><code>outputs</code></a> in the source model is not changed.</em>
<em>This is for example, important for linearization, in order that the interpretation of the output vector does not change for a re-exported FMU.]</em>
Attribute <a href="#dependencies"><code>dependencies</code></a> defines the dependencies of the <a href="#output"><code>outputs</code></a> from the knowns at the current super-dense time instant in Event and in <strong>Continuous-Time Mode</strong> (ME) and at the current communication point (xCS).
Beside the knowns the <a href="#output"><code>outputs</code></a> also depend on the freeze variables (= variables which cannot be changed in the current mode) but these freeze variables are not listed as <a href="#dependencies"><code>dependencies</code></a>.
The functional dependency is defined as (dependencies of variables that are fixed in Event and <strong>Continuous-Time Mode</strong> and at communication points are not shown):<br>
<span class="blue">\(\color{blue}{(\mathbf{y}_c, \mathbf{y}_d) := \mathbf{f}_{output}(\mathbf{x}_c, \mathbf{u}_c, \mathbf{u}_d, t, \mathbf{p}_{tune})}\)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Derivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordered list of all state derivatives, in other words, a list of value references where every corresponding variable must be a state derivative.
<em>[Note that only <a href="#continuous"><code>continuous</code></a> floating point variables are listed here.</em>
<em>If a <a href="#state"><code>state</code></a> or a <a href="#derivative"><code>derivative</code></a> of a <a href="#state"><code>state</code></a> shall not be exposed from the FMU, or if states are not statically associated with a variable (due to dynamic state selection), then dummy variables have to be introduced, for example, <code>x[4]</code>, or <code>xDynamicStateSet2[5]</code>.</em>
<em>The ordering of the variables in this list is defined by the exporting tool.</em>
<em>Usually, it is best to order according to the declaration order of the <a href="#state"><code>states</code></a> in the source model, since then the <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code> list does not change if the declaration order of states in the source model is not changed.</em>
<em>This is for example, important for linearization, in order that the interpretation of the state vector does not change for a re-exported FMU.]</em></p>
<p class="tableblock">The corresponding continuous-time <a href="#state"><code>states</code></a> are defined by attribute <a href="#derivative"><code>derivative</code></a> of the corresponding variable state derivative element.
<em>[Note that higher order derivatives must be mapped to first order derivatives but the mapping definition can be preserved due to attribute <a href="#derivative"><code>derivative</code></a>.</em>
<em>Example: if</em> \(\color{blue}{\frac{\text{ds}}{\text{dt}} = v,\ \frac{\text{dv}}{\text{dt}} =f(..)}\) <em>,then</em> \(\color{blue}{\left\{ v,\ \frac{\text{dv}}{\text{dt}} \right\}}\) <em>is the vector of state derivatives and attribute <a href="#derivative"><code>derivative</code></a> of</em> \(\color{blue}{v}\) <em>references</em> \(\color{blue}{s}\) <em>, and attribute <a href="#derivative"><code>derivative</code></a> of</em> \(\color{blue}{\frac{\text{dv}}{\text{dt}}}\) <em>references</em> \(\color{blue}{v}\) <em>.]</em><br>
For Co-Simulation, elements <code>Derivative</code> are ignored if capability flag <code>providesDirectionalDerivative</code> has a value of <code>false</code>, in other words, it cannot be computed.
<em>[This is the default.</em>
<em>If an FMU supports more than Model Exchange , then the <code>Derivative</code> elements might be present, since it is needed for Model Exchange.</em>
<em>If the above flag is set to <code>false</code> for the Co-Simulation cases, then the <code>Derivative</code> elements are ignored for Co-Simulation.</em>
<em>If "inline integration" is used for a co-simulation slave, then the model still has continuous-time <a href="#state"><code>states</code></a> and just a special solver is used (internally the implementation results in a discrete-time system, but from the outside, it is still a continuous-time system).]</em><br>
Attribute <a href="#dependencies"><code>dependencies</code></a> defines the dependencies of the state derivatives from the knowns at the current super-dense time instant in Event and in <strong>Continuous-Time Mode</strong> (ME) and at the current communication point (xCS).
Beside the knowns the derivatives also depend on the freeze variables (= variables which cannot be changed in the current mode) but these freeze variables are not listed as <a href="#dependencies"><code>dependencies</code></a>.
The functional dependency is defined as (dependencies of variables that are fixed in Event and <strong>Continuous-Time Mode</strong> and at communication points are not shown):<br>
<span class="blue">\(\color{blue}{\dot{\mathbf{x}_c} := \mathbf{f}_{der}(\mathbf{x}_c, \mathbf{u}_c, \mathbf{u}_d, t, \mathbf{p}_{tune})}\)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitialUnknown</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div id="InitialUnknown" class="paragraph">
<p>Ordered list of all exposed unknowns in <strong>Initialization Mode</strong>.
This list consists of all variables with</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> and (<a href="#initial"><code>initial</code></a> = <a href="#approx"><code>approx</code></a> or <a href="#calculated"><code>calculated</code></a>), and</p>
</li>
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a> and</p>
</li>
<li>
<p>all continuous-time <a href="#state"><code>states</code></a> and all state derivatives (defined with elements <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code>) with <a href="#initial"><code>initial</code></a> = <a href="#approx"><code>approx</code></a> or <a href="#calculated"><code>calculated</code></a> <em>[if a Basic Co-Simulation FMU does not define the <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code> elements, (3) cannot be present]</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The resulting list is not allowed to have duplicates (for example, if a <a href="#state"><code>state</code></a> is also an <a href="#output"><code>output</code></a>, it is included only once in the list).<br>
Attribute <a href="#dependencies"><code>dependencies</code></a> defines the dependencies of the unknowns from the knowns in <strong>Initialization Mode</strong> at the initial time.
Beside the knowns the initial unknowns also depend on the freeze variables (= variables which cannot be changed in the current mode) but these freeze variables are not listed as <a href="#dependencies"><code>dependencies</code></a>.
The functional dependency is defined as:</p>
</div>
<div class="paragraph">
<p><span class="blue">\(\color{blue}{\mathbf{v}_{initialUnknowns} := \mathbf{f}_{init}(\mathbf{u}_c, \mathbf{u}_d, t_0, \mathbf{v}_{initial=exact})}\)</span></p>
</div>
<div class="paragraph">
<p>Since, <a href="#output"><code>outputs</code></a>, continuous-time <a href="#state"><code>states</code></a> and state derivatives are either present as knowns (if <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>) or as unknowns (if <a href="#initial"><code>initial</code></a> = <a href="#approx"><code>approx</code></a> or <a href="#calculated"><code>calculated</code></a>), they can be inquired with <code>fmi3Get{VariableType}</code> in <strong>Initialization Mode</strong>.</p>
</div>
<div class="paragraph">
<p><em>[Example: Assume an FMU is defined in the following way:</em></p>
</div>
<div class="paragraph">
<p>\(\color{blue}{(\mathbf{y}_{c+d}, \dot{\mathbf{x}}_c) := \mathbf{f}_{init}(\mathbf{x}_c, \mathbf{u}_{c+d}, t_0, \mathbf{p})}\)<br></p>
</div>
<div class="paragraph">
<p>\(\color{blue}{(\mathbf{y}_{c+d}, \dot{\mathbf{x}}_c) := \mathbf{f}_{sim}(\mathbf{x}_c, \mathbf{u}_{c+d}, t_i, \mathbf{p})}\)<br></p>
</div>
<div class="paragraph">
<p><em>Therefore, the initial state \(\color{blue}{\mathbf{x}_c(t_0)}\) has <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> and the initial state derivative \(\color{blue}{\dot{\mathbf{x}}_c(t_0)}\) has <a href="#initial"><code>initial</code></a> = <a href="#calculated"><code>calculated</code></a>.</em>
<em>The environment can still initialize this FMU in steady-state, by using \(\color{blue}{\mathbf{x}_c(t_0)}\) as iteration variables and adding the equations \(\color{blue}{\dot{\mathbf{x}}_c(t_0) = \mathbf{0}}\) in the environment.]</em></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EventIndicator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="EventIndicator"></a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Elements <code>&lt;Output&gt;</code>, <code>&lt;Derivative&gt;</code> and <code>&lt;InitialUnknown&gt;</code> have the following attributes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Attribute-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueReference</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value reference of the unknown \(\color{blue}{v_{\text{unknown}}}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependencies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="dependencies"></a>
Optional attribute defining the dependencies of the unknown \(\color{blue}{v_{\text{unknown}}}\) (directly or indirectly via auxiliary variables) with respect to \(\color{blue}{\mathbf{v}_{\text{known}}}\).
If not present, it must be assumed that the unknown depends on all knowns.
If present as empty list, the unknown depends on none of the knowns.
Otherwise the unknown depends on the knowns defined by the given value references.<br>
Knowns \(\color{blue}{\mathbf{v}_{\text{known}}}\) in <strong>Event Mode</strong> and <strong>Continuous-Time Mode</strong> (ME) and at communication points (xCS) for <code>Output</code> and <code>Derivative</code> elements:</p>
<p class="tableblock">- inputs (variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>)</p>
<p class="tableblock">- continuous-time states</p>
<p class="tableblock">- <a href="#independent"><code>independent</code></a> variable (usually time; <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>).
If an <a href="#independent"><code>independent</code></a> variable is not explicitly defined under variables, it is assumed that the unknown depends explicitly on the <a href="#independent"><code>independent</code></a> variable.</p>
<p class="tableblock"><em>[<a href="#parameter"><code>parameters</code></a> and <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> must not be listed as knowns in this mode. This may change in a future FMI version which implies the possibility to calculate derivatives with respect to parameters.]</em></p>
<p class="tableblock"><code>Knowns</code> \(\color{blue}{\mathbf{v}_{\text{known}}}\) in <strong>Initialization Mode</strong> (for elements <a href="#InitialUnknown"><code>InitialUnknown</code></a>):</p>
<p class="tableblock">- inputs (variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>)</p>
<p class="tableblock">- variables with <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> <em>[for example, <a href="#independent"><code>independent</code></a> <a href="#parameter"><code>parameters</code></a> or initial <a href="#state"><code>states</code></a>]</em></p>
<p class="tableblock">- <a href="#independent"><code>independent</code></a> variable (usually time; <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>).
If an <a href="#independent"><code>independent</code></a> variable is not explicitly defined under variables, it is assumed that the unknown depends explicitly on the <a href="#independent"><code>independent</code></a> variable.</p>
<p class="tableblock">For Co-Simulation, <a href="#dependencies"><code>dependencies</code></a> does not list the dependency on continuous-time, if the capability flag <code>providesDirectionalDerivative</code> has a value of <code>false</code>.
In other words, the respective partial derivatives cannot be computed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependenciesKind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="dependenciesKind"></a>
If <a href="#dependenciesKind"><code>dependenciesKind</code></a> is present, <a href="#dependencies"><code>dependencies</code></a> must be present and must have the same number of list elements.
If not present, it must be assumed that the unknown \(\color{blue}{v_{\text{unknown}}}\) depends on the knowns \(\color{blue}{\mathbf{v}_{\text{known}}}\) without a particular structure.
Otherwise, the corresponding known \(\color{blue}{v_{known,i}}\) enters the equation as:</p>
<p class="tableblock"><code>= dependent</code>: no particular structure, \(\color{blue}{{h(..,\ v}_{known,i}}\),..)</p>
<p class="tableblock">Only for floating point type unknowns \(\color{blue}{v_{\text{unknown}}}\):</p>
<p class="tableblock"><code>=</code> <a href="#constant"><code>constant</code></a>: constant factor, \(\color{blue}{c \cdot v_{known,i}}\) where \(\color{blue}{c}\) is an expression that is evaluated before <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a> is called.</p>
<p class="tableblock">Only for floating point type unknowns \(\color{blue}{v_{\text{unknown}}}\) in Event and <strong>Continuous-Time Mode</strong> (ME) and at communication points (xCS), and not for <a href="#InitialUnknown"><code>InitialUnknown</code></a> for <strong>Initialization Mode</strong>:</p>
<p class="tableblock"><code>=</code> <a href="#fixed"><code>fixed</code></a>: fixed factor, \(\color{blue}{p \cdot v_{known,i}}\) where \(\color{blue}{p}\) is an expression that is evaluated before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called.</p>
<p class="tableblock"><code>=</code> <a href="#tunable"><code>tunable</code></a>: tunable factor, \(\color{blue}{p \cdot v_{known,i}}\) where \(\color{blue}{p}\) is an expression that is evaluated before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called and in <strong>Event Mode</strong> due to an external event (ME) or at a communication point (xCS)</p>
<p class="tableblock"><code>=</code> <a href="#discrete"><code>discrete</code></a>: discrete factor, \(\color{blue}{d \cdot v_{known,i}}\) where \(\color{blue}{d}\) is an expression that is evaluated before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called and in <strong>Event Mode</strong> due to an external or internal event or at a communication point (xCS).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Example 1:</em></p>
</div>
<div class="paragraph">
<p><em>An FMU is defined by the following equations:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}

\frac{d}{\text{dt}}\begin{bmatrix}
x_{1} \\
x_{2} \\
x_{3} \\
\end{bmatrix}

&amp;=

\begin{bmatrix}
f_{1}\left( x_{2} \right) \\
f_{2}\left( x_{1} \right) + 3 \cdot p^{2} \cdot x_{2} + 2 \cdot u_{1} + 3 \cdot u_{3} \\
f_{3}\left( x_{1},x_{3},u_{1},u_{2},u_{3} \right) \\
\end{bmatrix}

\\

y &amp;= g_1(x_2, x_3)

\end{align*},\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \(\color{blue}{u_{1}}\) <em>is a continuous-time <a href="#input"><code>input</code></a> (<a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a>),</em> \(\color{blue}{u_{2}}\) <em>is any type of <a href="#input"><code>input</code></a>,</em> \(\color{blue}{u_{3}}\) <em>is a floating point discrete-time <a href="#input"><code>input</code></a> (<a href="#variability"><code>variability</code></a> = "discrete"`), and</em> \(\color{blue}{p}\) <em>is a <a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameter</code></a> (<a href="#variability"><code>variability</code></a> = <a href="#fixed"><code>fixed</code></a>).</em>
<em>The initialization is defined by:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[x_1 = 1.1, \frac{dx_2}{dt} = 0, y = 3.3,\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, the initialization equations are:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}
x_{2} &amp;= \frac{1}{3 \cdot p^{2}} \cdot ( f_{2}\left( x_{1} \right) + 2 \cdot u_{1} + 3 \cdot u_{3} )
\\
x_{3} &amp;= g_{1}^{- 1}( x_{2}, y)
\end{align*}\]
</div>
</div>
<div class="paragraph">
<p><em>This equation system can be defined as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;ModelVariables&gt;
   &lt;Float64 name="p"       valueReference= "1"/&gt;
   &lt;Float64 name="u1"      valueReference= "2"/&gt;
   &lt;Float64 name="u2"      valueReference= "3"/&gt;
   &lt;Float64 name="u3"      valueReference= "4"/&gt;
   &lt;Float64 name="x1"      valueReference= "5"/&gt;
   &lt;Float64 name="x2"      valueReference= "6"/&gt;
   &lt;Float64 name="x3"      valueReference= "7"/&gt;
   &lt;Float64 name="der(x1)" valueReference= "8"/&gt;
   &lt;Float64 name="der(x2)" valueReference= "9"/&gt;
   &lt;Float64 name="der(x3)" valueReference="10"/&gt;
   &lt;Float64 name="y"       valueReference="11"/&gt;
&lt;/ModelVariables&gt;
&lt;ModelStructure&gt;
   &lt;Output valueReference="11" dependencies="6 7"/&gt;
   &lt;Derivative valueReference="8"  dependencies="6"/&gt;
   &lt;Derivative valueReference="9"  dependencies="2 4 5 6" dependenciesKind="constant constant dependent fixed"/&gt;
   &lt;Derivative valueReference="10" dependencies="2 3 4 5 6" /&gt;
   &lt;InitialUnknown valueReference="6" dependencies="2 4 5"/&gt;
   &lt;InitialUnknown valueReference="7" dependencies="2 4 5 11"/&gt;
   &lt;InitialUnknown valueReference="8"/&gt;
   &lt;InitialUnknown valueReference="10"/&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Example 2:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[y = \left\{ \begin{matrix}
2 \cdot u \ \mathrm{if} \ u &gt; 0 \\
3 \cdot u \ \mathrm{else} \\
\end{matrix}\right.\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \(\color{blue}{u}\) <em>is a continuous-time <a href="#input"><code>input</code></a> with <a href="#valueReference"><code>valueReference</code></a> = <code>1</code> and</em> \(\color{blue}{y}\) <em>is a continuous-time <a href="#output"><code>output</code></a> with <a href="#valueReference"><code>valueReference</code></a> = <code>2</code>.</em>
<em>The definition of the model structure is then:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;ModelStructure&gt;
  &lt;Output valueReference="2" dependencies="1" dependenciesKind="discrete"/&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>[Note that</em> \(\color{blue}{y = d \cdot u}\) <em>where</em> \(\color{blue}{d}\) <em>changes only during <strong>Event Mode</strong> (</em> \(\color{blue}{d = 2 \cdot u}\) <em>or</em> \(\color{blue}{3 \cdot u\ }\) <em>depending on relation</em> \(\color{blue}{u &gt; 0}\) <em>that changes only at <strong>Event Mode</strong>).</em>
<em>Therefore <a href="#dependenciesKind"><code>dependenciesKind</code></a> = <a href="#discrete"><code>discrete</code></a>.]</em></p>
</div>
<div class="paragraph">
<p><em>Example 3:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[y = \left\{ \begin{matrix}
2\ \ \mathrm{if}\ \ u &gt; 0 \\
3\ \ \mathrm{else} \\
\end{matrix}\right.\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \(\color{blue}{u}\) <em>is a continuous-time <a href="#input"><code>input</code></a> with <a href="#valueReference"><code>valueReference</code></a> = <code>1</code> and</em> \(\color{blue}{y}\) <em>is a continuous-time <a href="#output"><code>output</code></a> with <a href="#valueReference"><code>valueReference</code></a> = <code>2</code>.</em>
<em>The definition of the model structure is then:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;ModelStructure&gt;
  &lt;Output valueReference="2" dependencies="1" dependenciesKind="dependent"/&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>[Note that</em> \(\color{blue}{y = c}\) <em>where</em> \(\color{blue}{c}\) <em>changes only during <strong>Event Mode</strong> (</em> \(\color{blue}{c = 2}\) <em>or</em> \(\color{blue}{3\ }\) <em>depending on relation</em> \(\color{blue}{u &gt; 0}\) <em>that changes only at <strong>Event Mode</strong>).</em>
<em>Therefore <a href="#dependenciesKind"><code>dependenciesKind</code></a> = <a href="#dependenciesKind"><code>dependent</code></a> because it is not a linear relationship on</em> \(\color{blue}{u}\). <em>]</em></p>
</div>
<div class="paragraph">
<p><em>Example 4:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\frac{dx}{dt}=u, y=x\]
</div>
</div>
<div class="paragraph">
<p>where <code>u</code> is continuous-time input value reference <code>1</code>, <code>y</code> is a continuous-time output with value reference <code>2</code> and <code>dxdt</code> is a continuous-time derivative with value reference <code>4</code>.
The definition of the model structure is then:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;ModelVariables&gt;
   &lt;Float64 name="u" valueReference= "1"/&gt;
   &lt;Float64 name="y" valueReference= "2"/&gt;
   &lt;Float64 name="x" valueReference= "3"/&gt;
   &lt;Float64 name="dxdt" valueReference= "4"/&gt;
&lt;/ModelVariables&gt;
&lt;ModelStructure&gt;
  &lt;Output valueReference="2" dependencies="3" dependenciesKind="constant"/&gt;
  &lt;Derivative valueReference="4" dependencies="1" dependenciesKind="constant"/&gt;
  &lt;InitialUnknown valueReference="2" dependencies="3"/&gt;
  &lt;InitialUnknown valueReference="4" dependencies="1"/&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Defining FMU features with the</em> <a href="#dependencies"><code>dependencies</code></a> <em>list:</em></p>
</div>
<div class="paragraph">
<p><em>[Note that via the <a href="#dependencies"><code>dependencies</code></a> list the supported features of the FMU can be defined.</em>
<em>Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>If a state derivative <code>der_x</code> is a function of a <a href="#parameter"><code>parameter</code></a> p (so of a <a href="#start"><code>start</code></a> value of a variable with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#fixed"><code>fixed</code></a>), and the FMU does not support an iteration over <code>p</code> during <strong>Initialization Mode</strong> (for example, to iterate over p such that the state derivative <code>der_x</code> is zero), then the <a href="#dependencies"><code>dependencies</code></a> list of <code>der_x</code> should not include <code>p</code>.</em>
<em>If an FMU is imported in an environment and such an iteration is set up, then the tool can figure out that the resulting algebraic system of equations is structurally singular and therefore can reject such a definition.</em></p>
</li>
<li>
<p><em>For Basic Co-Simulation FMUs, it is common that no algebraic loops over the <a href="#input"><code>input</code></a> / <a href="#output"><code>output</code></a> variables nor over start-values is supported.</em>
<em>In such a case, all <a href="#dependencies"><code>dependencies</code></a> lists for <a href="#output"><code>output</code></a> variables under the <a href="#InitialUnknown"><code>InitialUnknown</code></a> element should be defined as empty lists defining that the setting of <a href="#input"><code>inputs</code></a> and/or of <a href="#start"><code>start</code></a> values does not influence the <a href="#output"><code>outputs</code></a>.</em>
<em>As a result, it is not possible to formulate algebraic loops of connected FMUs during <strong>Initialization Mode</strong>.]</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="variableNamingConvention">2.2.12. Variable Naming Conventions (variableNamingConvention)</h4>
<div class="paragraph">
<p>With attribute <code>variableNamingConvention</code> of element <code>fmiModelDescription</code>, the convention is defined how the variable names have been constructed.
If this information is known, the environment may be able to represent the names in a better way (for example, as a tree and not as a linear list).</p>
</div>
<div class="paragraph">
<p>In the following definitions, the <a href="http://en.wikipedia.org/wiki/Extended_BNF">EBNF</a> is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=   production rule
[ ] optional
{ } repeat zero or more times
|   or</pre>
</div>
</div>
<div class="paragraph">
<p>The names must be unique, non-empty strings.<br>
<em>[It is recommended that the names are visually clearly different from each other; but it is not required.]</em></p>
</div>
<div class="paragraph">
<p>The following conventions for scalar names are defined:</p>
</div>
<div class="paragraph">
<p><strong><code>variableNamingConvention = flat</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>name = Unicode-char { Unicode-char } // identical to xs:normalizedString
Unicode-char = any Unicode character without carriage return (#xD),
line feed (#xA) nor tab (#x9)</pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>variableNamingConvention</code> = structured`</strong></p>
</div>
<div class="paragraph">
<p>Structured names are hierarchical using "." as a separator between hierarchies.
A name consists of "_", letters and digits or may consist of any characters enclosed in single apostrophes.
A name may identify an array element on every hierarchical level using "[&#8230;&#8203;]" to identify the respective array index.
If an array is a leaf node of the variable hierarchy then the array can also be represented as a single variable of type array.
A <a href="#derivative"><code>derivative</code></a> of a variable is defined with <code>der(name)</code> for the first time derivative and <code>der(name,N)</code> for the N-th derivative.
Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle.engine.speed
resistor12.u
v_min
robot.axis.'motor #234'
der(pipe[3,4].T[14],2) // second time derivative of pipe[3,4].T[14]</pre>
</div>
</div>
<div class="paragraph">
<p>The precise syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>name            = identifier | "der(" identifier ["," unsignedInteger ] ")"
identifier      = B-name [ arrayIndices ] {"." B-name [ arrayIndices ] }
B-name          = nondigit { digit | nondigit } | Q-name
nondigit        = "pass:[_]" | letters "a" to "z" | letters "A" to "Z"
digit           = "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"
Q-name          = "'" ( Q-char | escape ) { Q-char | escape } "'"
Q-char          = nondigit | digit | "!" | "#" | "$" | "%" | "&amp;" | "(" | ")" |
                                     "*" | "+" | "," | "-" | "." | "/" | ":" |
                                     ";" | "&lt;" | "&gt;" | "=" | "?" | "@" | "[" |
                                     "]" | "^" | "{" | "}" | "|" | "~" | " "
escape          = "\'" | "\"" | "\?" | "\\" | "\a" | "\b" |
                  "\f" | "\n" | "\r" | "\t" | "\v"
arrayIndices    = "[" unsignedInteger {"," unsignedInteger} "]"
unsignedInteger = digit { digit }</pre>
</div>
</div>
<div class="paragraph">
<p><em>[This definition is identical to the syntax of an identifier in Modelica version 3.2.]</em></p>
</div>
<div class="paragraph">
<p>The tree of names is mapped to an ordered list of variable names in <a href="http://en.wikipedia.org/wiki/Depth-first_search">depth-first</a> order.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle
  transmission
    ratio
    outputSpeed
  engine
    inputSpeed
    temperature</pre>
</div>
</div>
<div class="paragraph">
<p>is mapped to the following list of variable names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle.transmission.ratio
vehicle.transmission.outputSpeed
vehicle.engine.inputSpeed
vehicle.engine.temperature</pre>
</div>
</div>
<div class="paragraph">
<p>All flattened array elements are given in a consecutive sequence of variables.
Elements of multi-dimensional arrays are ordered according to "row major" order that is elements of the last index are given in sequence.</p>
</div>
<div class="paragraph">
<p><em>[For example, the vector <code>centerOfMass</code> in body <code>arm1</code> is mapped to the following variables:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>robot.arm1.centerOfMass[1]
robot.arm1.centerOfMass[2]
robot.arm1.centerOfMass[3]</pre>
</div>
</div>
<div class="paragraph">
<p><em>For example, a table <code>T[4,3,2]</code> (first dimension 4 entries, second dimension 3 entries, third dimension 2 entries) is mapped to the following variables:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>T[1,1,1]
T[1,1,2]
T[1,2,1]
T[1,2,2]
T[1,3,1]
T[1,3,2]
T[2,1,1]
T[2,1,2]
T[2,3,1]
...</pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>It might be that not all elements of an array are present.
If they are present, they are given in consecutive order in the XML file.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fmu-distribution">2.3. FMU Distribution</h3>
<div class="paragraph">
<p>An FMU description consists of several files.
An FMU implementation may be distributed in source code and/or in binary format.
All relevant files are stored in a ZIP file with a pre-defined structure.
The implementation must implement all the functions for at least one of the FMI interface types.
Specifically it is required that all functions specified for the specified FMI interface type are present, even if they are only needed for capabilities that the FMU does not support.
The behavior of those functions is unspecified, so while calling environments can rely on the functions being present, they cannot rely on any particular behavior for functions only needed for capabilities the FMU does not support.
The extension of the ZIP file must be <code>.fmu</code> <em>[, for example, <code>HybridVehicle.fmu</code>]</em>.
The compression method used for the ZIP file must be <code>deflate</code> <em>[(most free tools, such as zlib, offer only the common compression method <code>deflate</code>)]</em>.</p>
</div>
<div class="paragraph">
<p><em>[Note: especially section 4.4.17 of <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">the ZIP format specification</a> states that backslashes "\" are forbidden as path separator, only forward slashes "/" are allowed.</em><br>
<em>Non-ASCII directory names are not explicitly forbidden, but might pose a problem on different operating systems and are thus discouraged.]</em></p>
</div>
<div class="paragraph">
<p>Every FMU is distributed with its own ZIP file.
This ZIP file has the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Structure of ZIP file of an FMU
modelDescription.xml          // description of FMU (required file)
documentation                 // directory containing the documentation (optional)
   index.html                 // entry point of the documentation
   diagram.png                // image file of a descriptive diagram view of the model (optional)
   diagram.svg                // if existing the diagram.png is required (optional)
   &lt;other documentation files&gt;
   licenses // Optional directory for licenses
      license.{txt,html}      // Entry point for license information
      &lt;license files&gt;         // For example BSD licenses
icon                          // FMU and terminal icons (optional)
   icon.png                   // image file of icon without terminals (optional)
   icon.svg                   // if existing the icon.png is required (optional)
   // all terminal and fmu icons referenced in the graphical representation
sources                       // directory containing the C sources (optional)
   // all needed C sources and C header files to compile and link the FMU
   // with exception of: fmi3PlatformTypes.h, fmi3FunctionTypes.h and fmi3Functions.h
   // The files to be compiled (but not the files included from these files)
   // have to be reported in the XML file under the structure
   // &lt;ModelExchange&gt;&lt;SourceFiles&gt; ... and &lt;CoSimulation&gt;&lt;SourceFiles&gt;
binaries                      // directory containing the binaries (optional)
   x86_64-windows             // binaries for Windows on Intel 64-bit
      &lt;modelIdentifier&gt;.dll   // shared library of the FMI implementation
      &lt;other DLLs&gt;            // the DLL can include other DLLs
   x86_64-windows-msvc140mt   // static libraries for 64-bit Windows generated with
      &lt;modelIdentifier&gt;.lib   // Visual Studio 2015 with /MT flag
   i686-linux                 // binaries for Linux on Intel 32-bit
      &lt;modelIdentifier&gt;.so    // shared library of the FMI implementation
   aarch32-linux              // binaries for Linux on ARM 32-bit
      &lt;modelIdentifier&gt;.so    // shared library of the FMI implementation
   x86_64-darwin              // binaries for macOS
      &lt;modelIdentifier&gt;.dylib // shared library of the FMI implementation
   // If an FMU is run through one of its binaries all items in that binary
   // folder are recommended to be unpacked at the same location as the binary
   // &lt; modelIdentifier &gt;.* is unpacked. If not it is likely that, if the FMU
   // has dependencies on those items, it will not be able to find them.
resources                     // resources needed by the FMU
   // data in FMU specific files which will be read during initialization;
   // also more folders can be added under resources (tool/model specific).
   // In order for the FMU to access these resource files, the resource directory
   // must be available in unzipped form and the absolute path to this directory
   // must be reported via argument "fmuResourceLocation" via fmi3Instantiate.
extra                         // Additional (meta-)data of the FMU (optional)
   // additional (meta-)data that is supposed to travel with the FMU;
   // see below for structure and content definition.</pre>
</div>
</div>
<div class="paragraph">
<p>An FMU has to implement all common functions (according to tables in <a href="#state-machine-model-exchange">Section 3.2.3</a> and <a href="#state-machine-co-simulation">Section 4.2.4</a>).
Additionally, all FMUs have to provide the respective FMU interface-type function they implement.</p>
</div>
<div class="paragraph">
<p>The FMU must be distributed with at least one implementation, in other words, either sources or one of the binaries for a particular machine.
It is also possible to provide the sources and binaries for different target machines together in one ZIP file.
The names of the binary directories are standardized by the "platform tuple".
Further names can be introduced by vendors.
Dynamic link libraries must include all referenced resources that are not available on a standard target machine <em>[for example, DLLs on Windows that are built  with Visual Studio should be compiled with the <code>/MT</code> option to include the required symbols from the Visual C runtime in the DLL, and not use the option <code>/MD</code> where this is not the case]</em>.
When compiling a shared object on Linux, <code>RPATH="$ORIGIN"</code> has to be set when generating the shared object in order that shared objects used from it, can be dynamically loaded.</p>
</div>
<div class="paragraph">
<p>The binaries must be placed in the respective &lt;platformTuple&gt; directory with the general format <code>&lt;arch&gt;-&lt;sys&gt;{-&lt;abi&gt;{&lt;abi_ver&gt;}{&lt;abi_sub&gt;}}</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Architecture <code>&lt;arch&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM 32-bit Architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM 64-bit Architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i386</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel 3rd generation x86 32-bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i586</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel 5th generation x86 32-bit w/o SSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i686</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel 6th generation x86 32-bit with SSE2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel/AMD x86 64-bit</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Operating system <code>&lt;sys&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">darwin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Darwin (macOS, iOS, watchOS, tvOS, audioOS)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Windows</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Application Binary Interface (ABI) <code>&lt;abi&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ELF file format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gnu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">android</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Android</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">macho</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mach object file format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msvc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Visual C</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">ABI version <code>&lt;abi_ver&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2005 (MSVC++ 8.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2008 (MSVC++ 9.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2010 (MSVC++ 10.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2012 (MSVC++ 11.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2013 (MSVC++ 12.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">140</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2015 (MSVC++ 14.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">141</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2017 (MSVC++ 15.0)</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Sub-ABI <code>&lt;abi_sub&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">md</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mdd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MDd</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MTd</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Typical scenarios are to provide binaries only for one machine type (for example, on the machine where the target simulator is running and for which licenses of run-time libraries are available) or to provide only sources (for example, for translation and download for a particular micro-processor).
If run-time libraries cannot be shipped due to licensing, special handling is needed, for example, by providing the run-time libraries at appropriate places by the receiver.</p>
</div>
<div class="paragraph">
<p>FMI provides the means for two kinds of implementation: <code>needsExecutionTool = true</code> and <code>needsExecutionTool = false</code>.
In the first case a tool specific wrapper DLL/SharedObject has to be provided as the binary, in the second a compiled or source code version of the model with its solver is stored (see <a href="#fmi-for-basic-co-simulation">Section 4</a> for details).</p>
</div>
<div class="paragraph">
<p>In an FMU multiple interface types might be present.
If in both cases the executable part is provided as a shared library, then two different or only one library can be provided.
The library names are defined in the <code>modelIdentifier</code> attribute of elements <code>fmiModelDescription.ModelExchange</code> and <code>fmiModelDescription.CoSimulation</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Example of different libraries:
   binaries
     x86_64-windows
        MyModel_ModelExchange.dll   // ModelExchange.modelIdentifier =
                                    //    "MyModel_ModelExchange"
        MyModel_CoSimulation.dll    // CoSimulation.modelIdentifier =
                                    //    "MyModel_CoSimulation"
]</pre>
</div>
</div>
<div class="paragraph">
<p>The usual distribution of an FMU will be with DLLs/SharedObjects because then further automatic processing <em>[(for example, importing into another tool)]</em> is possible.<br>
If run-time libraries are needed by the FMU that have to be present on the target machine, then automatic processing is likely impossible.
The requirements and the expected processing should be documented in the <code>documentation</code> directory in this case.<br>
A source-based distribution might require manual interaction in order that it can be utilized.
The intention is to support platforms that are not known in advance (such as HIL-platforms or micro-controllers).
Typically, in such a case the complete source code in ANSI-C is provided (for example, one C source file that includes all other needed C files with the <code>#include</code> directive).
All C source file names that need to be defined in a compiler directive have to be defined in the XML file under structure <code>&lt;ModelExchange&gt;&lt;SourceFiles&gt;</code> and <code>&lt;CoSimulation&gt;&lt;SourceFiles&gt;</code>.
These files may include other files.
<code>#include</code> directive with <code>""</code> should be used for header-filers distributed in the FMU instead of using <code>&lt;&#8230;&#8203;&gt;</code>.
If default options of the compiler are sufficient, it might then be possible to automatically process such source code FMUs.
In case information beyond <code>BuildConfiguration</code> is required to compile the FMU for specific targets, the <code>documentation</code> directory is the place to store further instructions.
<em>[As template makefile, CMake (<a href="http://www.cmake.org" class="bare">http://www.cmake.org</a>), a cross- platform, open-source build system might be used.]</em><br>
<em>[The sub-directory "licenses" can be used to bundle all license files.</em>
<em>It is strongly recommended to include all license and copyright related information in the licenses folder of an FMU (especially but not only for contained open source software) - the <code>license.{txt,html}</code> file can serve as an entry point for describing the contained licenses.</em>
<em>This will help the users to comply with license conditions when passing source or binary code contained in an FMU to other persons or organizations.]</em></p>
</div>
<div class="paragraph">
<p>In the mandatory directory <code>resources</code>, additional data can be provided in FMU specific formats, typically for tables and maps used in the FMU.
This data must be read into the model at the latest during initialization (that is, before <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called).
The actual file names in the ZIP file to access the data files can either be hard-coded in the generated FMU functions, or the file names can be provided as string parameters via the <code>fmi3SetString</code> function.
<em>[Note that the absolute file name of the resource directory is provided by the initialization functions.]</em>
In the case of a Basic Co-Simulation implementation of <code>needsExecutionTool = true</code> type, the <code>resources</code> directory can contain the model file in the tool specific file format.</p>
</div>
<div class="paragraph">
<p><em>[Note that the header files <code>fmi3PlatformTypes.h</code> and <code>fmi3FunctionTypes.h/fmi3Functions.h</code> are not included in the FMU due to the following reasons:</em></p>
</div>
<div class="paragraph">
<p><em><code>fmi3PlatformTypes.h</code> makes no sense in the <code>sources</code> directory, because if sources are provided, then the target simulator defines this header file and not the FMU.</em><br>
<em>This header file is not included in the <code>binaries</code> directory, because it is implicitly defined by the platform directory (for example, <code>i686-windows</code> for a 32-bit machine or <code>x86_64-linux</code> for a 64-bit machine).</em></p>
</div>
<div class="paragraph">
<p><em><code>fmi3FunctionTypes.h</code> / <code>fmi3Functions.h</code> are not needed in the <code>sources</code> directory, because they are implicitly defined by attribute <code>fmiVersion</code> in file <code>modelDescription.xml</code>.</em>
<em>Furthermore, in order that the C compiler can check for consistent function arguments, the header file from the target simulator should be used when compiling the C sources.</em>
<em>It would therefore be counter-productive (unsafe) if this header file was present.</em><br>
<em>These header files are not included in the <code>binaries</code> directory, since they are already utilized to build the target simulator executable.</em>
<em>The version number of the header file used to construct the FMU can be deduced via attribute <code>fmiVersion</code> in file <code>modelDescription.xml</code> or via function call <a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a>.]</em></p>
</div>
<div class="paragraph">
<p>The ZIP archive may contain additional entries with the prefix <code>extra/</code> that can be used to store additional data and meta-data.
In order to avoid ambiguities the extra files should be provided in subdirectories using a reverse domain name notation of a domain that is controlled by the entity defining the semantics and content of the additional entries <em>[(for example <code>extra/com.example/SimTool/meta.xml</code> or <code>extra/org.example.stdname/data.asd</code>)]</em>.
The use of subdirectories beginning with <code>org.modelica</code> and <code>org.fmi-standard</code> is explicitly reserved for use by MAP FMI-defined layered standards, i.e. other uses must not use subdirectory names beginning with these prefixes.
It is explicitly allowed for tools and users other than the original creator of an FMU to modify, add or delete entries in the <code>extra/</code> directory without affecting the validity of the FMU in all other aspects.
Specifically all validation or digital signature schemes used to protect the content of the FMU should take the variability of extra file content into account <em>[(for example by having seperate checksums or signatures for FMU core content and extra content, or not having signatures at all for extra content)]</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="common-concepts-cosim">2.4. Common Concepts for Co-Simulation</h3>
<div class="paragraph">
<p>Co-simulation exploits the modular structure of coupled problems in all stages of the simulation process beginning with the separate model setup and preprocessing for the individual subsystems in different simulation tools (which can be powerful simulators as well as simple C programs).
During time integration, the simulation is again performed independently for all subsystems restricting the data exchange between subsystems to discrete communication points \(tc_i\).
For simulator coupling, also the visualization and post-processing of simulation data is done individually for each subsystem in its own native simulation tool.
In different contexts, the communication points \(tc_i\), the communication steps \(tc_i \rightarrow tc_{i+1}\) and the communication step sizes \(hc_i := tc_{i+1} - tc_i\) are also known as sampling points (synchronization points), macro steps and sampling rates, respectively.
The term "communication point" in FMI for Co-Simulation refers to the communication between subsystems in a co-simulation environment and should not be mixed with the output points for saving simulation results to file.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation provides 3 interface standards for the solution of time-dependent coupled systems consisting of subsystems that are continuous in time (model components that are described by non-stationary differential equations) or time-discrete (model components that are described by difference equations such as discrete controllers).
In a block representation of the coupled system, the subsystems are represented by blocks with (internal) <a href="#state"><code>state</code></a> variables \(x(t)\) that are connected to other subsystems (blocks) of the coupled problem by <em>subsystem <a href="#input"><code>inputs</code></a></em> \(u(t)\) and <em>subsystem <a href="#output"><code>outputs</code></a></em> \(y(t)\).
In this framework, the physical connections between subsystems are represented by mathematical coupling conditions between the inputs \(u(t)\) and the <a href="#output"><code>outputs</code></a> \(y(t)\) of all subsystems, <a href="#KS00">[KS00]</a>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-data-flow.svg" alt="co simulation data flow" width="80%">
</div>
<div class="title">Figure 2. Data flow at communication points.</div>
</div>
<div class="paragraph">
<p>For co-simulation, two basic groups of functions have to be implemented:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>functions for the data exchange between subsystems</p>
</li>
<li>
<p>functions for algorithmic issues to synchronize the simulation of all subsystems and to proceed in communication steps \(tc_i \rightarrow tc_{i+1}\) from initial time \(tc_0 := t_{start}\) to end time \(tc_N := t_{stop}\)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In FMI for Co-Simulation, both functions are implemented in one software component, the Co-Simulation master.
The data exchange between the subsystems (slaves) is handled via the master only.
There is no direct communication between the slaves.
The master functionality can be implemented by a special software tool (a separate simulation backplane) or by one of the involved simulation tools.
In its most general form, the coupled system may be simulated in nested co-simulation environments and FMI for Co-Simulation applies to each level of the hierarchy.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation defines interface routines for the communication between the master and all slaves (subsystems) in a co-simulation environment.
The most common master algorithm stops at each communication point \(tc_i\) the simulation (time integration) of all slaves, collects the outputs \(y(tc_i)\) from all subsystems, evaluates the subsystem inputs \(u(tc_i)\), distributes these subsystem inputs to the slaves and continues the (co-)simulation with the next communication step \(tc_i \rightarrow tc_{i+1} = tc_i + hc\) with fixed communication step size \(hc\).
In each slave, an appropriate solver is used to integrate one of the subsystems for a given communication step \(tc_i \rightarrow tc_{i+1}\).
The most simple co-simulation algorithms approximate the (unknown) subsystem inputs \(u(t), (t &gt; tc_i))\) by frozen data \(u(tc_i)\) for \(tc_i \leq t &lt; tc_{i+1}\).
FMI for Co-Simulation supports this classical brute force approach as well as more sophisticated master algorithms.
FMI for Co-Simulation is designed to support a very general class of master algorithms but it does not define the master algorithm itself.</p>
</div>
<div class="paragraph">
<p>The ability of slaves to support more sophisticated master algorithms is characterized by a set of capability flags inside the XML description of the slave (see <a href="#fmi-for-basic-co-simulation">Section 4</a>).
Typical examples are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the ability to handle variable communication step sizes \(hc_i\),</p>
</li>
<li>
<p>the ability to repeat a rejected communication step \(tc_i \rightarrow tc_{i+1}\) with reduced communication step size,</p>
</li>
<li>
<p>the ability to provide <a href="#derivative"><code>derivatives</code></a> w.r.t. time of <a href="#output"><code>outputs</code></a> to allow interpolation (<a href="#transfer-of-input-output-and-parameters">Section 4.2.1</a>),</p>
</li>
<li>
<p>or the ability to provide Jacobians.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation is restricted to slaves with the following properties:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All calculated values are time-dependent functions within an a priori defined time interval \(t_{start} \leq t \leq t_{stop}\) (provided <code>stopTimeDefined = fmi3True</code> when calling <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>).</p>
</li>
<li>
<p>All calculations (simulations) are carried out with increasing time in general.
The current time \(t\) is running step by step from \(t_{start}\) to \(t_{stop}\).
The algorithm of the slave may have the property to be able to repeat the simulation of parts of \([t_{start}, t_{stop}\)] or the whole time interval \([t_{start}, t_{stop}\)].</p>
</li>
<li>
<p>The slave can be given a time value \(tc_i, t_{start} \leq tc_i \leq t_{stop}\).</p>
</li>
<li>
<p>The slave is able to interrupt the simulation when \(tc_i\) is reached.</p>
</li>
<li>
<p>During the interrupted simulation the slave (and its individual solver) can receive values for <a href="#input"><code>inputs</code></a> \(u(tc_i)\) and send values of outputs \(y(tc_i)\).</p>
</li>
<li>
<p>Whenever the simulation in a slave is interrupted, a new time value \(tc_{i+1}, tc_i \leq tc_{i+1} \leq t_{stop}\), can be given to simulate the time subinterval \(tc_i &lt; t \leq tc_{i+1}\)</p>
</li>
<li>
<p>The subinterval length \(hc_i\) is the communication step size of the \(i^{th}\) communication step, \(hc_i = tc_{i+1} - tc_i\).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The communication step size has to be greater than zero.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation allows a Co-Simulation flow which starts with instantiation and initialization (all slaves are prepared for computation, the communication links are established), followed by simulation (the slaves are forced to simulate a communication step), and finishes with shutdown.
The details of the flow are given in the state machine of the calling sequences from master to slave (see <a href="#state-machine-co-simulation">Section 4.2.4</a>).</p>
</div>
<div class="sect3">
<h4 id="math-intermediate-variable-access">2.4.1. Intermediate Variable Access Support</h4>
<div class="paragraph">
<p>Intermediate variable access has three main uses:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>An FMU is able to produce valid output variables at intermediate points between two consecutive communication points.</strong>
This is typically the result of an internal solver taking multiple integration steps between two consecutive communication points.
The FMU exposes intermediate output variables for the master whenever they are available.
These can be used for e.g. extrapolation, interpolation, filtering or asynchronous co-simulation.</p>
</li>
<li>
<p><strong>Intermediate <a href="#input"><code>input</code></a> variables for an FMU is available in the Co-Simulation master.</strong>
The FMU requests updated intermediate <a href="#input"><code>input</code></a> variables every time they are required by the internal solver.
This can be either at temporary solver states or after successful integration steps.</p>
</li>
<li>
<p><strong>Intermediate <a href="#input"><code>input</code></a> variables for the FMU can be computed by the Co-Simulation master.</strong>
The computation requires intermediate output variables from the FMU.
Whenever the internal solver in the FMU needs updated intermediate <a href="#input"><code>input</code></a> variables, it provides the intermediate output variables for and requests the intermediate <a href="#input"><code>input</code></a> variables from the master.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Combinations of the above methods are also allowed.</p>
</div>
<div class="paragraph">
<p>Access to intermediate variables enables several features such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Advanced interpolation/extrapolation techniques</p>
</li>
<li>
<p>Asynchronous communication</p>
</li>
<li>
<p>Anti-alias filtering</p>
</li>
<li>
<p>Smoothing of inputs</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_overview_of_different_co_simulation_interfaces">2.4.2. Overview of Different Co-Simulation Interfaces</h4>
<div class="paragraph">
<p>In FMI version 3.0 the following new features have been added:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>signaling of <a href="#clock"><code>clock</code></a> ticks (i.e. events/interrupts) from the FMU to simulation environment</p>
</li>
<li>
<p>signaling of <a href="#clock"><code>clock</code></a> ticks from simulation environment to the FMU</p>
</li>
<li>
<p>definition of multiple model rates (periodic, variable/triggerable) in one FMU</p>
</li>
<li>
<p>access to intermediate values of the FMU&#8217;s variables between two communication points</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to the different sections for a more detailed explanation of the motivation and use of the new features.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Basic Co-Simulation</dt>
<dd>
<p>Basic Co-Simulation is a rather general approach to the simulation of coupled technical systems and coupled physical phenomena in engineering with focus on non-stationary (time-dependent) problems.
The Basic Co-Simulation interface is similar to the feature set of FMI 2.0 for Co-Simulation.
The asynchronous mode for FMUs has been removed since this mode was not supported by tools and it can be suitably replaced by Co-Simulation master implementations that control the asynchronous computation of FMUs via separate tasks/threads created for each FMU.</p>
</dd>
</dl>
</div>
<div id="co-simulation-with-early-return" class="dlist">
<dl>
<dt class="hdlist1">Early Return</dt>
<dd>
<p>In FMI 3.0, an FMU is allowed to stop the execution of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> and return without reaching the predefined communication instant, i.e. <code>currentCommunicationPoint + communicationStepSize</code>.
This mechanism is called "early return".
With the early return feature, an FMU can signal <a href="#outputClock"><code>output clock</code></a> events or internal state changes, i.e., discontinuity events to the Co-Simulation master at any time (not only at the end of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> function calls).
When an internal event occurs inside the FMU at a time instant, it informs the master that a new communication point for the Co-Simulation can be created.
Note that an event signal is not seen in the narrow sense of solver induced discontinuity events but in the general sense of a simulation event that has to be handled by the Co-Simulation master (e.g. state changes that require extended handling).
On a multi-node architecture, in particular, significant co-simulation speed-up may be obtained if the Co-Simulation master can avoid waiting until the end of the slowest <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> when many FMUs are integrating in parallel and an event occurred.
To exploit such efficiency gains also the Co-Simulation master can command the FMU to return early from the current communication step.
This is even helpful if the FMU or the Co-Simulation master do not support the advanced handling of events based on the <a href="#hybrid-co-simulation-api">Hybrid Co-Simulation</a> functionalities.
In this way multiple event types and also <a href="#outputClock"><code>output clock</code></a> ticks or interrupts can be supported based on the early return functionality and additional functionalities provided by <a href="#hybrid-co-simulation-api">Hybrid Co-Simulation</a>.</p>
</dd>
<dt class="hdlist1">Hybrid Co-Simulation</dt>
<dd>
<p>The <a href="#hybrid-co-simulation-api">Hybrid Co-Simulation</a> interface provides functionalities to control and observe the ticking of <a href="#clock">clocks</a>.
For FMI for Hybrid Co-Simulation, the ticking of a clock is interpreted as an activity of the associated model partition.
During simulation, the Co-Simulation master updates and manages values of inputs and outputs of FMUs and further models at communication points for each model partition.
The ratio between communication points created for a model partition and time can be seen as a model rate.
In that sense multiple model partitions of a model define multiple model rates in a model.</p>
</dd>
<dt class="hdlist1">Scheduled Co-Simulation</dt>
<dd>
<p>The <a href="#hybrid-co-simulation-api">Hybrid Co-Simulation</a> interface provides an indirect control over the computation of model partitions.
With <a href="#scheduled-co-simulation-api">Scheduled Co-Simulation</a> a simulation master can directly control the time of computation (i.e. scheduling) for such model partitions.</p>
<div class="paragraph">
<p>The Scheduled Co-Simulation interface addresses simulation use cases that require:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>That at any time (even for unpredictable events) an event can be signaled to an FMU</p>
</li>
<li>
<p>If multiple FMUs share (execution) resources, the time requirements (e.g. execution time, communication deadlines) of all model partitions have to be observed and respected</p>
<div class="ulist">
<ul>
<li>
<p>Time requirements may exist due to communication constraints (that are not apparent at FMU simulation level) which have to be fulfilled by the simulation master</p>
</li>
<li>
<p>That requires a global execution order and preemption policy for all model partitions of the multiple FMUs</p>
</li>
<li>
<p>Priority information provided by the FMUs has to be evaluated and merged to an overall priority for available model partitions</p>
</li>
</ul>
</div>
</li>
<li>
<p>Data shall move between the different FMU model partitions for the same or next activation time, if direct communication via FMUs exist.</p>
<div class="ulist">
<ul>
<li>
<p>Get/set operations must also be possible for the same activation time for different model partitions between the computation of these model partitions.</p>
<div class="paragraph">
<p>This Co-Simulation interface provides support for concurrent computation of model partitions (i.e. a support of multiple rates) on a single computational resource (e.g. CPU-core) of an FMU.
For that a preemptive multitasking regime is intended (cooperative multitasking is not covered by this description).</p>
</div>
<div class="paragraph">
<p><em>[A parallel computation of model partitions is not part of the FMI 3.0 API.</em>
<em>An FMU may still internally use parallel computation on multiple cores, but handling this is (currently) not part of the FMI standard. Such an internal parallel computation is not visible to the simulation master.</em>
<em>It is a tool vendor specific solution that has ties to the used OS and the co-simulation environment]</em></p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div id="intermediate-variable-access" class="dlist">
<dl>
<dt class="hdlist1">Intermediate Variable Access</dt>
<dd>
<p>An FMU can inform a Co-Simulation master that is able to provide intermediate output variables and/or receive intermediate input variables at any time, i.e. not only at the end of a current <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> function call.
It is possible for the FMU to inform the master whether the internal solver is in a temporary state or if it has just completed an internal integration step.
If the internal solver is in a temporary state, intermediate output variables shall only be used for directly computing intermediate input variables.
If the internal integration step is completed, the master can forward intermediate outputs to interconnected simulation units.</p>
</dd>
<dt class="hdlist1">Coupling Scenarios</dt>
<dd>
<div id="figure-co-simulation-with-generated-code" class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-single-slave.svg" alt="co simulation single slave" width="50%">
</div>
<div class="title">Figure 3. Co-Simulation with generated code on a single computer (for simplicity shown for one slave only).</div>
</div>
<div id="figure-co-simulation-with-tool-coupling" class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-tool-coupling.svg" alt="co simulation tool coupling" width="70%">
</div>
<div class="title">Figure 4. Co-Simulation with tool coupling on a single computer (for simplicity shown for one slave only).</div>
</div>
<div class="paragraph">
<p>In the tool coupling case the FMU implementation wraps the FMI function calls to API calls which are provided by the simulation tool (for example, a COM or CORBA API).
Additionally to the FMU the simulation tool is needed to run a co-simulation.</p>
</div>
<div class="paragraph">
<p>In its most general form, a tool coupling based co-simulation is implemented on distributed hardware with subsystems being handled by different computers with different OSs (cluster computer, computer farm, computers at different locations).
The data exchange and communication between the subsystems is typically performed using one of the network communication technologies (for example, MPI, TCP/IP).
The definition of this communication layer is not part of the FMI standard.
However, distributed co-simulation scenarios can be implemented using FMI as shown in <a href="#figure-distributed-co-simulation">Figure 5</a>.</p>
</div>
<div id="figure-distributed-co-simulation" class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-distributed-infrastructure.svg" alt="co simulation distributed infrastructure" width="90%">
</div>
<div class="title">Figure 5. Distributed co-simulation infrastructure (for simplicity shown for one slave only).</div>
</div>
<div class="paragraph">
<p>The master has to implement the communication layer.
Additional parameters for establishing the network communication (for example, identification of the remote computer, port numbers, user account) are to be set via the GUI of the master.
These data are not transferred via the FMI API.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For all Co-Simulation interface types intermediate variable access can be activated, if the FMU and the master supports this.
More information can be found in <a href="#intermediate-variable-access">[intermediate-variable-access]</a>.</p>
</div>
<div class="paragraph">
<p>The Co-Simulation master signals to the FMU which features shall be used for the current instance of the FMU in <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Instance fmi3InstantiateModelExchangeTYPE(
    fmi3String                 instanceName,
    fmi3String                 instantiationToken,
    fmi3String                 resourceLocation,
    fmi3Boolean                visible,
    fmi3Boolean                loggingOn,
    fmi3InstanceEnvironment    instanceEnvironment,
    fmi3CallbackLogMessage     logMessage,
    fmi3CallbackAllocateMemory allocateMemory,
    fmi3CallbackFreeMemory     freeMemory);

typedef fmi3Instance fmi3InstantiateBasicCoSimulationTYPE(
    fmi3String                     instanceName,
    fmi3String                     instantiationToken,
    fmi3String                     resourceLocation,
    fmi3Boolean                    visible,
    fmi3Boolean                    loggingOn,
    fmi3Boolean                    intermediateVariableGetRequired,
    fmi3Boolean                    intermediateInternalVariableGetRequired,
    fmi3Boolean                    intermediateVariableSetRequired,
    fmi3InstanceEnvironment        instanceEnvironment,
    fmi3CallbackLogMessage         logMessage,
    fmi3CallbackAllocateMemory     allocateMemory,
    fmi3CallbackFreeMemory         freeMemory,
    fmi3CallbackIntermediateUpdate intermediateUpdate);

typedef fmi3Instance fmi3InstantiateHybridCoSimulationTYPE(
    fmi3String                     instanceName,
    fmi3String                     instantiationToken,
    fmi3String                     resourceLocation,
    fmi3Boolean                    visible,
    fmi3Boolean                    loggingOn,
    fmi3Boolean                    intermediateVariableGetRequired,
    fmi3Boolean                    intermediateInternalVariableGetRequired,
    fmi3Boolean                    intermediateVariableSetRequired,
    fmi3InstanceEnvironment        instanceEnvironment,
    fmi3CallbackLogMessage         logMessage,
    fmi3CallbackAllocateMemory     allocateMemory,
    fmi3CallbackFreeMemory         freeMemory,
    fmi3CallbackIntermediateUpdate intermediateUpdate);

typedef fmi3Instance fmi3InstantiateScheduledCoSimulationTYPE(
    fmi3String                     instanceName,
    fmi3String                     instantiationToken,
    fmi3String                     resourceLocation,
    fmi3Boolean                    visible,
    fmi3Boolean                    loggingOn,
    fmi3Boolean                    intermediateVariableGetRequired,
    fmi3Boolean                    intermediateInternalVariableGetRequired,
    fmi3Boolean                    intermediateVariableSetRequired,
    fmi3InstanceEnvironment        instanceEnvironment,
    fmi3CallbackLogMessage         logMessage,
    fmi3CallbackAllocateMemory     allocateMemory,
    fmi3CallbackFreeMemory         freeMemory,
    fmi3CallbackIntermediateUpdate intermediateUpdate,
    fmi3CallbackLockPreemption     lockPreemption,
    fmi3CallbackUnlockPreemption   unlockPreemption);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The master can only select a certain Co-Simulation interface for an FMU if the following attributes are set in the <code>modelDescription.xml</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Co-Simulation interface</th>
<th class="tableblock halign-left valign-top">Required attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic Co-Simulation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canNotUseBasicCoSimulation = false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hybrid Co-Simulation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesHybridCoSimulation = true</code>, <code>canReturnEarlyAfterIntermediateUpdate = true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheduled Co-Simulation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesScheduledCoSimulation = true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Generally it is assumed, that a Hybrid or Scheduled Co-Simulation FMU also supports Basic Co-Simulation.
If that is not possible for an FMU <em>[(e.g. if the FMU cannot provide an emulation of <a href="#inputClock"><code>input clock</code></a> tick occurrences)]</em>, it has to include the capability flag <code>canNotUseBasicCoSimulation = true</code> in the <code>modelDescription.xml</code>.</p>
</div>
<div class="paragraph">
<p>If the FMU does not support the Co-Simulation interface selected in <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a> it has to return <code>NULL</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Multiple Co-Simulation Interface Support in one FMU</dt>
<dd>
<p>Exporters are encouraged to support multiple Co-Simulation interfaces in one FMU, so it can be used in differently capable Co-Simulation master implementations and for different use cases.
<em>[That improves the reusability of FMUs.</em>
<em>A common application of this multiple mode support is the reuse of FMUs for real-time and non-real-time simulations.]</em></p>
<div class="paragraph">
<p>The described multi mode support is based on wrapping functionality into the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> function by emulating missing features of the Co-Simulation interface, the FMU has been originally exported for.</p>
</div>
<div class="paragraph">
<p>An FMU that supports <a href="#scheduled-co-simulation-api">Scheduled Co-Simulation</a> will in most cases also support <a href="#hybrid-co-simulation-api">Hybrid Co-Simulation</a>.</p>
</div>
<div class="paragraph">
<p><em>[Wrapping towards other Co-Simulation interfaces can influence the simulation results.</em>
<em>Depending on the model especially wrapping towards the (Basic) Co-Simulation interface may result in divergent simulation results.</em>
<em>Especially aperiodic <a href="#inputClock"><code>input clocks</code></a> can not always be sufficiently emulated in modes that do not directly support <a href="#clock"><code>clocks</code></a>.</em>
<em>Therefore it is recommended that the FMU provides logging information to the user about the influence of the current mode on simulation results, if non-optimal modes are used by the simulation environment.]</em></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_common_co_simulation_application_programming_interface">2.4.3. Common Co-Simulation Application Programming Interface</h4>
<div class="sect4">
<h5 id="api-intermediate-variable-access">2.4.3.1. Intermediate Variable Access</h5>
<div class="paragraph">
<p>If the Co-Simulation master signals the support for intermediate variable access and an FMU has at least one variable with <a href="#intermediateAccess"><code>intermediateAccess</code></a> = <code>true</code>, the FMU can use the callback function <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> to communicate information back to the Co-Simulation master.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status (*fmi3CallbackIntermediateUpdate) (
  fmi3InstanceEnvironment instanceEnvironment,
  fmi3Float64 intermediateUpdateTime,
  fmi3Boolean eventOccurred,
  fmi3Boolean clocksTicked,
  fmi3Boolean intermediateVariableSetAllowed,
  fmi3Boolean intermediateVariableGetAllowed,
  fmi3Boolean intermediateStepFinished,
  fmi3Boolean canReturnEarly);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following output arguments in <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> are used for intermediate variable access:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>intermediateUpdateTime</code> is the simulation time at which the <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> callback function is called by the FMU.</p>
</li>
<li>
<p>If <code>intermediateVariableSetAllowed = fmi3True</code>, the Co-Simulation master may provide intermediate <a href="#input"><code>input</code></a> variables by calling <code>fmi3Set{VariableType}</code> for variables with <a href="#intermediateAccess"><code>intermediateAccess</code></a> = <code>true</code>.</p>
</li>
<li>
<p>If <code>intermediateVariableGetAllowed = fmi3True</code>, the Co-Simulation master may collect intermediate output variables by calling <code>fmi3Get{VariableType}</code> for variables with <a href="#intermediateAccess"><code>intermediateAccess</code></a> = <code>true</code>.</p>
</li>
<li>
<p>If <code>intermediateStepFinished = fmi3False</code>, the Co-Simulation master shall only use intermediate output variables to compute intermediate <a href="#input"><code>input</code></a> variables at the current state.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hence, it is important to distinguish intermediate output from successful internal integration steps from intermediate outputs valid only for temporary solver states.
The <a href="#figure-intermediate-variable-access">Figure 6</a> shows an overview of the solver states and the intended use of intermediate variable access.
It is not necessary that temporary solver states occur before a finished step.
For example, variable step-size solvers may try longer steps first and then reduce step size before the step is finished.</p>
</div>
<div id="figure-intermediate-variable-access" class="imageblock text-center">
<div class="content">
<img src="images/intermediatevariableaccess.svg" alt="intermediatevariableaccess" width="400%">
</div>
<div class="title">Figure 6. Overview of solver states and intermediate variable access during a communication step</div>
</div>
<div class="sect5">
<h6 id="_pseudo_code_example_for_intermediate_variable_access">2.4.3.1.1. Pseudo-code Example for Intermediate Variable Access</h6>
<div class="paragraph">
<p>In the following example, the usage of the intermediate variable access is illustrated in order to clarify the typical calling sequence of the functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="c" class="language-c hljs">//////////////////////////
// Define callback

// Global variables
fmi3IntermediateInfo s_intermediateInfo;

// Callback
fmi3Status intermediateUpdate(fmi3ComponentEnvironment componentEnvironment, fmi3IntermediateInfo* info, fmi3Boolean* earlyReturn)
{
  intermediateTime = info-&gt;intermediateTime;

  //If getting intermediate output variables allowed
  if (info-&gt;intermediateVariableGetAllowed) then {
    //Get the output variables at time = intermediateTime
    fmi3GetReal/Integer/Boolean/String(s, ...);

    //If integration step in FMU solver is finished
    if (info-&gt;intermediateStepFinished) then {
      //Forward output variables to other FMUs or write to result files
    }
  }

  //If setting intermediate output variables allowed
  if (info-&gt;intermediateVariableSetAllowed) then {
    //Compute intermediate input variables from output varibles and
    //variables from other FMUs. Use latest available output
    //variables, possibly from get functions above
    inputVariables = ...

    //Set the input variables at time = intermediateTime
    fmi3SetReal/Integer/Boolean/String(s, ...);
  }

  //Internal execution in FMU will now continue
}

//////////////////////////
// Initialization sub-phase

// Set callback functions,
fmi3CallbackFunctions cbf;
fmi3EventInfo eventInfo;
cbf.logger = loggerFunction; // Logger function
cbf.allocateMemory = calloc;
cbf.freeMemory = free;
// Signal that early return is supported by master
cbf.intermediateUpdate = intermediateUpdate;

// Create pointer to information for identifying the FMU in callbacks
// (note: this is pseudo code, no correct pointer handling)
cbf.componentEnvironment = GUID;

//set Co-Simulation mode
fmi3CoSimulationConfiguration coSimulationConfiguration;
coSimulationConfiguration.intermediateVariableGetRequired = true;
coSimulationConfiguration.intermediateInternalVariableGetRequired = false;
coSimulationConfiguration.intermediateVariableSetRequired = true;
coSimulationConfiguration.coSimulationMode = fmi3ModeHybridCoSimulation;

// Instantiate slave
fmi3Component s = fmi3Instantiate("Tool1" , fmi3CoSimulation, GUID, "", fmi3False, fmi3False, &amp;cbf, fmi3True, fmi3False, &amp;coSimulationConfiguration);

if (s == NULL) then return FAILURE;

// Start and stop time
startTime = 0;
stopTime = 10;
// Communication constant step size
h = 0.01;

// Set all variable start values (of "ScalarVariable / &lt;type&gt; / start")
fmi3SetReal/Integer/Boolean/String(s, ...);

// Initialize slave
fmi3SetupExperiment(s, fmi3False, 0.0, startTime, fmi3True, stopTime);
fmi3EnterInitializationMode(s);

// Set the input values at time = startTime
fmi3SetReal/Integer/Boolean/String(s, ...);

fmi3ExitInitializationMode(s);

//////////////////////////
// Simulation sub-phase
tc = startTime; // Starting master time
step = h;       // Starting non-zero step size
while (tc &lt; tStop) do
{
  if (step &gt; 0) then
  { // Continuous mode (default mode)
    fmi3Bolean earlyReturn = fmi3False;
    status = fmi3DoStep(s,tc,step,...);
    switch () {
      case (status == fmi3OK):
        tc +=step;
      case (status == fmi3Warning):
        // Simplified code
      case (status == fmi3Error or status == fmi3Fatal or status == fmi3Discard):
        // Simplified code
    };
  }
  else
  { // Event mode
    fmi3NewDiscreteStates(s, s_eventInfo);
    if not(s_eventInfo.newDiscreteStatesNeeded) then {
      fmi3EnterContinuousMode(s);
      step = h;
    };
  };
  // Get outputs
  fmi3GetReal/Integer/Boolean/String(s, ...);
  // Set inputs
  fmi3SetReal/Integer/Boolean/String(s, ...);
};

//////////////////////////
// Shutdown sub-phase
if ((status != fmi3Error) and (status != fmi3Fatal)) then fmi3Terminate(s);

if (status != fmi3Fatal) then fmi3FreeInstance(s1);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-model-exchange">3. FMI for Model Exchange</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter contains the interface description to access the equations of a dynamic system from a C program.
A schematic view of a model in FMI for Model Exchange format is shown in <a href="#figure-model-exchange-data-flow">Figure 7</a>:</p>
</div>
<div id="figure-model-exchange-data-flow" class="imageblock text-center">
<div class="content">
<img src="images/model-exchange-data-flow.svg" alt="model exchange data flow" width="80%">
</div>
<div class="title">Figure 7. Data flow between the environment and an FMU for Model Exchange</div>
</div>
<div class="paragraph">
<p><strong class="blue">Blue</strong> arrows: Information provided by the FMU.<br>
<strong class="red">Red</strong> arrows : Information provided to the FMU.<br>
\(\mathbf{v}_{start}\), \(\mathbf{u}\), \(\mathbf{y}\), \(\mathbf{w}\), \(\mathbf{x}_d\) are of a numeric type or String;
\(\mathbf{t}\), \(\mathbf{x}_c\), \(\mathbf{z}\) are of floating point type.</p>
</div>
<div class="sect2">
<h3 id="math-model-exchange">3.1. Mathematical description</h3>
<div class="sect3">
<h4 id="basic-definitions-model-exchange">3.1.1. Basic definitions</h4>
<div class="paragraph">
<p>The goal of the Model Exchange interface is to numerically solve a system of differential, algebraic and discrete-time equations.
In this version of the interface, ordinary differential equations in state-space form with events are handled (abbreviated as "hybrid ODE").
Algebraic equation systems might be contained inside the FMU.
Also, the FMU might consist of discrete-time equations only, for example, describing a sampled-data controller.</p>
</div>
<div class="paragraph">
<p>The <a href="#independent"><code>independent</code></a> variable time \(t \in \mathbb{T}\) is a tuple \(t = (t_R,t_I)\), where \(t_R \in \mathbb{R},\ t_{I} \in \mathbb{N} = \{0, 1, 2, \ldots\}\).
The real part \(t_R\) of this tuple is the <a href="#independent"><code>independent</code></a> variable of the FMU for describing the continuous-time behavior of the model between events.
In this phase \(t_I = 0\).
The integer part \(t_I\) of this tuple is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(t_R\).
This time definition is also called "super-dense time" in literature, see, for example, <a href="#LZ07">[LZ07]</a>.
An ordering is defined on \(\mathbb{\text{T}}\) that leads to the notation below.
<em>[The notation \(^{\bullet}t\) is from <a href="#BCP10">BCP10</a>, adapted from non-standard analysis to super-dense time, in order to precisely define the value from the previous event iteration.]</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 58.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Operation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Mathematical meaning</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t_1 &lt; t_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((t_{R1},t_{I1}) &lt; (t_{R2}, t_{I2})\ \Leftrightarrow \ t_{R1} &lt; t_{R2}\ \textbf{or} \ t_{R1}= t_{R2} \ \textbf{and} \ t_{I1} &lt; t_{I2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_1\) is before \(t_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t_1 = t_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((t_{R1},t_{I1}) = (t_{R2},t_{I2}) \ \Leftrightarrow  t_{R1}= t_{R2}\ \textbf{and} \ t_{I1} = t_{I2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_1\) is identical to \(t_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t^{+}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({{(t}_{R},t_{I})}^{+} \Leftrightarrow (\lim_{\epsilon \rightarrow 0}{\left(t_{R} + \varepsilon \right),t_{Imax})}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">right limit at \(t\).
\(t_{Imax}\) is the largest occurring integer index of super-dense time</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^-t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{-}{{(t}_{R},t_{I})} \Leftrightarrow (\lim_{\epsilon \rightarrow 0}{\left( t_{R} - \varepsilon \right),0)}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left limit at \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{\bullet}{\left( t_{R},t_{I} \right)\ } \Leftrightarrow \left\{ \begin{matrix} ^-t \ &amp; \mathbf{if} \ t_I = 0 \\ (t_R, t_I - 1) \ &amp; \mathbf{if} \ t_I &gt; 0 \\ \end{matrix} \right.\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">previous time instant (= either left limit or previous event instant).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(v^+\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(t^+)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the right limit of \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{-}v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^-t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the left limit of \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^{\bullet}t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#previous"><code>previous</code></a> value (= either left limit or value from the previous event)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Assume that an FMU has an event at \(t_R=2.1s\) and here a signal changes discontinuously.</em>
<em>If no event iteration occurs, the time instant when the event occurs is defined as (2.1, 0), and the time instant when the integration is restarted is defined as (2.1, 1).]</em></p>
</div>
<div class="paragraph">
<p>The hybrid ODEs supported by FMI are described as piecewise continuous-time systems.
Discontinuities can occur at time instants \(t_0, t_1, \ldots, t_n\) where \(t_i &lt; t_{i+1}\).
These time instants are called <code>events</code>.
Events can be known before hand (= time event), or are defined implicitly (= state and step events), see below.
Between events, variables are either <a href="#continuous"><code>continuous</code></a> or do not change their value.
A variable is called discrete-time, if it changes its value only at an event instant.
Otherwise the variable is called continuous-time.
Only floating point variables can be continuous-time.
The following variable indices are used to describe the timing behavior of the corresponding variable (for example, \(v_d\) is a discrete-time variable).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Index</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A continuous-time variable \(x(t)\),
is a continuous function of time inside each interval \(t_i^+ &lt; \ ^-t_{i+1}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A piece-wise <a href="#constant"><code>constant</code></a> variable \(m(t)\), is constant inside each interval \(t_i^+ &lt; \ ^-t_{i+1}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <strong>Clock</strong> variable \(c(t)\), is active only at particular time instants.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <strong>Clocked</strong> variable \(r(t)\), is a variable of a numeric type, String or Enumeration associated to a <a href="#clock"><code>clock</code></a> \(c(t)\) and therefore active only at particular time instants.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At every event instant \(t_i\), variables might be discontinuous (see <a href="#figure-piecwise-continuous-variables">Figure 8</a>).</p>
</div>
<div id="figure-piecwise-continuous-variables" class="imageblock">
<div class="content">
<img src="images/PieceWiseContinuousVariables.svg" alt="PieceWiseContinuousVariables" width="60%">
</div>
<div class="title">Figure 8. Piecewise-continuous variables of an FMU: continuous-time (\(v_c\)) and discrete-time (\(v_d\)).</div>
</div>
<div class="paragraph">
<p>An event instant \(t_i\) is defined by one of the following conditions that give the smallest time instant:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The environment of the FMU triggers an event at the current time instant because at least one discrete-time <a href="#input"><code>input</code></a> changes its value, a continuous-time <a href="#input"><code>input</code></a> has a discontinuous change, or a <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a> changes its value.
Such an event is called external event.
<em>[Note that if an FMU A is connected to an FMU B, and an event is triggered for A, then potentially all <a href="#output"><code>outputs</code></a> of A will be discontinuous at this time instant.</em>
<em>It is therefore adviceable to trigger an external event for B at this time instant too, if an <a href="#output"><code>output</code></a> of A is connected to B.</em>
<em>This means to call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> on B.]</em><br>
All the following events are internal events.</p>
</li>
<li>
<p>At a predefined time instant \(t_i=(T_{next}(t_{i-1}, 0)\) that was defined at the previous event instant \(t_{i-1}\) by the FMU.
Such an event is called time event.</p>
</li>
<li>
<p>At a time instant, where an event indicator \(z_j(t)\) changes its domain from \(z_j &gt; 0\) to \(z_j \leq 0\) or from \(z_j \leq 0\) to \(z_j &gt; 0\) (see <a href="#figure-events">Figure 9</a> below).
More precisely: An event \(t = t_i\) occurs at the smallest time instant "min t" with \(t&gt;t_{i-1}\) where "\((z_j(t)&gt;0) \neq (z_j(t_{i-1}) &gt;0)\)".
Such an event is called state event.
<em>[This definition is slightly different from the standard definition of state events: "</em> \(z_j(t) \cdot z_j(t_{i-1}) \leq 0\) <em>".</em>
<em>This often used definition has the severe drawback that</em> \(z_j(t_{i-1}) \neq 0\) <em>is required in order to be well-defined and this condition cannot be guaranteed.].</em>
All event indicators are piecewise continuous and are collected together in one vector of floating point numbers \(\mathbf{z(t)}\).<br></p>
</li>
</ol>
</div>
<div id="figure-events" class="imageblock text-center">
<div class="content">
<img src="images/Event.svg" alt="Event" width="60%">
</div>
<div class="title">Figure 9. An event occurs when the event indicator changes its domain from \(z&gt;0\) to \(z\leq 0\) or vice versa.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>At every completed step of an integrator, <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> must be called (provided the capability flag <code>ModelDescription.completedIntegratorStepNotNeeded = false</code>).
An event occurs at this time instant, if indicated by the return argument <code>enterEventMode = fmi3True</code>.
Such an event is called step event.
<em>[Step events are, for example, used to dynamically change the (continuous) <a href="#state"><code>states</code></a> of a model internally in the FMU, because the previous states are no longer suited numerically.]</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An FMI Model-Exchange model is described by the following variables:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Variable</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#independent"><code>independent</code></a> variable time \(\in \mathbb{T}\).
(Variable defined with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of all exposed variables (all variables defined in element <code>&lt;ModelVariables&gt;</code>, see <a href="#definition-of-model-variables">Section 2.2.10</a>).
A subset of the variables is selected via a subscript.
Example: \(\mathbf{v}_{initial=exact}\) are variables defined with attribute <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> (see <a href="#definition-of-model-variables">Section 2.2.10</a>).
These are <a href="#independent"><code>independent</code></a> <a href="#parameter"><code>parameters</code></a> and start values of other variables, such as initial values for <a href="#state"><code>states</code></a>, state derivatives or <a href="#output"><code>outputs</code></a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{p}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters that are constant during simulation.
The symbol without a subscript references <a href="#independent"><code>independent</code></a> <a href="#parameter"><code>parameters</code></a> (variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a>).
Dependent <a href="#parameter"><code>parameters</code></a> (variables with <a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a>) are denoted as \(\mathbf{p}_{calculated}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{u}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input variables.
The values of these variables are defined outside of the model.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>.
Whether the <a href="#input"><code>input</code></a> is a discrete-time or continuous-time variable is defined via attribute <a href="#variability"><code>variability</code></a> = <a href="#discrete"><code>discrete</code></a> or <a href="#continuous"><code>continuous</code></a> (see <a href="#definition-of-model-variables">Section 2.2.10</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{y}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output variables.
The values of these variables are computed in the FMU and they are designed to be used in a model connection.
For instance, output variables might be used in the environment as input values to other FMUs or other submodels.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a>.
Whether the <a href="#output"><code>output</code></a> is a discrete-time or continuous-time variable is defined via attribute <a href="#variability"><code>variability</code></a> = <a href="#discrete"><code>discrete</code></a> or <a href="#continuous"><code>continuous</code></a> (see <a href="#definition-of-model-variables">Section 2.2.10</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{w}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local variables of the FMU that cannot be used for FMU connections.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#local"><code>local</code></a>, see <a href="#definition-of-model-variables">Section 2.2.10</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{z}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of floating point continuous-time variables representing the event indicators utilized to define state events, see below.
For notational convenience, an event indicator is conceptually treated as a different type of variable as an <a href="#output"><code>output</code></a> or a <a href="#local"><code>local</code></a> variable for the mathematical description below.
In reality, event indicator is however part of the <a href="#output"><code>outputs</code></a> \(\mathbf{y}\) or the <a href="#local"><code>local</code></a> variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_c(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of floating point continuous-time variables representing the continuous-time <a href="#state"><code>states</code></a>.
For notational convenience, a continuous-time <a href="#state"><code>state</code></a> is conceptually treated as a different type of variable as an <a href="#output"><code>output</code></a> or a <a href="#local"><code>local</code></a> variable for the mathematical description below.
In reality, a continuous-time <a href="#state"><code>state</code></a> is however part of the <a href="#output"><code>outputs</code></a> \(\mathbf{y}\) or the <a href="#local"><code>local</code></a> variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\)<br>
\(^{\bullet}\mathbf{x}_d(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\) is a vector of (internal) discrete-time variables (of any type) representing the discrete <a href="#state"><code>states</code></a>.<br>
\({}^{\bullet}\mathbf{x}_d(t)\) a is the value of \(\mathbf{x}_d(t)\) at the previous super-dense time instant, so \({}^{\bullet}\mathbf{x}_d(t)=\mathbf{x}_d({}^{\bullet}t)\).
Given the <a href="#previous"><code>previous</code></a> values of the discrete-time <a href="#state"><code>states</code></a>, \({}^{\bullet}\mathbf{x}_d(t)\), at the actual time instant \(t\), all other discrete-time variables, especially the discrete <a href="#state"><code>states</code></a> \(\mathbf{x}_d(t)\), can be computed.<br>
Discrete <a href="#state"><code>states</code></a> are not visible in the interface of an FMU and are only introduced here to clarify the mathematical description.
Formally, a discrete <a href="#state"><code>state</code></a> is part of the <a href="#output"><code>outputs</code></a> \(\mathbf{y}\) or the <a href="#local"><code>local</code></a> variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(T_{next}(t_{i})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At initialization or at an event insant, an FMU can define the next time instant \(T_{next}\), at which the next event occurs (see also the definition of events above).
Every event removes automatically a previous definition of \(T_{next}\), and it must be explicitly defined again, if a previously defined \(T_{next}\) was not triggered at the current event instant.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{r}(t_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of Boolean variables with \(r_{i} := z_{i} &gt; 0\).
When entering <strong>Continuous-Time Mode</strong> all relations reported via the event indicators \(\mathbf{z}\) are fixed and during this mode these relations are replaced by \(\mathbf{r}\).
Only during <strong>Initialization Mode</strong> or <strong>Event Mode</strong> the domains \(z_{i} &gt; 0\) can be changed.
For notational convenience, \(\mathbf{r} := \mathbf{z} &gt; 0\)is an abbreviation for \(\mathbf{r}:=\{z_1&gt;0, z_2&gt;0, \ldots \}\).
<em>[For more details, see "Remark 3" below.]</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="computation-modes-model-exchange">3.1.2. Computation Modes</h4>
<div class="paragraph">
<p>Computing the solution of an FMI model means to split the solution process in different phases, and in every phase different equations and solution methods are utilized.
The phases can be categorized according to the following modes:</p>
</div>
<div class="sect4">
<h5 id="_initialization_mode">3.1.2.1. Initialization Mode</h5>
<div class="paragraph">
<p>This mode is used to compute at the start time stem[t_0] initial values for continuous-time <a href="#state"><code>states</code></a>, \(\mathbf{x}_c(t_0)\), and for the <a href="#previous"><code>previous</code></a> (internal) discrete-time <a href="#state"><code>states</code></a>, \(\mathbf{x}_d(t_0)\), by utilizing extra equations not present in the other modes (for example, equations to define the <a href="#start"><code>start</code></a> value for a <a href="#state"><code>state</code></a> or for the derivative of a <a href="#state"><code>state</code></a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_continuous_time_mode">3.1.2.2. Continuous-Time Mode</h5>
<div class="paragraph">
<p>This mode is used to compute the values of all floating point continuous-time variables between events by numerically solving ordinary differential and algebraic equations.
All discrete-time variables are fixed during this phase and the corresponding discrete-time equations are not evaluated.</p>
</div>
</div>
<div class="sect4">
<h5 id="_event_mode">3.1.2.3. Event Mode</h5>
<div class="paragraph">
<p>This mode is used to compute new values for all continuous-time variables, as well as for all discrete-time variables that are activated at the current event instant \(t\), given the values of the variables from the <a href="#previous"><code>previous</code></a> instant \({}^{\bullet}t\).
This is performed by solving algebraic equations consisting of all continuous-time and all active discrete-time equations.
In FMI 2.0 there is no mechanism that the FMU can provide the information whether a discrete-time variable is active or is not active (is not computed) at an event instant.
Therefore, the environment has to assume that at an event instant always all discrete-time variables are computed, although internally in the FMU only a subset might be newly computed.</p>
</div>
<div class="paragraph">
<p>When connecting FMUs together, loop structures can occur that lead to particular difficulties because linear or non-linear algebraic systems of equations in floating point variables but also in Boolean or Integer variables might be present.
In order to solve such systems of equations over FMUs efficiently, the dependency information is needed stating, for example, which <a href="#output"><code>outputs</code></a> depend directly on <a href="#input"><code>inputs</code></a>.
This data is optionally provided in the XML file under element <code>&lt;ModelStructure&gt;</code>.
If this data is not provided, the worst case must be assumed (for example, all output variables depend algebraically on all <a href="#input"><code>input</code></a> variables).</p>
</div>
<div class="paragraph">
<p><em>[Example: In <a href="#figure-connected-fmus">Figure 10</a> two different types of connected FMUs are shown (the "dotted lines" characterize the dependency information):</em></p>
</div>
<div id="figure-connected-fmus" class="imageblock text-center">
<div class="content">
<img src="images/ArtificialAlgebraicLoop.svg" alt="ArtificialAlgebraicLoop" width="80%">
</div>
<div class="title">Figure 10. Calling sequences for FMUs that are connected in a loop.</div>
</div>
<div class="paragraph">
<p><em>In the upper diagram, FMU1 and FMU2 are connected in such a way that by an appropriate sequence of <code>fmi3Set{VariableType}</code> and <code>fmi3Get{VariableType}</code> calls, the FMU variables can be computed.</em>
<em>In the lower diagram, FMU3 and FMU4 are connected in such a way that a real algebraic loop is present.</em>
<em>This loop might be solved iteratively with a Newton method.</em>
<em>In every iteration the iteration variable \(u_4\) is provided by the solver, and via the shown sequence of <code>fmi3Set{VariableType}</code> and <code>fmi3Get{VariableType}</code> calls, the residue is computed and is provided back to the solver.</em>
<em>Based on the residue a new value of \(u_4\) is provided.</em>
<em>The iteration is terminated when the residue is close to zero.</em>
<em>These types of artifical or real algebraic loops can occur in all the different modes, such as <strong>Initialization Mode</strong>, <strong>Event Mode</strong>, and <strong>Continuous-Time Mode</strong>.</em>
<em>Since different variables are computed in every mode and the causality of variable computation can be different in <strong>Initialization Mode</strong> as with respect to the other two modes, it might be necessary to solve different kinds of loops in the different modes.]</em></p>
</div>
<div class="paragraph">
<p>In <a href="#table-math-model-exchange">Table 1</a> the equations are defined that can be evaluated in the respective mode.
The following color coding is used in the table:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="silver"><strong>grey</strong></span>: If a variable in an argument list is marked in <span class="silver">grey</span>, then this variable is not changing in this mode and just the last calculated value from the previous mode is internally used.
For an input argument, it is not allowed to call <code>fmi3Set{VariableType}</code>.
For an output argument, calling <code>fmi3Get{VariableType}</code> on such a variable returns always the same value in this mode.</p>
</li>
<li>
<p><span class="lime"><strong>green</strong></span>: Functions marked in <span class="lime">green</span> are special functions to enter or leave a mode.</p>
</li>
<li>
<p><span class="blue"><strong>blue</strong></span>: Equations and functions marked in <span class="blue">blue</span> define the actual computations to be performed in the respective mode.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[In the following table the setting of the super-dense time, (\(t_R\), \(t_I\)), is precisely described.</em>
<em>Tools will usually not have such a representation of time.</em>
<em>However, super-dense time defines precisely when a new "model evaluation" starts and therefore which variable values belong to the same "model evaluation" at the same (super-dense) time instant and should be stored together.]</em></p>
</div>
<table id="table-math-model-exchange" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Mathematical description of an FMU for Model Exchange.</caption>
<colgroup>
<col style="width: 62.5%;">
<col style="width: 37.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Equations</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FMI functions</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations before Initialization Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#independent"><code>independent</code></a> variable time \(T_{R0}\) and define \(t_0 := (t_{R0},0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(\mathbf{v}_{initial=exact}\) and \(\mathbf{v}_{initial=approx}\)  that have a <a href="#start"><code>start</code></a> value (<a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Initialization Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter <strong>Initialization Mode</strong> at \(t=t_0\) (activate initialization,
discrete-time and continuous-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3EnterInitializationMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(\mathbf{v}_{initial=exact}\) that have a <a href="#start"><code>start</code></a> value with
<a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> (<a href="#independent"><code>independent</code></a> <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}\) and
continuous-time <a href="#state"><code>states</code></a> with <a href="#start"><code>start</code></a> values \(\mathbf{x}_{c,initial=exact}\) are included here)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time <a href="#input"><code>inputs</code></a>  \(\mathbf{u}(\color{grey}t_{\color{grey} 0})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\(\mathbf{v}_{initialUnknowns}:=f_{init}(\mathbf{u_c}, \mathbf{u_d}, \color{grey}t_{\color{grey} 0}, \mathbf{v}_{initial=exact}\))</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi3Get{VariableType}</span></code>, <code><span class="blue">fmi3GetContinuousStates</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Exit <strong>Initialization Mode</strong> (de-activate initialization equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3ExitInitializationMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Event Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter <strong>Event Mode</strong> at \(t = t_{i}\) with \({t_{i}\ : = (t}_{R},t_{I} + 1)\) <strong>if</strong>  externalEvent <strong>or</strong> nextMode \(\equiv\) EventMode <strong>or</strong> \(t_i=(T_{next}(t_{i-1}), 0)\) <strong>or</strong>  \(\min_{t&gt;t_{i-1}} t:\left\lbrack z_{j}\left( t \right) &gt; 0\  \neq \ z_{j}\left( t_{i - 1} \right) &gt; 0 \right\rbrack\)<br>
(activate discrete-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3EnterInitializationMode</span></code> <span class="lime">(only from <strong>Continuous-Time Mode</strong> or after calling</span> <code><span class="lime">fmi3SetTime</span></code>
<span class="lime">if FMU has no continuous-time equations)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#independent"><code>independent</code></a> <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{tune}\)<br>
(and do not set other <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{other}\))</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}(t_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time <a href="#state"><code>states</code></a> \(\mathbf{x}_c(t_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code>,
<a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{w}_{c+d}, \mathbf{z}, \mathbf{x}_{c, reinit})=\mathbf{f}_{sim}(\mathbf{x_c}, \mathbf{u_{c+d}}, \color{grey}t_{\color{grey} i}, \mathbf{p}_{tune}, \color{grey}{\mathbf{p}_{other})}\)</span> <br>
\(\mathbf{f}_{sim}\)is also a function of the internal variables \({}^\bullet\mathbf{x}_d\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi3Get{VariableType}</span></code>,
<code><span class="blue">fmi3GetContinuousStates</span></code>,
<code><span class="blue">fmi3GetDerivatives</span></code>
<code><span class="blue">fmi3GetEventIndicators</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Increment super-dense time and define with</span>
<code><span class="lime">newDiscreteStatesNeeded</span></code> <span class="lime">whether a new event iteration is required.</span><br>
<span class="blue">\(\qquad\)<strong>if not</strong></span> <code><span class="blue">newDiscreteStatesNeeded</span></code><span class="blue"><strong>then</strong><br>
\(\qquad \qquad T_{next}=T_{next}(\mathbf{x}_c,{}^\bullet\mathbf{x}_d, \mathbf{u_{c+d}}, \color{grey}t_{\color{grey} i}, \mathbf{p}_{tune}, \color{grey}{\mathbf{p}_{other})}\)</span><br>
<span class="blue">\(\qquad\)<strong>end if</strong></span><br>
<span class="blue">\(\qquad t:=t(t_R, t_i+1)\)</span><br>
<span class="blue">\(\qquad {}^\bullet\mathbf{x}_d:=\mathbf{x}_d\)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3NewDiscreteState</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#independent"><code>independent</code></a> variable time \(t_i := (T_{next},0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetTime"><code>fmi3SetTime</code></a><br>
(if no continuous-time equations)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Continuous-Time Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter <strong>Continuous-Time Mode</strong>:</span><br>
<span class="lime">\(\qquad \textrm{// de-activate discrete-time equations}\)</span><br>
<span class="lime">\(\qquad \textrm{// "freeze" variables:}\)</span><br>
<span class="lime">\(\qquad \mathbf{r} := \mathbf{z}&gt;0 \qquad \textrm{//all relations}\)</span><br>
<span class="lime">\(\qquad \textbf{x}_d, \textbf{w}_d \qquad \textrm{//all discrete-time variables}\)</span><br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3EnterContinuousTimeMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#independent"><code>independent</code></a> variable time \(t(&gt;t_{enter  mode}): t:=(t_R, 0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetTime"><code>fmi3SetTime</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{c}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time <a href="#state"><code>states</code></a> \(\mathbf{x}_{c}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code>,
<a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="blue">\((\mathbf{y}_{c}\mathbf{,} \color{grey}{\mathbf{y}_{d}}\mathbf{,\ }{\dot{\mathbf{x}}}_{c}\mathbf{,}_{}\mathbf{w}_{c}\mathbf{,}\color{grey}{\mathbf{w}_{d}}\mathbf{,z,}\color{grey}{\mathbf{x}_{c,reinit}}):=\mathbf{f}_{sim}(\mathbf{x}_{c},\ \mathbf{u}_{c}\mathbf{,} \color{grey}{\mathbf{\ u}_{d}}, t,\color{grey}{\mathbf{p}_{tune},\mathbf{p}_{other}})\)</span><br>
<span class="blue">\(\qquad \mathbf{f}_{sim}\) is also a function of the internal variables</span> <span class="silver">\({}^\bullet\mathbf{x}_{d},\mathbf{r}\).</span></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><span class="blue">fmi3Get{VariableType},</span></code>
<code><span class="blue">fmi3GetDerivatives,</span></code>
<code><span class="blue">fmi3GetEventIndicators</span></code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Complete integrator step and return <code>enterEventMode</code></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3CompletedIntegratorStep</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Data types</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">\(t \in \mathbb{R}, \mathbf{p} \in \mathbb{P}^{np},  \mathbf{u}(t) \in \mathbb{P}^{nu},\mathbf{y}(t) \in \mathbb{P}^{ny}, \mathbf{x}_c(t) \in \mathbb{R}^{nxc}, \mathbf{x}_d(t) \in \mathbb{P}^{nxd}, \mathbf{w}(t) \in \mathbb{P}^{nw}, \mathbf{z}(t) \in \mathbb{R}^{nz}\)<br>
\(\qquad \mathbb{R}\): floating point variable, \(\mathbb{P}\): floating point <strong>or</strong> boolean <strong>or</strong> integer <strong>or</strong> enumeration <strong>or</strong> string variable<br>
\(\mathbf{f}_{init}, \mathbf{f}_{sim} \in C^0\) (=continuous functions with respect to all input arguments inside the respective mode).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Remark 1 - Calling Sequences:</em></p>
</div>
<div class="paragraph">
<p><em>In the table above, for notational convenience in every mode one function call is defined to compute all output arguments from all inputs arguments.</em>
<em>In reality, every scalar output argument is computed by one <code>fmi3Get{VariableType}</code> function call.</em>
<em>Additionally, the output argument need not be a function of all input arguments, but of only a subset from it, as defined in the XML file under <code>&lt;ModelStructure&gt;</code>.</em>
<em>This is essential when FMUs are connected in a loop, as shown in <a href="#figure-connected-fmus">Figure 10</a>. For example, since</em> \(y_{2a}\) <em>depends only on</em> \(u_{1a}\) <em>, but not on</em> \(u_{1b}\)<em>, it is possible to call</em> <code>fmi3Set{VariableType}</code> <em>to set</em> \(u_{1a}\) <em>, and then inquire</em> \(y_{2a}\) <em>with</em> <code>fmi3Get{VariableType}</code> <em>without setting</em> \(u_{1b}\) <em>beforehand.</em></p>
</div>
<div class="paragraph">
<p><em>It is non-trivial to provide code for <code>fmi3Set{VariableType}</code>, <code>fmi3Get{VariableType}</code>, if the environment can call</em> <code>fmi3Set{VariableType}</code> <em>on the <a href="#input"><code>inputs</code></a> in quite different orders.</em>
<em>A simple remedy is to provide the dependency information, not according to the real functional dependency, but according to the sorted equations in the generated code.</em>
<em>Example:</em></p>
</div>
<div class="paragraph">
<p><em>Assume an FMU is described by the following equations (<code>u1</code>, <code>u2</code> are <a href="#input"><code>inputs</code></a>, <code>y1</code>, <code>y2</code> are <a href="#output"><code>outputs</code></a>,<code>w1</code>, <code>w2</code> are internal variables):</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>w1 = w2 + u1
w2 = u2
y1 = w1
y2 = w2</pre>
</div>
</div>
<div class="paragraph">
<p><em>Sorting of the equations might result in (this ordering is not unique):</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>w2 := u2
y2 := w2
w1 := w2 + u1
y1 := w1</pre>
</div>
</div>
<div class="paragraph">
<p><em>With this ordering, the dependency should be defined as <code>y2 = f(u2), y1 = f(u1,u2)</code>.</em>
<em>When <code>y2</code> is called first with <code>fmi3Get{VariableType}</code>, then only <code>u2</code> must be set first (since <code>y2 = f(u2)</code>), and the first two equations are evaluated.</em>
<em>If later <code>y1</code> is inquired as well, then the first two equations are not evaluated again and only the last two equations are evaluated.</em>
<em>On the other hand, if <code>y1</code> is inquired first, then <code>u1</code> and <code>u2</code> must be set first (since <code>y1 = f(u1,u2)</code>) and then all equations are computed.</em>
<em>When <code>y2</code> is inquired afterwards, the cached value is returned.</em></p>
</div>
<div class="paragraph">
<p><em>If sorting of the equations in this example would instead result in the following code:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>w2 := u2
w1 := w2 + u1
y1 := w1
y2 := w2</pre>
</div>
</div>
<div class="paragraph">
<p><em>then the dependency should be defined as <code>y2 = f(u1,u2)</code>, <code>y1 = f(u1,u2)</code>, because <code>u1</code> and <code>u2</code> must be first set, before <code>y2</code> can be inquired with <code>fmi3Get{VariableType}</code> when executing this code.</em></p>
</div>
<div class="paragraph">
<p><em>Remark 2 - Mathematical Model of Discrete-Time FMUs:</em></p>
</div>
<div class="paragraph">
<p><em>There are many different ways discrete-time systems are described.</em>
<em>For FMI, the following basic mathematical model for discrete-time systems is used (other description forms must be mapped, as sketched below):</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/remark_2_source.png" alt="remark 2 source" width="70%">
</div>
</div>
<div class="paragraph">
<p><em>At an event instant, the discrete system is described by algebraic equations as function of the <a href="#previous"><code>previous</code></a> (internal) discrete-time <a href="#state"><code>states</code></a></em> \(_{}^{\bullet}\mathbf{x}_{d}\) <em>and the discrete-time <a href="#input"><code>inputs</code></a></em> \(\mathbf{u}_{d}\).
<em>If FMUs are connected in a loop, these algebraic equations are called iteratively, until the solution is found.</em>
<em>If the actual discrete-time <a href="#state"><code>states</code></a></em> \(\mathbf{x}_{d}\) <em>and the <a href="#previous"><code>previous</code></a> discrete-time <a href="#state"><code>states</code></a></em> \(_{}^{\bullet}\mathbf{x}_{d}\) <em>are not identical, the discrete-time <a href="#state"><code>states</code></a> are updated, the integer part of the time is incremented and a new event iteration is performed.</em>
<em>Other discrete-time models must be mapped to this description form.</em>
<em>Examples:</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Synchronous systems</dt>
<dd>
<p><em>A synchronous system, such as Lucid Synchrone <a href="#PZ06">[PZ06]</a> or Modelica 3.3 <a href="#MLS12">[MLS12]</a>, is called periodically, and at every sample instant the discrete-time equations are evaluated exactly once.</em>
<em>An FMU of this type can be implemented by activating the model equations only at the first event iteration and returning always <code>newDiscreteStatesNeeded = fmi3False</code> from <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a>.</em>
<em>Furthermore, the discrete-time <a href="#state"><code>states</code></a> are not updated by <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a>, but as first action before the discrete-time equations are evaluated, in order that</em> \(^{\bullet}\mathbf{x}_d\) <em>(= value at the previous <a href="#clock"><code>clock</code></a> tick) and</em> \(\mathbf{x}_d\) <em>(value at the latest <a href="#clock"><code>clock</code></a> tick) have reasonable values between <a href="#clock"><code>clock</code></a> ticks.</em></p>
</dd>
<dt class="hdlist1">State machines with one memory location for a state</dt>
<dd>
<p><em>In such a system there is only one memory location for a discrete-time <a href="#state"><code>state</code></a> and not two, and therefore a discrete-time <a href="#state"><code>state</code></a> is updated in the statement where it is assigned (and not in <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a>).</em>
<em>As a result, <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> is basically just used to start a new (super-dense) time instant.</em>
<em>This is unproblematic, as long as no algebraic loops occur.</em>
<em>FMUs of this type can therefore not be used in real algebraic loops if the involved variables depend on a discrete-time <a href="#state"><code>state</code></a>.</em>
<em>This restriction is communicated to the environment of the FMU by the <code>ScalarVariable</code> definition of the corresponding <a href="#input"><code>input</code></a> with flag <a href="#canHandleMultipleSetPerTimeInstant"><code>canHandleMultipleSetPerTimeInstant</code></a> <code>= false</code> (so an <a href="#input"><code>input</code></a> with this flag is not allowed to be called in an algebraic loop).</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Remark 3 - Event Indicators / Freezing Relations:</em></p>
</div>
<div class="paragraph">
<p><em>In the above table, vector</em> <strong>r</strong> <em>is used to collect all relations together that are utilized in the event indicators</em> <strong>z</strong> <em>.
_In <strong>Continuous-Time Mode</strong> all these relations are <code>frozen</code> and do not change during the evaluations in the respective mode.</em>
<em>This is indicated in the table above by computing</em> <strong>r</strong> <em>when entering the <strong>Continuous-Time Mode</strong> and providing</em> <strong>r</strong> <em>as (internal) input argument to the evaluation functions.</em>
<em>Example:</em></p>
</div>
<div class="paragraph">
<p><em>An equation of the form</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>y = if x1 &gt; x2 or x1 &lt; x3 then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>can be implemented in the FMU as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>z1 := x1 - x2;
z2 := x3 - x1;
if *Initialization Mode* or *Event Mode* then
  r1 := z1 &gt; 0;
  r2 := z2 &gt; 0;
end if;
y = if r1 or r2 then +1 else -1</pre>
</div>
</div>
<div class="paragraph">
<p><em>Therefore, the original if-clause is evaluated in this form only during <strong>Initialization Mode</strong> and <strong>Event Mode</strong>.</em>
<em>In <strong>Continuous-Time Mode</strong> this equation is evaluated as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>z1 = x1 - x2;
z2 = x3 - x1
y = if r1 or r2 then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>and when entering <strong>Continuous-Time Mode</strong> r1 and r2 are computed as</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>r1 = z1 &gt; 0
r2 = z2 &gt; 0</pre>
</div>
</div>
<div class="paragraph">
<p><em>When z1 changes from z1 &gt; 0 to z1 &#8656; 0 or vice versa, or z2 correspondingly, the integration is halted, and the environment must call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>.</em></p>
</div>
<div class="paragraph">
<p><em>An actual implementation will pack the code in an impure function, say Greater(&#8230;&#8203;), resulting in:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>y = if Greater(x1-x2,...) or Greater(x3-x1,...) then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>Furthermore, a hysteresis should be added for the event indicators.</em></p>
</div>
<div class="paragraph">
<p>An FMU is initialized in <strong>Initialization Mode</strong> with \(\mathbf{f}_{init}(\ldots)\).
The input arguments to this function consist of the <a href="#input"><code>input</code></a> variables (= variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>), of the <a href="#independent"><code>independent</code></a> variable (= variable with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>; usually the default value <code>time</code>), and of all variables that have a <a href="#start"><code>start</code></a> value with (explicitly or implicitly) <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> in order to compute the continuous-time <a href="#state"><code>states</code></a> and the output variables at the initial time \(t_0\).
In the above table, the variables with <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> are collected together in variable \(\mathbf{v}_{initial=exact}\).
For example, initialization might be defined by providing initial <a href="#start"><code>start</code></a> values for the <a href="#state"><code>states</code></a>, \(\mathbf{x}_{c0}\), or by stating that the state derivatives are zero (\(\dot{\mathbf{x}}_{c} = \mathbf{0}\)).
Initialization is a difficult topic by itself, and it is required that an FMU solves a well-defined initialization problem inside the FMU in <strong>Initialization Mode</strong>.<br>
After calling <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, the FMU is implicitly in <strong>Event Mode</strong>, and all discrete-time and continuous-time variables at the initial time instant \((t_R, 0)\) can be calculated.
If these variables are present in an algebraic loop, iteration can be used to compute them.
Once finalized, <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> must be called, and depending on the value of the return argument, the FMU either continues the event iteration at the initial time instant or switches to <strong>Continuous-Time Mode</strong>.<br>
After switching to <strong>Continuous-Time Mode</strong>, the integration is started.
Basically, in this phase the <a href="#derivative"><code>derivatives</code></a> of the continuous <a href="#state"><code>states</code></a> are computed.
If FMUs and/or submodels are connected together, then the <a href="#input"><code>inputs</code></a> of these models are the <a href="#output"><code>outputs</code></a> of other models, and therefore, the corresponding FMU outputs must be computed.
Whenever result values shall be stored, usually at output points defined before the start of the simulation, the <code>fmi3Get{VariableType}</code> function with respect to the desired variables must be called.<br>
Continuous integration is stopped at an event instant.
An event instant is determined by a time, state or step event, or by an external event triggered by the environment.
In order to determine a state event, the event indicators <strong>z</strong> have to be inquired at every completed integrator step.
Once the event indicators signal a change of their domain, an iteration over time is performed between the previous and the actual completed integrator step, in order to determine the time instant of the domain change up to a certain precision.<br>
After an event is triggered, the FMU needs to be switched to <strong>Event Mode</strong>.
In this mode, systems of equations over connected FMUs might be solved (similarily as in <strong>Continuous-Time Mode</strong>).
Once convergence is reached, <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> must be called to increment super-dense time (and conceptually update the discrete-time <a href="#state"><code>states</code></a> defined internally in the FMU by \(^{\bullet}\mathbf{x}_d := \mathbf{x}_d\)).
Depending on the discrete-time model, a new event iteration might be needed (for example, because the FMU describes internally a state machine
and transitions are still able to fire, but new <a href="#input"><code>inputs</code></a> shall be taken into account).<br>
The function calls in the table above describe precisely which input arguments are needed to compute the desired output argument(s).
There is no 1:1 mapping of these mathematical functions to C functions.
Instead, all input arguments are set with <code>fmi3Set{VariableType}</code> C function calls, and then the result argument(s) can be determined with the C functions defined in the right column of the above table.
This technique is discussed in detail in <a href="#providing-independent-variables-and-re-initialization">Section 3.2.1</a>.
<em>[In short: For efficiency reasons, all equations from the table above will usually be available in one (internal) C function.</em>
<em>With the C functions described in the next sections, input arguments are copied into the internal model data structure only when their value has changed in the environment.</em>
<em>With the C functions in the right column of the table above, the internal function is called in such a way that only the minimum needed equations are evaluated.</em>
<em>Hereby, variable values calculated from previous calls can be reused.</em>
<em>This technique is called "caching" and can significantly enhance the simulation efficiency of real-world models.]</em></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_application_programming_interface">3.2. Application Programming Interface</h3>
<div class="paragraph">
<p>This section contains the interface description to evaluate different model parts from a C program.</p>
</div>
<div class="sect3">
<h4 id="providing-independent-variables-and-re-initialization">3.2.1. Providing Independent Variables and Re-initialization of Caching</h4>
<div class="paragraph">
<p>Depending on the situation, different variables need to be computed.
In order to be efficient, it is important that the interface requires only the computation of variables that are needed in the present context.
For example, during the iteration of an integrator step, only the state derivatives need to be computed, provided the <a href="#output"><code>output</code></a> of a model is not connected.
It might be that at the same time instant other variables are needed.
For example, if an integrator step is completed, the event indicator functions need to be computed as well.
If the state derivatives have already been computed at the present time instant, then it is important for efficiency that they are not newly computed in the call to compute the event indicator functions.
This means, the state derivatives shall be reused from the previous call.
This feature is called "caching of variables" in the sequel.<br>
Caching requires that the model evaluation can detect when the input arguments, like time or states, have changed.
This is achieved by setting them explicitly with a function call, since every such function call signals precisely a change of the corresponding variables.
For this reason, this section contains functions to set the input arguments of the equation evaluation functions.
This is unproblematic for time and states, but is more involved for <a href="#parameter"><code>parameters</code></a> and <a href="#input"><code>inputs</code></a>, since the latter may have different data types.</p>
</div>
<div id="fmi3SetTime" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SetTimeTYPE(fmi3Instance instance, fmi3Float64 time);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set a new time instant and re-initialize caching of variables that depend on time, provided the newly provided time value is different to the previously set time value (variables that depend solely on <a href="#constant"><code>constants</code></a> or <a href="#parameter"><code>parameters</code></a> need not to be newly computed in the sequel, but the previously computed values can be reused).</p>
</div>
<div id="fmi3SetContinuousStates" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SetContinuousStatesTYPE(fmi3Instance instance,
                                               const fmi3Float64 x[],
                                               size_t nx);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set a new (continuous) state vector and re-initialize caching of variables that depend on the <a href="#state"><code>states</code></a>.
Argument <code>nx</code> is the length of vector <code>x</code> and is provided for checking purposes (variables that depend solely on<a href="#constant"><code>constants</code></a>, <a href="#parameter"><code>parameters</code></a>, time, and <a href="#input"><code>inputs</code></a> do not need to be newly computed in the sequel, but the previously computed values can be reused).
Note that the continuous <a href="#state"><code>states</code></a> might also be changed in <strong>Event Mode</strong>.
Note that <code>fmi3Status = fmi3Discard</code> is possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">fmi3Status fmi3Set{VariableType}(..);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set new values for (<a href="#independent"><code>independent</code></a>) <a href="#parameter"><code>parameters</code></a>, <a href="#start"><code>start</code></a> values and <a href="#input"><code>inputs</code></a> and re-initialize caching of variables that depend on these variables.
The details of these functions are defined in <a href="#get-and-set-variable-values">Section 2.1.7</a>.</p>
</div>
<div class="paragraph">
<p><em>[The functions above have the slight drawback that values must always be copied.</em>
<em>For example, a call to</em> <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a> <em>will provide the actual states in a vector, and this function has to copy the values in to the internal model data structure "</em> <code>c</code> <em>" so that subsequent evaluation calls can utilize these values.</em>
<em>If this turns out to be an efficiency issue, a future release of FMI might provide additional functions to provide the address of a memory area where the variable values are present.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="evaluation-of-model-equations">3.2.2. Evaluation of Model Equations</h4>
<div class="paragraph">
<p>This section contains the core functions to evaluate the model equations.
Before one of these functions can be called, the appropriate functions from the previous section have to be used, to set the input arguments to the current model evaluation.</p>
</div>
<div id="fmi3EnterEventMode" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3EnterEventModeTYPE(fmi3Instance instance,
                                          fmi3Boolean inputEvent,
                                          fmi3Boolean stepEvent,
                                          const fmi3Int32 rootsFound[],
                                          size_t nEventIndicators,
                                          fmi3Boolean timeEvent);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The model enters <strong>Event Mode</strong> from the <strong>Continuous-Time Mode</strong> and discrete-time equations may become active (and relations are not "frozen").</p>
</div>
<div class="paragraph">
<p>The followings arguments can be set to <code>fmi3True</code> to inform the FMU why <strong>Event Mode</strong> was entered.
<em>[These arguments are not mutually exclusive and may all be <code>fmi3False</code> if the caller cannot provide this information.]</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>inputEvent</code></dt>
<dd>
<p>An input event occurred.</p>
</dd>
<dt class="hdlist1"><code>stepEvent</code></dt>
<dd>
<p>A step event occurred.</p>
</dd>
<dt class="hdlist1"><code>rootsFound</code></dt>
<dd>
<p>Array of length <code>nEventIndicators</code>. For <code>i = 1, &#8230;&#8203;, nEventIndicators, rootsFound[i-1]</code> \(\neq\) <code>0</code> if the event indicator \(z_i\) has a root, and <code>rootsFound[i-1] == 0</code> if not.
For the components \(z_i\) for which a root was found, the sign of <code>rootsFound[i-1]</code> indicates the direction of the zero-crossing.
A value of <code>+1</code> indicates that \(z_i\) is increasing, while a value of <code>-1</code> indicates a decreasing \(z_i\).
If <code>nEventIndicators == 0</code> the value of <code>rootsFound</code> is not defined.</p>
</dd>
<dt class="hdlist1"><code>nEventIndicators</code></dt>
<dd>
<p>The number of event indicators or <code>0</code> if the caller cannot provide this information.</p>
</dd>
<dt class="hdlist1"><code>timeEvent</code></dt>
<dd>
<p>A time event occurred.</p>
</dd>
</dl>
</div>
<div id="fmi3NewDiscreteStates" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3NewDiscreteStatesTYPE(fmi3Instance instance,
                                             fmi3Boolean *newDiscreteStatesNeeded,
                                             fmi3Boolean *terminateSimulation,
                                             fmi3Boolean *nominalsOfContinuousStatesChanged,
                                             fmi3Boolean *valuesOfContinuousStatesChanged,
                                             fmi3Boolean *nextEventTimeDefined,
                                             fmi3Float64 *nextEventTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FMU is in <strong>Event Mode</strong> and the super dense time is incremented by this call.<br>
If the super dense time before a call to <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> was \((t_R,t_I)\), then the time instant after the call is \((t_R,t_I)\).<br>
If output argument <code>newDiscreteStatesNeeded = fmi3True</code>, the FMU should stay in <strong>Event Mode</strong>, and the FMU requires to set new inputs to the FMU (<code>fmi3Set{VariableType}</code> on <a href="#input"><code>inputs</code></a>) to compute and get the <a href="#output"><code>outputs</code></a> (<code>fmi3Get{VariableType}</code> on <a href="#output"><code>outputs</code></a>) and to call <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> again.</p>
</div>
<div class="paragraph">
<p>Depending on the connection with other FMUs, the environment shall</p>
</div>
<div class="ulist">
<ul>
<li>
<p>call <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>, if <code>terminateSimulation = fmi3True</code> is returned by at least one FMU,</p>
</li>
<li>
<p>call <a href="#fmi3EnterContinuousTimeMode"><code>fmi3EnterContinuousTimeMode</code></a> if all FMUs return <code>newDiscreteStatesNeeded = fmi3False</code>, and</p>
</li>
<li>
<p>stay in <strong>Event Mode</strong> otherwise.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the FMU is terminated, it is assumed that an appropriate message is printed by the logMessage function (see <a href="#creation-destruction-and-logging">Section 2.1.5</a>) to explain the reason for the termination.<br>
If <code>nominalsOfContinuousStatesChanged = fmi3True</code>, then the nominal values of the <a href="#state"><code>states</code></a> have changed due to the function call and can be inquired with <a href="#fmi3GetNominalsOfContinuousStates"><code>fmi3GetNominalsOfContinuousStates</code></a>.<br>
If <code>valuesOfContinuousStatesChanged = fmi3True</code>, then at least one element of the continuous state vector has changed its value due to the function call.</p>
</div>
<div id="state" class="paragraph">
<p>The new values of the <a href="#state"><code>states</code></a> can be inquired with <a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a> or individually for each state for which <code>reinit = true</code> by calling <code>fmi3GetFloat*</code>.
If no element of the continuous state vector has changed its value, <code>valuesOfContinuousStatesChanged</code> must return <code>fmi3False</code>.
<em>[If <code>fmi3True</code> would be returned in this case, an infinite event loop may occur.]</em><br>
If <code>nextEventTimeDefined = fmi3True</code>, then the simulation shall integrate at most until <code>time = nextEventTime</code>, and shall call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> at this time instant.
If integration is stopped before <code>nextEventTime</code>, for example, due to a state event, the definition of <code>nextEventTime</code> becomes obsolete.</p>
</div>
<div id="fmi3EnterContinuousTimeMode" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3EnterContinuousTimeModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The model enters <strong>Continuous-Time Mode</strong> and all discrete-time equations become inactive and all relations are "frozen".<br>
This function has to be called when changing from <strong>Event Mode</strong> (after the global event iteration in <strong>Event Mode</strong> over all involved FMUs and other models has converged) into <strong>Continuous-Time Mode</strong>.<br></p>
</div>
<div class="paragraph">
<p><em>[This function might be used for the following purposes:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>If the FMU stores results internally on file, then the results after the initialization and/or the event has been processed can be stored.</em></p>
</li>
<li>
<p><em>If the FMU contains dynamically changing states, then a new state selection might be performed with this function.]</em></p>
</li>
</ul>
</div>
<div id="fmi3CompletedIntegratorStep" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3CompletedIntegratorStepTYPE(fmi3Instance instance,
                                                   fmi3Boolean noSetFMUStatePriorToCurrentPoint,
                                                   fmi3Boolean* enterEventMode,
                                                   fmi3Boolean* terminateSimulation);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function must be called by the environment after every completed step of the integrator provided the capability flag <code>completedIntegratorStepNotNeeded = false</code>.
Argument <code>noSetFMUStatePriorToCurrentPoint</code> is <code>fmi3True</code> if <code>fmi3SetFMUState</code> will no longer be called for time instants prior to current time in this simulation run [the FMU can use this flag to flush a result buffer].<br>
The function returns <code>enterEventMode</code> to signal to the environment if the FMU shall call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>, and it returns <code>terminateSimulation</code> to signal if the simulation shall be terminated.
If <code>enterEventMode = fmi3False</code> and <code>terminateSimulation = fmi3False</code> the FMU stays in <strong>Continuous-Time Mode</strong> without calling <a href="#fmi3EnterContinuousTimeMode"><code>fmi3EnterContinuousTimeMode</code></a> again.
When the integrator step is completed and the <a href="#state"><code>states</code></a> are modified by the integrator afterwards (for example, correction by a BDF method),
then <a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a> has to be called with the updated states before <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> is called.<br>
When the integrator step is completed and one or more event indicators change sign (with respect to the previously completed integrator step), then the integrator or the environment has to determine the time instant of the sign change that is closest to the previous completed step up to a certain precision (usually a small multiple of the machine epsilon).
This is usually performed by an iteration where time is varied and <a href="#state"><code>state</code></a> variables needed during the iteration are determined by interpolation.
Function <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> must be called after this state event location procedure and not after the successful computation of the time step by the integration algorithm.
The intended purpose of the function call is to indicate to the FMU that at this stage all <a href="#input"><code>inputs</code></a> and <a href="#state"><code>state</code></a> variables have valid (accepted) values.
After <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> is called, it is still allowed to go back in time (calling <a href="#fmi3SetTime"><code>fmi3SetTime</code></a>) and inquire values of variables at previous time instants with <code>fmi3Get{VariableType}</code> <em>[for example, to determine values of non-state variables at output points]</em>.
However, it is not allowed to go back in time over the previous <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> or the previous <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> call.</p>
</div>
<div class="paragraph">
<p><em>[This function might be used, for example, for the following purposes:</em></p>
</div>
<div class="paragraph">
<p><em>Delays:</em><br>
<em>All variables that are used in a "delay(..)" operator are stored in an appropriate buffer and the function returns with <code>enterEventMode = fmi3False</code>, and <code>terminateSimulation = fmi3False</code>.</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Dynamic state selection:</em><br>
<em>It is checked whether the dynamically selected states are still numerically appropriate.</em>
<em>If yes, the function returns with <code>enterEventMode = fmi3False</code>  otherwise with <code>enterEventMode = fmi3True</code>.</em>
<em>In the latter case, <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> has to be called and the states are dynamically changed by a subsequent <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a>.</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Note that this function is not used to detect time or state events, for example, by comparing event indicators of the previous with the current call of <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a>.</em>
<em>These types of events are detected in the environment, and the environment has to call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> independently in these cases, whether the return argument <code>enterEventMode</code> of <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> is <code>fmi3True</code> or <code>fmi3False</code>.]</em></p>
</div>
<div id="fmi3GetDerivatives" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetDerivativesTYPE(fmi3Instance instance,
                                          fmi3Float64 derivatives[],
                                          size_t nx);</code></pre>
</div>
</div>
<div id="fmi3GetEventIndicators" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetEventIndicatorsTYPE(fmi3Instance instance,
                                              fmi3Float64 eventIndicators[],
                                              size_t ni);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compute state derivatives and event indicators at the current time instant and for the current <a href="#state"><code>states</code></a>.
Note that <code>fmi3Status = fmi3Discard</code> is possible for both functions.</p>
</div>
<div class="paragraph">
<p>The <a href="#derivative"><code>derivatives</code></a> are returned as a vector with <code>nx</code> elements.
The ordering of the elements of the <code>derivatives</code> vector is identical to the ordering of the state vector (for example, <code>derivatives[2]</code> is the <a href="#derivative"><code>derivative</code></a> of <code>x[2]</code>).
The order of the states and derivatives is also the same as the ordered list of elements <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code>.
<em>[Array variables are serialized in "row major" order, as usual.]</em></p>
</div>
<div class="paragraph">
<p>The event indicators are returned as a vector with <code>ni</code> elements.
The order of event indicators in <code>eventIndicators</code> vector is the same as the ordered list of <code>EventIndicator</code> elements in <code>ModelStructure</code>.
<em>[Array variables are serialized in "row major" order, as usual.]</em>
A state event is triggered when the domain of an event indicator changes from \(z_j &gt; 0\) to \(z_j \leq 0\) or vice versa.
The FMU must guarantee that at an event restart \(z_j \neq 0\), for example, by shifting \(z_j\) with a small value.
Furthermore, \(z_j\) should be scaled in the FMU with its nominal value (so all elements of the returned vector <code>eventIndicators</code> should be in the order of "one").</p>
</div>
<div id="fmi3GetContinuousStates" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetContinuousStatesTYPE(fmi3Instance instance, fmi3Float64 x[], size_t nx);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Return the new (continuous) state vector <code>x</code>.</p>
</div>
<div id="fmi3GetNominalsOfContinuousStates" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetNominalsOfContinuousStatesTYPE(fmi3Instance instance,
                                                         fmi3Float64 nominals[],
                                                         size_t nx);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Return the nominal values of the continuous <a href="#state"><code>states</code></a>.
This function should always be called after calling function <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a>, if <code>nominalsOfContinuousStatesChanged = fmi3True</code>, since then the nominal values of the continuous <a href="#state"><code>states</code></a> have changed <em>[for example, because the association of the continuous <a href="#state"><code>states</code></a> to variables has changed due to internal dynamic state selection]</em>.
If the FMU does not have information about the nominal value of a continuous <a href="#state"><code>state</code></a> i, a nominal value <code>x_nominal[i] = 1.0</code> should be returned.
Note that it is required that <code>x_nominal[i] &gt; 0.0</code>.
<em>[Typically, the nominal values of the continuous <a href="#state"><code>states</code></a> are used to compute the absolute tolerance required by the integrator.</em>
<em>Example:</em><br>
<code>absoluteTolerance[i] = 0.01 * tolerance * x_nominal[i];</code> <em>]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="state-machine-model-exchange">3.2.3. State Machine of Calling Sequence</h4>
<div class="paragraph">
<p>Every implementation of the FMI must support calling sequences of the functions according to the following state chart:</p>
</div>
<div id="figure-model-exchange-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/state-machine-model-exchange.svg" alt="state machine model exchange" width="80%">
</div>
<div class="title">Figure 11. Calling sequence of Model Exchange C functions in form of an UML 2.0 state machine.</div>
</div>
<div class="paragraph">
<p>The objective of the start chart is to define the allowed calling sequences for functions of the FMI: Calling sequences not accepted by the state chart are not supported by the FMI.
The behavior of an FMU is undefined for such a calling sequence.
For example, the state chart indicates that when an FMU for Model Exchange is in state <strong>Continuous-Time Mode</strong>, a call to <code>fmi3Set{VariableType}</code> for a <a href="#discrete"><code>discrete</code></a> <a href="#input"><code>input</code></a> is not supported.
The state chart is given here as UML 2.0 state machine.
If a transition is labelled with one or more function names (for example, <code>fmi3GetFloat64</code>, <code>fmi3GetUInt8</code>), this means that the transition is taken if any of these functions is successfully called.
Note that the FMU can always determine in which state it is since every state is entered by a particular function call (such as <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>), or a particular return value (such as <code>fmi3Fatal</code>).</p>
</div>
<div class="paragraph">
<p>The transition conditions <code>external event</code>, <code>time event</code>, and <code>state event</code> are defined in <a href="#math-model-exchange">Section 3.1</a>.
Each state of the state machine corresponds to a certain phase of a simulation as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">instantiated</dt>
<dd>
<p>In this state, <a href="#start"><code>start</code></a> and guess values (= variables that have <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a>) set and <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> can be set, this does not include inputs as they do not have an <a href="#initial"><code>initial</code></a> attribute.</p>
</dd>
<dt class="hdlist1">Configuration Mode</dt>
<dd>
<p>In this state <a href="#structuralParameter"><code>structural parameters</code></a> with <a href="#variability"><code>variability</code></a> = <a href="#fixed"><code>fixed</code></a> or <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> can be changed.
This state is entered from state <strong>Instantiated</strong> by calling <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> and left back to <strong>Instantiated</strong> by calling <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>.
<a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> can only be called if the FMU contains at least one <a href="#structuralParameter"><code>structural parameter</code></a></p>
</dd>
<dt class="hdlist1">Initialization Mode</dt>
<dd>
<p>In this state, equations are active to determine all continuous-time states, as well as all <a href="#output"><code>outputs</code></a> (and optionally other variables exposed by the exporting tool).
The variables that can be retrieved by <code>fmi3Get{VariableType}</code> calls are (1) defined in the XML file as elements <code>&lt;ModelStructure&gt;&lt;InitialUnknown&gt;</code> and (2) variables with <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a>.
Variables with <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> and <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a>, as well as variables with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> can be set.</p>
</dd>
<dt class="hdlist1">Continuous-Time Mode</dt>
<dd>
<p>In this state, the continuous-time model equations are active and integrator steps are performed.
The event time of a state event may be determined if a domain change of at least one event indicator is detected at the end of a completed integrator step.</p>
</dd>
<dt class="hdlist1">Event Mode</dt>
<dd>
<p>If an event is triggered in <strong>Continuous-Time Mode</strong>, <strong>Event Mode</strong> is entered by calling <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>.
In this mode all continuous-time and discrete-time equations are active and the unknowns at an event can be computed and retrieved.
After an event is completely processed, <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> must be called and depending on the return argument, <code>newDiscreteStatesNeeded</code>, the state chart stays in <strong>Event Mode</strong> or switches to <strong>Continuous-Time Mode</strong>.
When the <strong>Initialization Mode</strong> is terminated with <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, then <strong>Event Mode</strong> is directly entered, and the continuous-time and discrete-time variables at the initial time are computed based on the initial continuous-time states determined in the <strong>Initialization Mode</strong>.</p>
</dd>
<dt class="hdlist1">Reconfiguration Mode</dt>
<dd>
<p>In this state <a href="#structuralParameter"><code>structural parameters</code></a> with <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> can be changed.
This state is entered from state <strong>Event Mode</strong> by calling <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> and left back to <strong>Event Mode</strong> by calling <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>.
<a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> can only be called if the FMU contains at least one <a href="#structuralParameter"><code>structural parameter</code></a></p>
</dd>
<dt class="hdlist1">Terminated</dt>
<dd>
<p>In this state, the solution at the final time of a simulation can be retrieved.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that simulation backward in time is only allowed over continuous time intervals.
As soon as an event occurrs (<a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> was called), going back in time is forbidden, because <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> / <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> can only compute the next discrete state, not the previous one.</p>
</div>
<div class="paragraph">
<p>Note that during <strong>Initialization</strong>, <strong>Event</strong>, and <strong>Continuous-Time Mode</strong> <a href="#input"><code>input</code></a> variables can be set with <code>fmi3Set{VariableType}</code> and output variables can be retrieved with <code>fmi3Get{VariableType}</code> interchangeably according to the model structure defined under element <code>&lt;ModelStructure&gt;</code> in the XML file.
<em>[For example, if one <a href="#output"><code>output</code></a> <code>y1</code> depends on two <a href="#input"><code>inputs</code></a> <code>u1</code>, <code>u2</code>, then these two <a href="#input"><code>inputs</code></a> must be set, before <code>y1</code> can be retrieved.</em>
<em>If additionally an <a href="#output"><code>output</code></a> <code>y2</code> depends on an <a href="#input"><code>input</code></a> <code>u3</code>, then <code>u3</code> can be set and <code>y2</code> can be retrieved afterwards.</em>
<em>As a result, artificial or <code>real</code> algebraic loops over connected FMUs in any of these three modes can be handled by using appropriate numerical algorithms.]</em></p>
</div>
<div class="paragraph">
<p>The allowed function calls in the respective states are summarized in the following table (functions marked in "<span class="yellow-background">yellow</span>" are only available for Model Exchange, the other functions are available both for Model Exchange and Co-Simulation):</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<colgroup>
<col style="width: 58.8235%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8827%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-bottom" rowspan="2"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="7"><p class="tableblock"><strong>FMI 2.0 for Model Exchange</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Start, End</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Instantiated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Initialization Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Event Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Continuous-Time Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Terminated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Error</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Terminate"><code>fmi3Terminate</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Reset"><code>fmi3Reset</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>               </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a>             </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3EnterContinuousTimeMode"><code>fmi3EnterContinuousTimeMode</code></a>       </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a>       </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3SetTime"><code>fmi3SetTime</code></a>                       </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3SetContinuousStates"><code>fmi3SetContinuousStates</code></a>           </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3GetEventIndicators"><code>fmi3GetEventIndicators</code></a>            </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3GetContinuousStates"><code>fmi3GetContinuousStates</code></a>           </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3GetDerivatives"><code>fmi3GetDerivatives</code></a>                </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3GetNominalsOfContinuousStates"><code>fmi3GetNominalsOfContinuousStates</code></a> </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>x</strong> means: call is allowed in the corresponding state<br>
<strong>number</strong> means: call is allowed if the indicated condition holds:<br>
<strong>1</strong> for a variable with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> that has <a href="#initial"><code>initial</code></a> =
<a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a><br>
<strong>2</strong> for a variable with <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a>, or continuous-time states, state derivatives or event indicators,
<strong>3</strong> for a variable with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> that has <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>,
or <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> <br>
<strong>4</strong> for a variable with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>,
or (<a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>)<br>
<strong>5</strong> for a variable with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a><br>
<strong>7</strong> always, but retrieved values are usable for debugging only</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_example">3.2.4. Code Example</h4>
<div class="paragraph">
<p>In the following example, the usage of the <code>fmi3XXX</code> functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
Furthermore, it is assumed that one FMU is directly integrated in a simulation environment.
If the FMU would be used inside another model, additional code is needed, especially initialization and event iteration has to be adapted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="c" class="language-c hljs">m = M_fmi3InstantiateModelExchange("m", "{8c4e810f-3da3-4a00-8276-176fa3c9f000}", NULL, fmi3False, fmi3False,
                                   NULL, cb_logMessage, cb_allocateMemory, cb_freeMemory);
// "m" is the instance name
// "M_" is the MODEL_IDENTIFIER

// set the start time
time  = tStart;

// set all variable start values (of "ScalarVariable / &lt;type&gt; / start") and
// set the start values at time = Tstart
// M_fmi3SetReal/Integer/Boolean/String(m, ...)

// initialize
// determine continuous and discrete states
M_fmi3SetupExperiment(m, fmi3False, 0.0, tStart, fmi3True, tEnd);
M_fmi3EnterInitializationMode(m);
M_fmi3ExitInitializationMode(m);

initialEventMode = fmi3True;
enterEventMode   = fmi3False;
timeEvent        = fmi3False;
stateEvent       = fmi3False;

// initialize previous event indicators
M_fmi3GetEventIndicators(m, previous_z, nz);

M_fmi3EnterContinuousTimeMode(m);

// retrieve initial state x and
// nominal values of x (if absolute tolerance is needed)
M_fmi3GetContinuousStates(m, x, nx);
M_fmi3GetNominalsOfContinuousStates(m, x_nominal, nx);

// retrieve solution at t=Tstart, for example, for outputs
// M_fmi3SetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

while (!terminateSimulation) {

    tNext = time + h;

    // handle events
    if (enterEventMode || stateEvent || timeEvent) {
        fmi3Boolean nextEventTimeDefined;
        fmi3Float64 nextEventTime;

        if (!initialEventMode) {
            // TODO: pass rootsFound
            M_fmi3EnterEventMode(m, fmi3False, fmi3False, NULL, 0, timeEvent);
        }

        // event iteration
        newDiscreteStatesNeeded = fmi3True;
        valuesOfContinuousStatesChanged   = fmi3False;
        nominalsOfContinuousStatesChanged = fmi3False;

        while (newDiscreteStatesNeeded) {
            fmi3Boolean _nominalsOfContinuousStatesChanged;
            fmi3Boolean _valuesOfContinuousStatesChanged;

            // set inputs at super dense time point
            // M_fmi3SetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

            // update discrete states
            M_fmi3NewDiscreteStates(m,
                                    &amp;newDiscreteStatesNeeded,
                                    &amp;terminateSimulation,
                                    &amp;_nominalsOfContinuousStatesChanged,
                                    &amp;_valuesOfContinuousStatesChanged,
                                    &amp;nextEventTimeDefined,
                                    &amp;nextEventTime);

            // getOutput at super dense time point
            // M_fmi3GetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)
            valuesOfContinuousStatesChanged |= _valuesOfContinuousStatesChanged;
            nominalsOfContinuousStatesChanged |= _nominalsOfContinuousStatesChanged;

            if (terminateSimulation) goto TERMINATE_MODEL;
        }


        // enter Continuous-Time Mode
        M_fmi3EnterContinuousTimeMode(m);

        // retrieve solution at simulation (re)start
        // M_fmi3GetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

        if (initialEventMode || valuesOfContinuousStatesChanged) {
            // the model signals a value change of states, retrieve them
            M_fmi3GetContinuousStates(m, x, nx);
        }

        if (initialEventMode || nominalsOfContinuousStatesChanged) {
            // the meaning of states has changed; retrieve new nominal values
            M_fmi3GetNominalsOfContinuousStates(m, x_nominal, nx);
        }

        if (nextEventTimeDefined) {
            tNext = min(nextEventTime, tEnd);
        } else {
            tNext = tEnd;
        }

        initialEventMode = fmi3False;
    }

    if (time &gt;= tEnd) {
        goto TERMINATE_MODEL;
    }

    // compute derivatives
    M_fmi3GetDerivatives(m, der_x, nx);

    // advance time
    h = min(dt, tNext - time);
    time += h;
    M_fmi3SetTime(m, time);

    // set continuous inputs at t = time
    // M_fmi3SetFloat*(m, ...)

    // set states at t = time and perform one step
    for (i = 0; i &lt; nx; i++) {
        x[i] += h * der_x[i]; // forward Euler method
    }

    M_fmi3SetContinuousStates(m, x, nx);

    // get event indicators at t = time
    M_fmi3GetEventIndicators(m, z, nz);

    stateEvent = fmi3False;

    for (i = 0; i &lt; nz; i++) {
        stateEvent |= sign(z[i]) != sign(previous_z[i]); // detect events
        previous_z[i] = z[i]; // remember the current value
    }

    // inform the model about an accepted step
    M_fmi3CompletedIntegratorStep(m, fmi3True, &amp;enterEventMode, &amp;terminateSimulation);

    // get continuous output
    // M_fmi3GetFloat*(m, ...)
}

TERMINATE_MODEL:

// terminate simulation and retrieve final values
M_fmi3Terminate(m);

// M_fmi3GetFloat*/Int*/UInt*/Boolean/String/Binary(m, ...)

// cleanup
M_fmi3FreeInstance(m);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above, errors are not handled. Typically, <code>fmi3XXX</code> function calls are performed in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">status = M_fmi3GetDerivatives(m, der_x, nx);

switch (status) {
    case fmi3Discard:
        // reduce step size and try again
        break;
    case fmi3Error:
        // clean up and stop simulation
        break;
    case fmi3Fatal:
        // stop using the model
        break;
    default:
        break;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The switch statement could also be stored in a macro to simplify the code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_clocks_api">3.2.5. Clocks API</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Output Clocks</dt>
<dd>
<p>For a <a href="#outputClock"><code>output clock</code></a>, the environment integrates until a continuous-time event occurs and calls <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>. Afterwards with function call <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> the <a href="#outputClock"><code>output clocks</code></a> that became active at this event instant can be inquired by the environment.</p>
</dd>
<dt class="hdlist1">Input Clocks</dt>
<dd>
<p>Intervall is set with the function <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> or <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a>. It is activated by the environment with the function <a href="#fmi3SetClock"><code>fmi3SetClock</code></a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_handling_of_clock_events">3.2.6. Handling of clock events</h4>
<div class="paragraph">
<p>This concerns the following API calls: <a href="#fmi3SetClock"><code>fmi3SetClock</code></a>, <a href="#fmi3GetClock"><code>fmi3GetClock</code></a>, <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a>, <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a>, <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a>, <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a></p>
</div>
<div class="paragraph">
<p>A <a href="#clock"><code>clock</code></a> event is handled by the environment in the following way:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Enter event mode</dt>
<dd>
<p>The <strong>Event Mode</strong> is entered after initialization (call to function <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>) or during simulation with a call to the function <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>. The FMU activates <a href="#outputClock"><code>output clocks</code></a>.</p>
</dd>
<dt class="hdlist1">Synchronize clock activation and intervals with the environment</dt>
<dd>
<p>The <a href="#clock"><code>clock</code></a> activation status can be inquired with the function <a href="#fmi3GetClock"><code>fmi3GetClock</code></a>. The environment calls the function <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> for periodic <a href="#clock"><code>clocks</code></a> and <a href="#inputClock"><code>input clocks</code></a>.
Moreover the current <a href="#clock"><code>clock</code></a> intervals may be inquired with the function <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> or <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a> and set with the function <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a>.
<em>[In the Modelica language this is the value returned by the interval() operator. The initialization of intervals is needed for <a href="#output"><code>output</code></a> and <a href="#input"><code>input</code></a> sample times if a <a href="#clock"><code>clock</code></a> ticks the first time. The FMU determines the interval itself at subsequent <a href="#clock"><code>clock</code></a> ticks.]</em></p>
</dd>
<dt class="hdlist1">Solve algebraic loops among discrete-time equations of multiple FMUs or repeated evaluation in model-based control applications (optional)</dt>
<dd>
<p>With the <code>fmi3Set{VariableType}</code> functions the <a href="#input"><code>input</code></a> variables of the clocked partition can be set.
If algebraic loops are present among clocked partitions of multiple FMUs, then with the <code>fmi3Get{VariableType}</code> functions all variables on the corresponding <a href="#clock"><code>clock</code></a> can be inquired.
The latter function call triggers the evaluation of the discrete-time equations, provided the corresponding <a href="#clock"><code>clock</code></a> is active at this time instant.
If the corresponding <a href="#clock"><code>clock</code></a> is not active, the last evaluated value of the variable is returned.
Clocks are automatically deactivated if the corresponding discrete-time equations have been evaluated.
Before a new loop iteration is started, the environment must activate the <a href="#clock"><code>clocks</code></a> again and reset discrete states using the <code>fmi3Set{VariableType}</code> functions.</p>
</dd>
<dt class="hdlist1">Leave event mode</dt>
<dd>
<p>The function <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> evaluates the discrete-time equations, provided the corresponding <a href="#clock"><code>clock</code></a> is active and the discrete-time equations have not already been evaluated with calls to <code>fmi3Get{VariableType}</code> functions.
Clocks are automatically deactivated by <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> and by <a href="#fmi3Reset"><code>fmi3Reset</code></a>.
<em>[This handling of discrete <a href="#state"><code>states</code></a> and time events is forward compatible with FMI 2.0 for any model that could be treated with FMI 2.0 and is exported again using the new features.</em>
<em>The environment may ignore the new functions <a href="#fmi3SetClock"><code>fmi3SetClock</code></a>, <a href="#fmi3GetClock"><code>fmi3GetClock</code></a>, <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a>, <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a>, <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> and <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a>.</em>
<em>The new functions are needed for FMUs with input sample times and to set discrete-time <a href="#state"><code>states</code></a> in model-based control applications or if algebraic loops are present among discrete-time equations of multiple connected FMUs.]</em></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fmi_description_schema">3.3. FMI Description Schema</h3>
<div class="paragraph">
<p>This is defined in <a href="#fmi-description-schema">Section 2.2</a>.
Additionally, the Model Exchange-specific element <code>ModelExchange</code> is defined in the next section.</p>
</div>
<div class="sect3">
<h4 id="ModelExchange">3.3.1. Model Exchange FMU (ModelExchange)</h4>
<div class="paragraph">
<p>If the XML file defines an FMU for Model Exchange, element <code>ModelExchange</code> must be present.
It is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/ModelExchange.png" alt="ModelExchange" width="80%">
</div>
</div>
<div class="paragraph">
<p>The following attributes are defined (all of them are optional, with exception of <code>modelIdentifier</code>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelIdentifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short class name according to C syntax, for example, <code>A_B_C</code>.
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries, but not if the functions are provided by a DLL/SharedObject.
<code>modelIdentifier</code> is also used as name of the static library or DLL/SharedObject.
See also <a href="#header-files-and-naming-of-functions">Section 2.1.1</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>needsExecutionTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, a tool is needed to execute the model and the FMU just contains the communication to this tool.
<em>[Typically, this information is only utilized for information purposes.</em>
<em>For example, when loading an FMU with <code>needsExecutionTool = true</code>, the environment can inform the user that a tool has to be available on the computer where the model is instantiated.</em>
<em>The name of the tool can be taken from attribute <code>generationTool</code> of <code>fmiModelDescription</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>completedIntegratorStepNotNeeded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, function <a href="#fmi3CompletedIntegratorStep"><code>fmi3CompletedIntegratorStep</code></a> need not be called (this gives a slightly more efficient integration).
If it is called, it has no effect.<br>
If <code>false</code> (the default), the function must be called after every completed integrator step, see <a href="#evaluation-of-model-equations">Section 3.2.2</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canBeInstantiatedOnlyOncePerProcess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This flag indicates cases (especially for embedded code), where only one instance per FMU is possible (multiple instantiation is default = <code>false</code>; if multiple instances are needed and the flag <code>canBeInstantiatedOnlyOncePerProcess = true</code>, the FMUs must be instantiated in different processes).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canNotUseMemoryManagementFunctions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the FMU uses its own functions for memory allocation and freeing only.
The callback functions <a href="#allocateMemory"><code>allocateMemory</code></a> and <a href="#freeMemory"><code>freeMemory</code></a> given in <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a> are ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canGetAndSetFMUState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the environment can inquire the internal FMU state and can restore it.
That is, functions <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>, and <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a> are supported by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canSerializeFMUState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the environment can serialize the internal FMU state, in other words, functions <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a>, <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a>, <code>fmi3DeSerializeFMUState</code> are supported by the FMU.
If this is the case, then flag <code>canGetAndSetFMUState</code> must be <code>true</code> as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesDirectionalDerivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the directional derivative of the equations can be computed with <code>fmi3GetDirectionalDerivative</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The flags have the following default values.</p>
</div>
<div class="paragraph">
<p>boolean: <code>false</code><br>
unsignedInt: 0</p>
</div>
</div>
<div class="sect3">
<h4 id="xml-example-model-exchange">3.3.2. Example XML Description File</h4>
<div class="paragraph">
<p>When generating an FMU from the hypothetical model <code>MyLibrary.SpringMassDamper</code>, the XML file may have the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription
  fmiVersion="3.0-alpha.3"
  modelName="MyLibrary.SpringMassDamper"
  instantiationToken="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2011-09-23T16:57:33Z"
  variableNamingConvention="structured"&gt;
  &lt;ModelExchange modelIdentifier="MyLibrary_SpringMassDamper"/&gt;
  &lt;UnitDefinitions&gt;
    &lt;Unit name="rad"&gt;
      &lt;BaseUnit rad="1"/&gt;
      &lt;DisplayUnit name="deg" factor="57.2957795130823"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="rad/s"&gt;
      &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="kg.m2"&gt;
      &lt;BaseUnit kg="1" m="2"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="N.m"&gt;
      &lt;BaseUnit kg="1" m="2" s="-2"/&gt;
    &lt;/Unit&gt;
  &lt;/UnitDefinitions&gt;
  &lt;TypeDefinitions&gt;
    &lt;Float64 name="Modelica.SIunits.Inertia" quantity="MomentOfInertia" unit="kg.m2" min="0.0"/&gt;
    &lt;Float64 name="Modelica.SIunits.Torque" quantity="Torque" unit="N.m"/&gt;
    &lt;Float64 name="Modelica.SIunits.AngularVelocity" quantity="AngularVelocity" unit="rad/s"/&gt;
    &lt;Float64 name="Modelica.SIunits.Angle" quantity="Angle" unit="rad"/&gt;
  &lt;/TypeDefinitions&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;Float64 name="inertia1.J" valueReference="1073741824"
      description="Moment of load inertia" causality="parameter" variability="fixed"
      declaredType="Modelica.SIunits.Inertia" start="1"/&gt;
    &lt;Float64 name="torque.tau" valueReference="536870912"
      description="Accelerating torque acting at flange (= -flange.tau)" causality="input"
      declaredType="Modelica.SIunits.Torque" start="0"/&gt;
    &lt;Float64 name="inertia1.phi" valueReference="805306368"
      description="Absolute rotation angle of component" causality="output"
      declaredType="Modelica.SIunits.Angle"/&gt;
    &lt;Float64 name="inertia1.w" valueReference="805306369"
      description="Absolute angular velocity of component (= der(phi))" causality="output"
      declaredType="Modelica.SIunits.AngularVelocity"/&gt;
    &lt;Float64 name="x[1]" valueReference="0" initial="exact"/&gt;
    &lt;Float64 name="x[2]" valueReference="1" initial="exact"/&gt;
    &lt;Float64 name="der(x[1])" valueReference="2" derivative="0"/&gt;
    &lt;Float64 name="der(x[2])" valueReference="3" derivative="1"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Output valueReference="805306368"/&gt;
    &lt;Output valueReference="805306369"/&gt;
    &lt;Derivative valueReference="2"/&gt;
    &lt;Derivative valueReference="3"/&gt;
    &lt;InitialUnknown valueReference="805306368"/&gt;
    &lt;InitialUnknown valueReference="805306369"/&gt;
    &lt;InitialUnknown valueReference="2" dependencies="0 536870912"/&gt;
    &lt;InitialUnknown valueReference="3" dependencies="0 1"/&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-basic-co-simulation">4. FMI for Basic Co-Simulation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the Functional Mock-up Interface (FMI) for the coupling of two or more simulation models in a co-simulation environment (FMI for Basic Co-Simulation).
It is designed both for coupling with subsystem models, which have been exported by their simulator together with its solver as runnable code (<a href="#figure-co-simulation-with-generated-code">Figure 3</a>), and for coupling of simulation tools on a single machine (<a href="#figure-co-simulation-with-tool-coupling">Figure 4</a>) or as part of a distributed co-simulation (<a href="#figure-distributed-co-simulation">Figure 5</a>).</p>
</div>
<div class="sect2">
<h3 id="math-basic-co-simulation">4.1. Mathematical Description</h3>
<div class="paragraph">
<p>This section contains a formal mathematical model of Co-Simulation FMUs.</p>
</div>
<div class="paragraph">
<p>_[The following fundamental assumptions are made:</p>
</div>
<div class="paragraph">
<p><em>The slave simulators are seen by the master simulator as purely sampled-data systems.</em></p>
</div>
<div class="paragraph">
<p><em>Such a sampled-data system consists typically of a hybrid ODE that is integrated between communication points (known as "sampled access to time continuous systems") where internal events may occur and be handled, but events are not visible from the outside of the FMU.</em>
<em>It is assumed here that all <a href="#input"><code>inputs</code></a> and all <a href="#output"><code>outputs</code></a> of this hybrid ODE are floating point signals (defined with <a href="#variability"><code>variability</code></a> = <a href="#continuous"><code>continuous</code></a>),</em></p>
</div>
<div class="paragraph">
<p><em>Co-Simulation FMUs can also be used for real sampled-data systems (so a sampled discrete controller; the <a href="#input"><code>inputs</code></a> and <a href="#output"><code>outputs</code></a> could be of type Real, Integer, Boolean, String, or enumeration with <a href="#variability"><code>variability</code></a> = <a href="#discrete"><code>discrete</code></a>.)</em>
<em>However, in FMI 3.0, Hybrid Co-Simulation (HCS) and Scheduled Co-Simulation (SCS) may likely be more suitable for this use-case.]</em></p>
</div>
<div class="paragraph">
<p>The communication between the master and a slave takes only place at a discrete set of time instants, called communication points.</p>
</div>
<div class="paragraph">
<p>An FMI Co-Simulation model is described by the following variables:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Independent variable time \(\in \mathbb{R}\).
(Variable defined with <a href="#causality"><code>causality</code></a> = <a href="#independent"><code>independent</code></a>).<br>
The i-th communication point is denoted as \(t = tc_i\)<br>
The communication step size is denoted as \(hc_i = tc_{i+1} - tc_i\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{v}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of all exposed variables (all variables defined in element <code>&lt;ModelVariables&gt;</code>, see <a href="#definition-of-model-variables">Section 2.2.10</a>).
A subset of the variables is selected via a subscript.
Example:<br>
\(\mathbf{v}_{initial=exact}\) are variables defined with attribute <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>, see <a href="#definition-of-model-variables">Section 2.2.10</a>.
These are <a href="#independent"><code>independent</code></a> <a href="#parameter"><code>parameters</code></a> and <a href="#start"><code>start</code></a> values of other variables, such as initial values for <a href="#state"><code>states</code></a>, state derivatives or <a href="#output">outputs</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{p}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters that are constant during simulation.
The symbol without a subscript references <a href="#independent"><code>independent</code></a> <a href="#parameter"><code>parameters</code></a> (variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a>).
Dependent <a href="#parameter"><code>parameters</code></a> (variables with <a href="#causality"><code>causality</code></a> = <a href="#calculatedParameter"><code>calculatedParameter</code></a>) are denoted as \(\mathbf{p}_{calculated}\) and <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> (variables with <a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>) are denoted as \(\mathbf{p}_{tune}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{u}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input variables.
The values of these variables are defined outside of the model.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>.
Whether the <a href="#input"><code>input</code></a> is a discrete-time or continuous-time variable is defined via attribute <a href="#variability"><code>variability</code></a> = <a href="#discrete"><code>discrete</code></a> or <a href="#continuous"><code>continuous</code></a> (see <a href="#definition-of-model-variables">Section 2.2.10</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{y}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output variables.
The values of these variables are computed in the FMU and they are designed to be used in a model connection.
So output variables might be used in the environment as input values to other FMUs or other submodels.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a>.
Via attribute <a href="#variability"><code>variability</code></a> = <a href="#discrete"><code>discrete</code></a> or <a href="#continuous"><code>continuous</code></a> it is defined whether the <a href="#output"><code>output</code></a> is a discrete-time or continuous-time variable, see <a href="#definition-of-model-variables">Section 2.2.10</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{w}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local variables of the FMU that cannot be used for FMU connections.
Variables of this type are defined with attribute <a href="#causality"><code>causality</code></a> = <a href="#local"><code>local</code></a> (see <a href="#definition-of-model-variables">Section 2.2.10</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_c(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of floating point continuous-time variables representing the continuous-time <a href="#state"><code>states</code></a>.
For notational convenience, a continuous-time <a href="#state"><code>state</code></a> is conceptually treated as a different type of variable as an <a href="#output"><code>output</code></a> or a <a href="#local"><code>local</code></a> variable for the mathematical description below.
However, at a communication point, a continuous-time <a href="#state"><code>state</code></a> is part of the <a href="#output"><code>outputs</code></a> or the <a href="#local"><code>local</code></a> variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\)<br>
\(^{\bullet}\mathbf{x}_d(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\) is a vector of (internal) discrete-time variables (of any type) representing the (internal) discrete <a href="#state"><code>states</code></a>.<br>
\(^{\bullet}\mathbf{x}_d(t)\) is the value of \(\mathbf{x}_d(t)\) at the previous sample time instant, so \(^{\bullet}\mathbf{x}_d(t) = \mathbf{x}_d(^{\bullet}t)\).<br>
Given the <a href="#previous"><code>previous</code></a> values of the discrete-time <a href="#state"><code>states</code></a>, \(^{\bullet}\mathbf{x}_d(t)\), at the actual time instant \(t\), all other discrete-time variables, especially the discrete <a href="#state"><code>states</code></a> \(\mathbf{x}_d(t)\), can be computed.<br>
Discrete <a href="#state"><code>states</code></a> are not visible in the interface of an FMU and are only introduced here to clarify the mathematical description.
Formally, a discrete <a href="#state"><code>state</code></a> is part of the <a href="#output"><code>outputs</code></a> \(\mathbf{y}\) or the <a href="#local"><code>local</code></a> variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the transient simulation of the coupled system through Co-Simulation is completed, the sequence of evaluations is the following (here \(\mathbf{x} = {\lbrack \mathbf{x}_c; \mathbf{x}_d \rbrack}^T\) is the combined vector of continuous-time and discrete-time <a href="#state">states</a>, and \(\mathbf{y} = {\lbrack \mathbf{y}_c; \mathbf{y}_d \rbrack}^T\)) is the combined vector of continuous-time and discrete-time <a href="#output"><code>outputs</code></a>):</p>
</div>
<div id="equation-basic-co-simulation-evaluations" class="stemblock">
<div class="title">Sequence of Basic Co-Simulation evaluations</div>
<div class="content">
\[\mathrm{\text{for}}\ i = 0, \cdots, n-1

\begin{Bmatrix}

\mathbf{x}_{i+1} = \Phi_i \left( \mathbf{x}_i \left\{ \mathbf{u}_i^{(j)} \right\}_{j=0,\cdots,m_{ido}}, \mathbf{p}_{tune,i}, hc_i  \right)

\\

\left( \left\{ \mathbf{y}^{(j)}_{i+1} \right\}_{j=0,\cdots,m_{odo}}, \mathbf{w}_{i+1}\right) = \Gamma_i \left( \mathbf{x}_i, \left\{ \mathbf{u}^{(j)}_i \right\}_{j=0,\cdots,m_{ido}}, \mathbf{p}_{tune}, hc_i \right)

\end{Bmatrix}\]
</div>
</div>
<div class="paragraph">
<p>where \(\mathbf{\Phi}_i\) and \(\mathbf{\Gamma}_i\) define the system behavior for the time interval \(tc_i \leq t &lt; tc_{i+1}\),
with \(tc_i = tc_0 + \sum_{k=0}^{i-1}hc_k\).</p>
</div>
<div class="paragraph">
<p><em>[For the part of the Co-Simulation slave that is based on an ODE, a differential equation is solved between communication points:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\dot{\mathbf{x}}_c = \mathbf{\varphi} \left( \mathbf{x}_c(t), \mathbf{u}_c(t),
\mathbf{p}_{tune} \right)\]
</div>
</div>
<div class="paragraph">
<p><em>In this case, the following relationship should hold (note the use of</em> \(\mathbf{x}_{i+1}\) <em>here):</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\frac{\partial\mathbf{\Phi_i}}{\partial hc_i}
=
\boldsymbol{\varphi} \left( \mathbf{x}_{c,i+1},
\sum^{m_{ido}}_{j=0} \mathbf{u}^{(j)}_{c,i} \frac{hc^j_i}{j!},
\mathbf{p}_{tune,i}  \right)\]
</div>
</div>
<div class="paragraph">
<p><em>This relation is in practice inexact due to using finite precision on machines and stopping iterations early.</em>
<em>The slave simulators are responsible for implementing</em> \(\mathbf{\Phi}_i\) and \(\mathbf{\Gamma}_i\) <em>; for example, to handle stiff differential equations as:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{\Phi}_i \left( \mathbf{x}_{c,i}, \left\{ \mathbf{u}_{c,i}^{(j)} \right\}_{= 0,\cdots,m_{ido}},\ \mathbf{p}_{tune,i}, tc_i \right)
=
\mathbf{x}_{ci} + \left( \mathbf{I} -
hc_i \frac{\partial \mathbf{\varphi}}{\partial \mathbf{x}_c} \right)^{- 1}  hc_i \mathbf{\phi} \left( \mathbf{x}_{c,i}, \mathbf{u}_{c,i}, \mathbf{p}_{tune,i} \right) +
O(hc_i^{2}).\]
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>Definition <a href="#equation-basic-co-simulation-evaluations">Sequence of Basic Co-Simulation evaluations</a> is consistent with the definition of co-simulation by <a href="#KS00">[KS00]</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At the communication points, the master provides generalized inputs to the slave, which can be:</p>
<div class="ulist">
<ul>
<li>
<p>The current <a href="#input"><code>input</code></a> variables \(\mathbf{u}_i^{(0)}\) of the subsystem (in other words, the <a href="#input"><code>input</code></a> variables of the model contained in the slave simulator, in the sense of system-level simulation), along with some of their successive <a href="#derivative"><code>derivatives</code></a> \(\left\{ \mathbf{u}_i^{(j)} \right\}_{j=1,\cdots,m_{ido}}\) (in case of continuous-time variables), where \(m_{ido}\) stands for the model input derivative order.</p>
</li>
<li>
<p>Varying <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{tune,i}\), also known as <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The slave provides generalized outputs to the master, which are:</p>
<div class="ulist">
<ul>
<li>
<p>The current output variables \(\mathbf{y}_{i+1}^{(0)}\)of the subsystem (same remark as above), along with some of their successive <a href="#derivative"><code>derivatives</code></a> \(\left\{ \mathbf{y}_{i+1}^{(j)} \right\}_{j=1,\cdots,m_{odo}}\)(in case of continuous-time variables).</p>
</li>
<li>
<p>Observation variables and <a href="#calculated"><code>calculated</code></a> varying <a href="#parameter"><code>parameters</code></a> \(\mathbf{w}_{i+1}\), along with directional derivatives estimated at \(t = tc_{i+1}\) (in case of continuous-time variables).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Initialization: The slave being a sampled-data system, its internal states (which can be either continuous-time or discrete-time) need to be initialized at \(t = tc_0\).
This is performed through an auxiliary function <em>[this relationship is defined in the XML file under elements <code>&lt;ModelStructure&gt;&lt;InitialUnknown&gt;</code>]</em>:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Computing the solution of an FMI Co-Simulation model means to split the solution process in two phases and in every phase different equations and solution methods are utilized.
The phases can be categorized according to the following modes:</p>
</div>
<div class="sect3">
<h4 id="_initialization_mode_2">4.1.1. Initialization Mode</h4>
<div class="paragraph">
<p>This mode is used to compute at the start time \(t_0\) initial values for internal variables of the Co-Simulation slave, especially for continuous-time <a href="#state"><code>states</code></a>, \(\mathbf{x}_d(t_0)\), and for the previous discrete-time <a href="#state"><code>states</code></a>, \(^{\bullet}\mathbf{x}_d(t_0)\), by utilizing extra equations not present in the other mode <em>[for example, equations to set all <a href="#derivative"><code>derivatives</code></a> to zero, that is, to initialize in steady-state]</em>.
If the slave is connected in loops with other models, iterations over the FMU equations are possible.
Algebraic equations are solved in this mode.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_mode">4.1.2. Step Mode</h4>
<div class="paragraph">
<p>This mode is used to compute the values of all continuous-time and discrete-time variables at communication points by numerically solving ordinary differential, algebraic and discrete equations.
If the slave is connected in loops with other models, no iterations over the FMU equations are possible.</p>
</div>
<div class="paragraph">
<p><em>[Note that for a Co-Simulation FMU, no super-dense time description is used at communication points.]</em></p>
</div>
<div class="paragraph">
<p>The equations are defined in <a href="#table-math-basic-co-simulation">Table 2</a> can be evaluated in the respective mode.
The following color coding is used in the table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="silver"><strong>grey</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a variable in an argument list is marked in grey, then this variable is not changing in this mode and just the last calculated value from the previous mode is internally used.
For an input argument it is not allowed to call <code>fmi3Set{VariableType}</code>.
For an output argument, calling <code>fmi3Get{VariableType}</code> on such a variable returns always the same value in this mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime"><strong>green</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functions marked in <span class="lime">green</span> are special functions to enter or leave a mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue"><strong>blue</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equations and functions marked in <span class="blue">blue</span> define the actual computations to be performed in the respective mode.</p></td>
</tr>
</tbody>
</table>
<table id="table-math-basic-co-simulation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Mathematical description of an FMU for Basic Co-Simulation.</caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Equations</strong></th>
<th class="tableblock halign-left valign-top"><strong>FMI functions</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Equations before Initialization Mode</strong> (<strong>Instantiated</strong> in state machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set and set <a href="#start"><code>start</code></a> value of <a href="#independent"><code>independent</code></a> variable \(tc_{i=0}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables and that have a start value (<a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Equations during Initialization Mode</strong> (<strong>Initialization Mode</strong> in state machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter <strong>Initialization Mode</strong> at (activate initialization, discrete-time and continuous-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">fmi3EnterInitializationMode</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(v_{initial=exact}\) and \(v_{initial=approx}\) that have a <a href="#start"><code>start</code></a> value with <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> (<a href="#independent"><code>independent</code></a> <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}\) and continuous-time <a href="#state"><code>states</code></a> with start values \(\mathbf{x}_{c,initial=exact}\) are included here)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{c+d}(tc_0)\) and optionally the <a href="#derivative"><code>derivatives</code></a> of continuous-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{c}^{(j)}(tc_0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code><br>
<code>fmi3SetInputDerivatives</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\(\mathbf{v}_{InitialUnknowns} := \mathbf{f}_{init}(\mathbf{u}_c, \mathbf{u}_d, t_0, \mathbf{v}_{initial=exact})\)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi3Get{VariableType}</span></code><br>
<code><span class="blue">fmi3GetDirectionalDerivative</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Exit <strong>Initialization Mode</strong> (de-activate initialization equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">fmi3ExitInitializationMode</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Equations during Step Mode</strong> (<code>stepComplete</code>, <code>stepInProgress</code> in state machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <a href="#independent"><code>independent</code></a> <a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{tune}\) (and do not set other <a href="#parameter"><code>parameters</code></a> \(\mathbf{p}_{other}\))</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{d+c}(tc_i)\) and optionally the <a href="#derivative"><code>derivatives</code></a> of continuous-time <a href="#input"><code>inputs</code></a> \(\mathbf{u}_{c}^{(j)}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3Set{VariableType}</code><br>
<code>fmi3SetInputDerivatives</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\(\begin{matrix} tc_{i+1} := tc_i + hc_i \\ (\mathbf{y}_{c+d}, \mathbf{y}_c^{(j)}, \mathbf{w}_{c+d}) := \mathbf{f}_{doStep}(\mathbf{u}_{c+d}, \mathbf{u}_{c}^{(j)}, tc_i, hc_i, \mathbf{p}_{tune}, \mathbf{p}_{other})_{tc_i} \\ tc_i := tc_{i+1} \end{matrix}\)</span><br>
<span class="blue">\(\mathbf{f}_{doStep}\) is also a function of the internal variables \(\mathbf{x}_c\), \(^{\bullet}\mathbf{x}_d\)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi3DoStep</span></code><br>
<code>fmi3Get{VariableType}</code><br>
<code><span class="blue">fmi3GetOutputDerivatives</span></code><br>
<code><span class="blue">fmi3GetDirectionalDerivative</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Data types</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">\(t, tc, hc \in \mathbb{R}, \mathbf{p} \in \mathbb{P}^{np}, \mathbf{u}(tc) \in \mathbb{P}^{nu}, \mathbf{y}(tc) \in \mathbb{P}^{ny}, \mathbf{x}_c(t) \in \mathbb{R}^{nxc}, \mathbf{x}_d(t) \in \mathbb{P}^{nxd}, \mathbf{w}(tc) \in \mathbb{P}^{nw}\)<br>
\(\mathbb{R}\): floating point variable, \(\mathbb{R}\): floating point <strong>or</strong> boolean <strong>or</strong> integer <strong>or</strong> enumeration <strong>or</strong> string variable<br>
\(\mathbf{f}_{init}, \mathbf{f}_{out} \in C^0\) (=continuous functions with respect to all input arguments inside the respective mode).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Remark - Calling Sequences:</em></p>
</div>
<div class="paragraph">
<p><em>In the table above, for notational convenience in <strong>Initialization Mode</strong> one function call is defined to compute all output arguments from all inputs arguments.</em>
<em>In reality, every variable output argument is computed by one</em> <code>fmi3Get{VariableType}</code> <em>function call.</em></p>
</div>
<div class="paragraph">
<p><em>In <strong>Step Mode</strong> the input arguments to</em> \(\mathbf{f}_{doStep}\) <em>are defined by calls to</em> <code>fmi3Set{VariableType}</code> <em>and</em> <code>fmi3SetInputDerivatives</code> <em>functions.</em>
<em>The variables computed by</em> \(\mathbf{f}_{doStep}\) <em>can be inquired by</em>  <code>fmi3Get{VariableType}</code> <em>function calls.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_early_return_from_current_communication_step">4.1.3. Early Return from Current Communication Step</h4>
<div class="paragraph">
<p>In the particular context of multi-FMU architectures, significant co-simulation speed-up may be obtained if the master can avoid waiting until the end of the slowest FMU step integration.
If an FMU prematurely stops its current step integration computation due to an unpredictable internal event before the normal end of the step calculation, all other concurrently running FMUs may be stopped as soon as possible in order to minimize the time needed for the Co-Simulation master to resynchronize all the FMUs at the same event time.</p>
</div>
<div class="paragraph">
<p>In this context based on parallel multi-FMU calculations, the following figure illustrates different possibilities to synchronize FMUs at the same event time.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/earlyReturnFigure.png" alt="earlyReturnFigure" width="100%">
</div>
<div class="title">Figure 12: Different possibilities to synchronize parallel FMUs at the same event time.</div>
</div>
<div class="paragraph">
<p>Each FMU starts integration from communication point \(t_{i}\) to reach the next communication point \(t_{i+1}\).
Assuming an unexpected internal event is detected at \(t^{'}_{i+1}&lt; t_{i+1}\) during FMU<sub>1</sub> integration, the master is informed of this early return.
So now the master would like to avoid other FMUs exceed the event time, since all FMUs should be resynchronized at the event time which will be the next new communication point.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the case of FMU<sub>1</sub>, the internal event time becomes the new \(t_{i+1}\) time, i.e. this is the source of the event.</p>
</li>
<li>
<p>In the case of FMU<sub>2</sub>, a complete rollback from \(t_{i}\) to \(t^{'}_{i+1}\) is necessary.</p>
</li>
<li>
<p>In the case of FMU<sub>3</sub>, computation is immediately interrupted and only a partial rollback is necessary to reach \(t^{'}_{i+1}\) time.</p>
</li>
<li>
<p>In the case of FMU<sub>4</sub>, the current step integration has been interrupted at \(t^{'}_{i+1}\) and no rollback is necessary.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each ongoing FMU stops its integration either exactly at the broken time given by the master or immediately after its current intermediate step if this time is already out-of-date.
Afterwards, a new step integration done on the FMU returns and signals the premature stop (early-return) to the master.</p>
</div>
<div class="paragraph">
<p>Due to the early-return mechanism, the overall execution time of the simulation is reduced.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_application_programming_interface_2">4.2. Application Programming Interface</h3>
<div class="paragraph">
<p>This section contains the interface description to access the input/output data and status information of a Co-Simulation slave from a C program.</p>
</div>
<div class="sect3">
<h4 id="transfer-of-input-output-and-parameters">4.2.1. Variables access in fmi3CoSimulation</h4>
<div class="paragraph">
<p><a href="#input"><code>Input</code></a> and <a href="#output"><code>output</code></a> variables and other variables are accessed via the <code>fmi3Get{VariableType}</code> and <code>fmi3Set{VariableType}</code> functions, defined in <a href="#get-and-set-variable-values">Section 2.1.7</a>.</p>
</div>
<div class="paragraph">
<p>In order to enable the slave to interpolate the <a href="#continuous"><code>continuous</code></a> floating point <a href="#input"><code>inputs</code></a> between communication steps, the <a href="#derivative"><code>derivatives</code></a> of the <a href="#input"><code>inputs</code></a> with respect to time can be provided.
Also, higher <a href="#derivative"><code>derivatives</code></a> can be set to allow higher order interpolation.
Whether the slave is able to handle the <a href="#derivative"><code>derivatives</code></a> of <a href="#input"><code>inputs</code></a> is given by the unsigned integer capability flag <code>MaxInputDerivativeOrder</code>. It delivers the maximum order of the input <a href="#derivative"><code>derivative</code></a>.</p>
</div>
<div id="fmi3SetInputDerivatives" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3SetInputDerivativesTYPE(fmi3Instance instance,
                                               const fmi3ValueReference valueReferences[],
                                               size_t nValueReferences,
                                               const fmi3Int32 orders[],
                                               const fmi3Float64 values[],
                                               size_t nValues);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sets the n-th time <a href="#derivative"><code>derivative</code></a> of floating point <a href="#input"><code>input</code></a> variables.
Argument <code>vr</code> is a vector of value references that define the variables whose <a href="#derivative"><code>derivatives</code></a> shall be set.
The array <code>order</code> contains the orders of the respective <a href="#derivative"><code>derivative</code></a> (1 means the first <a href="#derivative"><code>derivative</code></a>, 0 is not allowed).
Argument <code>value</code> is a vector with the values of the <a href="#derivative"><code>derivatives</code></a>.
<code>nValueReferences</code> is the dimension of the vectors.<br>
Different input variables may have different interpolation order.<br>
Restrictions on using the function are the same as for the <code>fmi3Set{VariableType}</code> function.</p>
</div>
<div class="paragraph">
<p><a href="#input"><code>Inputs</code></a> and their <a href="#derivative"><code>derivatives</code></a> are set with respect to the beginning of a communication time step.</p>
</div>
<div class="paragraph">
<p>To allow interpolation/approximation of the floating point output variables between communication steps (if they are used as inputs for other slaves), the <a href="#derivative"><code>derivatives</code></a> of the <a href="#output"><code>outputs</code></a> with respect to time can be read.
Whether the slave is able to provide the <a href="#derivative"><code>derivatives</code></a> of <a href="#output"><code>output</code></a> is given by the unsigned integer capability flag <code>MaxOutputDerivativeOrder</code>.
It delivers the maximum order of the <a href="#output"><code>output</code></a> <a href="#derivative"><code>derivative</code></a>.
If the actual order is lower (because the order of integration algorithm is low), the retrieved value is 0.</p>
</div>
<div class="paragraph">
<p><em>[Example: If the internal polynomial is of order 1 and the master inquires the second <a href="#derivative"><code>derivative</code></a> of an <a href="#output"><code>output</code></a>, the slave will return zero.]</em></p>
</div>
<div class="paragraph">
<p>The <a href="#derivative"><code>derivatives</code></a> can be retrieved by:</p>
</div>
<div id="fmi3GetOutputDerivatives" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetOutputDerivativesTYPE(fmi3Instance instance,
                                                const fmi3ValueReference valueReferences[],
                                                size_t nValueReferences,
                                                const fmi3Int32 orders[],
                                                fmi3Float64 values[],
                                                size_t nValues);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Retrieves the n-th <a href="#derivative"><code>derivative</code></a> of <a href="#output"><code>output</code></a> values.
Argument <code>vr</code> is a vector of <code>nValueReferences</code> value references that define the variables whose <a href="#derivative"><code>derivatives</code></a> shall be retrieved.
The array <code>order</code> contains the order of the respective <a href="#derivative"><code>derivative</code></a> (1 means the first <a href="#derivative"><code>derivative</code></a>, 0 is not allowed).
Argument <code>value</code> is a vector with the actual values of the <a href="#derivative"><code>derivatives</code></a>.<br>
Restrictions on using the function are the same as for the <code>fmi3Get{VariableType}</code> function.</p>
</div>
<div class="paragraph">
<p>The returned <a href="#output"><code>outputs</code></a> correspond to the current slave time.
E.g. after a successful call to <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> the returned values are related to the end of the communication time step.</p>
</div>
</div>
<div class="sect3">
<h4 id="_computation_in_fmi3cosimulation">4.2.2. Computation in fmi3CoSimulation</h4>
<div class="paragraph">
<p>The computation of time steps is controlled by the following function.</p>
</div>
<div id="fmi3DoStep" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3DoStepTYPE(fmi3Instance instance,
                                  fmi3Float64 currentCommunicationPoint,
                                  fmi3Float64 communicationStepSize,
                                  fmi3Boolean noSetFMUStatePriorToCurrentPoint,
                                  fmi3Boolean* earlyReturn);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The computation of a time step is started.<br>
Argument <code>currentCommunicationPoint</code> is the current communication point of the master (\(tc_i\)) and argument <code>communicationStepSize</code> is the communication step size (\(hc_i\)).
The latter must be \(&gt; 0.0\).
The slave must integrate until time instant \(tc_{i+1} = tc_i + hc_i\).
<em>[The calling environment defines the communication points and <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> must synchronize to these points by always integrating exactly to \(tc_i + hc_i\).</em></p>
</div>
<div class="paragraph">
<p><em>It is up to <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> how to achieve this.]</em>
At the first call to <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> after <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> was called <code>currentCommunicationPoint</code> must be equal to <code>startTime</code> as set with <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>.
<em>[Formally, argument <code>currentCommunicationPoint</code> is not needed.</em>
<em>It is present in order to handle a mismatch between the master and the FMU state of the slave: The <code>currentCommunicationPoint</code> and the FMU state of the slaves defined by former</em> <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> <em>or</em> <code>fmi3SetFMUState</code> <em>calls have to be consistent with respect to each other.</em>
<em>For example, if the slave does not use the update formula for the <a href="#independent"><code>independent</code></a> variable as required above,</em> \(tc_{i+1} = tc_i + hc_i\) <em>(using argument</em> \(tc_i\) = <code>currentCommunicationPoint</code> <em>of</em> <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>) <em>but uses internally an own update formula, such as</em> \(tc_{s,i+1} = tc_{s,i} + hc_{s,i}\) <em>then the slave could use as time increment</em> \(\text{hc}_{s,i} := (tc_i - tc_{s,i}) + hc_i\) <em>(instead of</em> \(\text{hc}_{s,i} := hc_i\) <em>) to avoid a mismatch between the master time</em> \(tc_{i+1}\) <em>and the slave internal time</em> \(tc_{s,i+1}\) <em>for large i.]</em></p>
</div>
<div class="paragraph">
<p><em>rgument <code>noSetFMUStatePriorToCurrentPoint</code> is <code>fmi3True</code> if <code>fmi3SetFMUState</code> will no longer be called for time instants prior to <code>currentCommunicationPoint</code> in this simulation run _[the slave can use this flag to flush a result buffer]</em>.</p>
</div>
<div class="paragraph">
<p>The function returns:<br>
<code>fmi3OK</code> - if the communication step was computed successfully until its end.<br>
<code>fmi3Discard</code> - if the slave computed successfully only a subinterval of the communication step. The FMU enters the <code>Step Discarded</code> state, see <a href="#state-step-discarded-co-simulation">Section 4.2.4.9</a> for more information.
<br>
<code>fmi3Error</code> - the communication step could not be carried out at all.
The master can try to repeat the step with other input values and/or a different communication step size in the same way as described in the <code>fmi3Discard</code> case above.<br>
<code>fmi3Fatal</code> - if an error occurred which corrupted the FMU irreparably.
<em>[The master should stop the simulation run immediately.]</em>
See <a href="#status-returned-by-functions">Section 2.1.3</a> for details.</p>
</div>
<div class="paragraph">
<p>It depends on the capabilities of the slave which parameter constellations and calling sequences are allowed (see <a href="#fmi-for-basic-co-simulation">Section 4</a>)</p>
</div>
</div>
<div class="sect3">
<h4 id="retrieving-status-from-slave">4.2.3. Retrieving Status Information from the Slave in fmi3CoSimulation</h4>
<div class="paragraph">
<p>Status information is retrieved from the slave by the following function:</p>
</div>
<div id="fmi3GetDoStepDiscardedStatus" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3GetDoStepDiscardedStatusTYPE(fmi3Instance instance,
                                                    fmi3Boolean* terminate,
                                                    fmi3Float64* lastSuccessfulTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>terminate = true</code> if the slave wants to terminate the simulation.
<code>lastSuccessfulTime</code> is the time instant at which the slave stopped the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> call.</p>
</div>
</div>
<div class="sect3">
<h4 id="state-machine-co-simulation">4.2.4. State Machine of Calling Sequence from Master to Slave in fmi3CoSimulation</h4>
<div class="paragraph">
<p>The following state machine defines the supported calling sequences.</p>
</div>
<div id="figure-co-simulation-state-machine" class="imageblock text-center">
<div class="content">
<img src="images/state-machine-co-simulation.svg" alt="state machine co simulation" width="80%">
</div>
<div class="title">Figure 12. Calling sequence of Co-Simulation C functions in form of an UML 2.0 state machine.</div>
</div>
<div class="paragraph">
<p>In this Co-Simulation interface the following functions must not be called: <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>, <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a>, <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>, <a href="#fmi3SetClock"><code>fmi3SetClock</code></a>, <a href="#fmi3GetClock"><code>fmi3GetClock</code></a>, <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a>, <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a>, <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a>, <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> including all functions that are specific to fmuType <code>fmi3ModelExchange</code>.</p>
</div>
<div class="sect4">
<h5 id="state-slave-setable-fmu-state-co-simulation">4.2.4.1. State: Slave Setable FMU State</h5>
<div class="paragraph">
<p>In all states of this super state it is allowed to call <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>, <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a>`, <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a>, <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a>, <code>fmi3DeSerializeFMUState</code>, <a href="#fmi3Reset"><code>fmi3Reset</code></a>, <a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a>, <code>fmi3SetDebugLogging</code> and <a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a>.</p>
</div>
<div class="paragraph">
<p>If any function returns with <code>fmi3Fatal</code> the FMU enters the terminal state.</p>
</div>
</div>
<div class="sect4">
<h5 id="state-slave-under-evaluation-co-simulation">4.2.4.2. State: Slave Under Evaluation</h5>
<div class="paragraph">
<p>This super state is entered by the FMU when <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a> is called.
If any function returns <code>fmi3Error</code> the FMU enters state <strong>Terminated</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="state-slave-initialized-co-simulation">4.2.4.3. State: Slave Initialized</h5>
<div class="paragraph">
<p>This super state is entered by the FMU when <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> is called.
If the function <a href="#fmi3Terminate"><code>fmi3Terminate</code></a> is called, the FMU enters state <strong>Terminated</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="state-instantiated-co-simulation">4.2.4.4. State: Instantiated</h5>
<div class="paragraph">
<p>In this state the FMU can do one-time initializations and allocate memory.
The FMU sets all variables to its <a href="#start"><code>start</code></a> values.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dd>
<p><a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a>, <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a></p>
</dd>
<dt class="hdlist1"><code>fmi3Set{VariableType}</code></dt>
<dd>
<p>For variables with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> and for which <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a>.
The intention is to set <a href="#start"><code>start</code></a> and guess values for these variables.</p>
</dd>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p><a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>, <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>, <code>fmi3Get{VariableType}</code>, <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>, <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a>, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a>, <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, <a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a>, <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>, <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="state-initialization-mode-co-simulation">4.2.4.5. State: Initialization Mode</h5>
<div class="paragraph">
<p>This mode is used by the master to compute consistent initial conditions for overall system.
Therefore iterative calls of <code>fmi3Set{VariableType}</code> and <code>fmi3Get{VariableType}</code> are allowed.
In between the FMU must evaluate all relevant equations.
In this way artificial or real algebraic loops over connected FMUs in <strong>Initialization Mode</strong> may be handled by using appropriate numerical algorithms.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dd>
<p><a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, <a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a>, <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></p>
</dd>
<dt class="hdlist1"><code>fmi3Set{VariableType}</code></dt>
<dd>
<p>For variables with:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> that have <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>, or</p>
</li>
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, or</p>
</li>
<li>
<p><a href="#causality"><code>causality</code></a> = to <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = to <a href="#tunable"><code>tunable</code></a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>fmi3Get{VariableType}</code></dt>
<dd>
<p>For variables with <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> or continuous-time <a href="#state"><code>states</code></a> or state derivatives.</p>
</dd>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p><a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>, <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a>, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a>, <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a>, <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>, <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>, <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="state-step-mode-co-simulation">4.2.4.6. State: Step Mode</h5>
<div class="paragraph">
<p>This state is used by the master to progress simulation time.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dd>
<p><a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a>, <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>, <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a>, <code>fmi3Get{VariableType}</code>, <a href="#fmi3Terminate"><code>fmi3Terminate</code></a></p>
</dd>
<dt class="hdlist1"><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a></dt>
<dd>
<p>With this function call the <strong>Reconfiguration Mode</strong> is entered.
This function must not be called if the FMU contains no <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a> (i.e. with <a href="#causality"><code>causality</code></a>= <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>).</p>
</dd>
<dt class="hdlist1"><a href="#fmi3DoStep"><code>fmi3DoStep</code></a></dt>
<dd>
<p>Within fmi3DoStep() the FMU may call <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a></p>
<div class="ulist">
<ul>
<li>
<p>If the function returns with <code>fmi3OK</code> or <code>fmi3Warning</code> the FMU stays in this state.</p>
</li>
<li>
<p>If the function returns with <code>fmi3Discard</code> the FMU enters state <strong>Step Discarded</strong>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>fmi3Set{VariableType}</code></dt>
<dd>
<p>For variables with:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a>, or</p>
</li>
<li>
<p><a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It is not allowed to call <code>fmi3Get{VariableType}</code> functions after <code>fmi3Set{VariableType}</code> functions without an <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> call in between.</p>
</div>
<div class="paragraph">
<p><em>[The reason is to avoid different interpretations of the caching, since contrary to FMI for Model Exchange, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> will perform the actual calculation instead of <code>fmi3Get{VariableType}</code>, and therefore, dummy algebraic loops at communication points cannot be handled by an appropriate sequence of <code>fmi3Get{VariableType}</code> and, <code>fmi3Set{VariableType}</code> calls as for Model Exchange.</em></p>
</div>
<div class="paragraph">
<p><em>Examples:</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Correct calling sequence</em></th>
<th class="tableblock halign-left valign-top"><em>Wrong calling sequence</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi3Set{VariableType} on inputs</em><br>
<em>fmi3DoStep</em><br>
<em>fmi3Get{VariableType} on outputs</em><br>
<em>fmi3Set{VariableType} on inputs</em><br>
<em>fmi3DoStep</em><br>
<em>fmi3Get{VariableType} on outputs</em><br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi3Set{VariableType} on inputs</em><br>
<em>fmi3DoStep</em><br>
<em>fmi3Get{VariableType} on outputs</em><br>
<em>fmi3Set{VariableType} on inputs</em><br>
<em>fmi3Get{VariableType} on outputs // not allowed</em><br>
<em>fmi3DoStep</em><br>
<em>fmi3Get{VariableType} on outputs</em><br></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p><a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>, <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>, <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, <a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a>, <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a>, <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="state-intermediate-update-mode-co-simulation">4.2.4.7. State: Intermediate Update Mode</h5>
<div class="paragraph">
<p>In this state the master can retrieve information from the FMU between communication points.
Functions called in this state must not return <code>fmi3Discard</code>.</p>
</div>
<div class="paragraph">
<p>The FMU enters this state by calling <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> within <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> and leaves the state towards state <strong>Step Mode</strong> if the function returns <code>fmi3OK</code> or <code>fmi3Warning</code>.
If the function returns <code>fmi3Error</code> the FMU enters state <strong>Terminated</strong>.
If the function returns <code>fmi3Fatal</code> the FMU enters the terminal state.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dd>
<p><a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a></p>
</dd>
<dt class="hdlist1"><code>fmi3Set{VariableType}</code>, <a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a></dt>
<dd>
<p>If <code>intermediateVariableSetAllowed = fmi3True</code>, the value of intermediate variables can be set.
Intermediate variables are variables that are marked with attribute <a href="#intermediateAccess"><code>intermediateAccess</code></a> = <code>true</code> in the <code>modelDescription.xml</code>.</p>
</dd>
<dt class="hdlist1"><code>fmi3Get{VariableType}</code>, <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></dt>
<dd>
<p>If <code>intermediateVariableGetAllowed = fmi3True</code>, the value of intermediate variables can be retrieved.
Intermediate variables are variables that are marked with attribute <a href="#intermediateAccess"><code>intermediateAccess</code></a> = <code>true</code> in the <code>modelDescription.xml</code>.</p>
</dd>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p>The same functions which are not allowed to be called in <strong>Step Mode</strong> must not be called in this state.
Additionally the following functions must not be called  <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a>, <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="state-reconfiguration-mode-co-simulation">4.2.4.8. State: Reconfiguration Mode</h5>
<div class="paragraph">
<p>In this state <a href="#structuralParameter"><code>structural parameters</code></a> with <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> can be changed.
This state is entered from state <strong>Step Mode</strong> by calling <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> and left back to <strong>Step Mode</strong> by calling <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dd>
<p><a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a></p>
</dd>
<dt class="hdlist1"><code>fmi3Set{VariableType}</code></dt>
<dd>
<p>Only for variables with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>.</p>
</dd>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a>, <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>, <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, <a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a>, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a>, <a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a>, <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>, <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a>, <code>fmi3Get{VariableType}</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="state-step-discarded-co-simulation">4.2.4.9. State: Step Discarded</h5>
<div class="paragraph">
<p>The FMU changes into this state if it is not able to compute a communication step completely by returning <code>fmi3Discard</code> from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.
This might have been caused by numerical problems or intended stop of the simulation run.
The master can call <a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a> to get further information.
In case of numerical problems the master may try to achieve a correct solution for example by repeating the last step with a different communication step size. <em>[Redoing a step is only possible if the FMU state has been recorded at the beginning of the current (discarded) step with <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a>.</em>
<em>Redoing a step is performed by calling <code>fmi3SetFMUState</code> and afterwards calling <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with the new communicationStepSize.</em>
<em>Note that it is not possible to change <code>currentCommunicationPoint</code> in such a call.]</em>
The master can also continue from the <code>lastSuccessfulTime</code>.
It does not enter into this state if the FMU returns early from a communication step caused by <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dd>
<p><a href="#fmi3Terminate"><code>fmi3Terminate</code></a>, <code>fmi3Get{VariableType}</code>, <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>, <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a></p>
</dd>
<dt class="hdlist1"><a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a></dt>
<dd>
<p>The master calls this functions to retrieve information about the reason for discarding the last communication step.</p>
</dd>
<dt class="hdlist1"><a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a></dt>
<dd>
<p>The <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a> function pushes the FMU from <strong>Step Discarded</strong> to <strong>Step Mode</strong>.
<em>[In <strong>Step Mode</strong>, the master may change again FMU <a href="#input"><code>inputs</code></a> and <a href="#parameter"><code>parameters</code></a>, or push the FMU into other states]</em>
In this case, a new step may be started from <code>lastSuccessfulTime</code> which can be retrieved by the <a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a> function in state <strong>Step Discarded</strong>.</p>
</dd>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a>, <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>, <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>, <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, <code>fmi3Set{VariableType}</code>, <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a>, <a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="state-terminated-co-simulation">4.2.4.10. State: Terminated</h5>
<div class="paragraph">
<p>In this state, the solution at the final time of the simulation can be retrieved.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dd>
<p><code>fmi3Get{VariableType}</code>, <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>, <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a></p>
</dd>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a>, <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>, <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>, <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, <code>fmi3Set{VariableType}</code>, <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a>, <a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="state-configuration-mode-co-simulation">4.2.4.11. State: Configuration Mode</h5>
<div class="paragraph">
<p>In this state <a href="#structuralParameter"><code>structural parameters</code></a> with <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> can be changed.</p>
</div>
<div class="paragraph">
<p>This state is entered from state <strong>Instantiated</strong> by calling <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> and left back to <strong>Instantiated</strong> by calling <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dd>
<p><a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a></p>
</dd>
<dt class="hdlist1"><code>fmi3Set{VariableType}</code></dt>
<dd>
<p>Only for variables with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>.</p>
</dd>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a>, <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>, <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, <a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a>, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a>, <a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a>, <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>, <a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a>, <code>fmi3Get{VariableType}</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em><span class="The allowed function calls in the respective states are summarized in the following table (functions marked in [yellow-background">"yellow"</span> are only available for Co-Simulation, the other functions are available both for Model Exchange and Co-Simulation):</em></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 52.6315%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2637%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-bottom" rowspan="2"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="9"><p class="tableblock"><strong>FMI 3.0 for Co-Simulation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Start, End</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Instantiated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Initialization Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">StepComplete</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">StepInProgress</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">StepDiscarded</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">StepCanceled</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Terminated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Error</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Terminate"><code>fmi3Terminate</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Reset"><code>fmi3Reset</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a>  </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a> </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3DoStep"><code>fmi3DoStep</code></a>                   </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a>            </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a> </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a>            </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>x</strong> means: call is allowed in the corresponding state<br>
<strong>number</strong> means: call is allowed if the indicated condition holds:<br>
<strong>1</strong> for a variable with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> that has <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a><br>
<strong>2</strong> for a variable with <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> or continuous-time states or state derivatives
(if element <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code> is present)<br>
<strong>3</strong> for a variable with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> that has <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>,
or <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a><br>
<strong>6</strong> for a variable with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> or (<a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>)<br>
<strong>7</strong> always, but retrieved values are usable for debugging only<br>
<strong>8</strong> always, but if status is other than <code>fmi3Terminated</code>,
retrieved values are usable for debugging only ]_</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_example_for_fmi3cosimulation">4.2.5. Code Example for fmi3CoSimulation</h4>
<div class="paragraph">
<p>In the following example, the usage of the FMI functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
We consider two slaves, where both have one <a href="#continuous"><code>continuous</code></a> floating point <a href="#input"><code>input</code></a> and one <a href="#continuous"><code>continuous</code></a> floating point <a href="#output"><code>output</code></a> which are connected in the following way:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-connection-of-slaves.svg" alt="co simulation connection of slaves" width="30%">
</div>
<div class="title">Figure 13. Connection graph of the slaves.</div>
</div>
<div class="paragraph">
<p>We assume no algebraic dependency between input and <a href="#output"><code>output</code></a> of each slave.
The code demonstrates the simplest master algorithm as shown in <a href="#math-basic-co-simulation">Section 4.1</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Constant communication step size.</p>
</li>
<li>
<p>No repeating of communication steps.</p>
</li>
<li>
<p>The slaves do not support asynchronous execution of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The error handling is implemented in a very rudimentary way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">////////////////////////////
// Initialization sub-phase

// instantiate both slaves
s1 = s1_fmi3InstantiateBasicCoSimulation("slave1", guid, NULL, fmi3False, fmi3False, fmi3False, fmi3False, fmi3False,
                        NULL, cb_logMessage, cb_allocateMemory, cb_freeMemory, NULL);
s2 = s2_fmi3InstantiateBasicCoSimulation("slave2", guid, NULL, fmi3False, fmi3False, fmi3False, fmi3False, fmi3False,
                        NULL, cb_logMessage, cb_allocateMemory, cb_freeMemory, NULL);

if (s1 == NULL || s2 == NULL)
    return EXIT_FAILURE;

// start and stop time
startTime = 0;
stopTime = 10;

// communication step size
h = 0.01;

// set all variable start values (of "ScalarVariable / &lt;type&gt; / start")
// s1_fmi3SetReal/Integer/Boolean/String(s1, ...);
// s2_fmi3SetReal/Integer/Boolean/String(s2, ...);

// initialize the slaves
s1_fmi3SetupExperiment(s1, fmi3False, 0.0, startTime, fmi3True, stopTime);
s2_fmi3SetupExperiment(s2, fmi3False, 0.0, startTime, fmi3True, stopTime);

s1_fmi3EnterInitializationMode(s1);
s2_fmi3EnterInitializationMode(s2);

// set the input values at time = startTime
// fmi3SetReal/Integer/Boolean/String(s1, ...);
// fmi3SetReal/Integer/Boolean/String(s2, ...);

s1_fmi3ExitInitializationMode(s1);
s2_fmi3ExitInitializationMode(s2);

////////////////////////
// Simulation sub-phase
tc = startTime; // current master time

while ((tc &lt; stopTime) &amp;&amp; (status == fmi3OK)) {

    // retrieve outputs
    // fmi3GetReal(s1, ..., 1, &amp;y1);
    // fmi3GetReal(s2, ..., 1, &amp;y2);

    // set inputs
    // fmi3SetReal(s1, ..., 1, &amp;y2);
    // fmi3SetReal(s2, ..., 1, &amp;y1);

    // call slave s1 and check status
    status = s1_fmi3DoStep(s1, tc, h, fmi3True, NULL);

    switch (status) {
        case fmi3Discard:
            s1_fmi3GetDoStepDiscardedStatus(s1, &amp;discard, &amp;lastSuccessfulTime);
            if (discard == fmi3True)
                printf("Slave s1 wants to terminate simulation.");
        case fmi3Error:
        case fmi3Fatal:
            terminateSimulation = true;
            break;
        default:
            break;
    }

    if (terminateSimulation)
        break;

    // call slave s2 and check status as above
    status = s2_fmi3DoStep(s2, tc, h, fmi3True, NULL);

    // ...

    // increment master time
    tc += h;
 }

//////////////////////////
// Shutdown sub-phase
if (status != fmi3Error &amp;&amp; status != fmi3Fatal) {
    s1_fmi3Terminate(s1);
    s2_fmi3Terminate(s2);
}

if (status != fmi3Fatal) {
    s1_fmi3FreeInstance(s1);
    s2_fmi3FreeInstance(s2);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="earlyreturn-co-simulation">4.2.6. Early-return Requested by the Co-Simulation Master in fmi3CoSimulation</h4>
<div class="paragraph">
<p>The boolean capability flag <code>canReturnEarlyAfterIntermediateUpdate</code> in the modelDescription XML file indicates whether the FMU supports the early-return feature.
The default value of this capability flag is <code>false</code>.
Each time an internal discontinuity or an event happens inside an FMU with capability flag <code>canReturnEarlyAfterIntermediateUpdate = true</code>, the callback function <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> is invoked by the FMU.
The master can only use this early return functionality if it provides the <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> callback function pointer in <a href="#fmi3CallbackFunctions"><code>fmi3CallbackFunctions</code></a> in <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>.</p>
</div>
<div id="fmi3CallbackIntermediateUpdate" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="c" class="language-c hljs">typedef fmi3Status (*fmi3CallbackIntermediateUpdate) (
  fmi3InstanceEnvironment instanceEnvironment,
  fmi3Float64 intermediateUpdateTime,
  fmi3Boolean eventOccurred,
  fmi3Boolean clocksTicked,
  fmi3Boolean intermediateVariableSetAllowed,
  fmi3Boolean intermediateVariableGetAllowed,
  fmi3Boolean intermediateStepFinished,
  fmi3Boolean canReturnEarly);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Co-Simulation master can request the FMU to end the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> at a Newtonian time instant and to do an early return by calling the <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a> function inside the callback function <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>.
The Co-Simulation master is only allowed to call this function, if <code>canReturnEarly = fmi3True</code>.
If the master does not call <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a> the FMU continues the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> computation until the next predefined communication instant (i.e., <code>currentCommunicationPoint + communicationStepSize</code>) or until the next call of <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>.</p>
</div>
<div id="fmi3DoEarlyReturn" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="c" class="language-c hljs">typedef fmi3Status fmi3DoEarlyReturnTYPE(fmi3Instance instance, fmi3Float64 earlyReturnTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FMU should return early from the current <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> at the time instant defined by parameter <code>earlyReturnTime</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>earlyReturnTime</code> is greater than the last signaled <code>intermediateUpdateTime</code>, the FMU may integrate up to the time instant <code>earlyReturnTime</code>.</p>
</div>
<div class="paragraph">
<p>If the early return is conducted successfully by the FMU it must set the parameter <code>earlyReturn</code> to <code>fmi3True</code> in <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> and return <code>fmi3OK</code>.
In that case the internal simulation time of the FMU equals the value of <code>earlyReturnTime</code> of the last <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a> call.</p>
</div>
<div class="paragraph">
<p>If the requested <code>earlyReturnTime</code> is less than the last signaled <code>intermediateUpdateTime</code> or the FMU can not reach the requested <code>earlyReturnTime</code> for other reasons, the FMU must set the parameter <code>earlyReturn</code> to <code>fmi3True</code> in <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> and return <code>fmi3Discard</code> and enter state <strong>Step Discarded</strong>.</p>
</div>
<div class="paragraph">
<p>In state <strong>Step Discarded</strong> the Co-Simulation master can retrieve the <code>lastSuccessfulTime</code> via calling <a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a>.
The Co-Simulation master can decide if a rollback of the FMU to reach the <code>earlyReturnTime</code> time is required or it may continue the simulation from <code>lastSuccessfulTime</code> for that FMU.
Note that <strong>Event Mode</strong> is not supported in <code>fmi3CoSimulation</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="basic-co-simulation-schema">4.3. Description Schema</h3>
<div class="paragraph">
<p>This is defined in <a href="#fmi-description-schema">Section 2.2</a>.
Additionally, the Co-Simulation specific element <code>Implementation</code> is defined in the next section.</p>
</div>
<div class="paragraph">
<p>If the XML file defines an FMU for Co-Simulation, element <code>BasicCoSimulation</code> must be present.
It is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/schema/BasicCoSimulation.png" alt="BasicCoSimulation" width="80%">
</div>
</div>
<div class="paragraph">
<p>These attributes have the following meaning (all attributes are optional with exception of <code>modelIdentifier</code>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelIdentifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short class name according to C syntax, for example, <code>A_B_C</code>.
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries, but not if the functions are provided by a DLL/SharedObject.
<code>modelIdentifier</code> is also used as name of the static library or DLL/SharedObject.
See also <a href="#header-files-and-naming-of-functions">Section 2.1.1</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>needsExecutionTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, a tool is needed to execute the model.
The FMU just contains the communication to this tool (see <a href="#figure-co-simulation-with-tool-coupling">Figure 4</a>).
<em>[Typically, this information is only utilized for information purposes.</em>
<em>For example, a Co-Simulation master can inform the user that a tool has to be available on the computer where the slave is instantiated.</em>
<em>The name of the tool can be taken from attribute <code>generationTool</code> of <code>fmiModelDescription</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canBeInstantiatedOnlyOncePerProcess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This flag indicates cases (especially for embedded code), where only one instance per FMU is possible.
(For multiple instantiation the default is <code>false</code>; if multiple instances are needed, the FMUs must be instantiated in different processes.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canNotUseMemoryManagementFunctions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the slave uses its own functions for memory allocation and freeing only.
The callback functions <a href="#allocateMemory"><code>allocateMemory</code></a> and <a href="#freeMemory"><code>freeMemory</code></a> given in <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a> are ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canGetAndSetFMUState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the environment can inquire the internal FMU state and restore it.
That is, <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>, and <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a> are supported by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canSerializeFMUState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the environment can serialize the internal FMU state, in other words, <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a>, <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a>, <a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a> are supported by the FMU.
If this is the case, then flag <code>canGetAndSetFMUState</code> must be <code>true</code> as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesDirectionalDerivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the directional derivative of the equations at communication points can be computed with <code>fmi3GetDirectionalDerivative</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canInterpolateInputs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slave is able to interpolate <a href="#continuous"><code>continuous</code></a> <a href="#input"><code>inputs</code></a>.
Calling of <code>fmi3SetInputDerivatives</code> has an effect for the slave.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxOutputDerivativeOrder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slave is able to provide <a href="#derivative"><code>derivatives</code></a> of <a href="#output"><code>outputs</code></a> with maximum order.
Calling of <code>fmi3GetOutputDerivatives</code> is allowed up to the order defined by <code>maxOutputDerivativeOrder</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canHandleVariableCommunicationStepSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slave can handle variable communication step size.
The communication step size (parameter communicationStepSize of <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>) has not to be constant for each call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesIntermediateVariableAccess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slave is able to provide access to selected variables during callback function call <code>intermediateUpdate()</code>.
The accessible variables are marked with attribute <a href="#intermediateAccess"><code>intermediateAccess</code></a> = <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canReturnEarlyAfterIntermediateUpdate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the slave is able to return early from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> if master calls <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a> during callback function call <code>intermediateUpdate()</code> and <code>canReturnEarly = true</code> in <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>.
<em>[If set to <code>true</code> and <code>providesHybridCoSimulation</code> is set to <code>false</code>, the FMU supports the basic functionality of ending DoSteps before the planned next communication point time.</em>
<em>This is controlled by the simulation master for avoiding unnecessary computations and roll backs of the FMU due to external events known by the simulation master]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesHybridCoSimulation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the slave can be set to <code>fmi3HybridCoSimulation</code> during instantiation of FMU.
If set to <code>true</code> also <code>canReturnEarlyAfterIntermediateUpdate</code> must be set to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesScheduledCoSimulation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the slave can instantiated as Scheduled Co-Simulation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canNotUseBasicCoSimulation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>false</code>, the slave can be set to <code>fmi3CoSimulation</code> during instantiation of the FMU.
<em>[the support of Basic Co-Simulation should be possible for most Co-Simulation FMUs, thus the default value is <code>false</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fixedInternalStepSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fixed internal step size of the FMU (optional).
<em>[This information can be used by the co-simulation master to synchronize the communication interval with the internal step size of the FMU.</em>
<em>The co-simulation master should calculate the communication points by multiplying (<code>number_of_steps * step_size</code>) instead of repeatedly incrementing (<code>time += step_size</code>) to avoid the accumulation of numerical errors.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The flags have the following default values.<br>
boolean: <code>false</code><br>
unsignedInt: <code>0</code><br></p>
</div>
<div class="paragraph">
<p>Note that if <code>needsExecutionTool = true</code>, then it is required that the original tool is available to be executed during co-simulation.
If <code>needsExecutionTool = false</code>, the slave is completely contained inside the FMU in source code or binary format (DLL/SharedObject).</p>
</div>
<div class="sect3">
<h4 id="xml-example-co-simulation">4.3.1. Example XML Description File</h4>
<div class="paragraph">
<p>The example below is the same as shown in <a href="#xml-example-model-exchange">Section 3.3.2</a> for a Model Exchange FMU.
The only difference is the replacement of the element <code>ModelExchange</code> with the element <code>CoSimulation</code> (with additional attributes) and the removal of <a href="#local"><code>local</code></a> variables, which are associated with continuous <a href="#state"><code>states</code></a> and their <a href="#derivative"><code>derivatives</code></a>.
The XML file may have the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription
  fmiVersion="3.0-alpha.3"
  modelName="MyLibrary.SpringMassDamper"
  instantiationToken="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2011-09-23T16:57:33Z"
  variableNamingConvention="structured"&gt;
  &lt;BasicCoSimulation
    modelIdentifier="MyLibrary_SpringMassDamper"
    canHandleVariableCommunicationStepSize="true"
    canInterpolateInputs="true"/&gt;
  &lt;UnitDefinitions&gt;
    &lt;Unit name="rad"&gt;
      &lt;BaseUnit rad="1"/&gt;
      &lt;DisplayUnit name="deg" factor="57.2957795130823"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="rad/s"&gt;
      &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="kg.m2"&gt;
      &lt;BaseUnit kg="1" m="2"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="N.m"&gt;
      &lt;BaseUnit kg="1" m="2" s="-2"/&gt;
    &lt;/Unit&gt;
  &lt;/UnitDefinitions&gt;
  &lt;TypeDefinitions&gt;
    &lt;Float64 name="Modelica.SIunits.Inertia" quantity="MomentOfInertia" unit="kg.m2" min="0.0"/&gt;
    &lt;Float64 name="Modelica.SIunits.Torque" quantity="Torque" unit="N.m"/&gt;
    &lt;Float64 name="Modelica.SIunits.AngularVelocity" quantity="AngularVelocity" unit="rad/s"/&gt;
    &lt;Float64 name="Modelica.SIunits.Angle" quantity="Angle" unit="rad"/&gt;
  &lt;/TypeDefinitions&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;Float64 name="inertia1.J" valueReference="1073741824"
      description="Moment of load inertia" causality="parameter" variability="fixed"
      declaredType="Modelica.SIunits.Inertia" start="1"/&gt;
    &lt;Float64 name="torque.tau" valueReference="536870912"
      description="Accelerating torque acting at flange (= -flange.tau)" causality="input"
      declaredType="Modelica.SIunits.Torque" start="0"/&gt;
    &lt;Float64 name="inertia1.phi" valueReference="805306368"
      description="Absolute rotation angle of component" causality="output"
      declaredType="Modelica.SIunits.Angle"/&gt;
    &lt;Float64 name="inertia1.w" valueReference="805306369"
      description="Absolute angular velocity of component (= der(phi))" causality="output"
      declaredType="Modelica.SIunits.AngularVelocity"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Output valueReference="805306368"/&gt;
    &lt;Output valueReference="805306369"/&gt;
    &lt;InitialUnknown valueReference="805306368"/&gt;
    &lt;InitialUnknown valueReference="805306369"/&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_early_return_from_current_communication_step_2">4.3.2. Early Return from Current Communication Step</h4>
<div class="paragraph">
<p>The simulation master collects the information about the capability of an FMU to perform an early return by analyzing the <code>modelDescription.xml</code> as defined in section <a href="#fmi-description-schema">Section 2.2</a> and <a href="#fmi-for-basic-co-simulation">Section 4</a>.</p>
</div>
<div class="sect4">
<h5 id="_co_simulation_fmu">4.3.2.1. Co-Simulation FMU</h5>
<div class="paragraph">
<p>In order to support the early return in <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> the capability flag  <code>canReturnEarlyAfterIntermediateUpdate</code> in the XML should be <code>true</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_example_xml_description_file">4.3.2.2. Example XML Description File</h5>
<div class="paragraph">
<p>Here is an example of an XML of an FMU supporting early return.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;fmiModelDescription
  fmiVersion="3.0-alpha.3"
  modelName="MyLibrary.SpringMassDamper_Early_Return_example"
  instantiationToken="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2011-09-23T16:57:33Z"
  variableNamingConvention="structured"&gt;
  &lt;BasicCoSimulation
    modelIdentifier="MyLibrary_SpringMassDamper"
    canHandleVariableCommunicationStepSize="true"
    canReturnEarlyAfterIntermediateUpdate="true"/&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;Float64 name="inertia1.J" valueReference="1073741824"
      description="Moment of load inertia" causality="parameter" variability="fixed"
      declaredType="Modelica.SIunits.Inertia" start="1"/&gt;
    &lt;Float64 name="torque.tau" valueReference="536870912"
      description="Accelerating torque acting at flange (= -flange.tau)" causality="input"
      declaredType="Modelica.SIunits.Torque" start="0"/&gt;
    &lt;Float64 name="inertia1.phi" valueReference="805306368"
      description="Absolute rotation angle of component" causality="output"
      declaredType="Modelica.SIunits.Angle"/&gt;
    &lt;Float64 name="inertia1.w" valueReference="805306369"
      description="Absolute angular velocity of component (= der(phi))" causality="output"
      declaredType="Modelica.SIunits.AngularVelocity"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Output valueReference="805306368"/&gt;
    &lt;Output valueReference="805306369"/&gt;
    &lt;InitialUnknown valueReference="805306368"/&gt;
    &lt;InitialUnknown valueReference="805306369"/&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-hybrid-co-simulation">5. FMI for Hybrid Co-Simulation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The notion of <a href="#clock"><code>clock</code></a> in FMI for Model Exchange has been extended to the FMI for Co-Simulation.</p>
</div>
<div class="paragraph">
<p>Both <a href="#outputClock"><code>output clocks</code></a> and <a href="#inputClock"><code>input clocks</code></a> are supported in Co-Simulation with <a href="#clock"><code>clocks</code></a>.
In order to handle <a href="#inputClock"><code>input</code></a> and <a href="#outputClock"><code>output clocks</code></a> in Co-Simulation, a new <strong>Event Mode</strong> has been introduced.</p>
</div>
<div class="paragraph">
<p>The concept and the way <a href="#inputClock"><code>input</code></a> and <a href="#outputClock"><code>output clocks</code></a> are handled are very similar in Model Exchange and Co-Simulation.
In order to handle <a href="#inputClock"><code>input clocks</code></a>, the Co-Simulation master schedules <a href="#inputClock"><code>input clocks</code></a> and adjusts the communication steps in such a way that <a href="#inputClock"><code>input clock</code></a> ticks become communication points.
At these communication points, the FMU is pushed to the <strong>Event Mode</strong> and <a href="#inputClock"><code>input clocks</code></a> are handled.</p>
</div>
<div class="paragraph">
<p><a href="#outputClock"><code>Output clocks</code></a>, on the other hand, are detected by the FMU.
The FMU detects an <a href="#outputClock"><code>output clock</code></a> and informs the master by invoking a callback in which the event time and the event type is communicated to the master.
Then FMU stops the current Co-Simulation step and returns back from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.
Then the FMU is pushed to the <strong>Event Mode</strong> and the event is handled.
Note that, since output events time instants are not known in advance, at output event time instants, new communication steps are created.</p>
</div>
<div class="sect2">
<h3 id="math-hybrid-co-simulation">5.1. Mathematical Description</h3>

</div>
<div class="sect2">
<h3 id="hybrid-co-simulation-api">5.2. Application Programming Interface</h3>
<div class="paragraph">
<p>If the boolean capability flag <code>providesHybridCoSimulation</code> and <code>canReturnEarlyAfterIntermediateUpdate = true</code> the Co-Simulation master can use the interface <code>fmi3HybridCoSimulation</code>.</p>
</div>
<div class="sect3">
<h4 id="_communication_of_event_time_and_inputoutput_values">5.2.1. Communication of event time and input/output values</h4>
<div class="paragraph">
<p>The <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> callback described in section <a href="#earlyreturn-co-simulation">Section 4.2.6</a> is also used in order to communicate the <a href="#input"><code>input</code></a> and <a href="#output"><code>output</code></a> and, in particular, the event and <a href="#clock"><code>clock</code></a> time from the FMU to the Co-Simulation master.
The <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> callback allows internal events (e.g. associated to <a href="#outputClock"><code>output clock</code></a> ticks) to be signaled from an FMU to the Co-Simulation master.
If <code>fmu3Type</code> is set to <code>fmi3HybridCoSimulation</code>, the <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> callback must be defined in <a href="#fmi3CallbackFunctions"><code>fmi3CallbackFunctions</code></a> in <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>.
In other cases a NULL pointer can be assigned to the <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> callback, such as if the <code>fmu3Type</code> is set to  <code>fmi3ModelExchange</code>.</p>
</div>
<div class="paragraph">
<p>The output arguments of <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> are used to signal <a href="#outputClock"><code>output clock</code></a> ticks and internal events to the master.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status (*fmi3CallbackIntermediateUpdate) (
  fmi3InstanceEnvironment instanceEnvironment,
  fmi3Float64 intermediateUpdateTime,
  fmi3Boolean eventOccurred,
  fmi3Boolean clocksTicked,
  fmi3Boolean intermediateVariableSetAllowed,
  fmi3Boolean intermediateVariableGetAllowed,
  fmi3Boolean intermediateStepFinished,
  fmi3Boolean canReturnEarly);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>intermediateUpdateTime</code> is the internal simulation time of the FMU at which the callback has been called.
If an event happens or a <a href="#outputClock"><code>output clock</code></a> ticks, <code>intermediateUpdateTime</code> is the time of event or <a href="#outputClock"><code>output clock</code></a> tick.
If the FMU signals an <code>earlyReturn = fmi3True</code> and <code>fmi3OK</code> after returning from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> then <code>intermediateUpdateTime</code> is the internal simulation time of the FMU of the last <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> call that signaled <code>canReturnEarly = fmi3true</code>.
<code>intermediateUpdateTime</code> is also the time of intermediate steps of the internal FMU solver.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following <code>fmi3Boolean</code> variables define the reasons for the <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> call.
Several variables can be set by the FMU.
Default value of variables is <code>fmi3False</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when <code>eventOccurred</code> is <code>fmi3True</code>, the master must call <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a> to do an early return and handle the event via entering <strong>Event Mode</strong>.
In this case, <code>earlyReturnTime</code> argument of <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a> is ignored.
In <strong>Event Mode</strong> the master shall call the <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> function for gathering related information about the event that occurred at <code>intermediateUpdateTime</code>.</p>
</li>
<li>
<p>when <code>clocksTicked</code>  is <code>fmi3True</code>, it means that <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> function should be called for gathering all <a href="#clock"><code>clock</code></a> related information about ticking <a href="#outputClock"><code>output clocks</code></a> at <code>intermediateUpdateTime</code>.
If this flag is <code>fmi3True</code> the master must call <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a> to do an early return and handle the <a href="#clock"><code>clock</code></a> event in <strong>Event Mode</strong>.
In this case, <code>earlyReturnTime</code> argument of <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a> is ignored.</p>
</li>
<li>
<p>when <code>intermediateVariableSetAllowed</code> is <code>fmi3True</code>, the FMU signals that intermediate output values can be collected by the Co-Simulation master.</p>
</li>
<li>
<p>when <code>intermediateVariableGetAllowed</code> is <code>fmi3True</code>, the FMU signals that intermediate input values can be set by the Co-Simulation master.</p>
</li>
<li>
<p>when <code>intermediateStepFinished</code> is <code>fmi3True</code>, the FMU signals that the internal solver step for this time instant is complete.</p>
</li>
<li>
<p>when <code>canReturnEarly</code> is <code>fmi3True</code> the master can request the FMU to return early at the current <code>intermediateUpdateTime</code> time instant via calling <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a> within the callback function <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>.
If <code>canReturnEarly</code> is <code>fmi3False</code> the FMU will not do the early return, regardless of the master request.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that only the first discontinuity event at a Newtonian time instant shall be signaled that way.
But in <strong>Event Mode</strong>, there may be an event iteration at a Newtonian time instant and have super-dense time instants.</p>
</div>
<div class="paragraph">
<p>Based on the information provided by <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>, additional information about the discontinuity at that time instant can be obtained by calling <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> and <a href="#fmi3GetClock"><code>fmi3GetClock</code></a>.</p>
</div>
<div class="paragraph">
<p>The FMU must not call the callback function <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> with an <code>intermediateUpdateTime</code> that is smaller than the <code>intermediateUpdateTime</code> given in a previous call of <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> with <code>intermediateStepFinished = fmi3True</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_handling_a_successful_early_return_by_the_co_simulation_master_in_fmi3hybridcosimulation">5.2.2. Handling a Successful Early-Return by the Co-Simulation Master in fmi3HybridCoSimulation</h4>
<div class="paragraph">
<p>If the FMU is successful in conducting an early return, the return value of the <code>earlyReturn</code> argument in <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> is <code>fmi3True</code>, otherwise <code>fmi3False</code>.
If the FMU returns from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> with the <code>earlyReturn = fmi3True</code> the Co-Simulation master has to call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> for that FMU.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3EnterEventModeTYPE(fmi3Instance instance,
                                          fmi3Boolean inputEvent,
                                          fmi3Boolean stepEvent,
                                          const fmi3Int32 rootsFound[],
                                          size_t nEventIndicators,
                                          fmi3Boolean timeEvent);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Co-Simulation master can also call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> at communication instants to handle input events, as will be discussed in following sections.</p>
</div>
<div class="paragraph">
<p>If an FMU provides the early-return capability that includes the handling of events in <strong>Event Mode</strong>, the FMU signals this via <code>canReturnEarlyAfterIntermediateUpdate</code> and <code>providesHybridCoSimulation = true</code> in the modelDescription.
The master should indicate to the FMU that this early-return feature is also supported by the master.
The Co-Simulation master signals to the FMU that it supports and has recognized the early return Co-Simulation capabilities of the FMU by setting the Co-Simulation interface to <code>fmi3HybridCoSimulation</code> in the <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a> function.</p>
</div>
<div class="paragraph">
<p>The FMU stops computation at the first encountered internal event (if any) and the event time is provided through <code>intermediateUpdateTime</code>.
If <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> returns with <code>earlyReturn = fmi3True</code> and an event has happened, i.e. <code>eventOccurred = fmi3True</code>, then an event handling has to be done by the Co-Simulation master.
In order to start event handling the Co-Simulation master has to call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> for that FMU to push the FMU into <strong>Event Mode</strong>.
In this mode the Co-Simulation master is supposed to catch all events through the <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> function.</p>
</div>
<div class="paragraph">
<p>If the early-return request of the Co-Simulation master is ignored by the FMU, then <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> returns with <code>earlyReturn = fmi3False</code>.
The master can start a resynchronization of FMUs at an event time, if the <code>currentCommunicationPoint</code> has passed the event time, the master can roll-back the FMU and repeat the step with a suitable <code>communicationStepSize</code> (if the FMU supports the roll-back).</p>
</div>
<div class="paragraph">
<p>In <strong>Event Mode</strong> and only after <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> returned with <code>earlyReturn = fmi3True</code> the function <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> may be called.
Only the following output arguments may be considered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When <code>newDiscreteStatesNeeded = true</code>, the master should stay in <strong>Event Mode</strong> and another call to <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> is required.</p>
</li>
<li>
<p>When <code>nextEventTimeDefined = fmi3True</code>, an event time is available and the value is given by <code>nextEventTime</code>.
This is the case when the model can report in advance the accurate time of the next predictable time event.</p>
</li>
<li>
<p>When <code>terminateSimulation = fmi3True</code>, the model requested to stop integration and the Co-Simulation master should call <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <strong>Event Mode</strong> it is allowed to call <code>fmi3Get{VariableType}</code> after <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> has been called and it is allowed to call <code>fmi3Set{VariableType}</code> before calling <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a>.
The FMU leaves <strong>Event Mode</strong> when the master calls <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a>.</p>
</div>
<div class="paragraph">
<p>It is not allowed to call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> or <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a> for an FMU with interface type Basic Co-Simulation and Scheduled Co-Simulation.</p>
</div>
</div>
<div class="sect3">
<h4 id="api-clocked-co-simulation">5.2.3. Co-Simulation with Clock Support in fmi3HybridCoSimulation</h4>
<div class="paragraph">
<p>In this section, signaling and retrieving <a href="#clock"><code>clock</code></a> ticks as well as the interface for supporting <a href="#clock"><code>clocks</code></a> in FMI for Co-Simulation will be discussed.
If an FMU for Co-Simulation declares <a href="#clock"><code>clocks</code></a> and clocked variables in the <code>modelDescription.xml</code> file, it supports <a href="#clock"><code>clocks</code></a>.
The Co-Simulation master should indicate the FMU that the master has recognized the <a href="#clock"><code>clock</code></a> capabilities of the FMU and supports the <a href="#clock"><code>clock</code></a> handling by setting the Co-Simulation interface to <code>fmi3HybridCoSimulation</code> in <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>.
Note, even if no <a href="#clock"><code>clock</code></a> is defined by an FMU in <code>modelDescription.xml</code>, the master is allowed to set the interface to <code>fmi3HybridCoSimulation</code> to be able to do early return with event handling in <strong>Event Mode</strong>.</p>
</div>
<div class="paragraph">
<p>If an FMU provides <a href="#clock"><code>clocks</code></a>, but the Co-Simulation master does not support or does not want to support early-return or <a href="#clock"><code>clocks</code></a>, by setting the interface to <code>fmi3CoSimulation</code>, the activation of model partitions inside of the FMU has to be handled internally within <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.</p>
</div>
<div class="paragraph">
<p><em>[Remark: Wrapping towards other Co-Simulation interfaces can influence the simulation results.</em>
<em>Depending on the model especially wrapping towards <code>fmi3CoSimulation</code> may result in divergent simulation results.</em>
<em>Especially aperiodic <a href="#inputClock"><code>input clocks</code></a> can not always be sufficiently emulated in modes that do not directly support <a href="#clock"><code>clocks</code></a>.</em>
<em>Therefore it is recommended that the FMU provides logging information to the user about the influence of the current mode on simulation results, if non-optimal modes are used by the simulation environment.]</em></p>
</div>
<div id="fmi3EnterStepMode" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3EnterStepModeTYPE(fmi3Instance instance);</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="transfer-of-input-output-and-parameters-clocked-co-simulation">5.2.3.1. Transfer of Input / Output Values and Parameters in fmi3HybridCoSimulation</h5>
<div class="paragraph">
<p>If the Co-Simulation master supports <a href="#clock"><code>clocks</code></a>, all <a href="#inputClock"><code>input clocks</code></a> of the model should be handled and <a href="#inputClock"><code>input clock</code></a> events should be scheduled by the master.
If an <a href="#outputClock"><code>output clock</code></a> ticks, the FMU calls <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> with <code>clocksTicked = fmi3True</code>.
Then the master must call <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a> to do an early return from <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> and push the FMU into <strong>Event Mode</strong> by calling <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>.
Once the FMU is in <strong>Event Mode</strong>, the activation status of <a href="#outputClock"><code>output clocks</code></a> are retrieved by <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> function.
Then <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> (and <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> or <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a> if necessary) should be invoked to enable the ticked <a href="#inputClock"><code>input clocks</code></a>.
Each <a href="#clock"><code>clock</code></a>, that ticks outside of the FMU (i.e. <a href="#inputClock"><code>input clock</code></a>), is activated for an FMU based on its <a href="#clockReference"><code>clockReference</code></a> and an associated <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in <strong>Event Mode</strong>.
<a href="#fmi3SetClock"><code>fmi3SetClock</code></a> can activate multiple <a href="#clock"><code>clocks</code></a> with each call.
An event iteration is possible.
Once all <a href="#clock"><code>clock</code></a> events are handled for this time instant, the FMU should be pushed into <strong>Step Mode</strong> by calling <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a>.
In <strong>Step Mode</strong>, the Co-Simulation master can call <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> for the time interval from the current event time instant until the next input event instant.
Note that <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> may not reach the next input event instant because an early return may occur.</p>
</div>
<div class="paragraph">
<p>The simulation master sets and gets <a href="#clock"><code>clock</code></a> variable values similar to the FMI for Model Exchange, as defined in <a href="#fmi-api-setting-getting-clock-activation-state">Section 2.1.9</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="computation-clocked-co-simulation">5.2.3.2. Computation in fmi3HybridCoSimulation</h5>
<div class="paragraph">
<p>Similar to FMI for Model Exchange, in order to activate <a href="#inputClock"><code>input clocks</code></a> of an FMU, it is required to push the FMU into <strong>Event Mode</strong> by calling <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>.
If <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> returns with <code>earlyReturn = fmi3True</code> and <code>eventOccurred = fmi3True</code> or <code>clocksTicked = fmi3True</code>, the FMU must be pushed into the <strong>Event Mode</strong> by calling <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>.</p>
</div>
<div class="paragraph">
<p>In order to retrieve the status of <a href="#outputClock"><code>output clocks</code></a>, <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> and <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> or <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a> need to be called in the <strong>Event Mode</strong>.
If the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> return value is <code>fmi3OK</code> and <code>earlyReturn = fmi3False</code>, the calling of <a href="#fmi3GetClock"><code>fmi3GetClock</code></a>, <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a>, <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a>, <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> is only meaningful after <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> in the case of super-dense time iterations are desired.</p>
</div>
<div class="paragraph">
<p>Similar to the Model Exchange case, the allowed call order is <a href="#fmi3GetClock"><code>fmi3GetClock</code></a>, <a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a>, <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a>, <code>fmi3Get{VariableType}</code>, <code>fmi3Set{VariableType}</code>.
Function calls of this call order can be omitted.</p>
</div>
<div class="paragraph">
<p>The handling of return values of function calls is identical to <code>fmi3CoSimulation</code>.</p>
</div>
<div class="paragraph">
<p>If <code>terminateSimulation</code> becomes <code>fmi3True</code> after calling <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> then the co-simulation should be terminated by calling <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>.
Once handling of the <a href="#clock"><code>clock</code></a> events finished, the master calls <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a> for that FMU to push it into <strong>Step Mode</strong>.
Note that it is not allowed to call <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> or <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a> in Basic and Scheduled Co-Simulation.</p>
</div>
<div class="paragraph">
<p><em>[Usually the Co-Simulation master should be able to derive (but is not forced to do so) the correct communication point times for <a href="#inputClock"><code>input clocks</code></a> in advance and thus it should be able to set the proper <code>communicationStepSize</code> for <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>.</em>
<em>This might not be possible if an aperiodic <a href="#inputClock"><code>input clock</code></a> of an FMU depends on the ticking of an aperiodic <a href="#outputClock"><code>output clock</code></a> of another FMU or other aperiodic tick sources.]</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="state-machine-calling-sequence-clocked-co-simulation">5.2.4. State Machine of Calling Sequence from Master to Slave in fmi3HybridCoSimulation</h4>
<div class="paragraph">
<p>The following state machine defines the supported calling sequences.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/state-machine-hybrid-co-simulation.svg" alt="state machine hybrid co simulation" width="80%">
</div>
<div class="title">Figure 14. Calling sequence of Hybrid Co-Simulation interface.</div>
</div>
<div id="figure-hybrid-co-simulation-state-machine" class="paragraph">
<p>In this Co-Simulation interface the following functions must not be called: <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> including all functions that are specific to fmuType <code>fmi3ModelExchange</code>.</p>
</div>
<div class="paragraph">
<p>Unlike the state machine in section <a href="#state-machine-co-simulation">Section 4.2.4</a> the entry state after <strong>Initialization Mode</strong> is the <strong>Event Mode</strong> in order to allow the FMU to handle the very first discrete event.
Each state of the state machine corresponds to a certain phase of a simulation as follows:</p>
</div>
<div class="sect4">
<h5 id="_state_slave_setable_fmu_state">5.2.4.1. State: Slave Setable FMU State</h5>
<div class="paragraph">
<p>This super state in Hybrid Co-Simulation does not differ from Basic Co-Simulation described in section <a href="#state-slave-setable-fmu-state-co-simulation">Section 4.2.4.1</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_slave_under_evaluation">5.2.4.2. State: Slave Under Evaluation</h5>
<div class="paragraph">
<p>This super state in Hybrid Co-Simulation does not differ from Basic Co-Simulation described in section <a href="#state-slave-under-evaluation-co-simulation">Section 4.2.4.2</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_slave_initialized">5.2.4.3. State: Slave Initialized</h5>
<div class="paragraph">
<p>This super state in Hybrid Co-Simulation does not differ from Basic Co-Simulation described in section <a href="#state-slave-initialized-co-simulation">Section 4.2.4.3</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_instantiated">5.2.4.4. State: Instantiated</h5>
<div class="paragraph">
<p>This super state in Hybrid Co-Simulation does not differ from Basic Co-Simulation described in section <a href="#state-instantiated-co-simulation">Section 4.2.4.4</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_configuration_mode">5.2.4.5. State: Configuration Mode</h5>
<div class="paragraph">
<p>This state in Hybrid Co-Simulation does not differ from Basic Co-Simulation described in section <a href="#state-configuration-mode-co-simulation">Section 4.2.4.11</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_initialization_mode">5.2.4.6. State: Initialization Mode</h5>
<div class="paragraph">
<p>This state in Hybrid Co-Simulation does not differ from Basic Co-Simulation described in section <a href="#state-initialization-mode-co-simulation">Section 4.2.4.5</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_event_mode">5.2.4.7. State: Event Mode</h5>
<div class="paragraph">
<p>The master and the FMU enter this state when the master calls <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> in state <strong>Initialization Mode</strong> or <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a> in state <strong>Reconfiguration Mode</strong> or <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a> in state <strong>Step Mode</strong>.
In order to handle discrete events and <a href="#clock"><code>clock</code></a> ticks, the FMU is pushed into the <strong>Event Mode</strong> by calling <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1"><a href="#fmi3Terminate"><code>fmi3Terminate</code></a></dt>
<dd>
<p>Upon return of <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a>, if <code>terminateSimulation = fmi3True</code>, the master should finish the Co-Simulation by calling <code>fmi3Terminate</code> on all FMU instances.</p>
</dd>
<dt class="hdlist1"><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a></dt>
<dd>
<p>With this function call the <strong>Reconfiguration Mode</strong> is entered.
This function must not be called if the FMU contains no <a href="#tunable"><code>tunable</code></a> <a href="#structuralParameter"><code>structural parameters</code></a> (i.e. with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>).</p>
</dd>
<dt class="hdlist1"><a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a></dt>
<dd>
<p>In order to handle discrete events <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> is called.
When the output argument <code>newDiscreteStatesNeeded = fmi3True</code>, the FMU should stay in <strong>Event Mode</strong> and another call to <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> is required.</p>
</dd>
<dt class="hdlist1"><a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a></dt>
<dd>
<p>Once all events are handled and <code>newDiscreteStatesNeeded = fmi3False</code>, the FMU should be pushed to <strong>Step Mode</strong> by calling <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a>, unless it requests to terminate the Co-Simulation by setting  <code>terminateSimulation</code> to <code>fmi3True</code>.
In this case, a new step can be started from the current communication point time.</p>
</dd>
<dt class="hdlist1"><a href="#fmi3GetClock"><code>fmi3GetClock</code></a></dt>
<dd>
<p>The status of <a href="#clock"><code>clocks</code></a> can be inquired by this function.</p>
</dd>
<dt class="hdlist1"><a href="#fmi3SetClock"><code>fmi3SetClock</code></a></dt>
<dd>
<p>For <a href="#inputClock"><code>input clocks</code></a>, <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> is called after entering <strong>Event Mode</strong> to set the activation status of <a href="#clock"><code>clocks</code></a>.
For both <a href="#input"><code>input</code></a> and trigerred <a href="#clock"><code>clocks</code></a>, this function can be called several times, only if recomputations of clock state are needed during <strong>Event Mode</strong>.</p>
</dd>
<dt class="hdlist1"><a href="#fmi3GetIntervalDecimal"><code>fmi3GetIntervalDecimal</code></a> &amp; <a href="#fmi3GetIntervalFraction"><code>fmi3GetIntervalFraction</code></a></dt>
<dd>
<p>For both <a href="#outputClock"><code>output clocks</code></a> and <a href="#inputClock"><code>input clocks</code></a> it is allowed to call these functions during <strong>Event Mode</strong>.</p>
</dd>
<dt class="hdlist1"><a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a> &amp; <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a></dt>
<dd>
<p>It is not allowed to call these functions for <a href="#output"><code>output</code></a>, aperiodic and strictly periodic <a href="#clock"><code>clocks</code></a>.
For <a href="#input"><code>input</code></a> periodic <a href="#clock"><code>clocks</code></a>, these functions are called after the first <a href="#clock"><code>clock</code></a> activaion.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_state_step_mode">5.2.4.8. State: Step Mode</h5>
<div class="paragraph">
<p>This state in Hybrid Co-Simulation does not differ from Basic Co-Simulation described in section <a href="#state-step-mode-co-simulation">Section 4.2.4.6</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_intermediate_update_mode">5.2.4.9. State: Intermediate Update Mode</h5>
<div class="paragraph">
<p>This state in Hybrid Co-Simulation differ from Basic Co-Simulation described in section <a href="#state-step-mode-co-simulation">Section 4.2.4.6</a> as following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1"><a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a></dt>
<dd>
<p>If <code>canReturnEarly = fmi3True</code>, the Co-Simulation master can request the FMU to end the <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> and to do an early return by calling this function.</p>
</dd>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p>All API functions not listed in the allowed function list, including <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> and  <a href="#fmi3SetClock"><code>fmi3SetClock</code></a> are forbidden in this mode.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_state_reconfiguration_mode">5.2.4.10. State: Reconfiguration Mode</h5>
<div class="paragraph">
<p>This state in Hybrid Co-Simulation does not differ from Basic Co-Simulation described in section <a href="#state-reconfiguration-mode-co-simulation">Section 4.2.4.8</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_step_discarded">5.2.4.11. State: Step Discarded</h5>
<div class="paragraph">
<p>This state in Hybrid Co-Simulation does not differ from Basic Co-Simulation described in section <a href="#state-step-discarded-co-simulation">Section 4.2.4.9</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_terminated">5.2.4.12. State: Terminated</h5>
<div class="paragraph">
<p>This state in Hybrid Co-Simulation does not differ from Basic Co-Simulation described in section <a href="#state-terminated-co-simulation">Section 4.2.4.10</a>.</p>
</div>
<div class="paragraph">
<p><em><span class="The allowed function calls in the respective states are summarized in the following table (functions marked in [yellow-background">"yellow"</span> are only available for Co-Simulation, the other functions are available both for Model Exchange and Co-Simulation):</em></p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 41.6666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1666%;">
<col style="width: 4.1676%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-bottom" rowspan="2"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="14"><p class="tableblock"><strong>FMI 3.0 for Co-Simulation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">start, end</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Instantiated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Configuration Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Initialization Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Event Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Reconfiguration Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Step Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepComplete</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepInProgress</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Step Discarded</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Intermediate Update Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepCanceled</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Terminated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">error</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Terminate"><code>fmi3Terminate</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Reset"><code>fmi3Reset</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a>            </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a>      </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a>     </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3DoStep"><code>fmi3DoStep</code></a>                   </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>   </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a>            </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a> </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>]</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="code-example-clocked-co-simulation">5.2.5. Code Example for fmi3HybridCoSimulation</h4>
<div class="paragraph">
<p>In the following example, the usage of the FMI functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
We consider &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>The error handling is implemented in a very rudimentary way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">  //////////////////////////
  // Initialization sub-phase

  fmi3EventInfo s_eventInfo;

  // Set callback functions
  callbacks.logMessage          = cb_logMessage;
  callbacks.allocateMemory      = cb_allocateMemory;
  callbacks.freeMemory          = cb_freeMemory;
  // Signal that early return is supported by master
  callbacks.intermediateUpdate  = cb_intermediateUpdate;
  callbacks.lockPreemption      = NULL; // Preemption not active
  callbacks.unlockPreemption    = NULL; // Preemption not active


  // Instantiate slave
  // Create pointer to information for identifying the FMU in callbacks
  callbacks.instanceEnvironment = NULL;

  //set Co-Simulation mode
  fmi3CoSimulationConfiguration coSimulationConfiguration;
  coSimulationConfiguration.intermediateVariableGetRequired         = fmi3False;
  coSimulationConfiguration.intermediateInternalVariableGetRequired = fmi3False;
  coSimulationConfiguration.intermediateVariableSetRequired         = fmi3False;
  coSimulationConfiguration.coSimulationMode                        = fmi3ModeHybridCoSimulation;


  // Instantiate slave
  s = fmi3Instantiate("Slave", fmi3CoSimulation, s_GUID, NULL, &amp;callbacks, fmi3False, fmi3True, &amp;coSimulationConfiguration); // [TODO]: fmuResourceLocation --&gt; NULL?

  if (s == NULL) return EXIT_FAILURE; // error



  // Configuration Mode
  //fmi3EnterConfigurationMode(s);
  //fmi3ExitConfigurationMode(s);


  // Setup Experiment
  // Start and stop time
  startTime = 0;
  stopTime  = 10;
  // Communication constant step size
  h = 0.01;

  // Set all variable start values (of "ScalarVariable / &lt;type&gt; / start")
  //fmi3SetReal / Integer / Boolean / String(s, ...); // [TODO]: To be set.
  //fmi3SetClock(s, ...); // [TODO]: To be set.

  fmi3SetupExperiment(s, fmi3False, 0.0, startTime, fmi3True, stopTime);



  // Initialization Mode
  fmi3EnterInitializationMode(s);

  // Set the input values at time = startTime
  //fmi3SetReal / Integer / Boolean / String(s, ...); // [TODO]: To be set.
  //fmi3SetClock(s, ...); // [TODO]: To be set.

  fmi3ExitInitializationMode(s);



  //////////////////////////
  // Simulation sub-phase
  tc = startTime; // Starting master time
  tStop = stopTime; // Stopping master time
  step = h; // Starting non-zero step size
  inferredClocksTickedS = fmi3False; // [TODO]: To be set.

  mode = eventMode; // [TODO]: @Masoud recheck: continuousTimeMode --&gt; eventMode

  while (tc &lt; tStop) {
    if (0 /* Inferred clock is active at current time tc */) { // [TODO]: To be set.
      /*Set possible active inferred clocks to true or to false*/
      if(mode == stepMode) { // [TODO]: @Masoud recheck: continuousTimeMode --&gt; stepMode
        status = fmi3EnterEventMode(s);
        if ((status == fmi3Fatal) || (status == fmi3Error)) break;
        mode = eventMode;
      };
      //fmi3SetClock(s, ...); // [TODO]: To be set.
      //fmi3SetIntervalDecimal(s, ...); /*Only needed if interval changes*/ // [TODO]: To be set.
      //fmi3SetIntervalFraction(s, ...); /*Only needed if interval changes*/ // [TODO]: To be set.
    };



    if (mode == eventMode) {
      status = fmi3NewDiscreteStates(s, &amp;s_eventInfo);
      if ((status == fmi3Fatal) || (status == fmi3Error)) break;
    }



    if(mode == stepMode) { // [TODO]: @Masoud recheck: continuousTimeMode --&gt; stepMode
      // Step Mode (default mode)
      tend = tc+step;
      t = tend*2;
      earlyReturn = fmi3False;
      status = fmi3DoStep(s, tc, step, fmi3False, &amp;earlyReturn); // [TODO]: noSetFMUStatePriorToCurrentPoint == fmi3False?

      switch (status) {
        case fmi3Discard:
          fmi3GetDoStepDiscardedStatus(s, &amp;discard, &amp;lastSuccessfulTime);
          if (discard == fmi3True) printf("Slave s wants to terminate simulation.");
        case fmi3Error:
        case fmi3Fatal:
          terminateSimulation = fmi3True;
          break;
        default:
          break;
      }

      if (terminateSimulation) break;



      if(earlyReturn) {
        t = s_intermediateUpdateInfo.intermediateUpdateTime;
        /*rollback FMUs to earliest event time*/
        fmi3EnterEventMode(s);
        if ((status == fmi3Fatal) || (status == fmi3Error)) break;
        mode = eventMode;
        tc = t;
      }
      else{
        tc = tend;
      };
    };



    if(s_intermediateUpdateInfo.clocksTicked) {
      //fmi3GetClock(s, ...); // [TODO]: To be set.
      //fmi3GetIntervalDecimal(s, /*Intervals*/,...); // [TODO]: To be set.
      //fmi3GetIntervalFraction(s, /*Intervals*/,...); // [TODO]: To be set.
    };



    if((mode == eventMode) &amp;&amp; (s_eventInfo.newDiscreteStatesNeeded == fmi3False) &amp;&amp; (1 /*no clocks from GetClock() are active*/)) { // [TODO]: To be set.
      status = fmi3EnterStepMode(s); // [TODO]: @Masoud recheck: EnterContinuousTimeMode --&gt; fmi3EnterStepMode
      if ((status == fmi3Fatal) || (status == fmi3Error)) break;
      mode = stepMode;
      //step = min(/*Intervals*/, s_eventInfo.nextEventTime); // [TODO]: To be set.
    };


    // Get outputs
    //fmi3GetReal/Integer/Boolean/String(s, ...); // [TODO]: To be set.
    // Set inputs
    //fmi3SetReal/Integer/Boolean/String(s, ...); // [TODO]: To be set.

  }


  //////////////////////////
  // Shutdown sub-phase
  if ((status != fmi3Error) &amp;&amp; (status != fmi3Fatal)) {
    fmi3Terminate(s);
  }

  if (status != fmi3Fatal) {
    fmi3FreeInstance(s);
  }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hybrid-co-simulation-schema">5.3. Description Schema</h3>
<div class="paragraph">
<p>The Co-Simulation master collects the information about the number and properties of <a href="#clock"><code>clocks</code></a> supported by the FMU by analyzing the <code>modelDescription.xml</code>, see <a href="#clock-type-definition">[clock-type-definition]</a>.</p>
</div>
<div class="paragraph">
<p>The definition of <a href="#clock"><code>clocks</code></a> is optional.</p>
</div>
<div class="paragraph">
<p>Each <a href="#inputClock"><code>input clock</code></a> that ticks outside of the FMU, is activated for an FMU based on their <a href="#valueReference"><code>valueReference</code></a>.
<a href="#outputClock"><code>Output clocks</code></a> inside of an FMU signal their activation based on their <a href="#valueReference"><code>valueReference</code></a>`.</p>
</div>
<div class="paragraph">
<p><em>[If <a href="#dependencies"><code>dependencies</code></a> (<code>fmi3Unknown</code>) are defined in the <code>ModelStructure</code> section of the <code>modelDescription.xml</code>, it is recommended to define such <a href="#dependencies"><code>dependencies</code></a> only within a model partition of a model (i.e. between variables that are assigned to the same <a href="#clock"><code>clock</code></a>).]</em></p>
</div>
<div class="paragraph">
<p>If <a href="#dependencies"><code>dependencies</code></a> are defined for variables across model partitions, such variables can not be assigned to a <a href="#clock"><code>clock</code></a> via <a href="#clockReference"><code>clockReference</code></a>.</p>
</div>
<div class="paragraph">
<p>For FMI for Co-Simulation, variables that are assigned to a model partition of the model based on <a href="#clockReference"><code>clockReference</code></a> are not necessarily <code>clocked</code>.
Such variables can be continuous-time or discrete-time variables if the <a href="#clock"><code>clock</code></a> is of <code>clockType = communicationPoint</code>.</p>
</div>
<div class="sect3">
<h4 id="xml-flags-clocked-co-simulation">5.3.1. Capability Flags</h4>
<div class="paragraph">
<p>If the XML file defines an FMU for Hybrid Co-Simulation, element <code>CoSimulation</code> must be present as described in section <a href="#fmi-for-basic-co-simulation">Section 4</a>.</p>
</div>
<div class="paragraph">
<p>In order to provide a Hybrid Co-Simulation, the attribute <code>providesHybridCoSimulation</code> has set to be set to <code>true</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="xml-example-clocked-co-simulation">5.3.2. Example XML Description File</h4>
<div class="paragraph">
<p>The example below is the same one as shown in <a href="#xml-example-co-simulation">Section 4.3.1</a> for a Co-Simulation FMU.
The only differences are, that <code>providesHybridCoSimulation</code> is set to <code>true</code> and <a href="#clock"><code>clocks</code></a> are defined in the <code>modelDescription.xml</code>. <mark>[TODO]: Recheck later</mark>
The XML file may have the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">//include::examples/co_simulation_clocked_cosimulation.xml[]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-scheduled-co-simulation">6. FMI for Scheduled Co-Simulation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="math-scheduled-co-simulation">6.1. Mathematical Description</h3>
<div class="paragraph">
<p>The Scheduled Co-Simulation interface has a different timing concept compared to the other two Co-Simulation interfaces.
This is required to cover <a href="#clock"><code>clock</code></a> ticks for aperiodic <a href="#inputClock"><code>input clocks</code></a> which may tick at time instances that are not predictable in advance for the simulation master.
Typically, hardware I/O or virtual ECU software events belong to this category.</p>
</div>
<div class="paragraph">
<p>A Co-Simulation master&#8217;s call for computing a model partition will compute the results of the model partition defined by an <a href="#inputClock"><code>input clock</code></a> for the current <a href="#clock"><code>clock</code></a> tick time \(t_i\).</p>
</div>
<div class="paragraph">
<p>The result values will be computed for the current <a href="#clock"><code>clock</code></a> tick time (activation time) \(t_i\) from the assigned <a href="#inputClock"><code>input clock</code></a> (which is known to the Co-Simulation master).
Refer to the <a href="#clock"><code>clock</code></a> time progress definition (<a href="#clock-types-for-evaluation-of-clocked-model-partitions">Section 2.1.8.1</a>) for periodic <a href="#clock"><code>clocks</code></a>.</p>
</div>
<div class="paragraph">
<p>If required, the FMU can internally derive the <a href="#clock"><code>clock</code></a> interval \(\Delta T_i\) based on the last <a href="#clock"><code>clock</code></a> tick time \(t_{i-1}\) i.e. last activation time for this model partition.</p>
</div>
<div class="paragraph">
<p>A model partition can only be activated once per activation time point \(t_i\).</p>
</div>
<div class="paragraph">
<p>Model partitions that are associated to <a href="#outputClock"><code>output clocks</code></a> will accordingly provide the result values of the model partition&#8217;s variables for the current <a href="#outputClock"><code>output clock</code></a> tick time \(t_i\) of the active <a href="#outputClock"><code>output clock</code></a>.
The activation of such a <a href="#outputClock"><code>output clock</code></a> is not directly controlled by the Co-Simulation master but internally by the FMU.</p>
</div>
</div>
<div class="sect2">
<h3 id="scheduled-co-simulation-api">6.2. Application Programming Interface</h3>
<div class="paragraph">
<p>This section contains the interface description for supporting the Scheduled Co-Simulation interface from a C program.</p>
</div>
<div class="paragraph">
<p>The direct scheduling of model partitions based on <a href="#clock"><code>clock</code></a> ticks requires an additional handling mode for FMUs.
The FMU signals its support for direct model partition scheduling in the <code>modelDescription.xml</code> via the flag <code>providesScheduledCoSimulation = true</code>.
The Co-Simulation master signals to the FMU that it supports and has recognized the <a href="#clock"><code>clock</code></a> and model partition scheduling capabilities of the FMU by instantiating it as Scheduled Co-Simulation.</p>
</div>
<div class="paragraph">
<p>If the flag <code>providesScheduledCoSimulation = false</code>, it is not allowed to use the Scheduled Co-Simulation interface.</p>
</div>
<div class="paragraph">
<p>If no <a href="#inputClock"><code>input clocks</code></a> are defined by the FMU it is not allowed to set <code>providesScheduledCoSimulation</code> to <code>true</code> in the <code>modelDescription.xml</code>.</p>
</div>
<div class="paragraph">
<p>Error, reset or terminate information is a global state of the FMU.
If e.g. an function returns <code>fmi3Discard</code> or <code>fmi3Error</code> this is also assumed for all active or preempted model partitions.
In case of <code>fmi3Discard</code> or <code>fmi3Error</code> no repetition of the step is possible, the only possible way to go forward is to enter the <strong>Terminated</strong> state and to end or to reset the simulation or - if supported - to set the FMU back to a former state.</p>
</div>
<div class="sect3">
<h4 id="_transfer_of_input_output_values_and_parameters_in_scheduled_co_simulation">6.2.1. Transfer of Input / Output Values and Parameters in Scheduled Co-Simulation</h4>
<div class="paragraph">
<p>The simulation master sets and gets variable values as defined in section <a href="#get-and-set-variable-values">Section 2.1.7</a>.</p>
</div>
<div class="paragraph">
<p>Before scheduling a model partition it is allowed to set all variables assigned to that model partition via its associated <a href="#clock"><code>clock</code></a> (including all global variables that are not associated to a <a href="#clock"><code>clock</code></a>) via <code>fmi3Set{VariableType}</code>.
After the computation of a model partition (call of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> with the <a href="#clockReference"><code>clockReference</code></a> of the <a href="#clock"><code>clock</code></a> that is associated to the model partition) all variables that are assigned to this model partition (including all global variables that are not associated to a <a href="#clock"><code>clock</code></a>) can be retrieved via <code>fmi3Get{VariableType}</code>.
Set/get operations have to be atomic for a single variable.</p>
</div>
<div class="paragraph">
<p><em>[The value of global variables can be influenced by more than one model partition if multiple model partitions are active at the same time.]</em></p>
</div>
<div class="paragraph">
<p>The computational effort has to be predictable, thus all computationally expensive operations needed to calculate a model partition have to be contained within the <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function.
The simulation master can assume that <code>fmi3Get{VariableType} and fmi3Set{VariableType}</code> operations are not computationally expensive.
In Scheduled Co-Simulation the handling of <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> callbacks is the same as in section <a href="#fmi-for-hybrid-co-simulation">Section 5</a>.
The only difference is that an early return has no meaning in this mode and  no additional event handling based on <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a> is conducted.
All internal events that shall be handled by the Co-Simulation master are signaled via <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>.
<em>[In this mode it is recommended to restrict such updates by the FMU to <a href="#outputClock"><code>output clock</code></a> ticks for reducing the computational load in real-time simulations.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_computation_in_scheduled_co_simulation">6.2.2. Computation in Scheduled Co-Simulation</h4>
<div class="paragraph">
<p>If this mode is set, the master has to directly control the time of computation of model partitions associated to <a href="#inputClock"><code>input clocks</code></a>.
The activation states of <a href="#outputClock"><code>output clocks</code></a> are transported via <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a> and <a href="#fmi3GetClock"><code>fmi3GetClock</code></a>.</p>
</div>
<div id="fmi3ActivateModelPartition" class="paragraph">
<p>Each <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call is now associated to the computation of a (publicly disclosed, externally controlled) model partition of the model and therefore to a single defined <a href="#inputClock"><code>input clock</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef fmi3Status fmi3ActivateModelPartitionTYPE(fmi3Instance instance,
                                                  fmi3ValueReference clockReference,
                                                  fmi3Float64 activationTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function has the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fmi3Instance instance</code>: same meaning as for other <code>fmi3*</code> functions</p>
</li>
<li>
<p><code>fmi3ValueReference</code> <a href="#clockReference"><code>clockReference</code></a>: <a href="#valueReference"><code>valueReference</code></a> of an <a href="#inputClock"><code>input clock</code></a> defined in the <code>modelDescription.xml</code> which shall be activated</p>
</li>
<li>
<p><code>fmi3Float64 activationTime</code>: simulation (i.e. virtual) time of the <a href="#clock"><code>clock</code></a> tick</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Scheduling of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> calls for each FMU is done by the simulation master.
Calls are based on ticks of periodic or aperiodic <a href="#inputClock"><code>input clocks</code></a>.
These <a href="#inputClock"><code>input clock</code></a> ticks can be based on <a href="#clock"><code>clock</code></a> ticks from FMU external sources (e.g. <a href="#outputClock"><code>output clocks</code></a> of other FMUs) or other external <a href="#clock"><code>clocks</code></a>/events/interrupts assigned via the simulation master configuration (such external events can be based on a potentially unpredictable process or can be just simulation time based events e.g. the planned communication point).
The <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function is not called for <a href="#outputClock"><code>output clocks</code></a> of an FMU.</p>
</div>
<div class="paragraph">
<p>The value for the <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> parameter <code>activationTime</code> is the <a href="#clock"><code>clock</code></a> tick time \(t_i\) from the  assigned <a href="#inputClock"><code>input clock</code></a> (which is known to the Co-Simulation master).</p>
</div>
<div class="paragraph">
<p>Refer to <a href="#math-scheduled-co-simulation">Section 6.1</a> and <a href="#clock-types-for-evaluation-of-clocked-model-partitions">Section 2.1.8.1</a>.</p>
</div>
<div class="paragraph">
<p>This is a different timing concept compared to <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> calls.
A <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call will compute the results of the model partition defined by <a href="#clockReference"><code>clockReference</code></a> (i.e. <a href="#valueReference"><code>valueReference</code></a> of the variable that defines a <a href="#clock"><code>clock</code></a>) for the current <a href="#clock"><code>clock</code></a> tick \(t_i\).</p>
</div>
<div class="paragraph">
<p>The value for the <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> parameter <code>activationTime</code> is the <a href="#clock"><code>clock</code></a> tick time \(t_i\) from the assigned <a href="#inputClock"><code>input clock</code></a> (which is known to the Co-Simulation master).
Refer to the <a href="#clock"><code>clock</code></a> time progress definition (<a href="#clock-types-for-evaluation-of-clocked-model-partitions">Section 2.1.8.1</a>) for periodic <a href="#clock"><code>clocks</code></a>.</p>
</div>
<div class="paragraph">
<p>If required, the FMU can internally derive the <a href="#clock"><code>clock</code></a> interval \(\Delta T_i\) based on the last <a href="#clock"><code>clock</code></a> tick time \(t_{i-1}\) i.e. last activationTime for this <a href="#clockReference"><code>clockReference</code></a> (based on last <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call).</p>
</div>
<div class="paragraph">
<p>It is not allowed to call <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> for a <a href="#clockReference"><code>clockReference</code></a> (i.e. <a href="#valueReference"><code>valueReference</code></a> of <a href="#clock"><code>clock</code></a> variable) more than once for the same activationTime \(t_i\).</p>
</div>
</div>
<div class="sect3">
<h4 id="_state_machine_for_scheduled_co_simulation">6.2.3. State Machine for Scheduled Co-Simulation</h4>
<div class="paragraph">
<p>This section summarizes the available states and the allowed function calls in the respective states.
All states must not be entered or exited concurrently for model partitions of an FMU but only for the whole FMU instance.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/state-machine-scheduled-co-simulation.svg" alt="state machine scheduled co simulation" width="80%">
</div>
<div class="title">Figure 10: Calling sequence of Scheduled Co-Simulation.</div>
</div>
<div class="paragraph">
<p>In Scheduled Co-Simulation the following functions must not be called: <a href="#fmi3DoStep"><code>fmi3DoStep</code></a>, <a href="#fmi3NewDiscreteStates"><code>fmi3NewDiscreteStates</code></a>, <a href="#fmi3SetClock"><code>fmi3SetClock</code></a>, <a href="#fmi3SetIntervalDecimal"><code>fmi3SetIntervalDecimal</code></a>, <a href="#fmi3SetIntervalFraction"><code>fmi3SetIntervalFraction</code></a>, <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a>, <a href="#fmi3EnterEventMode"><code>fmi3EnterEventMode</code></a>, <a href="#fmi3EnterStepMode"><code>fmi3EnterStepMode</code></a> including all functions that are specific to the Model Exchange interface.</p>
</div>
<div class="paragraph">
<p>The states <strong>Configuration Mode</strong>, <strong>Instantiated</strong>, <strong>Initialization Mode</strong>, and <strong>Terminated</strong> are handled in the same way as in Co-Simulation, with the exception that the generally not allowed functions of Scheduled Co-Simulation must not be called.</p>
</div>
<div class="sect4">
<h5 id="_state_slave_settable_fmu_state">6.2.3.1. State: Slave Settable FMU State</h5>
<div class="paragraph">
<p>In all states of this super state it is allowed to call <a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a>, <code>fmi3SetFMUState</code>, <code>fmi3FreeFMUState</code>, <a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a>, <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a>, <a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a>, <a href="#fmi3Reset"><code>fmi3Reset</code></a>, <a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a>, <code>fmi3SetDebugLogging</code> and <a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a>.</p>
</div>
<div class="paragraph">
<p>If any function returns with <code>fmi3Fatal</code> the FMU enters the terminal state.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_slave_under_evaluation_2">6.2.3.2. State: Slave Under Evaluation</h5>
<div class="paragraph">
<p>This super state is entered by the FMU when <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a> is called.
If any function returns <code>fmi3Error</code> or <code>fmi3Discard</code> the FMU enters state <strong>Terminated</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_slave_initialized_2">6.2.3.3. State: Slave Initialized</h5>
<div class="paragraph">
<p>This super state is entered by the FMU when <code>fmi3ExitInitializatoinMode</code> is called.
If the function <a href="#fmi3Terminate"><code>fmi3Terminate</code></a> is called, the FMU enters state <strong>Terminated</strong> from all states of this super state.
The FMU enters state <strong>Terminated</strong> only after all other tasks related to the computation of model partitions of this FMU have ended.
After <a href="#fmi3Terminate"><code>fmi3Terminate</code></a> has been called no new tasks can be started (e.g. related to <a href="#outputClock"><code>output clock</code></a> ticks) and all other function calls for this FMU must return <code>fmi3Error</code> until the state <strong>Terminated</strong> is reached.</p>
</div>
</div>
<div class="sect4">
<h5 id="_state_clock_activation_mode">6.2.3.4. State: Clock Activation Mode</h5>
<div class="paragraph">
<p>The FMU enters this state when the master calls <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a> in state <strong>Initialization Mode</strong> or <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a> in state <strong>Reconfiguration Mode</strong>.
In this state the master can create multiple concurrent tasks related to an FMU and in each task the master can activate one or multiple <a href="#inputClock"><code>input clocks</code></a> of an FMU based on the defined <a href="#clock"><code>clock</code></a> properties via a <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call for each <a href="#clock"><code>clock</code></a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dt class="hdlist1"><a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a></dt>
<dd>
<p>If the function returns with <code>fmi3OK</code> or <code>fmi3Warning</code> the FMU stays in this state.
In case of <code>fmi3Fatal</code> the master can prematurely end all tasks related to the computation of model partitions of this FMU.
In case of <code>fmi3Discard</code> or <code>fmi3Error</code> the master must wait until all other tasks related to the computation of model partitions of this FMU have ended, but no new tasks can be started (e.g. related to <a href="#outputClock"><code>output clock</code></a> tick) and all other function calls for this FMU must also return <code>fmi3Discard</code> or <code>fmi3Error</code> until the state <strong>Terminated</strong> is reached.</p>
<div class="paragraph">
<p>It is recommended to call <code>fmi3Set{VariableType}</code> and <code>fmi3Get{VariableType}</code> in the same task as <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> for setting and retrieving variable values associated to a <a href="#clock"><code>clock</code></a> activation.</p>
</div>
</dd>
<dt class="hdlist1"><a href="#get-and-set-variable-values">fmi3Set{VariableType}</a>, <code>fmi3SetInputDerivatives</code></dt>
<dd>
<p>Is called before the start of the computation of a model partition (i.e. before call of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>) and only for global variables and variables associated to the <a href="#inputClock"><code>input clock</code></a> assigned to the model partition.</p>
<div class="paragraph">
<p>The restrictions related to variable <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a> defined for <strong>Step Mode</strong> in <code>fmi3CoSimulation</code> apply.</p>
</div>
<div class="paragraph">
<p>If the function returns with <code>fmi3OK</code> or <code>fmi3Warning</code> the FMU stays in this state.
In case the function returns <code>fmi3Fatal</code> the master can prematurely end all tasks related to the computation of model partitions of this FMU.
In case the function returns <code>fmi3Discard</code> or <code>fmi3Error</code> the master must wait until all other tasks related to the computation of the model partitions of this FMU have ended, but new tasks must not be started (e.g. related to <a href="#outputClock"><code>output clock</code></a> ticks) and all other function calls for this FMU must also return <code>fmi3Discard</code> or <code>fmi3Error</code> until the state <strong>Terminated</strong> is reached.</p>
</div>
</dd>
<dt class="hdlist1"><a href="#get-and-set-variable-values">fmi3Get{VariableType}</a>, <code>fmi3GetOutputDerivatives</code>, <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>`</dt>
<dd>
<p>Is called after the end of the computation of a model partition (i.e. after return of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>) and only for global variables and variables associated to the <a href="#inputClock"><code>input clock</code></a> assigned to the model partition.</p>
<div class="paragraph">
<p>The restrictions related to variable <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a> defined for <strong>Step Mode</strong> in <code>fmi3CoSimulation</code> apply.</p>
</div>
<div class="paragraph">
<p>If the function returns with <code>fmi3OK</code> or <code>fmi3Warning</code> the FMU stays in this state.
In case the function returns <code>fmi3Fatal</code> the master can prematurely end all tasks related to the computation of model partitions of this FMU.
In case the function returns <code>fmi3Discard</code> or <code>fmi3Error</code> the master must wait until all other tasks related to the computation of model partitions of this FMU have ended, but new tasks must not be started (e.g. related to <a href="#outputClock"><code>output clock</code></a> ticks) and all other function calls for this FMU have to also return <code>fmi3Discard</code> or <code>fmi3Error</code> until the state <strong>Terminated</strong> is reached.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It is not allowed to call <code>fmi3Get{VariableType}</code> functions after <code>fmi3Set{VariableType}</code> functions without an <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> call in between.</p>
</div>
<div class="paragraph">
<p><em>[The reason is to avoid different interpretations of the caching, since contrary to FMI for Model Exchange, <a href="#fmi3DoStep"><code>fmi3DoStep</code></a> will perform the actual calculation instead of <code>fmi3Get{VariableType}</code>, and therefore, dummy algebraic loops at communication points cannot be handled by an appropriate sequence of <code>fmi3Get{VariableType}</code> and, <code>fmi3Set{VariableType}</code> calls as for Model Exchange.</em></p>
</div>
<div class="paragraph">
<p><em>Example:</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Correct calling sequence for a model partition of an FMU</em></th>
<th class="tableblock halign-left valign-top"><em>Wrong calling sequence</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi3Set{VariableType} on inputs</em><br>
fmi3ActivateModelPartition<br>
<em>fmi3Get{VariableType} on outputs</em><br>
<em>fmi3Set{VariableType} on inputs</em><br>
fmi3ActivateModelPartition<br>
<em>fmi3Get{VariableType} on outputs</em><br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi3Set{VariableType} on inputs</em><br>
fmi3ActivateModelPartition<br>
<em>fmi3Get{VariableType} on outputs</em><br>
<em>fmi3Set{VariableType} on inputs</em><br>
<em>fmi3Get{VariableType} on outputs // not allowed</em><br>
fmi3ActivateModelPartition<br>
<em>fmi3Get{VariableType} on outputs</em><br></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a></dt>
<dd>
<p>Only in this state the FMU is allowed to call the callback <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>.
The callback may be called from concurrent tasks within <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>.
The function must not return <code>fmi3Discard</code>.</p>
</dd>
<dt class="hdlist1"><a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a></dt>
<dd>
<p>This function must not be called if the FMU contains no <a href="#structuralParameter"><code>structural parameters</code></a> or other tasks related to the computation of model partitions of this FMU are currently active or preempted.
Thus this function can not be called concurrently for model partitions of an FMU but only for the whole FMU instance.</p>
<div class="paragraph">
<p>If the function returns with <code>fmi3OK</code> or <code>fmi3Warning</code> the FMU goes into state <strong>Reconfiguration Mode</strong>.</p>
</div>
</dd>
<dt class="hdlist1"><code>fmi3Terminate</code>, <code>fmi3Reset</code>, <a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a></dt>
<dd>
<p>These functions can not be called concurrently for model partitions of an FMU but only for the whole FMU instance.
If these functions are called while a model partition of an FMU is currently active or preempted, the FMU changes its state after the computation of all model partitions of this FMU has ended.</p>
</dd>
<dt class="hdlist1"><a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a>, <a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a>, <a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a>,<a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a>, <a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a>, <a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a></dt>
<dd>
<p>Can be called if no other task related to the computation of model partitions of this FMU is currently active or preempted and the prerequisites defined for these functions in <code>fmi3CoSimulation</code> are fulfilled.
Thus these functions can not be called concurrently for model partitions of an FMU but only for the whole FMU instance.</p>
</dd>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p>Additionally to the generally forbidden functions in Scheduled Co-Simulation as listed above, the following functions must not be called in this state: <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>, <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>, <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, <a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_state_intermediate_update_mode_2">6.2.3.5. State: Intermediate Update Mode</h5>
<div class="paragraph">
<p>In this state the master can retrieve information from the FMU between communication points.
Functions called in this state must not return <code>fmi3Discard</code>.</p>
</div>
<div class="paragraph">
<p>The FMU enters this state by calling <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>  within <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> and leaves the state towards state <strong>Clock Activation Mode</strong> if the function returns <code>fmi3OK</code> or <code>fmi3Warning</code>.
If the function returns <code>fmi3Error</code> the FMU enters state <strong>Terminated</strong>.
If the function returns <code>fmi3Fatal</code> the FMU enters the terminal state.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p>The same functions which are not allowed to be called in <strong>Clock Activation Mode</strong> must not be called in this state. Additionally the following functions must not be called <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>, <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a>, <a href="#fmi3Terminate"><code>fmi3Terminate</code></a>.</p>
</dd>
<dt class="hdlist1">Allowed Function Calls</dt>
<dd>
<p>For a <a href="#outputClock"><code>output clock</code></a> only the first call of <code>fmi3GetClock</code> for a specific activation of this <a href="#clock"><code>clock</code></a> signals <code>fmi3True</code>.
The FMU sets the reported activation state immediately back to <code>fmi3False</code> for the following <code>fmi3GetClock</code> calls for that <a href="#clock"><code>clock</code></a> (in the same or other model partitions of the FMU) until this <a href="#outputClock"><code>output clock</code></a> is internally activated again.
The master can call <code>fmi3Set{VariableType}</code> and <code>fmi3Get{VariableType}</code> during the callback for variables associated to a <a href="#outputClock"><code>output clock</code></a> that is active during this callback.
Also intermediate variable access is allowed as defined in <a href="#state-intermediate-update-mode-co-simulation">Section 4.2.4.7</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>[Based on the FMI standard it cannot be determined which part of the code of an FMU has called the callback function <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>.</em>
<em>This is especially the case for Scheduled Co-Simulation where multiple model partitions can be active at the same time.</em>
<em>This causes no issues since all function call prerequisites are connected to the activation state of <a href="#clock"><code>clocks</code></a>, <code>modelDescription.xml</code> information and additionally available information from <a href="#fmi3CallbackIntermediateUpdate"><code>fmi3CallbackIntermediateUpdate</code></a>]</em></p>
</div>
</div>
<div class="sect4">
<h5 id="_state_reconfiguration_mode_2">6.2.3.6. State: Reconfiguration Mode</h5>
<div class="paragraph">
<p>In this state <a href="#structuralParameter"><code>structural parameters</code></a> with <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a> can be changed.
This state is entered from state <strong>Clock Activation Mode</strong> by calling <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a> and left back to <strong>Clock Activation Mode</strong> by calling <a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Allowed Function Calls</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#fmi3ExitConfigurationMode"><code>fmi3ExitConfigurationMode</code></a></p>
</li>
<li>
<p><code>fmi3Set{VariableType}</code>: Only for variables with <a href="#causality"><code>causality</code></a> = <a href="#structuralParameter"><code>structuralParameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Forbidden Function Calls</dt>
<dd>
<p>Additionally to the generally forbidden functions in Scheduled Co-Simulation listed above the following functions must not be called in this state: <a href="#fmi3EnterConfigurationMode"><code>fmi3EnterConfigurationMode</code></a>, <a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a>, <a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a>, <a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a>, <a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a>, <a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a>, <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>,<code>fmi3SetInputDerivatives</code>, <a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a>, <code>fmi3GetOutputDerivatives</code>, <code>fmi3Get{VariableType}</code>, <a href="#fmi3DoEarlyReturn"><code>fmi3DoEarlyReturn</code></a></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-bottom" rowspan="2"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="10"><p class="tableblock"><strong>FMI 3.0 for Scheduled Co-Simulation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Start, End</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Instantiated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Initialization Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Configuration Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Clock Activation Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Reconfiguration Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Intermediate Update Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Terminated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Error</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Fatal</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetVersion"><code>fmi3GetVersion</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetDebugLogging"><code>fmi3SetDebugLogging</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Instantiate"><code>fmi3Instantiate</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3FreeInstance"><code>fmi3FreeInstance</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetupExperiment"><code>fmi3SetupExperiment</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3EnterInitializationMode"><code>fmi3EnterInitializationMode</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3ExitInitializationMode"><code>fmi3ExitInitializationMode</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Terminate"><code>fmi3Terminate</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3Reset"><code>fmi3Reset</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetFMUState"><code>fmi3GetFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SetFMUState"><code>fmi3SetFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3FreeFMUState"><code>fmi3FreeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SerializedFMUStateSize"><code>fmi3SerializedFMUStateSize</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3SerializeFMUState"><code>fmi3SerializeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3DeSerializeFMUState"><code>fmi3DeSerializeFMUState</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#fmi3GetDirectionalDerivative"><code>fmi3GetDirectionalDerivative</code></a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3SetInputDerivatives"><code>fmi3SetInputDerivatives</code></a>  </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3GetOutputDerivatives"><code>fmi3GetOutputDerivatives</code></a> </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock"><a href="#fmi3GetDoStepDiscardedStatus"><code>fmi3GetDoStepDiscardedStatus</code></a> </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>x</strong> means: call is allowed in the corresponding state<br>
<strong>number</strong> means: call is allowed if the indicated condition holds:<br>
<strong>1</strong> for a variable with <a href="#variability"><code>variability</code></a> \(\neq\) <a href="#constant"><code>constant</code></a> that has <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a> or <a href="#approx"><code>approx</code></a><br>
<strong>2</strong> for a variable with <a href="#causality"><code>causality</code></a> = <a href="#output"><code>output</code></a> or continuous-time states or state derivatives
(if element <code>&lt;ModelStructure&gt;&lt;Derivative&gt;</code> is present)<br>
<strong>3</strong> for a variable with <a href="#variability"><code>variability</code></a> = <a href="#constant"><code>constant</code></a> that has <a href="#initial"><code>initial</code></a> = <a href="#exact"><code>exact</code></a>,
or <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a><br>
<strong>6</strong> for a variable with <a href="#causality"><code>causality</code></a> = <a href="#input"><code>input</code></a> or (<a href="#causality"><code>causality</code></a> = <a href="#parameter"><code>parameter</code></a> and <a href="#variability"><code>variability</code></a> = <a href="#tunable"><code>tunable</code></a>)<br>
<strong>7</strong> always, but retrieved values are usable for debugging only<br>
<strong>8</strong> always, but if status is other than <code>fmi3Terminated</code>,
retrieved values are usable for debugging only ]_</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="preemption-support">6.2.4. Preemption Support</h4>
<div class="paragraph">
<p>For real-time applications the simulation time equals the real wall <a href="#clock"><code>clock</code></a> time, thus each <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> computation step has to be finished in real-time within its current period time length (computation time is not only defined by the runtime of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> but also by the time for setting and getting variables and related operations).
Usually a preemptive scheduling of the <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>, <code>fmi3Get{VariableType}</code>, <code>fmi3Set{VariableType}</code> calls is required for respecting this constraint.</p>
</div>
<div class="paragraph">
<p>The FMU&#8217;s code has to be prepared for being able to correctly handle preemptive calls of <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>, <code>fmi3Get{VariableType}</code>, <code>fmi3Set{VariableType}</code>.
That requires a secured internal and external access to global states and variable values.
Thus in Scheduled Co-Simulation a support for a correct handling of the preemption of model partition computations is required.
That also requires that the FMU reports the active state of a <a href="#outputClock"><code>output clock</code></a> only with the first call of <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> for a specific activation of this <a href="#clock"><code>clock</code></a> and sets the reported activation state immediately back to <code>false</code> for the following <a href="#fmi3GetClock"><code>fmi3GetClock</code></a> calls for that <a href="#clock"><code>clock</code></a> until this <a href="#outputClock"><code>output clock</code></a> is internally activated again.</p>
</div>
<div class="paragraph">
<p>If a preemptive multitasking regime is intended an individual task (or thread&#8201;&#8212;&#8201;task and thread are used synonymously here) for each model partition (associated to an <a href="#inputClock"><code>input clock</code></a>) has to be created.
The task for computing each <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> is created and controlled by the simulation master, not by the FMU.
So the FMU exporting tool does not need to take care for that (except for preparing its code to support preemption).</p>
</div>
<div class="paragraph">
<p><em>[If only one single model partition (<a href="#inputClock"><code>input clock</code></a>) is available via the interface of an FMU, preemptive calls of the related <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> function are possible by default since there are no external cross dependencies within one model partition between communication points.]</em></p>
</div>
<div class="paragraph">
<p>Based on the <a href="#inputClock"><code>input clock</code></a> settings defined in the XML the master calls <code>fmi3Set{VariableType}</code>, <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a>, <code>fmi3Get{VariableType}</code> calls.
Set/get calls for each task are only allowed for variables that are associated to the <a href="#inputClock"><code>input clock</code></a> associated to that task or - here preemption issues become important - to variables that are associated to no <a href="#clock"><code>clocks</code></a> (global variables), based on the XML information (see <a href="#clock-type-definition">[clock-type-definition]</a>).</p>
</div>
<div class="paragraph">
<p><em>[The recommendation is to avoid global variable associations as much as possible in the XML.</em>
<em>It is also recommended to reduce dependencies (defined in XML model structure) between variables located in different model partitions of one FMU, since this also requires in most cases that the related variables have to be global variables.]</em></p>
</div>
<div class="paragraph">
<p>The Co-Simulation master has no knowledge about the FMU internal communication between the model partitions of a single FMU and does not handle it.</p>
</div>
<div class="paragraph">
<p>The simulation master schedules the <a href="#fmi3ActivateModelPartition"><code>fmi3ActivateModelPartition</code></a> (as well as related <code>fmi3Get{VariableType}</code> and <code>fmi3Set{VariableType}</code>) calls based on given priorities for <a href="#inputClock"><code>input clocks</code></a> defined in the <code>modelDescription.xml</code>.</p>
</div>
<div class="paragraph">
<p>Priority (see <a href="#clock-type-definition">[clock-type-definition]</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Same priority: Tasks cannot preempt each other. Arbitrary execution order is possible for tasks of the same priority.</p>
</li>
<li>
<p>Different priorities: Tasks of a higher priority preempt tasks of a lower priority as soon as the higher priority task needs to be computed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[If multiple tasks are needed to be scheduled for computation at a certain time instant a master must schedule a task of a higher priority always before a task of a lower priority]</em></p>
</div>
<div class="paragraph">
<p><a href="#input"><code>Input</code></a> <a href="#clock"><code>clock</code></a> ticks (see <a href="#variants-of-clocks">Section 2.1.8.2</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(strict) periodic (period can be predefined by FMU or be defined by master, depending on XML information)</p>
</li>
<li>
<p>aperiodic (based on external possibly unpredictable events)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Based on the period and priority definitions the exporting tool can restrict the code execution order.
It nevertheless has to secure its code against concurrent execution <em>[not against parallel execution, as this is not supported for model partitions of an FMU in the interface description of this mode]</em> along the defined priority restrictions.
Mostly this is required for internal inter-model-partition communication and in general for the joint use of global variables within the FMU.
The exporting tool has to consider external events i.e. interrupts (if <a href="#input"><code>input</code></a> aperiodic <a href="#clock"><code>clocks</code></a> are defined) and the influences of computing speed, so the exact preemption occurrence points cannot be foreseen (within the given priority and period restrictions).</p>
</div>
<div class="paragraph">
<p>To provide more options to secure the code against unwanted preemption new callback functions are defined that can be used to prevent preemption for certain code parts.
If <code>providesScheduledCoSimulation = true</code> the default setting is that preemption is permitted.
The preemption lock has to be actively locked and unlocked in the FMU&#8217;s code.
Such locks should be used with care and only for securing very short code parts that cannot be secured otherwise.</p>
</div>
<div class="paragraph">
<p>A lock can be created and released to prevent preemption of that task (i.e. model partition):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">typedef void       (*fmi3CallbackLockPreemption)   ();
typedef void       (*fmi3CallbackUnlockPreemption) ();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even if the Co-Simulation master does not support preemption and Scheduled Co-Simulation, at least an empty implementation of these callback functions is required.</p>
</div>
<div class="paragraph">
<p>Example for the use of <code>fmi3CallbackLockPreemption</code> and <code>fmi3CallbackUnlockPreemption</code> callback functions in the FMU code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="C" class="language-C hljs">Int16 DataBuffer[3];   // global buffer


void Task1(void) //low priority
{
   ...
   // write data to DataBuffer
   fmi3CallbackLockPreemption();
   DataBuffer[0] = internal_out_RootSys1_1;
   DataBuffer[1] = internal_out_RootSys1_2;
   DataBuffer[2] = internal_out_RootSys1_3;
   fmi3CallbackUnlockPreemption();
   ...
 }

...
void Task2(void) //high priority
{
   ...
   // read data from DataBuffer
   fmi3CallbackLockPreemption();
   internal_in_RootSys2_1 = DataBuffer[0];
   internal_in_RootSys2_2 = DataBuffer[1];
   internal_in_RootSys2_3 = DataBuffer[2];
   fmi3CallbackUnlockPreemption();
   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pseudo_code_example_for_scheduled_co_simulation">6.2.5. Pseudo-code Example for Scheduled Co-Simulation</h4>
<div class="paragraph">
<p>In the following example, the usage of the FMI functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
The example is given in a mix of pseudo-code and C, in order to keep it small and understandable.
We consider one slave with three model partitions. Two model partitions associated to two periodic <a href="#inputClock"><code>input clocks</code></a> (<a href="#clock"><code>clock</code></a> periods 1 ms and 2 ms) and one aperiodic <a href="#inputClock"><code>input clock</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="c" class="language-c hljs">//////////////////////////
// Define callback

// Global variables
fmi3IntermediateUpdateInfo s1_intermediateInfo;

// Callback

//Remark:
//pointer for intermediateInfo has to be unique for each model partition that calls s1_triggeredClock_intermediateUpdate
//currently no clockIndex information is transported with intermediateInfo.
//Thus it is required to a) that the FMU secures (via lockPreemption, unlockPreemption) the call of fmi3GetClock()
//b) fmi3GetClock() sets back the activation state of the triggered clock
fmi3Status s1_triggeredClock_intermediateUpdate(fmi3InstanceEnvironment instance, fmi3IntermediateUpdateInfo* intermediateUpdateInfo)
{
	//local variables;
	fmi3Boolean triggered_clockStatesS1[];
	fmi3ValueReference triggered_clockReferenceS1[];
	size_t nclocks;

	// Save intermediateInfo for later use
	 s1_intermediateInfo = *intermediateUpdateInfo;
	 if (s1_intermediateInfo.clocksTicked)
	 {
		s1_fmi3GetClocks(s1, triggered_clockReferenceS1, nclocks, triggered_clockStatesS1);
		s1_fmi3GetReal/Integer/Boolean/String(s1, variables_associated_to_active_triggered_clock);
	 }

	 //evaluate which triggered clocks have ticked and are associated via clockReference to inferred clocks
	 inferredClockReferences = getActiveClocksForFMU(ID1,triggered_clockReferenceS1,triggered_clockStatesS1);
	 for (index=0,count(inferredClockReferences),index++)
	 {
		//call os function to schedule a fmi3ActivateModelPartiton() call together with associated get/set calls
		//In this case clock 2 (defined in modelDescription.XML via valueReference)
		//(--&gt; see functions s1_Execute_clockIndex2 and s2_Execute_clockIndex2)
		scheduleTaskForInferredClock(inferredClockReferences[index]);
	 }

 	 if (s1_intermediateInfo.clocksTicked)
	 {
		s1_fmi3SetReal/Integer/Boolean/String(s1, variables_associated_to_active_triggered_clock);
	 }

}


// Set callback functions,
fmi3CallbackFunctions cbf1;
fmi3EventInfo eventInfo;

//////////////////////////
// Initialization sub-phase
fmi3Status GlobalInitialize()
{

	cbf1.logger = loggerFunction; // Logger function
	cbf1.allocateMemory = calloc;
	cbf1.freeMemory = free;
	cbf1.intermediateUpdate = s1_triggeredClock_intermediateUpdate;
	cbf1.lockPreemption = lockPreemption(); // Preemption is OS specific
	cbf1.unlockPreemption = unlockPreemption(); // Preemption is OS specific

	// Create pointer to information for identifying the FMU in callbacks
	// (note: this is pseudo code, no correct pointer handling)
	cbf1.instanceEnvironment = NULL

	//set Co-Simulation mode
	fmi3CoSimulationConfiguration coSimulationConfiguration;
	coSimulationConfiguration.intermediateVariableGetRequired = false;
	coSimulationConfiguration.intermediateInternalVariableGetRequired = false;
	coSimulationConfiguration.intermediateVariableSetRequired = false;
	coSimulationConfiguration.coSimulationMode = fmi3ModeScheduledCoSimulation;

	// Instantiate slave 1
	fmi3Instance s1 = s1_fmi3Instantiate("Tool1" , fmi3CoSimulation, ID1, "", &amp;cbf1, fmi3False, fmi3True, &amp;coSimulationConfiguration);


	if (s1 == NULL) then return FAILURE;


	// Set all variable start values (of "ScalarVariable / &lt;type&gt; / start")
	s1_fmi3SetReal/Integer/Boolean/String(s1, ...);

	// Initialize slaves
	s1_fmi3SetupExperiment(s1, fmi3False, 0.0, startTime, fmi3True, stopTime);

	s1_fmi3EnterInitializationMode(s1);


	// Set the input values at time = startTime
	s1_fmi3SetReal/Integer/Boolean/String(s1, ...);

	s1_fmi3ExitInitializationMode(s1);


	// Get all outputs (for better readability only Real variables are used here. Handling for Integer, Boolean, String is the same)
	s1_fmi3GetReal(s1, yr1_c0); // variable associated to clockIndex 0
	s1_fmi3GetReal(s1, yr1_c1); // variable associated to clockIndex 1
	s1_fmi3GetReal(s1, yr1_c2); // variable associated to clockIndex 2
}

//////////////////////////
// Simulation sub-phase

// Step function for 1ms task. Assuming that both FMUs contain a clock for 1ms (clockIndex=0)
fmi3Status Execute_1ms()
{
	 ur1_c0 = yr1_c0;

	 // Set inputs associated to clockIndex 0
	 s1_fmi3SetReal(s1, ur1_c0);


	 // call step functions for clockIndex 0
	 status1 = fmi3ModelPartitionActivation(s1, 0, activationTime, currentTime);

  	 // Get outputs associated to clockIndex 0
	 s1_fmi3GetReal(s1, yr1_c0);
};

// Step function for 2ms task. Assuming that both FMUs contain a clock for 2ms (clockIndex=1)
fmi3Status Execute_2ms()
{
	 ur1_c1 = yr1_c1;

	 // Set inputs associated to clockIndex 1
	 s1_fmi3SetReal(s1, ur1_c1);


	 // call step functions for clockIndex 1
	 status1 = s1_fmi3ModelPartitionActivation(s1, 1, activationTime, currentTime);

  	 // Get outputs associated to clockIndex 1
	 s1_fmi3GetReal(s1, yr1_c1);
}

// Step function for s1 for inferred clock with clockIndex=2.
fmi3Status s1_Execute_clockIndex2(activationTime, currentTime)
{
	 ur1_c2 = yr1_c2;

	 // Set inputs associated to clockIndex 2
	 s1_fmi3SetReal(s1, ur1_c2);

	 // call step functions for clockIndex 2
	 status = s1_fmi3ModelPartitionActivation(s1, 2, activationTime, currentTime);

  	 // Get outputs associated to clockIndex 2
	s1_fmi3GetReal(s1, yr1_c2);
}

//////////////////////////
// Shutdown sub-phase
fmi3Status GlobalTerminate(status)
{
	if ((status1 != fmi3Error) and (status1 != fmi3Fatal)) then fmi3Terminate(s1);

	if (status1 != fmi3Fatal) then fmi3FreeInstance(s1);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scheduled-co-simulation-schema">6.3. Description Schema</h3>
<div class="paragraph">
<p>The simulation master collects the information about the number and properties of <a href="#clock"><code>clocks</code></a> supported by the FMU via analyzing the <code>modelDescription.xml</code> as defined in section 2.2. and 4.3.</p>
</div>
<div class="paragraph">
<p>Each <a href="#clock"><code>clock</code></a> that ticks outside of the FMU is activated for an FMU based on its <a href="#clockReference"><code>clockReference</code></a>.
There is a direct one-to-one relation for a <a href="#clock"><code>clock</code></a> and a model partition.</p>
</div>
<div class="paragraph">
<p>If <a href="#clock"><code>clocks</code></a> are defined and the flag <code>providesScheduledCoSimulation = true</code>, the Co-Simulation master can use the Scheduled Co-Simulation interface.
If no <a href="#inputClock"><code>input clocks</code></a> are defined, the flag <code>providesScheduledCoSimulation</code> shall not be set to <code>true</code>.</p>
</div>
<div class="sect3">
<h4 id="_example_xml_description_file_2">6.3.1. Example XML Description File</h4>
<div class="paragraph">
<p>The example below is the same one as shown in section [TBD] for a <code>fmi3ClockedCoSimulation</code> FMU.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">//include::examples/co_simulation_scheduled_execution.xml[]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_literature">7. Literature</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="ABL12"></a>[ABL12] &#197;kesson J., Braun W., Lindholm P., and Bachmann B. (2012): <strong>Generation of Sparse Jacobians for the Functional Mockup Interface 2.0</strong>. 9th International Modelica Conference, Munich, 2012. <a href="http://www.ep.liu.se/ecp/076/018/ecp12076018.pdf" class="bare">http://www.ep.liu.se/ecp/076/018/ecp12076018.pdf</a></p>
</li>
<li>
<p><a id="BPRS15"></a>[BPRS15] Atilim Gunes Baydin, Barak A. Pearlmutter, Alexey Andreyevich Radul, Jeffrey Mark Siskind (2015): <strong>Automatic differentiation in machine learning: a survey</strong>. <a href="https://arxiv.org/abs/1502.05767" class="bare">https://arxiv.org/abs/1502.05767</a></p>
</li>
<li>
<p><a id="BCP10"></a>[BCP10] Benveniste A., Caillaud B., Pouzet M. (2010): <strong>The Fundamentals of Hybrid Systems Modelers</strong>. In 49th IEEE International Conference on Decision and Control (CDC), Atlanta, Georgia, USA, December 15-17. <a href="http://www.di.ens.fr/~pouzet/bib/cdc10.pdf" class="bare">http://www.di.ens.fr/~pouzet/bib/cdc10.pdf</a></p>
</li>
<li>
<p><a id="BOA11"></a>[BOA11] Blochwitz T., Otter M., Arnold M., Bausch C., Clau&#223; C., Elmqvist H., Junghanns A., Mauss J., Monteiro M., Neidhold T., Neumerkel D., Olsson H., Peetz J.-V., Wolf S. (2011): <strong>The Functional Mockup Interface for Tool independent Exchange of Simulation Models</strong>. 8th International Modelica Conference, Dresden 2011. <a href="http://www.ep.liu.se/ecp/063/013/ecp11063013.pdf" class="bare">http://www.ep.liu.se/ecp/063/013/ecp11063013.pdf</a></p>
</li>
<li>
<p><a id="BKF17"></a>[BKF17] Braun W., Kulshreshtha K., Franke R., Walther A., Bachmann B., Towards Adjoint and Directional Derivatives in FMI utilizing ADOL-C within OpenModelica, 12th International Modelica Conference, Prague, 2017. <a href="https://2017.international.conference.modelica.org/proceedings/html/submissions/ecp17132363_BraunKulshreshthaFrankeBachmannWalther.pdf" class="bare">https://2017.international.conference.modelica.org/proceedings/html/submissions/ecp17132363_BraunKulshreshthaFrankeBachmannWalther.pdf</a></p>
</li>
<li>
<p><a id="BOA12"></a>[BOA12] Blochwitz T., Otter M., &#197;kesson J., Arnold M., Clau&#223; C., Elmqvist H., Friedrich M., Junghanns A., Mauss J., Neumerkel D., Olsson H., Viel A. (2012): <strong>Functional Mockup Interface 2.0: The Standard for Tool independent Exchange of Simulation Models</strong>. 9th International Modelica Conference, Munich, 2012. <a href="http://www.ep.liu.se/ecp/076/017/ecp12076017.pdf" class="bare">http://www.ep.liu.se/ecp/076/017/ecp12076017.pdf</a></p>
</li>
<li>
<p><a id="KS00"></a>[KS00] K&#252;bler R., Schiehlen W. (2000): <strong>Two methods of simulator coupling</strong>. Mathematical and Computer Modeling of Dynamical Systems 6 pp. 93-113.</p>
</li>
<li>
<p><a id="LZ07"></a>[LZ07] Lee E.A., Zheng H. (2007): <strong>Leveraging Synchronous Language Principles for Heterogeneous Modeling and Design of Embedded Systems</strong>. EMSOFT'07, September 30-October 3, Salzburg, Austria. <a href="https://ptolemy.berkeley.edu/publications/papers/07/unifying/LeeZheng_SRUnifying.pdf" class="bare">https://ptolemy.berkeley.edu/publications/papers/07/unifying/LeeZheng_SRUnifying.pdf</a></p>
</li>
<li>
<p><a id="MLS12"></a>[MLS12] Modelica (2012): <strong>Modelica, A Unified Object-Oriented Language for Systems Modeling</strong>. Language Specification, Version 3.3, May 9, 2012. <a href="https://www.modelica.org/documents/ModelicaSpec33.pdf" class="bare">https://www.modelica.org/documents/ModelicaSpec33.pdf</a></p>
</li>
<li>
<p><a id="MG09"></a>[MG09] MODELISAR Glossary (2009): <strong>MODELISAR WP2 Glossary and Abbreviations</strong>. Version 1.0, June 9, 2009.</p>
</li>
<li>
<p><a id="PZ06"></a>[PZ06] Pouzet M. (2006): Lucid Synchrone, Version 3.0, Tutorial and Reference Manual.
<a href="http://www.di.ens.fr/~pouzet/lucid-synchrone/" class="bare">http://www.di.ens.fr/~pouzet/lucid-synchrone/</a></p>
</li>
<li>
<p><a id="CGM84"></a>[CGM84] Coleman, Garbow, Mor&#233; (1984): <strong>Software for estimating sparse Jacobian matrices, ACM Transactions on Mathematical Software</strong>. TOMS , vol. 10, no. 3, pp. 346-347</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fmi_revision_history">Appendix A: FMI Revision History</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix describes the history of the FMI design and its contributors. The current version of this document is available from <a href="https://fmi-standard.org/" class="bare">https://fmi-standard.org/</a>.</p>
</div>
<div class="paragraph">
<p>The Functional Mock-up Interface development was initiated and organized by Daimler AG (from Bernd Relovsky and others) as subproject inside the <a href="http://www.itea2.org/">ITEA2</a> MODELISAR project.</p>
</div>
<div class="paragraph">
<p>The development of versions 1.0 and 2.0 was performed within WP200 of MODELISAR, organized by the WP200 work package leader Dietmar Neumerkel from Daimler.</p>
</div>
<div class="sect2">
<h3 id="_a_1_version_1_0_fmi_for_model_exchange">A.1 Version 1.0 - FMI for Model Exchange</h3>
<div class="paragraph">
<p>Version 1.0 of FMI for Model Exchange was released on Jan. 26, 2010.</p>
</div>
<div class="paragraph">
<p>The subgroup "FMI for Model Exchange" was headed by Martin Otter (DLR-RM).
The essential part of the design of this version was performed by (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Torsten Blochwitz, ITI, Germany</p>
</li>
<li>
<p>Hilding Elmqvist, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>Andreas Junghanns, QTronic, Germany</p>
</li>
<li>
<p>Jakob Mauss, QTronic, Germany</p>
</li>
<li>
<p>Hans Olsson, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>Martin Otter, DLR-RM, Germany</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This version was evaluated with prototypes implemented for (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dymola by Peter Nilsson, Dan Henriksson, Carl Fredrik Abelson, and Sven Erik Mattson, Dassault Syst&#232;mes,</p>
</li>
<li>
<p>JModelica.org by Tove Bergdahl, Modelon AB,</p>
</li>
<li>
<p>Silver by Andreas Junghanns, and Jakob Mauss, QTronic</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These prototypes have been used to refine the design of "FMI for Model
Exchange".</p>
</div>
<div class="paragraph">
<p>The following MODELISAR partners participated at FMI design meetings and contributed to the discussion (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ingrid Bausch-Gall, Bausch-Gall GmbH, Munich, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Alex Eichberger, SIMPACK AG, Gilching, Germany</p>
</li>
<li>
<p>Hilding Elmqvist, Dassault Syst&#232;mes, Lund, Sweden</p>
</li>
<li>
<p>Andreas Junghanns, QTronic GmbH, Berlin, Germany</p>
</li>
<li>
<p>Rainer Keppler, SIMPACK AG, Gilching, Germany</p>
</li>
<li>
<p>Gerd Kurzbach, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Carsten K&#252;bler, TWT, Germany</p>
</li>
<li>
<p>Jakob Mauss, QTronic GmbH, Berlin, Germany</p>
</li>
<li>
<p>Johannes Mezger, TWT, Germany</p>
</li>
<li>
<p>Thomas Neidhold, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Dietmar Neumerkel, Daimler AG, Stuttgart, Germany</p>
</li>
<li>
<p>Peter Nilsson, Dassault Syst&#232;mes, Lund, Sweden</p>
</li>
<li>
<p>Hans Olsson, Dassault Syst&#232;mes, Lund, Sweden</p>
</li>
<li>
<p>Martin Otter, German Aerospace Center (DLR), Oberpfaffenhofen, Germany</p>
</li>
<li>
<p>Antoine Viel, LMS International (Imagine), Roanne, France</p>
</li>
<li>
<p>Daniel Weil, Dassault Syst&#232;mes, Grenoble, France</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following people outside of the MODELISAR consortium contributed with comments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Johan &#197;kesson, Lund University, Lund, Sweden</p>
</li>
<li>
<p>Joel Andersson, KU Leuven, The Netherlands</p>
</li>
<li>
<p>Roberto Parrotto, Politecnico di Milano, Italy</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_a_2_version_1_0_fmi_for_co_simulation">A.2 Version 1.0 - FMI for Co-Simulation</h3>
<div class="paragraph">
<p>Version 1.0 of FMI for Co-Simulation was released on Oct. 10, 2010.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation was developed in three subgroups: "Solver Coupling" headed by Martin Arnold (University Halle) and Torsten Blochwitz (ITI), "Tool Coupling" headed by J&#246;rg-Volker Peetz (Fraunhofer SCAI), and "Control Logic" headed by Manuel Monteiro (Atego).
The essential part of the design of this version was performed by (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Martin Arnold, University Halle, Germany</p>
</li>
<li>
<p>Constanze Bausch, Atego Systems GmbH, Wolfsburg, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Christoph Clau&#223;, Fraunhofer IIS EAS, Dresden, Germany</p>
</li>
<li>
<p>Manuel Monteiro, Atego Systems GmbH, Wolfsburg, Germany</p>
</li>
<li>
<p>Thomas Neidhold, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>J&#246;rg-Volker Peetz, Fraunhofer SCAI, St. Augustin, Germany</p>
</li>
<li>
<p>Susann Wolf, Fraunhofer IIS EAS, Dresden, Germany</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This version was evaluated with prototypes implemented for (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SimulationX by Torsten Blochwitz and Thomas Neidhold (ITI GmbH)</p>
</li>
<li>
<p>Master algorithms by Christoph Clau&#223; (Fraunhofer IIS EAS)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following MODELISAR partners participated at FMI design meetings and contributed to the discussion (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Martin Arnold, University Halle, Germany</p>
</li>
<li>
<p>Jens Bastian, Fraunhofer IIS EAS, Dresden, Germany</p>
</li>
<li>
<p>Constanze Bausch, Atego Systems GmbH, Wolfsburg, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Christoph Clau&#223;, Fraunhofer IIS EAS, Dresden, Germany</p>
</li>
<li>
<p>Manuel Monteiro, Atego Systems GmbH, Wolfsburg, Germany</p>
</li>
<li>
<p>Thomas Neidhold, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Dietmar Neumerkel, Daimler AG, B&#246;blingen, Germany</p>
</li>
<li>
<p>Martin Otter, DLR, Oberpfaffenhofen, Germany</p>
</li>
<li>
<p>J&#246;rg-Volker Peetz, Fraunhofer SCAI, St. Augustin, Germany</p>
</li>
<li>
<p>Tom Schierz, University Halle, Germany</p>
</li>
<li>
<p>Klaus Wolf, Fraunhofer SCAI, St. Augustin, Germany</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_a_3_version_2_0_fmi_for_model_exchange_and_co_simulation">A.3 Version 2.0 - FMI for Model Exchange and Co-Simulation</h3>
<div class="paragraph">
<p>FMI 2.0 for Model Exchange and Co-Simulation was released on July 25, 2014.</p>
</div>
<div class="sect3">
<h4 id="_a_3_1_overview">A.3.1 Overview</h4>
<div class="paragraph">
<p>This section gives an overview about the changes with respect to versions 1.0 for Model Exchange and 1.0 for Co-Simulation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI 2.0 is not backwards compatible to FMI 1.0.</p>
</li>
<li>
<p>The documents, schema and header files for Model Exchange and for Co-Simulation have been merged. Due to the merging, some conflicts had to be resolved leading to some non-backwards compatible changes with respect to FMI 1.0.</p>
</li>
<li>
<p>Parameters can be declared to be <a href="#tunable"><code>tunable</code></a> in the FMU, in other words, during simulation these <a href="#parameter"><code>parameters</code></a> can be changed (if supported by the simulation environment).</p>
</li>
<li>
<p>When enabling logging, log categories to be logged can be defined, so that the FMU only needs to generate logs of the defined categories (in FMI 1.0, logs had to be generated for all log categories and they had to be filtered afterwards). Log categories that are supported by an FMU can be optionally defined in the XML file so that a simulation environment can provide them to the user for selection.</p>
</li>
<li>
<p>In order that tools can more simply support importing both FMI 1.0 and 2.0, all file and function names of FMI 2.0 start with <code>fmi2</code>, whereas they start with <code>fmi</code> for FMI 1.0.</p>
</li>
<li>
<p>FMI function names are no longer prefixed with the <code>modelIdentifier</code> if used in a DLL/sharedObject. As a result, FMUs that need a tool can use a generic communication DLL, and the loading of DLLs is no longer FMU dependent.</p>
</li>
<li>
<p>The different modes of an FMU are now clearly signaled with respective function calls (<code>fmi2EnterInitializationMode</code>, <code>fmi2EnterEventMode</code>, <code>fmi2EnterContinuousTimeMode</code>).</p>
</li>
<li>
<p>The interfaces have been redesigned, in order that algebraic loops over connected FMUs with Real, Integer, or Boolean unknowns can now be handled reasonably not only in <strong>Continuous-Time Mode</strong>, but also in <strong>Initialization Mode</strong> and <strong>Event Mode</strong>. In FMI 1.0, algebraic loops in <strong>Initialization Mode</strong> and <strong>Even Mode</strong> could not be handled.</p>
</li>
<li>
<p>The termination of every global event iteration over connected FMUs must be reported by a new function call (<code>fmi2EnterContinuousTimeMode</code>).</p>
</li>
<li>
<p>The unit definitions have been improved: The tool-specific unit-name can optionally be expressed as function of the 7 SI base units and the SI derived unit <code>rad</code>. It is then possible to check units when FMUs are connected together (without standardizing unit names), or to convert variable values that are provided in different units (for the same physical quantity).</p>
</li>
<li>
<p>Enumerations have an arbitrary (but unique) mapping to integers (in FMI 1.0, the mapping was automatically to 1,2,3,&#8230;&#8203;).</p>
</li>
<li>
<p>The alias/negatedAlias variable definitions have been removed, to simplify the interface: If variables of the same base type (like <code>fmi2Real</code>) have the same <a href="#valueReference"><code>valueReference</code></a>, they have identical values. A simulation environment may ignore this completely (this was not possible in FMI 1.0), or can utilize this information to more efficiently store results on file.</p>
</li>
<li>
<p>When instantiating an FMU, the absolute path to the FMU resource directory is now reported also in Model Exchange, in order that the FMU can read all of its resources (for example, maps, tables, &#8230;&#8203;) independently of the "current directory" of the simulation environment where the FMU is used.</p>
</li>
<li>
<p>An ordering is defined for <a href="#input"><code>input</code></a>, <a href="#output"><code>output</code></a>, and <a href="#state"><code>state</code></a> variables in the XML file of an FMU, in order for this order to be defined in the FMU, and not be (arbitrarily) selected by the simulation environment. This is essential, for example, when linearizing an FMU, or when providing <code>sparsity</code> information (see below).</p>
</li>
<li>
<p>Several optional features have been added:</p>
<div class="ulist">
<ul>
<li>
<p>The complete FMU state can be saved, restored, and serialized to a byte vector (that can be stored on file). As a result, a simulation (both for Model Exchange and for Co-Simulation) can be restarted from a saved FMU state. Rejecting steps for variable step-size Co-Simulation master algorithms is now performed with this feature (instead of the less powerful method of FMI 1.0).</p>
</li>
<li>
<p>The dependency of state derivatives and of output variables from <a href="#input"><code>inputs</code></a> and <a href="#state"><code>states</code></a> can be defined in the XML file, in other words, the sparsity pattern for Jacobians can be defined. This allows simulating stiff FMUs with many states (&gt; 1000 states) since sparse matrix methods can be utilized in the numerical integration method. Furthermore, it can be stated whether this dependency is linear (this allows to transform nonlinear algebraic equation systems into linear equation systems when connecting FMUs).</p>
</li>
<li>
<p>Directional derivatives can be computed for derivatives of continuous-time <a href="#state"><code>states</code></a> and for <a href="#output"><code>outputs</code></a>. This is useful when partial derivatives of connected FMUs must be computed. If the exported FMU performs this computation analytically, then all numerical algorithms based on these partial derivatives (for example, the numerical integration method or nonlinear algebraic solvers) are more efficient and more reliable.</p>
</li>
<li>
<p>Every scalar variable definition can have an additional <code>annotation</code> data structure that is arbitrary (<code>any</code> element in XML). A tool vendor can store tool-dependent information here (that other tools can ignore), for example, to store the graphical layout of parameter menus. The <code>VendorAnnotations</code> element was also generalized from (name, value) pairs to any XML data structure.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Many smaller improvements have been included, due to the experience in using FMI 1.0 (for example, the <a href="#causality"><code>causality</code></a>/<a href="#variability"><code>variability</code></a> attributes have been changed and more clearly defined, the fmi2ModelFunctions.h header has been split into two header files (one for the function signature, and one for the function names), in order that the header files can be directly used both for DLLs and for source code distribution).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_a_3_2_main_changes">A.3.2 Main changes</h4>
<div class="paragraph">
<p>This section gives the details about the changes with respect to versions 1.0 for Model Exchange and 1.0 for Co-Simulation:</p>
</div>
<div class="paragraph">
<p>In this version, the documents of version 1.0 for Model Exchange and for Co-Simulation have been merged and several new features have been added.</p>
</div>
<div class="paragraph">
<p><strong>The following changes in FMI 2.0 are not backwards compatible due to the merging</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>File fmiModelTypes.h (in FMI for Model Exchange) has been renamed to fmi2TypesPlatform.h (the file name used in FMI for Co-Simulation).</p>
</li>
<li>
<p>File fmiModelFunctions.h (in FMI for Model Exchange) has been renamed to fmi2Functions.h (the file name used in FMI for Co-Simulation), and the function prototypes in this header files have been merged from Model Exchange and from Co-Simulation). Additionally, a new header files has been added, <code>fmi2FunctionTypes.h</code> that contains a definition of the function signatures. This header file is also used in <code>fmi2Functions.h</code> (so the signature is not duplicated). The benefit is that <code>fmi2FunctionTypes.h</code> can be directly used when loading a DLL/sharedObject (in FMI 1.0, the tool providers had to provide this header file by themselves).</p>
</li>
<li>
<p>Fixing ticket #47:<br>
In FMI 1.0 for Model Exchange the fmiModelDescription.version was
defined as string, whereas in Co-Simulation it was defined as integer.
This has been changed, so that version is a string.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>The following backwards compatible improvements have been made in FMI 2.0:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The FMI 1.0 documents have been merged (for example, all common definitions have been placed in the new <a href="#fmi-common-concepts">Section 2</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>The following not backwards compatible improvements have been made in FMI 2.0:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Element <code>fmiModelDescription.Implementation</code> in the model description schema file has been replaced by a different structure where one hierarchical level is removed. There are now 2 elements directly under fmiModelDescription: <code>ModelExchange</code> and <code>CoSimulation</code>.<br>
File <code>fmiImplementation.xsd</code> has been removed.<br>
New capability flags have been introduced both for <code>ModelExchange</code> and for <code>CoSimulation</code>, such as <code>canGetAndSetFMUState</code>, <code>canSerializeFMUState</code>, etc.<br>
Attribute <code>modelIdentifier</code> has been moved from an <code>fmiModelDescription</code> attribute to an attribute in <code>ModelExchange</code> and in <code>CoSimulation</code>. This allows providing different identifiers, and then an FMU may contain both distribution types with different DLL names (which correspond to the <code>modelIdentifier</code> names).<br>
A new attribute <code>needsExecutionTool</code> has been introduced both in <code>ModelExchange</code> and in <code>CoSimulation</code> in order to define whether a tool is needed to execute the FMU. The previous elements in <code>CoSimulation_Tool</code> have been removed.</p>
</li>
<li>
<p>The state machines of Model Exchange and CoSimulation have been improved. Especially, the entering of the states in this state machine are now clearly marked by corresponding function calls (<code>fmi2EnterInitializationMode</code>, <code>fmi2EnterEventMode</code>, <code>fmi2EnterContinuousTimeMode</code>).</p>
</li>
<li>
<p>Fixing ticket #9:<br>
A new element <code>LogCategory</code> was introduced in <code>fmiModelDescription</code>. This is an unordered set of strings representing the possible values of the log categories of the FMU (for example, <code>logEvent</code>).<br>
Function <code>fmi2SetDebugLogging</code> has two new arguments to define the categories (from <code>LogCategory</code>) to be used in log messages.</p>
</li>
<li>
<p>Fixing ticket #33:<br>
The <a href="#causality"><code>causality</code></a> and <a href="#variability"><code>variability</code></a> attributes of a <code>ScalarVariable</code> have not been fully clear. This has been fixed by changing the enumeration values of <a href="#variability"><code>variability</code></a> from <a href="#constant"><code>constant</code></a>, <a href="#parameter"><code>parameter</code></a>, <a href="#discrete"><code>discrete</code></a>, <a href="#continuous"><code>continuous</code></a> to <a href="#constant"><code>constant</code></a>, <a href="#fixed"><code>fixed</code></a>, <a href="#tunable"><code>tunable</code></a>, <a href="#discrete"><code>discrete</code></a>, <a href="#continuous"><code>continuous</code></a> and <a href="#causality"><code>causality</code></a> from <a href="#input"><code>input</code></a>, <a href="#output"><code>output</code></a>, <code>internal</code>, none" to <a href="#parameter"><code>parameter</code></a>, <a href="#input"><code>input</code></a>, <a href="#output"><code>output</code></a>, <a href="#local"><code>local</code></a>. This change includes now also the support of parameters that can be tuned (changed) during simulation.</p>
</li>
<li>
<p>Fixing ticket #35:<br>
In order to simplify implementation (for example, an "element event handler" is no longer needed in SAX XML parser), the only location where data is not defined by attributes, is changed to an attribute definition: Element <code>DirectDependency</code> in <code>ScalarVariable</code> is removed. The same information can now be obtained from the <code>InputDependency</code> attribute inside <code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;&lt;Outputs&gt;</code>.</p>
</li>
<li>
<p>Fixing ticket #37:<br>
The new status flag <code>fmi2Terminate</code> is added to the Co-Simulation definition. This allows a slave to terminate the simulation run before the stop time is reached without triggering an error.</p>
</li>
<li>
<p>Fixing ticket #39:<br>
Wrong example in the previous section 2.10 of Co-Simulation has been fixed.</p>
</li>
<li>
<p>Fixing ticket #41:<br>
New types introduced in fmi2TypesPlatform.h :<br>
<code>fmi2ComponentEnvironment</code>, <code>fmi2FMUState</code>, <code>fmi2Byte</code>.<br>
Struct <code>fmi2CallbackFunctions</code> gets a new last argument:<br>
<code>fmi2ComponentEnvironment instanceEnvironment</code><br>
The first argument of function <a href="#logMessage"><code>logMessage</code></a> is changed from type <code>fmi2Component</code>
to <code>fmi2ComponentEnvironment</code>.<br>
By these changes, a pointer to a data structure from the simulation environment is passed to the <a href="#logMessage"><code>logMessage</code></a> and allows the <a href="#logMessage"><code>logMessage</code></a>, for example, to transform a <a href="#valueReference"><code>valueReference</code></a> in the log message to a variable name.</p>
</li>
<li>
<p>Fixing ticket #42:<br>
Enumerations defined in fmi2Type.xsd are now defined with (name, value) pairs. An enumeration value must be unique within the same enumeration (to have a bijective mapping between enumeration names and values, in order that results can optionally be presented with names and not with values).<br>
Furthermore, the <code>min/max</code> values of element <code>Enumeration</code> in <code>TypeDefinition</code> have been removed because they are meaningless.</p>
</li>
<li>
<p>Fixing ticket #43:<br>
The previous header file fmiFunctions.h is split into 2 header files, fmi2FunctionTypes.h and fmi2Functions.h, in order to simplify the dynamic loading of an FMU (the typedefs of the function prototypes defined in fmi2FunctionTypes.h can be used to type case the function pointers of the dynamic loading).</p>
</li>
<li>
<p>Fixing ticket #45:<br>
Contrary to the ticket proposal, no new function <code>fmiResetModel</code> is added. Instead 6 new functions are added to get and set the internal FMU state via a pointer and to serialize and deserialize an FMU state via a byte vector provided by the environment. For details, see <a href="#get-set-fmu-state">Section 2.1.10</a>. This feature allows, for example, to support more sophisticated co-simulation master algorithms which require the repetition of communication steps. Additionally, two capability flags have been added (<code>canGetAndSetFMUState</code>, <code>canSerializeFMUState</code>) in order to define whether these features are supported by the FMU.</p>
</li>
<li>
<p>Fixing ticket #46:<br>
The unit definitions have been enhanced by providing an optional mapping to the 7 SI base units and the SI derived unit <code>rad</code>, in order for a tool to be able to check whether a signal provided to the FMU or inquired by the FMU has the expected unit.</p>
</li>
<li>
<p>Fixing ticket #48:<br>
The definition of <code>fmiBoolean</code> in <code>fmiTypesPlatform.h</code> for <code>standard32</code> was changed from <code>char</code> to <code>int</code>. The main reason is to avoid unnecessary casting of Boolean types when exporting an FMU from a Modelica environment or when importing it into a Modelica environment.<br>
The current definition of <code>char</code> for a Boolean was not meaningful, since, for example, for embedded code generation usually Booleans are packed on integers and <code>char</code> for one Boolean would also not be used. It is planned to add more supported data types to an FMU in the future, which should then also include support for packed Booleans.</p>
</li>
<li>
<p>Fixing ticket #49:<br>
Argument <code>fmiComponent</code> in function pointer <code>stepFinished</code> was changed to <code>fmi2ComponentEnvironment</code> (when <code>stepFinished</code> is called from a Co-Simulation slave and provides <code>fmi2ComponentEnvironment</code>, then this data structure provided by the environment can provide environment specific data to efficiently identify the slave that called the function).</p>
</li>
<li>
<p>Fixing ticket #54:<br>
In <a href="#fmu-distribution">Section 2.3</a> it is now stated, that the FMU must include all referenced resources. This means especially that for Microsoft VisualStudio the option "MT" has to be used when constructing a DLL in order to include the run-time environment of VisualStudio in the DLL.</p>
</li>
<li>
<p>Fixing ticket #75:<br>
Since states are now explicitly defined in the XML file, function <code>fmiGetStateValueReferences</code> is no longer needed, as well as the special type <code>fmiUndefinedValueReference</code> that might be used as return value of this function. Therefore, both elements have been removed in FMI 2.0.</p>
</li>
<li>
<p>Fixing ticket #85:<br>
New argument <code>noSetFMUStatePriorToCurrentPoint</code> to function <code>fmi2CompletedIntegratorStep</code>, similarly to <code>fmi2DoStep</code>, in order that the FMU can flush a result buffer if necessary.</p>
</li>
<li>
<p>Fixing ticket #86:<br>
The fmi2TypesPlatform.h header file has been slightly changed: The default value of <code>fmi2TypesPlatform</code> is changed from <code>standard32</code> to <code>default</code>, since this definition holds for most platforms and compilers. Furthermore, the default type of <code>fmi2ValueReference</code> has been changed from <code>unsigned int</code> to <code>size_t</code>.</p>
</li>
<li>
<p>Fixing ticket #88:<br>
The definition of fmi2Functions.h slightly changed to improve portability (the header file can now be utilized both for Microsoft and gnu compilers, and the danger of name conflicts has been reduced).</p>
</li>
<li>
<p>Fixing ticket #95:<br>
FMI XML files need to be UTF-8 encoded (as are XML schema files and strings in the C-API), in order to simplify reading of XML files.</p>
</li>
<li>
<p>Fixing ticket #113:<br>
Changed function name <code>fmiTerminateSlave</code> to <code>fmi2Terminate</code> in order to be consistent with the other function definitions (<code>fmi2EnterSlaveInitializationMode</code>, <code>fmi2Terminate</code>).</p>
</li>
<li>
<p>Fixing ticket #115:<br>
Clarification added, that the special values <code>NAN</code>, <code>+INF</code>, <code>-INF</code>, are not allowed in the FMI XML files.</p>
</li>
<li>
<p>Fixing ticket #127:<br>
Added clarifications in section 2.1, that all C-API functions are not thread safe and that FMUs must not influence each other.</p>
</li>
<li>
<p>Fixing ticket #218:<br>
Changed all name prefixes from <code>fmi</code> to <code>fmi2</code> in *.h, *.xsd, *.png files and in the specification to avoid compiler and linker problems when supporting both FMI 1.0 and 2.0 in the same program.</p>
</li>
<li>
<p>Function <code>fmiInitialize</code> was split into two functions: <code>fmi2EnterInitializationMode</code> and <code>fmi2ExitInitializationMode</code> in order that artificial or real algebraic loops over connected FMUs can be handled in an efficient way.</p>
</li>
<li>
<p>Function <code>stepEvent</code> in <code>struct fmi2CallbackFunctions</code> had different locations in the FMI documentation and in the header file. This inconsistency has been corrected by using the location in the header file (at the end of the <code>struct</code>).</p>
</li>
<li>
<p>The <code>struct fmi2CallbackFunctions</code> is provided as a pointer to the <code>struct</code> when instantiating an FMU, and not as the <code>struct</code> itself. This simplifies the importing of an FMU into a Modelica environment.</p>
</li>
<li>
<p>Defined how to utilize the <code>min</code>/<code>max</code> attributes for <code>fmi2SetReal</code>, <code>fmi2SetInteger</code>, <code>fmi2GetReal</code>, <code>fmi2GetInteger</code> calls.</p>
</li>
<li>
<p>Attributes <code>numberOfScalarVariables</code>, <code>numberOfContinuousStates</code>, <code>numberOfInputs</code>, <code>numberOfOutputs</code> available in FMI 1.0 have been removed, because they can be deduced from the remaining XML file (so in FMI 2.0 this would have been redundant information).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_a_3_3_contributors">A.3.3 Contributors</h4>
<div class="paragraph">
<p>The development group for this version was headed by Torsten Blochwitz (ITI). The essential part of the design of this version was performed by (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Johan &#197;kesson, Modelon, Sweden</p>
</li>
<li>
<p>Martin Arnold, University Halle, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ITI, Germany</p>
</li>
<li>
<p>Christoph Clauss, Fraunhofer IIS EAS, Germany</p>
</li>
<li>
<p>Hilding Elmqvist, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>R&#252;diger Franke, ABB AG, Germany</p>
</li>
<li>
<p>Markus Friedrich, SIMPACK AG, Germany</p>
</li>
<li>
<p>Lev Greenberg, IBM Research, Israel</p>
</li>
<li>
<p>Andreas Junghanns, QTronic, Germany</p>
</li>
<li>
<p>Jakob Mauss, QTronic, Germany</p>
</li>
<li>
<p>Iakov Nakhimovski, Modelon, Sweden</p>
</li>
<li>
<p>Dietmar Neumerkel, Daimler AG, Germany</p>
</li>
<li>
<p>Hans Olsson, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>Martin Otter, DLR RMC-SR, Germany</p>
</li>
<li>
<p>Antoine Viel, Siemens PLM Software, France</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The FMI 2.0 document was edited by Martin Otter (DLR), Torsten Blochwitz (ITI), and Martin Arnold (Uni Halle). The State Machines and tables for the Calling Sequences for Model Exchange and Co-Simulation are from Jakob Mauss (QTronic).</p>
</div>
<div class="paragraph">
<p>This version was evaluated with prototypes implemented for (alphabetical
list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dymola by Peter Nilsson, Karl Wernersson, and Sven Erik Mattson, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>FMI Compliance Checker by Iakov Nakhimovski, Modelon AB, Sweden</p>
</li>
<li>
<p>LMS Imagine.Lab AMESim by Antoine Viel, Siemens PLM Software, France</p>
</li>
<li>
<p>MapleSim, by Kaska Kowalska, Maplesoft, Canada</p>
</li>
<li>
<p>Silver by Andreas Junghanns, QTronic, Germany</p>
</li>
<li>
<p>SimulationX by Torsten Blochwitz, ITI, Germany</p>
</li>
<li>
<p>SCALEXIO and VEOS by Irina Zacharias, Andreas Pillekeit, dSPACE GmbH, Germany</p>
</li>
<li>
<p>xMOD by Mongi ben Gaid, Bertrand Hugon, Bruno L&#233;ty, and Fabien Debertolis, IFPEN, France</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These prototypes have been used to refine the design of "FMI 2.0 for Model Exchange and Co-Simulation".</p>
</div>
<div class="paragraph">
<p>The open source FMITest library (<a href="https://svn.fmi-standard.org/fmi/branches/public/Test_FMUs/_FMIModelicaTest/FMITest/help/FMITest.html" class="bare">https://svn.fmi-standard.org/fmi/branches/public/Test_FMUs/_FMIModelicaTest/FMITest/help/FMITest.html</a>) to test difficult cases of connected FMUs was implemented by Martin Otter (DLR, Germany) based on suggestions by Hilding Elmqvist (Dassault Syst&#232;mes, Sweden) and Torsten Blochwitz (ITI, Germany).</p>
</div>
<div class="paragraph">
<p>The following partners participated at FMI 2.0 design meetings and contributed to the discussion (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Johan &#197;kesson, Modelon, Sweden</p>
</li>
<li>
<p>Christian Andersson, Modelon, Sweden</p>
</li>
<li>
<p>Martin Arnold, University Halle, Germany</p>
</li>
<li>
<p>Adeel Asghar, PELAB, Sweden</p>
</li>
<li>
<p>Mongi Ben-Gaid, IFP, France</p>
</li>
<li>
<p>Christian Bertsch, Robert Bosch GmbH, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ITI, Germany</p>
</li>
<li>
<p>Christoph Clauss, Fraunhofer IIS EAS, Germany</p>
</li>
<li>
<p>Alex Eichberger, SIMPACK AG, Germany</p>
</li>
<li>
<p>Hilding Elmqvist, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>R&#252;diger Franke, ABB AG, Germany</p>
</li>
<li>
<p>Markus Friedrich, SIMPACK AG, Germany</p>
</li>
<li>
<p>Peter Fritzson, PELAB, Sweden</p>
</li>
<li>
<p>Rafael Gilles (Erbacher), dSPACE GmbH, Germany</p>
</li>
<li>
<p>Lev Greenberg, IBM Research, Israel</p>
</li>
<li>
<p>Anton Haumer, Modelon, Germany</p>
</li>
<li>
<p>Andreas Junghanns, QTronic, Germany</p>
</li>
<li>
<p>Karsten Kr&#252;gel, dSPACE GmbH, Germany</p>
</li>
<li>
<p>Edward Lee, Berkeley University, U.S.A.</p>
</li>
<li>
<p>Bruno Loyer, Siemens PLM Software, France</p>
</li>
<li>
<p>Petter Lindholm, Modelon, Sweden</p>
</li>
<li>
<p>Kristin Majetta, Fraunhofer IIS EAS, Germany</p>
</li>
<li>
<p>Sven Erik Mattsson, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>Jakob Mauss, QTronic, Germany</p>
</li>
<li>
<p>Monika M&#252;hlbauer, Siemens AG, Germany</p>
</li>
<li>
<p>Dietmar Neumerkel, Daimler AG, Germany</p>
</li>
<li>
<p>Peter Nilsson, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>Hans Olsson, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>Martin Otter, DLR RMC-SR, Germany</p>
</li>
<li>
<p>Nicolas Pernet, IFPEN, France</p>
</li>
<li>
<p>Andreas Pillekeit, dSPACE GmbH, Germany</p>
</li>
<li>
<p>Bernd Relovsky, Daimler AG, Germany</p>
</li>
<li>
<p>Tom Schierz, University Halle, Germany</p>
</li>
<li>
<p>Chad Schmitke, Maplesoft, Canada</p>
</li>
<li>
<p>Stefan-Alexander Schneider, BMW, Germany</p>
</li>
<li>
<p>Klaus Schuch, AVL List GmbH, Austria</p>
</li>
<li>
<p>Bernhard Thiele, DLR RMC-SR, Germany</p>
</li>
<li>
<p>Antoine Viel, Siemens PLM Software, France</p>
</li>
<li>
<p>Karl Wernersson, Dassault Syst&#232;mes, Sweden</p>
</li>
<li>
<p>Irina Zacharias, dSPACE GmbH, Germany</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following people contributed with comments (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Peter Aaronsson, MathCore, Sweden</p>
</li>
<li>
<p>Bernhard Bachmann, University of Bielefeld, Germany</p>
</li>
<li>
<p>Andreas Pfeiffer, DLR RMC-SR</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_a_3_4_fmi_2_0_1_maintenane_release_changes_and_contributors">A.3.4 FMI 2.0.1 maintenane release: changes and contributors</h3>
<div class="paragraph">
<p>The changes w.r.t. FMI 2.0 (clarifications and bugfixes) are summarized on the release page for FMI 2.0.1 <a href="https://github.com/modelica/fmi-standard/releases/tag/v2.0.1" class="bare">https://github.com/modelica/fmi-standard/releases/tag/v2.0.1</a></p>
</div>
<div class="paragraph">
<p>The following partners participated at FMI 2.0.1 meetings (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Christian Bertsch, Robert Bosch GmbH, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ESI ITI GmbH, Germany</p>
</li>
<li>
<p>Robert Braun, Link&#252;ping University, Sweden</p>
</li>
<li>
<p>Andreas Junghanns, QTronic GmbH, Germany</p>
</li>
<li>
<p>Pierre R. Mai, PMSF IT Consulting, Germany</p>
</li>
<li>
<p>Masoud Najafi, Altair, France</p>
</li>
<li>
<p>Andreas Pillekeit, dSPACE GmbH, Germany</p>
</li>
<li>
<p>Torsten Sommer, Dassault Syst&#232;mes, Germany</p>
</li>
<li>
<p>Karl Wernersson, Dassault Syst&#232;mes, Sweden</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For further contributors by comments please refer to the issue tracking system <a href="https://github.com/modelica/fmi-standard/milestone/3" class="bare">https://github.com/modelica/fmi-standard/milestone/3</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_glossary">Appendix B: Glossary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This glossary is a subset of (<em>MODELISAR Glossary, 2009</em>) with some extensions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Term</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>algorithm</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A formal recipe for solving a specific type of problem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>application programming interface (API)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of functions, procedures, methods or classes together with type conventions/declarations (for example, C header files) that an operating system, library or service provides to support requests made by computer programs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AUTOSAR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AUTomotive Open System Architecture (<a href="http://www.autosar.org/">www.autosar.org</a>).<br>
Evolving standard of the automotive industry to define the implementation of embedded systems in vehicles including communication mechanisms. An important part is the standardization of C functions and macros to communicate between software components. AUTOSAR is targeted to built on top of the real-time operating system OSEK (<a href="http://www.osek-vdx.org/">www.osek-vdx.org</a>, <a href="http://de.wikipedia.org/wiki/OSEK">de.wikipedia.org/wiki/OSEK</a>). The use of the AUTOSAR standard requires AUTOSAR membership.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>clock tick</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the <a href="#clock"><code>clock</code></a> ticks an event is present otherwise the event is absent.
For FMI for Co-Simulation the ticking of a <a href="#clock"><code>clock</code></a> is interpreted as an activity of the associated model partition.
The ticking of a <a href="#outputClock"><code>output clock</code></a> may lead to an <a href="#inputClock"><code>input clock</code></a> tick for another FMU (has to be defined via Co-Simulation master) or for a model partition of the same FMU (is defined in <code>modelDescription.xml</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>communication points</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time grid for data exchange between master and slaves in a co-simulation environment (also known as "sampling points" or "synchronization points").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>communication step size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance between two subsequent <em>communication points</em> (also known as "sampling rate" or "macro step size").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>co-simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coupling (in other words, dynamic mutualexchange and utilization of intermediate results) of several <em>simulation programs</em> including their numerical solvers in order to simulate a system consisting of several subsystems.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>co-simulation platform</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software used for coupling several <em>simulation programs</em> for <em>co-simulation.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ECU</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Electronic Control Unit (Microprocessor that is used to control a sub-system in a vehicle).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Something that occurs instantaneously at a specific time or when a specific condition occurs.
At an event, numerical integration is suspended and variables may change their values discontinuously.
Internal events occur inside the FMU and should be signaled to the environment without any delay.
External events occur outside the FMU and should be signaled to the FMU without any delay.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface:<br>
Interface of a functional mock-up in form of a model. In analogy to the term digital mock-up (see <em>mock-up</em>), functional mock-up describes a computer-based representation of the functional behaviour of a system for all kinds of analyses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for Co-Simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface for Co-Simulation:<br>
One of the MODELISAR <em>functional mock-up interfaces.</em> It connects the <em>master solver</em> component with one or more <em>slave solvers</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for Model Exchange</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface for Model Exchange:<br>
One of the MODELISAR <em>functional mock-up interfaces.</em> It consists of the <em>model description interface</em> and the <em>model execution interface</em>.<br>
It connects the <em>external model</em> component with the <em>solver</em> component.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMU</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Unit:<br>
A "model class" from which one or more "model instances" can be instantiated for simulation. An FMU is stored in one ZIP file as defined in <a href="#fmu-distribution">Section 2.3</a> consisting basically of one XML file that defines the model variables and a set of C functions (see <a href="#fmi-application-programming-interface">Section 2.1</a>), in source or binary form, to execute the model equations or the simulator slave. In case of tool execution, additionally, the original simulator is required to perform the co-simulation (compare <a href="#fmi-for-basic-co-simulation">Section 4</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integration algorithm</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The numerical algorithm to solve differential equations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integrator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>software component</em>, which implements an <em>integration algorithm</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An abstraction of a <em>software component</em> that describes its behavior without dealing with the internal implementation. <em>Software components</em> communicate with each other via interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>interrupt</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> connected to the tick of an <a href="#inputClock"><code>input clock</code></a> of an FMU that is caused by an external potentially random process, i.e. hardware interrupt, software interrupt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>master/slave</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A method of communication, where one device or process has unidirectional control over one or more other devices. Once a master/slave relationship between devices or processes is established, the direction of control is always from the master to the slaves. In some systems a master is elected from a group of eligible devices, with the other devices acting in the role of slaves.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>mock-up</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A full-sized structural, but not necessarily functional model built accurately to scale, used chiefly for study, testing, or display. In the context of computer aided design (CAD), a digital mock-up (DMU) means a computer-based representation of the product geometry with its parts, usually in 3-D, for all kinds of geometrical and mechanical analyses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A model is a mathematical or logical representation of a system of entities, phenomena, or processes. Basically a model is a simplified abstract view of the complex reality.<br>
It can be used to compute its expected behavior under specified conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model description file</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The model description file is an XML file, which supplies a description of all properties of a <em>model</em> (for example, <a href="#input"><code>input</code></a> / <a href="#output"><code>output</code></a> variables).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model description interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An interface description to write or retrieve information from the <em>model description file</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Model Description Schema</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <em>XML</em> schema that defines how all relevant, non-executable, information about a "model class" (<em>FMU)</em> is stored in a text file in <em>XML</em> format. Most important, data for every variable is defined (variable name, handle, data type, variability, unit, etc.), see <a href="#fmi-description-schema">Section 2.2</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model rate</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inverse of time interval between two communication points associated to an exposed model partition within the FMU (i.e. <a href="#clock"><code>clock</code></a> is defined in interface). In general multiple rates i.e. multiple model partitions can be defined for an Co-Simulation FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model partition</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Model partitions can be associated to a discrete or (piecewise) continuous part of the FMU.
The computation of model partitions can be externally controlled based on <a href="#clock"><code>clock</code></a> ticks of associated <a href="#inputClock"><code>input clocks</code></a>.</p>
<p class="tableblock">Not all FMU internal model partitions have to be exposed in the Co-Simulation interface as <a href="#clock"><code>clock</code></a> and can also be handled FMU internally (e.g. internal subsampling).
Nevertheless, it is assumed that the activation of all exposed <a href="#inputClock"><code>input clocks</code></a> results in the computation of the complete FMU.</p>
<p class="tableblock">As stated above, continuous parts of the FMU are also associated to model partitions that define the sampling points (i.e. communication points) for the <a href="#continuous"><code>continuous</code></a> values.
Please note that this is only possible for CommunicationPointClocks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>numerical solver</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>solver</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>output points</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tool internal time grid for saving output data to file (in some tools also known as "<em>communication points</em>" - but this term is used in a different way in FMI for Co-Simulation, see above).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>output step size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance between two subsequent <em>output points</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A quantity within a <em>model</em>, which remains constant during <em>simulation (<a href="#fixed"><code>fixed</code></a> <a href="#parameter"><code>parameter</code></a>) or may change at event instances (<a href="#tunable"><code>tunable</code></a> <a href="#parameter"><code>parameter</code></a>)</em>. Examples are a mass, stiffness, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>slave</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>master/slave</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute the behavior of one or several <em>models</em> under specified conditions.<br>
(see also <em>co-simulation</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation model</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>model</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation program</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software to develop and/or solve simulation <em>models</em>. The software includes a <em>solver</em>, may include a user interface and methods for post processing (see also: <em>simulation tool</em>, <em>simulation environment</em>).<br>
Examples of simulation programs are: AMESim, Dymola, SIMPACK, SimulationX, SIMULINK.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation tool</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>simulation program</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A simulator can include one or more <em>simulation programs</em>, which solve a common simulation task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>solver</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Software component,</em> which includes algorithms to solve <em>models</em>, for example, <em>integration algorithms</em> and <em>event handling</em> methods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>state</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The continuous <a href="#state"><code>states</code></a> of a model are all variables that appear differentiated in the model and are independent from each other.<br>
The discrete <a href="#state"><code>states</code></a> of a model are time-discrete variables that have two values in a model: The value of the variable from the previous <em>event</em> instant, and the value of the variable at the actual event instant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>state event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that is defined by the time instant where the domain \(z &gt; 0\) of an event indicator variable <code>z</code> is changed to \(z \leq 0\), or vice versa.<br>
This definition is slightly different from the usual standard definition of state events: "\(z(t)*z(t_{i-1}) \leq 0\)" which has the severe drawback that the value of the event indicator at the previous event instant, \(z(t_{i-1}) \neq 0\), must be non-zero and this condition cannot be guaranteed. The often used term "zero crossing function" for <code>z</code> is misleading (and is therefore not used in this document), since a state event is defined by a change of a domain and not by a zero crossing of a variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>step event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that might occur at a completed integrator step. Since this event type is not defined by a precise time or condition, it is usually not defined by a user. A program may use it, for example, to dynamically switch between different states. A step event is handled much more efficiently than a <em>state event</em>, because the event is just triggered after performing a check at a completed integrator step, whereas a search procedure is needed for a state event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>super-dense time</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A precise definition of time taking into account iterations at an event. For an <em>FMU</em>, the <a href="#independent"><code>independent</code></a> variable time \(t \in \mathbb{T}\) is a tuple \(t = (t_R, t_I)\) where \(t_R \in  \mathbb{R}, t_I \in \mathbb{N} = \{0,1,2,\ldots\}\). The real part \(t_R\) of this tuple is the <a href="#independent"><code>independent</code></a> variable of the FMU for describing the continuous-time behavior of the model between events. In this phase \(t_I = 0\). The integer part \(t_I\) of this tuple is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(t_R\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>time event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that is defined by a predefined time instant. Since the time instant is known in advance, the integrator can select its step size so that the event point is directly reached. Therefore, this event can be handled efficiently.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The part of the simulation program that gives the user control over the simulation and allows watching results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XML</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eXtensible Markup Language (<a href="http://www.w3.org/XML/">www.w3.org/XML</a>, <a href="http://en.wikipedia.org/wiki/Xml">en.wikipedia.org/wiki/XML</a>) - An open standard to store information in text files in a structured form.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>