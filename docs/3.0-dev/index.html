<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<title>Functional Mock-up Interface for Model&#160;Exchange and Co-Simulation</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:30em;padding-right:0}
#toc.toc2{width:30em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

/* customizations */

body{
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
}

.toc-hidden {
  padding-left: 0 !important;
}

.imageblock {
  text-align: center;
}

.imageblock img {
  display: block;
  margin: auto;
}

.imageblock .title {
  display: inline-block;
  margin: auto;
}

.vertical-text {
	transform: rotate(-90deg) translate(-8em, 0);
	transform-origin: left top 0;
  float: left;
  display: inline-block;
  white-space: nowrap;
  width: 1em;
  height: 8em;
}

/* no alternating row colors */
table tr.even,table tr.alt,table tr:nth-of-type(even) {
  background:none
}

/* use parent text color for captions */
.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
  color: inherit;
}

</style>
<script>
// hide / show the Table of Contents (TOC)
function toggleTOC() {
  var toc = document.getElementById("toc");
  var body = document.getElementsByTagName("body")[0];

  if (toc.style.display === "none") {
      toc.style.display = "block";
      body.classList.remove("toc-hidden");
  } else {
      toc.style.display = "none";
      body.classList.add("toc-hidden");
  }
}

// toggle the TOC when "t" key is pressed
document.addEventListener('keydown', (event) => {
  if (event.key == 't') {
    toggleTOC();
  }
});
</script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Functional Mock-up Interface for Model&#160;Exchange and Co-Simulation</h1>
<div class="details">
<span id="revnumber">version 3.0,</span>
<span id="revdate">unreleased</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#_properties_and_guiding_ideas">1.1. Properties and Guiding Ideas</a></li>
<li><a href="#_acknowledgements">1.2. Acknowledgements</a></li>
</ul>
</li>
<li><a href="#fmi-common-concepts">2. FMI Common Concepts for Model Exchange and Co-Simulation</a>
<ul class="sectlevel2">
<li><a href="#_fmi_application_programming_interface">2.1. FMI Application Programming Interface</a>
<ul class="sectlevel3">
<li><a href="#header-files-and-naming-of-functions">2.1.1. Header Files and Naming of Functions</a></li>
<li><a href="#_platform_dependent_definitions_fmi3typesplatform_h">2.1.2. Platform Dependent Definitions (fmi3TypesPlatform.h)</a></li>
<li><a href="#status-returned-by-functions">2.1.3. Status Returned by Functions</a></li>
<li><a href="#inquire-platform-and-version-number">2.1.4. Inquire Platform and Version Number of Header Files</a></li>
<li><a href="#creation-destruction-and-logging">2.1.5. Creation, Destruction and Logging of FMU Instances</a></li>
<li><a href="#_initialization_termination_and_resetting_an_fmu">2.1.6. Initialization, Termination, and Resetting an FMU</a></li>
<li><a href="#get-and-set-variable-values">2.1.7. Getting and Setting Variable Values</a></li>
<li><a href="#get-set-fmu-state">2.1.8. Getting and Setting the Complete FMU State</a></li>
<li><a href="#_getting_partial_derivatives">2.1.9. Getting Partial Derivatives</a></li>
<li><a href="#_getting_number_of_event_indicators">2.1.10. Getting Number of Event Indicators</a></li>
<li><a href="#_getting_number_of_states">2.1.11. Getting Number of States</a></li>
<li><a href="#_getting_number_of_variable_dependencies_and_variable_dependencies">2.1.12. Getting Number of Variable Dependencies and Variable Dependencies</a></li>
</ul>
</li>
<li><a href="#fmi-description-schema">2.2. FMI Description Schema</a>
<ul class="sectlevel3">
<li><a href="#fmiModelDescription">2.2.1. Definition of an FMU (fmiModelDescription)</a></li>
<li><a href="#_definition_of_units_unitdefinitions">2.2.2. Definition of Units (UnitDefinitions)</a></li>
<li><a href="#definition-of-types">2.2.3. Definition of Types (TypeDefinitions)</a></li>
<li><a href="#definition-of-log-categories">2.2.4. Definition of Log Categories (LogCategories)</a></li>
<li><a href="#DefaultExperiment">2.2.5. Definition of a Default Experiment (DefaultExperiment)</a></li>
<li><a href="#_definition_of_vendor_annotations_vendorannotations">2.2.6. Definition of Vendor Annotations (VendorAnnotations)</a></li>
<li><a href="#definition-of-model-variables">2.2.7. Definition of Model Variables (ModelVariables)</a></li>
<li><a href="#ModelStructure">2.2.8. Definition of the Model Structure (ModelStructure)</a></li>
<li><a href="#variableNamingConvention">2.2.9. Variable Naming Conventions (variableNamingConvention)</a></li>
</ul>
</li>
<li><a href="#fmu-distribution">2.3. FMU Distribution</a></li>
</ul>
</li>
<li><a href="#fmi-for-model-exchange">3. FMI for Model Exchange</a>
<ul class="sectlevel2">
<li><a href="#math-model-exchange">3.1. Mathematical description</a></li>
<li><a href="#_fmi_application_programming_interface_2">3.2. FMI Application Programming Interface</a>
<ul class="sectlevel3">
<li><a href="#providing-independent-variables-and-re-initialization">3.2.1. Providing Independent Variables and Re-initialization of Caching</a></li>
<li><a href="#evaluation-of-model-equations">3.2.2. Evaluation of Model Equations</a></li>
<li><a href="#state-machine-model-exchange">3.2.3. State Machine of Calling Sequence</a></li>
<li><a href="#_pseudo_code_example">3.2.4. Pseudo-code Example</a></li>
</ul>
</li>
<li><a href="#_fmi_description_schema">3.3. FMI Description Schema</a>
<ul class="sectlevel3">
<li><a href="#ModelExchange">3.3.1. Model Exchange FMU (ModelExchange)</a></li>
<li><a href="#xml-example-model-exchange">3.3.2. Example XML Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#fmi-for-co-simulation">4. FMI for Co‑Simulation</a>
<ul class="sectlevel2">
<li><a href="#math-co-simulation">4.1. Mathematical Description</a>
<ul class="sectlevel3">
<li><a href="#_basics">4.1.1. Basics</a></li>
<li><a href="#_mathematical_model">4.1.2. Mathematical Model</a></li>
</ul>
</li>
<li><a href="#_fmi_application_programming_interface_3">4.2. FMI Application Programming Interface</a>
<ul class="sectlevel3">
<li><a href="#transfer-of-input-output-and-parameters">4.2.1. Transfer of Input / Output Values and Parameters</a></li>
<li><a href="#_computation">4.2.2. Computation</a></li>
<li><a href="#retrieving-status-from-slave">4.2.3. Retrieving Status Information from the Slave</a></li>
<li><a href="#state-machine-co-simulation">4.2.4. State Machine of Calling Sequence from Master to Slave</a></li>
<li><a href="#_pseudo_code_example_2">4.2.5. Pseudo-code Example</a></li>
</ul>
</li>
<li><a href="#_fmi_description_schema_2">4.3. FMI Description Schema</a>
<ul class="sectlevel3">
<li><a href="#CoSimulation">4.3.1. Co-Simulation FMU (CoSimulation)</a></li>
<li><a href="#_example_xml_description_file">4.3.2. Example XML Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_literature">5. Literature</a></li>
<li><a href="#_fmi_revision_history">Appendix A: FMI Revision History</a>
<ul class="sectlevel2">
<li><a href="#_a_1_version_1_0_fmi_for_model_exchange">A.1 Version 1.0 – FMI for Model Exchange</a></li>
<li><a href="#_a_2_version_1_0_fmi_for_co_simulation">A.2 Version 1.0 – FMI for Co-Simulation</a></li>
<li><a href="#_a_3_version_2_0_fmi_for_model_exchange_and_co_simulation">A.3 Version 2.0 – FMI for Model Exchange and Co-Simulation</a>
<ul class="sectlevel3">
<li><a href="#_a_3_1_overview">A.3.1 Overview</a></li>
<li><a href="#_a_3_2_main_changes">A.3.2 Main changes</a></li>
<li><a href="#_a_3_3_contributors">A.3.3 Contributors</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_glossary">Appendix B: Glossary</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document defines the Functional Mock-up Interface (FMI), version 2.0.
FMI is a tool-independent standard to support both model exchange and co-simulation of dynamic models using a combination of XML files and C code (either compiled in DLL/shared libraries or in source code).
The first version, FMI 1.0, was published in 2010.
The FMI development was initiated by Daimler AG with the goal to improve the exchange of simulation models between suppliers and OEMs.
As of today, development of the standard continues through the participation of 16 companies and research institutes.
FMI 1.0 is supported by over 45 tools and is used by automotive and non-automotive organizations throughout Europe, Asia and North America.</p>
</div>
<div class="paragraph">
<p>The downloads page (<a href="https://fmi-standard.org/downloads/" class="bare">https://fmi-standard.org/downloads/</a>) provides, this specification, as well as supporting C header and XML schema files, and an FMI compliance checker.
In addition, sample models (exported from different tools in FMI format) are provided to assist tool vendors to ensure compatibility with other tools, as well as a test suite to check whether connected FMUs (Function Mock-up Units) are appropriately handled by a tool.</p>
</div>
<div class="paragraph">
<p>Contact the FMI development group at <a href="mailto:contact@fmi-standard.org">contact@fmi-standard.org</a>.</p>
</div>
<div class="paragraph">
<p><em>History / Road Map</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Date</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-01-26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First version of FMI for Model Exchange</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-10-12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First version of FMI for Co-Simulation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014-07-25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Second version of FMI for Model Exchange and Co-Simulation</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Please report issues that you find with this specification to the public FMI issue tracking system: <a href="https://github.com/modelica/fmi-standard/issues/" class="bare">https://github.com/modelica/fmi-standard/issues/</a></p>
</div>
<div class="paragraph">
<p><strong>License of this document</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Copyright &#169;</dt>
<dd>
<p>2008-2011 MODELISAR consortium and<br>
2012-2014 Modelica Association Project "FMI"</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This document is provided "as is" without any warranty.
It is licensed under the CC-BY-SA (Creative Commons Attribution-Sharealike 4.0 International) license, which is the license used by Wikipedia.
Human-readable summary of the license text from <a href="http://creativecommons.org/licenses/by-sa/4.0/" class="bare">http://creativecommons.org/licenses/by-sa/4.0/</a> is as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">You are free to</p>
<p class="tableblock"><strong>Share</strong> — copy and redistribute the material in any medium or format</p>
<p class="tableblock"><strong>Remix</strong> — remix, transform, and build upon the material for any purpose, even commercially.</p>
<p class="tableblock">The licensor cannot revoke these freedoms as long as you follow the license terms.</p>
<p class="tableblock">Under the following terms:</p>
<p class="tableblock"><strong>Attribution</strong> — You must give appropriate credit, provide a link to the
license, and indicate if changes were made.
You may do so in any reasonable manner, but not in any way that suggests the licensor endorses you or your use.</p>
<p class="tableblock"><strong>Share Alike</strong> — If you remix, transform, or build upon the material, you must distribute your contributions under the same license as the original.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The legal license text and disclaimer is available at:</p>
</div>
<div class="paragraph">
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/legalcode" class="bare">http://creativecommons.org/licenses/by-sa/4.0/legalcode</a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Note</dt>
<dd>
<p>Article (3a) of this license requires that modifications of this work must clearly label, demarcate or otherwise identify that changes were made.</p>
<div class="paragraph">
<p>The C header and XML schema files that accompany this document are available under the <a href="https://opensource.org/licenses/BSD-2-Clause">2-Clause BSD license</a>.</p>
</div>
<div class="paragraph">
<p>Attention is drawn to the possibility that some of the elements of this document may be the subject of patent rights.
Modelica Association shall not be held responsible for identifying such patent rights.</p>
</div>
<div class="paragraph">
<p>If you have improvement suggestions, please send them to the FMI development group at mailto:contact@fmi-standard.org.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>Abstract</strong></p>
</div>
<div class="paragraph">
<p>This document defines the Functional Mock-up Interface (FMI),
version 2.0 to (a) exchange dynamic models between tools and (b) define tool
coupling for dynamic system simulation environments.</p>
</div>
<div class="paragraph">
<p><em>FMI for Model Exchange (<a href="#fmi-for-model-exchange">Section 3</a>)</em></p>
</div>
<div class="paragraph">
<p>The intention is that a modeling environment can generate a C code representation of
a dynamic system model that can be utilized by other modeling and simulation environments.
Models are described by differential,
algebraic and discrete equations with time-, state- and step-events.
If the C code describes a continuous system,
this system is solved with the integrators of the environment where it is used.
The models to be treated by this interface can be large for usage in offline or online simulation,
or they can be used in embedded control systems on micro-processors.</p>
</div>
<div class="paragraph">
<p><em>FMI for Co-Simulation (<a href="#fmi-for-co-simulation">Section 4</a>)</em></p>
</div>
<div class="paragraph">
<p>The intention is to provide an interface standard for coupling
of simulation tools in a co-simulation environment.
The data exchange between subsystems is restricted to discrete communication points.
In the time between two communication points,
the subsystems are solved independently from each other by their individual solver.
Master algorithms control the data exchange between subsystems and the
synchronization of all simulation solvers (slaves).
Simple master algorithms,
as well as more sophisticated ones are both supported.
Note that the master algorithm itself is not part of the FMI standard.</p>
</div>
<div class="paragraph">
<p><em>FMI Common Concepts (<a href="#fmi-common-concepts">Section 2</a>)</em></p>
</div>
<div class="paragraph">
<p>The two interface standards have many parts in common.
In particular, it is possible to utilize several
instances of a model and/or a co-simulation tool and to connect them together.
The interfaces are independent of the target environment because no header files
are used that depend on the target environment
(with exception of the data types of the target platform).
This allows generating one dynamic link library that can be utilized in any environment on the same platform.
A model, a cosimulation slave or the coupling part of a tool,
is distributed in one ZIP file called FMU (Functional Mockup Unit) that contains several files:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An XML file contains the definitions of all exposed variables in the FMU and other static information.
It is then possible to run the FMU on a target system without this information,
in other words with no unnecessary overhead.</p>
</li>
<li>
<p>All required model equations or the access to co-simulation tools are provided with a small set of easy-to-use C functions.
A new caching technique allows a more efficient evaluation of
the model equations than in other approaches.
These C functions can either be provided in source and/or binary form.
Binary forms for different platforms can be included in the same FMU ZIP file.</p>
</li>
<li>
<p>The model equations or the co-simuation tool can be either provided directly in the FMU,
or the FMU contains only a generic communication module that communicates
with an external tool that evaluates or simulates the model.
In the XML file, information about the capabilities of the FMU are present,
for example to characterize the ability of a co-simulation slave to support advanced master algorithms such as the usage of variable communication step sizes,
higher order signal extrapolation, or others.</p>
</li>
<li>
<p>Further data can be included in the FMU ZIP file,
especially a model icon (bitmap file),
documentation files,
maps and tables needed by the FMU,
and/or all object libraries or dynamic link libraries that are
utilized.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A growing set of tools supports FMI.
The actual list of tools is available at: <a href="https://www.fmi-standard.org/tools" class="bare">https://www.fmi-standard.org/tools</a></p>
</div>
<div class="paragraph">
<p><strong>About FMI 2.0</strong></p>
</div>
<div class="paragraph">
<p>This version 2.0 is a major enhancement to FMI 1.0,
that merges the FMI 1.0 Model Exchange and
Co-Simulation standards
and incorporates many improvements,
often due to practical experience when using the FMI 1.0 standards.
New features are usually optional
(need neither be supported by the tool that exports an FMU, nor by the tool that imports an FMU).
Details are provided in appendix A.3.1.
The appendix of the FMI 1.0 specification has been mostly moved in an
extended and improved form to a companion document</p>
</div>
<div class="paragraph">
<p>"FunctionalMockupInterface-ImplementationHints.pdf"</p>
</div>
<div class="paragraph">
<p>where practical information for the implementation of the FMI standard is provided.</p>
</div>
<div class="paragraph">
<p><strong>Conventions used in this Document</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-normative text is given in square brackets in italic font: <em>[Especially examples are defined in this style.]</em></p>
</li>
<li>
<p>Arrays appear in two forms:</p>
<div class="ulist">
<ul>
<li>
<p>In the end-user/logical view, one- and two-dimensional arrays are used.
Here the convention of linear algebra,
the control community and the most important tools in this area is utilized.
In other words the first element along one dimension starts at index one.
In all these cases,
the starting index is also explicitly mentioned at the respective definition of the array.
For example,
in the modelDescription.xml file,
the set of exposed variables is defined as ordered sets where the first
element is referenced with index one
(these indices are, for example,
used to define the sparseness structure of partial derivative matrices).</p>
</li>
<li>
<p>In the implementation view, one-dimensional C arrays are used.
In order to access an array element the C convention is used.
For example,
the first element of input argument <code>x</code> for function <code>setContinuousStates</code> is <code>x[0]</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The FMI (Functional Mock-up Interface) defines an interface to
be implemented by an executable called an FMU (Functional Mock-up Unit).
The FMI functions are used (called) by a simulation environment to
create one or more instances of the FMU and to simulate them,
typically together with other models.
An FMU may either have its own solvers
(FMI for Co-Simulation, <a href="#fmi-for-co-simulation">Section 4</a>)
or require the simulation environment to perform numerical integration
(FMI for Model Exchange, <a href="#fmi-for-model-exchange">Section 3</a>).
The goal of this interface is that the calling of an FMU
in a simulation environment is reasonably simple.
No provisions are provided in this document for how to generate an FMU from a modeling environment.
Hints for implementation can be found in the companion document "FunctionalMockupInterfaceImplementationHints.pdf".</p>
</div>
<div class="paragraph">
<p>The <span class="underline">FMI for Model Exchange</span> interface defines an interface to the model
of a dynamic system described by <span class="underline">differential</span>,
<span class="underline">algebraic</span> and <span class="underline">discrete-time</span> equations.
It provides an interface to evaluate these
equations as needed in different <span class="underline">simulation environments</span>,
as well as in <span class="underline">embedded control systems</span>,
with explicit or implicit integrators, and fixed or variable step-size.
The interface is designed to allow the
description of large models.</p>
</div>
<div class="paragraph">
<p>The <span class="underline">FMI for Co-Simulation</span> interface is designed both for the <span class="underline">coupling of simulation tools</span>
(simulator coupling, tool coupling),
and coupling with subsystem models,
which have been exported by their
simulators together with its solvers as <span class="underline">runnable code</span>.
The goal is to compute the solution of time-dependent
coupled systems consisting of subsystems that are continuous in time (model components
that are described by differential-algebraic equations) or are time-discrete (model components that are
described by difference equations, for example discrete controllers).
In a block representation of the coupled system,
the subsystems are represented by blocks with (internal) state variables <code>x(t)</code> that are
connected to other subsystems (blocks) of the coupled problem
by subsystem inputs <code>u(t)</code> and subsystem outputs <code>y(t)</code>.</p>
</div>
<div class="paragraph">
<p>In case of tool coupling,
the modular structure of coupled problems is exploited in all stages of the
simulation process beginning with the separate model setup and pre-processing for the individual
subsystems in different simulation tools.
During time integration, the simulation is again performed independently for all
subsystems restricting the data exchange between subsystems to discrete <em>communication points</em>.
Finally, the visualization and post-processing of simulation data is done
individually for each subsystem in its own native simulation tool.</p>
</div>
<div class="paragraph">
<p>The two interfaces have large parts in common.
These parts are defined in <a href="#fmi-common-concepts">Section 2</a>.
In particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="underline">FMI Application Programming Interface (C)</span><br>
All required equations or tool coupling computations are evaluated by calling standardized <span class="underline">C functions</span>.
C is used
because it is the most portable programming language today and is the only
programming language that can be utilized in all embedded control systems.</p>
</li>
<li>
<p><span class="underline">FMI Description Schema (XML)</span><br>
The schema defines the structure and content of an XML file generated by a modeling environment.
This XML file contains the definition of all variables of the FMU in a standardized way.
It is then
possible to run the C code in an embedded system without the overhead of the variable definition
(the alternative would be to store this information in the C code and access it via function calls,
but this is neither practical for embedded systems nor for large models).
Furthermore, the variable definition is a complex data structure and tools should
be free to determine how to represent this data structure in their programs.
The selected approach allows a tool to store and access the variable definitions
(without any memory or efficiency overhead of standardized access functions) in the programming
language of the simulation environment,
such as C++, C#, Java, or Python. Note that there are many free and commercial libraries
in different programming languages to read XML files into an appropriate data structure.
See for example <a href="http://en.wikipedia.org/wiki/XML#Parsers" class="bare">http://en.wikipedia.org/wiki/XML#Parsers</a>
and especially the efficient open source parser SAX (<a href="http://sax.sourceforge.net/" class="bare">http://sax.sourceforge.net/</a>,
<a href="http://en.wikipedia.org/wiki/Simple_API_for_XML" class="bare">http://en.wikipedia.org/wiki/Simple_API_for_XML</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An FMU (in other words a model without integrators,
a runnable model with integrators,
or a tool coupling interface) is distributed in one ZIP file.
The ZIP file contains (more details are given in <a href="#fmu-distribution">Section 2.3</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The FMI Description File (in XML format).</p>
</li>
<li>
<p>The C sources of the FMU,
including the needed run-time libraries used in the model,
and/or binaries for one or several target machines,
such as Windows dynamic link libraries (.dll) or
Linux shared object libraries (.so).
The latter solution is especially used if the FMU provider
wants to hide the source code to secure the contained know-how or to allow a fully automatic
import of the FMU in another simulation environment.
An FMU may contain physical parameters or geometrical dimensions,
which should not be open.
On the other hand,
some functionality requires source code.</p>
</li>
<li>
<p>Additional FMU data (such as tables or maps) in FMU specific file formats.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A schematic view of an FMU is shown in <a href="#figure-data-flow">Figure 1</a>:</p>
</div>
<div id="figure-data-flow" class="imageblock text-center">
<div class="content">
<img src="images/enclosing_model.svg" alt="enclosing model" width="60%">
</div>
<div class="title">Figure 1. Data flow between the environment and an FMU.</div>
</div>
<div class="paragraph">
<p>For details, see <a href="#fmi-for-model-exchange">Section 3</a> and <a href="#fmi-for-co-simulation">Section 4</a>.
<span class="blue">Blue</span> arrows: Information provided by the FMU.
<span class="red">Red</span> arrows: Information provided to the FMU.</p>
</div>
<div class="paragraph">
<p>Publications for FMI are available from <a href="https://fmi-standard.org/literature/" class="bare">https://fmi-standard.org/literature/</a>,
specially Blochwitz et.al. <a href="http://www.ep.liu.se/ecp/063/013/ecp11063013.pdf">2011</a> and <a href="http://www.ep.liu.se/ecp/076/017/ecp12076017.pdf">2012</a>.</p>
</div>
<div class="sect2">
<h3 id="_properties_and_guiding_ideas">1.1. Properties and Guiding Ideas</h3>
<div class="paragraph">
<p>In this section,
properties are listed and some principles are defined that guided the low-level design of
the FMI.
This shall increase self consistency of the interface functions.
The listed issues are sorted,
starting from high-level properties to low-level implementation issues.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Expressivity</dt>
<dd>
<p>The FMI provides the necessary features that Modelica&#174;, Simulink&#174; and SIMPACK&#174; models
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>
can transform to an FMU.</p>
</dd>
<dt class="hdlist1">Stability</dt>
<dd>
<p>The FMI is expected to be supported by many simulation tools world-wide.
Implementing such support is a major investment for tool vendors.
Stability and backwards compatibility of the FMI has therefore high priority.
To support this, the FMI defines "capability flags" that will be used by future versions of the FMI to extend and improve the FMI in a backwards compatible way, whenever feasible.</p>
</dd>
<dt class="hdlist1">Implementation</dt>
<dd>
<p>FMUs can be written manually or can be generated automatically from a modeling environment.
Existing manually coded models can be transformed manually to a model according to the FMI standard.</p>
</dd>
<dt class="hdlist1">Processor independence</dt>
<dd>
<p>It is possible to distribute an FMU without knowing the target processor.
This allows an FMU to run on a PC, a Hardware-in-the-Loop simulation platform or as part of the controller software of an ECU, for example, as part of an AUTOSAR SWC.
Keeping the FMU independent of the target processor increases the usability of the FMU and is even required by the AUTOSAR software component model.
Implementation: Using a textual FMU (distribute the C source of the FMU).</p>
</dd>
<dt class="hdlist1">Simulator independence</dt>
<dd>
<p>It is possible to compile, link and distribute an FMU without knowing the target simulator.
Reason: The standard would be much less attractive otherwise, unnecessarily restricting the later use of an FMU at compile time and forcing users to maintain simulator specific variants of an FMU.
Implementation: Using a binary FMU.
When generating a binary FMU such as a Windows dynamic link library (.dll) or a Linux shared object library (.so), the target operating system and eventually the target processor must be known.
However, no run-time libraries, source files or header files of the target simulator are needed to generate the binary FMU.
As a result, the binary FMU can be executed by any simulator running on the target platform (provided the necessary licenses are available, if required from the model or from the used run-time libraries).</p>
</dd>
<dt class="hdlist1">Small run-time overhead</dt>
<dd>
<p>Communication between an FMU and a target simulator through the FMI does not introduce significant run-time overhead.
This is achieved by a new caching technique (to avoid computing the same variables several times) and by exchanging vectors instead of scalar quantities.</p>
</dd>
<dt class="hdlist1">Small footprint</dt>
<dd>
<p>A compiled FMU (the executable) is small.
Reason: An FMU may run on an ECU (Electronic Control Unit, for example, a micro-processor), and ECUs have strong memory limitations.
This is achieved by storing signal attributes (names, units, etc.) and all other static information not needed for model evaluation in a separate text file (= Model Description File) that is not needed on the micro-processor where the executable might run.</p>
</dd>
<dt class="hdlist1">Hide data structure</dt>
<dd>
<p>The FMI for Model Exchange does not prescribe a data structure (a C struct) to represent a model.
Reason: the FMI standard shall not unnecessarily restrict or prescribe a certain implementation of FMUs or simulators (whichever contains the model data) to ease implementation by different tool vendors.</p>
</dd>
<dt class="hdlist1">Support many and nested FMUs</dt>
<dd>
<p>A simulator may run many FMUs in a single simulation run and/or multiple instances of one FMU.
The inputs and outputs of these FMUs can be connected with direct feed-through.
Moreover, an FMU may contain nested FMUs.</p>
</dd>
<dt class="hdlist1">Numerical Robustness</dt>
<dd>
<p>The FMI standard allows that problems which are numerically critical (for example, time and state events, multiple sample rates, stiff problems) can be treated in a robust way.</p>
</dd>
<dt class="hdlist1">Hide cache</dt>
<dd>
<p>A typical FMU will cache computed results for later reuse.
To simplify usage and to reduce error possibilities by a simulator, the caching mechanism is hidden from the usage of the FMU.
Reason: First, the FMI should not force an FMU to implement a certain caching policy.
Second, this helps to keep the FMI simple.</p>
</dd>
<dt class="hdlist1">Implementation</dt>
<dd>
<p>The FMI provides explicit methods (called by the FMU environment) for setting properties that invalidate cached data.
An FMU that chooses to implement a cache may maintain a set of "dirty" flags, hidden from the simulator.
A get method, for example to a state, will then either trigger a computation, or return cached data, depending on the value of these flags.</p>
</dd>
<dt class="hdlist1">Support numerical solvers</dt>
<dd>
<p>A typical target simulator will use numerical solvers.
These solvers require vectors for states, derivatives and zero-crossing functions.
The FMU directly fills the values of such vectors provided by the solvers.
Reason: minimize execution time.
The exposure of these vectors conflicts somewhat with the "hide data structure" requirement, but the efficiency gain justifies this.</p>
</dd>
<dt class="hdlist1">Explicit signature</dt>
<dd>
<p>The intended operations, argument types and return values are made explicit in the signature.
For example, an operator (such as <code>compute_derivatives</code>) is not passed as an int argument but a special function is called for this.
The <code>const</code> prefix is used for any pointer that should not be changed, including <code>const char*</code> instead of <code>char*</code>.
Reason: the correct use of the FMI can be checked at compile time and allows calling of the C code in a C++ environment (which is much stricter on <code>const</code> than C is).
This will help to develop FMUs that use the FMI in the intended way.</p>
</dd>
<dt class="hdlist1">Few functions</dt>
<dd>
<p>The FMI consists of a few, "orthogonal" functions, avoiding redundant functions that could be defined in terms of others.
Reason: This leads to a compact, easy-to-use, and hence attractive API with a compact documentation.</p>
</dd>
<dt class="hdlist1">Error handling</dt>
<dd>
<p>All FMI methods use a common set of methods to communicate errors.</p>
</dd>
<dt class="hdlist1">Allocator must free</dt>
<dd>
<p>All memory (and other resources) allocated by the FMU are freed (released) by the FMU.
Likewise, resources allocated by the simulator are released by the simulator.
Reason: this helps to prevent memory leaks and run-time errors due to incompatible run-time environments for different components.</p>
</dd>
<dt class="hdlist1">Immutable strings</dt>
<dd>
<p>All strings passed as arguments or returned are read-only and must not be modified by the receiver.
Reason: This eases the reuse of strings.</p>
</dd>
<dt class="hdlist1">Named list elements</dt>
<dd>
<p>All lists defined in the <code>fmiModelDescription.xsd</code> XML schema file have a String attribute <code>name</code> to a list element.
This attribute must be unique with respect to all other <code>name</code> attributes of the <em>same</em> list.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Use C:
The FMI is encoded using C, not C++.
Reason: Avoid problems with compiler and linker dependent behavior.
Run FMU on embedded target.</p>
</div>
<div class="paragraph">
<p>This version of the functional mock-up interface does <span class="underline">not</span> have the following desirable properties.
They might be added in a future version.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The FMI for Model Exchange is for ordinary differential equations (ODEs) in state space form.
It is not for a general differential-algebraic equation system.
However, algebraic equation systems inside the FMU are supported (for example, the FMU can report to the environment to re-run the current step with a smaller step size since a solution could not be found for an algebraic equation system).</p>
</li>
<li>
<p>Special features that might be useful for multibody system programs, like SIMPACK, are not included.</p>
</li>
<li>
<p>The interface is for simulation and for embedded systems.
Properties that might be additionally needed for trajectory optimization, for example, derivatives of the model with respect to parameters during continuous integration are not included.</p>
</li>
<li>
<p>No explicit definition of the variable hierarchy in the XML file.</p>
</li>
<li>
<p>The number of states and number of event indicators are fixed for an FMU and cannot be changed.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgements">1.2. Acknowledgements</h3>
<div class="paragraph">
<p>Until Dec. 2011, this work was carried out within the ITEA2 MODELISAR project (project number: ITEA2-07006, <a href="https://itea3.org/project/modelisar.html" class="bare">https://itea3.org/project/modelisar.html</a>).</p>
</div>
<div class="paragraph">
<p>Daimler AG, DLR, ITI GmbH, Martin Luther University Halle-Wittenberg, QTronic GmbH and SIMPACK AG thank BMBF for partial funding of this work within MODELISAR (BMBF Förderkennzeichen: 01lS0800x).</p>
</div>
<div class="paragraph">
<p>Dassault Systèmes (Sweden) thanks the Swedish funding agency VINNOVA (2008-02291) for partial funding of this work within MODELISAR.</p>
</div>
<div class="paragraph">
<p>LMS Imagine and IFPEN thank DGCIS for partial funding of this work within MODELISAR.</p>
</div>
<div class="paragraph">
<p>Since Sept. 2012 until Nov. 2015, this work is partially carried out within the ITEA2 MODRIO project (project number: ITEA 2-11004, <a href="https://itea3.org/project/modrio.html" class="bare">https://itea3.org/project/modrio.html</a>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DLR, ITI GmbH, QTronic GmbH and SIMPACK AG thank BMBF for partial funding of this work within MODRIO (BMBF Förderkennzeichen: 01IS12022E).</p>
</li>
<li>
<p>Dassault Systèmes (Sweden), Linköping University and Modelon AB thank the Swedish funding agency VINNOVA (2012&#8212;&#8203;01157) for partial funding of this work within MODRIO.</p>
</li>
<li>
<p>Siemens PLM Software (France) and IFPEN thank DGCIS for partial funding of this work within MODRIO.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-common-concepts">2. FMI Common Concepts for Model Exchange and Co-Simulation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The concepts defined in this chapter are defined that are common for "model exchange" and "co-simulation".
In both cases, FMI defines an input/output block of a dynamic model where the distribution of the block, the platform dependent header file, several access functions, as well as the schema files are identical.
The definitions that are specific to the particular cases are defined in <a href="#fmi-for-model-exchange">Section 3</a> and <a href="#fmi-for-co-simulation">Section 4</a>.
.</p>
</div>
<div class="paragraph">
<p>Below, the term <em>FMU</em> (Functional Mock-up Unit) will be used as common term for a model in the "FMI for model exchange" format, or a co-simulation <span class="underline">slave</span> in the "FMI for co-simulation" format.
Note that the interface supports <span class="underline">several instances</span> of <span class="underline">one FMU</span>.</p>
</div>
<div class="sect2">
<h3 id="_fmi_application_programming_interface">2.1. FMI Application Programming Interface</h3>
<div class="paragraph">
<p>This section contains the common interface definitions to execute functions of an FMU from a C program.</p>
</div>
<div class="paragraph">
<p>Note that he following general properties hold for an FMU:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI functions of one instance do not need to be thread-safe.<br>
<em>[For example, if the functions of one instance of an FMU are accessed from more than one thread;
the multi-threaded environment that uses the FMU must guarantee that the calling sequences of functions defined in <a href="#state-machine-model-exchange">Section 3.2.3</a> and <a href="#state-machine-co-simulation">Section 4.2.4</a>. are used.
The FMU itself does not implement any services to support this.]</em></p>
</li>
<li>
<p>FMI functions must not change global settings which affect other processes/threads.
An FMI function may change settings of the process/thread in which it is called (such as floating point control registers), provided these changes are restored before leaving the function or before a callback function is called.<br>
<em>[This property ensures that functions of different FMU instances can be called safely in any order.
Additionally, they can be called in parallel provided the functions are called in different process/threads.
If an FMI function changes for example the floating point control word of the CPU, it must restore the previous value before return of the function.
For x86 CPUs, the floating point control word is set using the <code>fldcw</code> instruction.
This can be used to switch on additional exceptions such as "floating point division by zero".
An FMU might temporarily change the floating point control word and get notified on floating point exceptions internally, but has to restore the flag and clear the floating point status word before return of the respective FMI function.]</em></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="header-files-and-naming-of-functions">2.1.1. Header Files and Naming of Functions</h4>
<div class="paragraph">
<p>Three header files are provided that define the interface of an FMU.
In all header files the convention is used that all C function and type definitions start with the prefix "<span class="underline">fmi3</span>":</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3TypesPlatform.h</code></dt>
<dd>
<p>contains the type definitions of the input and output arguments of the functions.
This header file must
be used both by the FMU and by the target simulator.
If the target simulator has different definitions in
the header file (for example, <code>typedef float fmi3Real</code> instead of <code>typedef double** fmi3Real</code>),
then the <span class="underline">FMU</span> needs to be <span class="underline">re-compiled</span> with the header file used by the <span class="underline">target simulator</span>.<br>
<em>[Example for a definition in this header file:<br>
<code>typedef double fmi3Real;</code><br>
]</em></p>
</dd>
<dt class="hdlist1"><code>fmi3FunctionTypes.h</code></dt>
<dd>
<p>contains <code>typedef</code> definitions of all function prototypes of an FMU.
When dynamically loading an FMU, these definitions can be used to type-cast the function pointers to the respective function definition.
<em>[Example for a definition in this header file:<br>
<code>typedef fmi3Status fmi3SetTimeTYPE(fmi3Component, fmi3Real);</code>]</em></p>
</dd>
<dt class="hdlist1"><code>fmi3Functions.h</code></dt>
<dd>
<p>contains the function prototypes of an FMU that can be accessed in simulation environments and that are defined in <a href="#fmi-common-concepts">Section 2</a>, <a href="#fmi-for-model-exchange">Section 3</a> and
<a href="#fmi-for-co-simulation">Section 4</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This header file includes <code>fmi3TypesPlatform.h</code> and <code>fmi3FunctionTypes.h</code>.
The header file version number for which the model was compiled, can be inquired in the target simulator with <code>fmi3GetVersion</code> (see <a href="#inquire-platform-and-version-number">Section 2.1.4</a>).<br>
<em>[Example for a definition in this header file</em> <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>:<br>
<em>`FMI3_Export fmi3SetTimeTYPE fmi3SetTime;`]</em></p>
</div>
<div class="paragraph">
<p>The goal is that both textual and binary representations of FMUs are supported and that several FMUs
might be present at the same time in an executable (for example, FMU A may use an FMU B).
In order for this to be possible,
the names of the functions in different FMUs must be different, or function pointers must be used.
To support the first variant macros are provided in <code>fmi3Functions.h</code> to build the actual
function names by using a function prefix that depends on how the FMU is shipped.
Typically, FMU functions are used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">// FMU is shipped with C source code, or with static link library
#define FMI3_FUNCTION_PREFIX MyModel_
#include "fmi3Functions.h"
&lt; usage of the FMU functions &gt;
// FMU is shipped with DLL/SharedObject
#include "fmi3Functions.h"
&lt; usage of the FMU functions &gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function that is defined as <code>fmi3GetReal</code> is changed by the macros to a function name as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the FMU is shipped with C source code or with static link library:<br>
The constructed function name is <code>MyModel_fmi3GetReal</code>.
In other words the function name is prefixed with the model name and an <code>_</code>.
As <code>FMI3_FUNCTION_PREFIX</code> the <code>modelIdentifier</code> attribute defined in <code>&lt;fmiModelDescription&gt;&lt;ModelExchange&gt;</code>, or <code>&lt;fmiModelDescription&gt;&lt;CoSimulation&gt;</code> is used, together with <code>_</code> at the end (see <a href="#ModelExchange">Section 3.3.1</a> and <a href="#CoSimulation">Section 4.3.1</a>).
A simulation environment can therefore construct the relevant function names by generating code for the actual function call.
In case of a static link library, the name of the library is MyModel.lib on Windows and libMyModel.a on Linux; in other words the <code>modelIdentifier</code> attribute is used as library name.</p>
</li>
<li>
<p>If the FMU is shipped with DLL/SharedObject:<br>
The constructed function name is <code>fmi3GetReal</code>, in other words, it is not changed.
A simulation environment will then dynamically load this library and will explicitly import the function symbols by providing the FMI function names as strings.
The name of the library is <code>MyModel.dll</code> on Windows or <code>MyModel.so</code> on Linux; in other words the <code>modelIdentifier</code> attribute is used as library name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[An FMU can be optionally shipped so that it basically contains only the communication to another tool (needsExecutionTool = true, see <a href="#CoSimulation">Section 4.3.1</a>).
This is particularily common for co-simulation tasks.
In FMI 1.0, the function names are always prefixed with the model name and therefore a DLL/Shared Object has to be generated for every model.
FMI 2.0 improves this situation since model names are no longer used as prefix in case of DLL/Shared Objects: Therefore one DLL/Shared Object can be used for all models in case of tool coupling.
If an FMU is imported into a simulation environment, this is usually performed dynamically (based on the FMU name, the corresponding FMU is loaded during execution of the simulation environment) and then it does not matter whether a model name is prefixed or not.]</em></p>
</div>
<div class="paragraph">
<p>Since <code>modelIdentifier</code> is used as prefix of a C-function name it must fulfill the restrictions on C-function
names (only letters, digits and/or underscores are allowed).
<em>[For example, if <code>modelName = "A.B.C"</code>, then <code>modelIdentifier</code> might be "A_B_C".]</em>
Since <code>modelIdentifier</code> is also used as name in a file system, it must also fulfill the restrictions of the targeted operating system.
Basically, this means that it should be short.
For example, the Windows API only supports full path-names of a file up to 260 characters (see: <a href="http://msdn.microsoft.com/en-us/library/aa365247%28VS.85%29.aspx" class="bare">http://msdn.microsoft.com/en-us/library/aa365247%28VS.85%29.aspx</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_platform_dependent_definitions_fmi3typesplatform_h">2.1.2. Platform Dependent Definitions (fmi3TypesPlatform.h)</h4>
<div class="paragraph">
<p>To simplify porting, no C types are used in the function interfaces, but the alias types are defined in this section.
All definitions in this section are provided in the header file <code>fmi3TypesPlatform.h</code>.
It is required to use this definition for all binary FMUs.
<em>[Only for source code FMUs, a change might be useful in some cases.]</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void*           fmi3Component;             /* Pointer to FMU instance */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to an FMU specific data structure that contains the information needed to process the model equations or to process the co-simulation of the respective slave.
This data structure is implemented by the environment that provides the FMU; in other words, the calling environment does not know its content, and the code to process it must be provided by the FMU generation environment and must be shipped with the FMU.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void*           fmi3ComponentEnvironment;  /* Pointer to FMU environment */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to a data structure in the simulation environment that calls the FMU.
Using this pointer, data from the <code>modelDescription.xml</code> file <em>[for example, mapping of <code>valueReference</code>s to variable names]</em> can be transferred between the simulation environment and the <code>logger</code> function (see <a href="#creation-destruction-and-logging">Section 2.1.5</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void*           fmi3FMUstate;              /* Pointer to internal FMU state */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a pointer to a data structure in the FMU that saves the internal FMU state of the actual or a previous time instant.
This allows to restart a simulation from a previous FMU state (see <a href="#get-set-fmu-state">Section 2.1.8</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef unsigned int    fmi3ValueReference;        /* Handle to the value of a variable */</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a handle to a (base type) variable value of the model.
Handle and base type (such as <code>fmi3Real</code>) uniquely identify the value of a variable.
Variables of the same base type that have the same handle, always have identical values, but other parts of the variable definition might be different <em>[for example, min/max attributes]</em>.</p>
</div>
<div class="paragraph">
<p>All structured entities, such as records or arrays, are "flattened" into a set of scalar values of type <code>fmi3Real</code>, <code>fmi3Integer</code> etc.
An <code>fmi3ValueReference</code> references one such scalar.
The coding of <code>fmi3ValueReference</code> is a "secret" of the environment that generated the FMU.
The interface to the equations only provides access to variables via this handle.
Extracting concrete information about a variable is specific to the used environment that reads the Model Description File in which the value handles are defined.
If a function in the following sections is called with a wrong <code>fmi3ValueReference</code> value <em>[for example, setting a constant with a <code>fmi3SetReal</code> function call]</em>, then the function has to return with an error ( <code>fmi3Status = fmi3Error</code>, see <a href="#status-returned-by-functions">Section 2.1.3</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef float           fmi3Float32;  /* Single precision floating point (32-bit) */
typedef double          fmi3Float64;  /* Double precision floating point (64-bit) */
typedef   int8_t        fmi3Int8;     /* 8-bit signed integer */
typedef  uint8_t        fmi3UInt8;    /* 8-bit unsigned integer */
typedef  int16_t        fmi3Int16;    /* 16-bit signed integer */
typedef uint16_t        fmi3UInt16;   /* 16-bit unsigned integer */
typedef  int32_t        fmi3Int32;    /* 32-bit signed integer */
typedef uint32_t        fmi3UInt32;   /* 32-bit unsigned integer */
typedef  int64_t        fmi3Int64;    /* 64-bit signed integer */
typedef uint64_t        fmi3UInt64;   /* 64-bit unsigned integer */
typedef int             fmi3Boolean;  /* Data type to be used with fmi3True and fmi3False */
typedef char            fmi3Char;     /* Data type for one character */
typedef const fmi3Char* fmi3String;   /* Data type for character strings
                                         ('\0' terminated, UTF8 encoded) */
typedef char            fmi3Byte;     /* Smallest addressable unit of the machine
                                         (typically one byte) */
typedef const fmi3Byte* fmi3Binary;   /* Data type for binary data
                                         (out-of-band length terminated) */

/* Values for fmi3Boolean */
#define fmi3True  1
#define fmi3False 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>These are the basic data types used in the interfaces of the C functions.
More data types might be included in future versions of the interface.
In order to keep flexibility, especially for embedded systems or for high performance computers, the exact data types or the word length of a number are not standardized.
Instead, the precise definition (in other words, the header file <code>fmi3TypesPlatform.h</code>) is provided by the environment where the FMU shall be used.
In most cases, the definition above will be used.
If the target environment has different definitions and the FMU is distributed in binary format, it must be newly compiled and linked with this target header file.</p>
</div>
<div class="paragraph">
<p>If an <code>fmi3String</code> or an <code>fmi3Binary</code> variable is passed as <span class="underline">input</span> argument to an FMI function and the FMU needs to use the string/binary later,
the FMI function must copy the string/binary before it returns and store it in the internal FMU memory,
because there is no guarantee for the lifetime of the string/binary after the function has returned.</p>
</div>
<div class="paragraph">
<p>If an <code>fmi3String</code> or an <code>fmi3Binary</code> variable is passed as <span class="underline">output</span> argument from an FMI function and the string/binary shall be used in the target environment,
the target environment must copy the whole string/binary (not only the pointer).
The memory of this string/binary may be deallocated by the next call to any of the FMI interface functions (the string/binary memory might also be just a buffer, that is reused).</p>
</div>
</div>
<div class="sect3">
<h4 id="status-returned-by-functions">2.1.3. Status Returned by Functions</h4>
<div class="paragraph">
<p>This section defines the <code>status</code> flag (an enumeration of type <code>fmi3Status</code> defined in file <code>fmi3FunctionTypes.h</code> ) that is returned by all functions to indicate the success of the function call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum {
    fmi3OK,
    fmi3Warning,
    fmi3Discard,
    fmi3Error,
    fmi3Fatal,
    fmi3Pending
} fmi3Status;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Status returned by functions.
The status has the following meaning</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3OK</code></dt>
<dd>
<p>all well.</p>
</dd>
<dt class="hdlist1"><code>fmi3Warning</code></dt>
<dd>
<p>things are not quite right, but the computation can continue.
Function <code>logger</code> was called in the model (see below), and it is expected that
this function has shown the prepared information message to the user.</p>
</dd>
<dt class="hdlist1"><code>fmi3Discard</code></dt>
<dd>
<p>this return status is only possible if explicitly defined for the corresponding function <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>:
(ModelExchange: <code>fmi3SetReal</code>, <code>fmi3SetInteger</code>, <code>fmi3SetBoolean</code>, <code>fmi3SetString</code>, <code>fmi3SetContinuousStates</code>, <code>fmi3GetReal</code>, <code>fmi3GetDerivatives</code>,
<code>fmi3GetContinuousStates</code>, <code>fmi3GetEventIndicators</code>; CoSimulation: <code>fmi3SetReal</code>, <code>fmi3SetInteger</code>, <code>fmi3SetBoolean</code>, <code>fmi3SetString</code>, <code>fmi3DoStep</code>,
<code>fmi3GetXXXStatus</code>):<br>
For "model exchange": It is recommended to perform a smaller step size and evaluate the model equations again, for example because an iterative solver in the model did not converge or because a function is outside of its domain [for example, <code>sqrt(&lt;negative number&gt;)</code>].
If this is not possible, the simulation has to be terminated.<br>
For "co-simulation": <code>fmi3Discard</code> is returned also if the slave is not able to return the required status information.
The master has to decide if the simulation run can be continued.<br>
In both cases, function <code>logger</code> was called in the FMU (see below), and it is expected that this function has shown the prepared information message to the user if the FMU was called in debug mode (<code>loggingOn = fmi3True</code>).
Otherwise, <code>logger</code> should not show a message.</p>
</dd>
<dt class="hdlist1"><code>fmi3Error</code></dt>
<dd>
<p>the FMU encountered an error.
The simulation cannot be continued with this FMU instance.
If one of the functions returns <code>fmi3Error</code>, it can be tried to restart the simulation from a formerly stored FMU state by calling <code>fmi3SetFMUstate</code>.
This can be done if the capability flag <code>canGetAndSetFMUstate</code> is true and <code>fmi3GetFMUstate</code> was called before in non-erroneous state.
If not, the simulation cannot be continued and <code>fmi3FreeInstance</code> or <code>fmi3Reset</code> <span class="underline">must</span> be called afterwards.<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup><br>
Further processing is possible after this call; especially other FMU instances are not affected.
Function <code>logger</code> was called in the FMU (see below), and it is expected that this function has shown the prepared information message to the user.</p>
</dd>
<dt class="hdlist1"><code>fmi3Fatal</code></dt>
<dd>
<p>the model computations are irreparably corrupted for all FMU instances.
<em>[For example, due to a run-time exception such as access violation or integer division by zero during the execution of an fmi function]</em>.
Function <code>logger</code> was called in the FMU (see below), and it is expected that this function has shown the prepared information message to the user.
It is not possible to call any other function for any of the FMU instances.</p>
</dd>
<dt class="hdlist1"><code>fmi3Pending</code></dt>
<dd>
<p>this status is returned only from the co-simulation interface, if the slave executes the function in an asynchronous way.
That means the slave starts to compute but returns immediately.
The master has to call <code>fmi3GetDoStepPendingStatus</code> to determine if the slave has finished the computation.
Can be returned only by <code>fmi3DoStep</code> and <code>fmi3GetDoStepPendingStatus</code> (see <a href="#retrieving-status-from-slave">Section 4.2.3</a>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="inquire-platform-and-version-number">2.1.4. Inquire Platform and Version Number of Header Files</h4>
<div class="paragraph">
<p>This section documents functions to inquire information about the header files used to compile its functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef const char* fmi3GetVersionTYPE(void);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns the version of the <code>fmi3Functions.h</code> header file which was used to compile the functions of the FMU.
The function returns <code>fmi3Version</code> which is defined in this header file.
The standard header file as documented in this specification has version <code>"3.0"</code> (so this function usually returns <code>"3.0"</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="creation-destruction-and-logging">2.1.5. Creation, Destruction and Logging of FMU Instances</h4>
<div class="paragraph">
<p>This section documents functions that deal with instantiation, destruction and logging of FMUs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Component fmi3InstantiateTYPE(fmi3String  instanceName,
                                          fmi3Type    fmuType,
                                          fmi3String  fmuGUID,
                                          fmi3String  fmuResourceLocation,
                                          const fmi3CallbackFunctions* functions,
                                          fmi3Boolean visible,
                                          fmi3Boolean loggingOn);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum {
    fmi3ModelExchange,
    fmi3CoSimulation
} fmi3Type;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function returns a new instance of an FMU.
If a null pointer is returned, then instantiation failed.
In that case, <code>functions&#8594;logger</code> is called with detailed information about the reason.
An FMU can be instantiated many times (provided capability flag <code>canBeInstantiatedOnlyOncePerProcess = false</code>).</p>
</div>
<div class="paragraph">
<p>This function must be called successfully before any of the following functions can be called.
For co-simulation, this function call has to perform all actions of a slave which are necessary before a simulation run starts (for example, loading the model file, compilation&#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>Argument <code>instanceName</code> is a unique identifier for the FMU instance.
It is used to name the instance, for example, in error or information messages generated by one of the <code>fmi3XXX</code> functions.
It is not allowed to provide a null pointer and this string must be non-empty (in other words, must have at least one character that is no white space).
<em>[If only one FMU is simulated, as instanceName attribute <code>modelName</code> or <code>&lt;ModelExchange/CoSimulation modelIdentifier=".."&gt;</code> from the XML schema <code>fmiModelDescription</code> might be used.]</em></p>
</div>
<div class="paragraph">
<p>Argument <code>fmuType</code> defines the type of the FMU:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fmi3ModelExchange</code></dt>
<dd>
<p>FMU with initialization and events; between events simulation of continuous systems is performed with external integrators from the environment (see <a href="#fmi-for-model-exchange">Section 3</a>).</p>
</dd>
<dt class="hdlist1"><code>fmi3CoSimulation</code></dt>
<dd>
<p>Black box interface for co-simulation (see <a href="#fmi-for-co-simulation">Section 4</a>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Argument <code>instantiationToken</code> can be used by the FMU to check that the <code>modelDescription.xml</code> file (see <a href="#fmu-distribution">Section 2.3</a>) is compatible with the implementation of the FMU.
It is an opaque string generated by the FMU exporter that is stored in the xml file as mandatory attribute instantiationToken (see <a href="#fmiModelDescription">Section 2.2.1</a>).
It must be passed unchanged to the FMU, this argument must not be null.</p>
</div>
<div class="paragraph">
<p>Argument <code>fmuResourceLocation</code> is a URI according to the <a href="http://datatracker.ietf.org/doc/rfc3986/">IETF RFC3986</a> syntax to indicate the location to the <code>resources</code> directory of the unzipped FMU archive.
The following schemes must be understood by the FMU:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mandatory: <code>file</code> with absolute path (either including or omitting the authority component)</p>
</li>
<li>
<p>Optional: <code>http</code>, <code>https</code>, <code>ftp</code></p>
</li>
<li>
<p>Reserved: <code>fmi3</code> for FMI for PLM.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[Example: An FMU is unzipped in directory "C:\temp\MyFMU", then fmuResourceLocation = "file:///C:/temp/MyFMU/resources" or "file:/C:/temp/MyFMU/resources".
Function <code>fmi3Instantiate</code> is then able to read all needed resources from this directory, for example maps or tables used by the FMU.]</em></p>
</div>
<div class="paragraph">
<p>Argument <code>functions</code> provides callback functions to be used from the FMU functions to utilize resources from the environment (see type <code>fmi3CallbackFunctions</code> below).</p>
</div>
<div class="paragraph">
<p>Argument <code>visible = fmi3False</code> defines that the interaction with the user should be reduced to a minimum (no application window, no plotting, no animation, etc.).
In other words, the FMU is executed in batch mode.
If <code>visible = fmi3True</code>, the FMU is executed in interactive mode, and the FMU might require to explicitly acknowledge start of simulation / instantiation / initialization (acknowledgment is non-blocking).</p>
</div>
<div class="paragraph">
<p>If <code>loggingOn = fmi3True</code>, debug logging is enabled.<br>
If <code>loggingOn = fmi3False</code>, debug logging is disabled.</p>
</div>
<div class="paragraph">
<p><em>[The FMU enable/disables <code>LogCategories</code> which are useful for debugging according to this argument.
Which <code>LogCategories</code> the FMU sets is unspecified.]</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void  (*fmi3CallbackLogger)         (fmi3ComponentEnvironment componentEnvironment,
                                             fmi3String instanceName,
                                             fmi3Status status,
                                             fmi3String category,
                                             fmi3String message);
typedef void* (*fmi3CallbackAllocateMemory) (fmi3ComponentEnvironment componentEnvironment,
                                             size_t nobj,
                                             size_t size);
typedef void  (*fmi3CallbackFreeMemory)     (fmi3ComponentEnvironment componentEnvironment,
                                             void* obj);
typedef void  (*fmi3StepFinished)           (fmi3ComponentEnvironment componentEnvironment,
                                             fmi3Status status);

typedef struct {
    fmi3CallbackLogger         logger;
    fmi3CallbackAllocateMemory allocateMemory;
    fmi3CallbackFreeMemory     freeMemory;
    fmi3StepFinished           stepFinished;
    fmi3ComponentEnvironment   componentEnvironment;
} fmi3CallbackFunctions;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The struct contains pointers to functions provided by the environment to be used by the FMU.
It is not allowed to change these functions between <code>fmi3Instantiate</code> and <code>fmi3Terminate</code> calls.
Additionally, a pointer to the environment is provided (componentEnvironment) that needs to be passed to all of the callback functions, in order that those functions can utilize data from the environment, such as mapping a <code>valueReference</code> to a string, or assigning memory to a certain FMU instance.
In the unlikely case that <code>fmi3Component</code> is also needed in those functions, it has to be passed via argument <code>componentEnvironment</code>. Argument <code>componentEnvironment</code> may be a null pointer.</p>
</div>
<div class="paragraph">
<p>The <code>componentEnvironment</code> pointer is also passed to the <code>stepFinished</code> function in order that the environment can provide an efficient way to identify the slave that called <code>stepFinished</code>.</p>
</div>
<div class="paragraph">
<p>In the default <code>fmi3FunctionTypes.h</code> file, typedefs for the function definitions are present to simplify the usage; this is non-normative.
The functions have the following meaning:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Function <code>logger</code></dt>
<dd>
<p>Pointer to a function that is called in the FMU, usually if an <code>fmi3XXX</code> function does not behave as desired.
If <code>logger</code> is called with <code>status = fmi3OK</code>, then the message is a pure information message.
<code>instanceName</code> is the instance name of the model that calls this function.
<code>category</code> is the category of the message.
The meaning of <code>category</code> is defined by the modeling environment that generated the FMU.
Depending on this modeling environment, none, some or all allowed values of <code>category</code> for this FMU are defined in the <code>modelDescription.xml</code> file via element <code>&lt;fmiModelDescription&gt;&lt;LogCategories&gt;</code>, see <a href="#definition-of-log-categories">Section 2.2.4</a>.
Only messages are provided by function <code>logger</code> that have a category according to a call to <code>fmi3SetDebugLogging</code> (see below).
Argument <code>message</code> is a string that contains the message.
<em>[Typically, this function prints the message and stores it optionally in a log file.]</em></p>
<div class="paragraph">
<p>All string-valued arguments passed by the FMU to the <code>logger</code> may be deallocated by the FMU directly after function <code>logger</code> returns.
The environment must therefore create copies of these strings if it needs to access these strings later.<br>
The <code>logger</code> function will append a line break to each message when writing messages after each other to a terminal or a file (the messages may also be shown in other ways, for example, as separate text-boxes in a GUI).
The caller may include line-breaks (using "\n") within the message, but should avoid trailing line breaks.<br>
Variables can be referenced in a message with <code>#&lt;ValueReference&gt;#</code>.
If the character <code>#</code> shall be included in the message, it has to be prefixed with <code>#</code>, so <code>#</code> is an escape character.</p>
</div>
<div class="paragraph">
<p><em>[Example:</em><br>
<em>The message</em> <code>#1365# must be larger than zero (used in IO channel ##4)</code><br>
<em>might be changed by the</em> <code>logger</code> <em>function to</em><br>
<code>body.m must be larger than zero (used in IO channel #4)</code><br>
<em>if <code>body.m</code> is the name of the variable with value reference 1365.]</em></p>
</div>
</dd>
<dt class="hdlist1">Function <code>allocateMemory</code></dt>
<dd>
<p>Pointer to a function that is called in the FMU if memory needs to be allocated.
If attribute <code>canNotUseMemoryManagementFunctions = "true"</code> in <code>&lt;fmiModelDescription&gt;&lt;ModelExchange / CoSimulation&gt;</code>, then function <code>allocateMemory</code> is not used in the FMU and a void pointer can be provided.
If this attribute has a value of <code>false</code> (which is the default), the FMU must not use <code>malloc</code>, <code>calloc</code> or other memory allocation functions.
One reason is that these functions might not be available for embedded systems on the target machine.
Another reason is that the environment may have optimized or specialized memory allocation functions.
<code>allocateMemory</code> returns a pointer to space for a vector of <code>nobj</code> objects, each of size <code>size</code> or <code>NULL</code>, if the request cannot be satisfied.
The space is initialized to zero bytes <em>[(a simple implementation is to use <code>calloc</code> from the C standard library)]</em>.</p>
</dd>
<dt class="hdlist1">Function <code>freeMemory</code></dt>
<dd>
<p>Pointer to a function that must be called in the FMU if memory is freed that has been allocated with <code>allocateMemory</code>.
If a null pointer is provided as input argument <code>obj</code>, the function shall perform no action <em>[(a simple implementation is to use free from the C standard library; in ANSI C89 and C99, the null pointer handling is identical as defined here)]</em>.
If attribute <code>canNotUseMemoryManagementFunctions = "true"</code> in <code>&lt;fmiModelDescription&gt;&lt;ModelExchange / CoSimulation&gt;</code>, then function <code>freeMemory</code> is not used in the FMU and a null pointer can be provided.</p>
</dd>
<dt class="hdlist1">Function <code>stepFinished</code></dt>
<dd>
<p>Optional call back function to signal if the computation of a communication step of a co- simulation slave is finished.
A null pointer can be provided.
In this case the master must use <code>fmi3GetDoStepPendingStatus</code> to query the status of <code>fmi3DoStep</code>.
If a pointer to a function is provided, it must be called by the FMU after a completed communication step.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void fmi3FreeInstanceTYPE(fmi3Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Disposes the given instance, unloads the loaded model, and frees all the allocated memory and other resources that have been allocated by the functions of the FMU interface.
If a null pointer is provided for <code>c</code>, the function call is ignored (does not have an effect).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status  fmi3SetDebugLoggingTYPE(fmi3Component c,
                                            fmi3Boolean loggingOn,
                                            size_t nCategories,
                                            const fmi3String categories[]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>loggingOn=fmi3True</code>, debug logging is enabled, otherwise it is switched off.
If <code>loggingOn=fmi3True</code> and <code>nCategories &gt; 0</code>, then only debug messages according to the <code>categories</code> argument shall be printed via the <code>logger</code> function.
Vector <code>categories</code> has <code>nCategories</code> elements.
The allowed values of <code>categories</code> are defined by the modeling environment that generated the FMU.
Depending on the generating modeling environment, none, some or all allowed values for <code>categories</code> for this FMU are defined in the <code>modelDescription.xml</code> file via element <code>fmiModelDescription.LogCategories</code>, see <a href="#definition-of-log-categories">Section 2.2.4</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_initialization_termination_and_resetting_an_fmu">2.1.6. Initialization, Termination, and Resetting an FMU</h4>
<div class="paragraph">
<p>This section documents functions that deal with initialization, termination, and resetting of an FMU.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetupExperimentTYPE(fmi3Component c,
                                           fmi3Boolean toleranceDefined,
                                           fmi3Float64 tolerance,
                                           fmi3Float64 startTime,
                                           fmi3Boolean stopTimeDefined,
                                           fmi3Float64 stopTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Informs the FMU to setup the experiment.
This function can be called after <code>fmi3Instantiate</code> and before <code>fmi3EnterInitializationMode</code> is called.
Arguments <code>toleranceDefined</code> and <code>tolerance</code> depend on the FMU type:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>fmuType = fmi3ModelExchange</code></dt>
<dd>
<p>If <code>toleranceDefined = fmi3True</code>, then the model is called with a numerical integration scheme where the step size is controlled by using <code>tolerance</code> for error estimation (usually as relative 'tolerance').
In such a case all numerical algorithms used inside the model (for example, to solve non-linear algebraic equations) should also operate with an error estimation of an appropriate smaller relative tolerance.</p>
</dd>
<dt class="hdlist1"><code>fmuType = fmi3CoSimulation</code></dt>
<dd>
<p>If <code>toleranceDefined = fmi3True</code>, then the communication interval of the slave is controlled by error estimation.
In case the slave utilizes a numerical integrator with variable step size and error estimation, it is suggested to use <code>tolerance</code> for the error estimation of the internal integrator (usually as relative tolerance).<br>
An FMU for Co-Simulation might ignore this argument.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The arguments <code>startTime</code> and <code>stopTime</code> can be used to check whether the model is valid within the given boundaries or to allocate memory which is necessary for storing results.
Argument <code>startTime</code> is the fixed initial value of the independent variable <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup> value <em>[if the independent variable is <code>time</code>, <code>startTime</code> is the starting time of initializaton]</em>.
If <code>stopTimeDefined = fmi3True</code>, then <code>stopTime</code> is the defined final value of the independent variable [if the independent variable is <code>time</code>, <code>stopTime</code> is the stop time of the simulation] and if the environment tries to compute past <code>stopTime</code> the FMU has to return <code>fmi3Status = fmi3Error</code>.
 If <code>stopTimeDefined = fmi3False</code>, then no final value of the independent variable is defined and argument <code>stopTime</code> is meaningless.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterInitializationModeTYPE(fmi3Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Informs the FMU to enter Initialization Mode.
Before calling this function, all variables with attribute <code>&lt;ScalarVariable initial = "exact"</code> or <code>"approx"&gt;</code> can be set with the <code>fmi3SetXXX</code> functions (the <code>ScalarVariable</code> attributes are defined in the Model Description File, see <a href="#definition-of-model-variables">Section 2.2.7</a>).
Setting other variables is not allowed.
Furthermore, <code>fmi3SetupExperiment</code> must be called at least once before calling <code>fmi3EnterInitializationMode</code>, in order that <code>startTime</code> is defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3ExitInitializationModeTYPE(fmi3Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Informs the FMU to exit Initialization Mode.
For <code>fmuType = fmi3ModelExchange</code>, this function switches off all initialization equations, and the FMU enters Event Mode implicitly; that is, all continuous-time and active discrete-time equations are available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3TerminateTYPE(fmi3Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Informs the FMU that the simulation run is terminated.
After calling this function,
the final values of all variables can be inquired with the <code>fmi3GetXXX</code> functions.
It is not allowed to call this function after one of the functions returned with a status flag of <code>fmi3Error</code> or <code>fmi3Fatal</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3ResetTYPE(fmi3Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Is called by the environment to reset the FMU after a simulation run.
The FMU goes into the same state as if <code>fmi3Instantiate</code> would have been called.
All variables have their default values.
Before starting a new run, <code>fmi3SetupExperiment</code> and <code>fmi3EnterInitializationMode</code> have to be called.</p>
</div>
</div>
<div class="sect3">
<h4 id="get-and-set-variable-values">2.1.7. Getting and Setting Variable Values</h4>
<div class="paragraph">
<p>All variable values of an FMU are identified with a variable handle called "value reference".
The handle is defined in the <code>modelDescription.xml</code> file (as attribute <code>valueReference</code> in element <code>Variable</code>).
Element <code>valueReference</code> shall be unique for all variables.</p>
</div>
<div class="paragraph">
<p>Variables can be scalar or array variables. When getting or setting the values of array variables, the serialization of array variable values used in C-API function calls, as well as in the XML <code>start</code> attributes is defined as row major - i.e. dimension order from left&#8594;right for the C-API (e.g. <code>array[dim1][dim2]…[dimN]</code>), and document order in the XML attributes.</p>
</div>
<div class="paragraph">
<p><em>[Example: A 2D matrix</em></p>
</div>
<div class="stemblock">
<div class="content">
\[A = \left( \begin{array}{cc} a_{11}&amp;a_{12}\\
                             a_{21}&amp;a_{22}\\
                             a_{31}&amp;a_{32}\\
            \end{array} \right)\]
</div>
</div>
<div class="paragraph">
<p><em>is serialized as follows:</em></p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[0][0]=a11</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[0][1]=a12</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+1</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[1][0]=a21</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+2</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[1][1]=a22</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+3</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[2][0]=a31</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+4</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A[2][1]=a32</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>memory  address: A+5</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>The actual values of the variables that are defined in the <code>modelDescription.xml</code> file can be inquired after calling <code>fmi3EnterInitializationMode</code> with the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetFloat32TYPE(fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3Float32 value[], size_t nValues);

typedef fmi3Status fmi3GetFloat64TYPE(fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3Float64 value[], size_t nValues);

typedef fmi3Status fmi3GetInt8TYPE   (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3Int8 value[], size_t nValues);

typedef fmi3Status fmi3GetUInt8TYPE  (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3UInt8 value[], size_t nValues);

typedef fmi3Status fmi3GetInt16TYPE  (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3Int16 value[], size_t nValues);

typedef fmi3Status fmi3GetUInt16TYPE (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3UInt16 value[], size_t nValues);

typedef fmi3Status fmi3GetInt32TYPE  (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3Int32 value[], size_t nValues);

typedef fmi3Status fmi3GetUInt32TYPE (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3UInt32 value[], size_t nValues);

typedef fmi3Status fmi3GetInt64TYPE  (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3Int64 value[], size_t nValues);

typedef fmi3Status fmi3GetUInt64TYPE (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3UInt64 value[], size_t nValues);

typedef fmi3Status fmi3GetBooleanTYPE(fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3Boolean value[], size_t nValues);

typedef fmi3Status fmi3GetStringTYPE (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      fmi3String value[], size_t nValues);

typedef fmi3Status fmi3GetBinaryTYPE (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      size_t size[], fmi3Binary value[], size_t nValues);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Get actual values of variables by providing their variable references.
<em>[These functions are especially used to get the actual values of output variables if a model is connected with other models.
Since state derivatives are also <code>Variable</code>s, it is possible to get the value of a state derivative.
This is useful when connecting FMUs together.
Furthermore, the actual value of every variable defined in the <code>modelDescription.xml</code> file can be determined at the actually defined time instant (see <a href="#definition-of-model-variables">Section 2.2.7</a>).]</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>vr</code> is a vector of <code>nvr</code> value handles that define the variables that shall be inquired.</p>
</li>
<li>
<p>Argument <code>value</code> is a vector with the actual values of these variables.</p>
</li>
<li>
<p>Argument <code>size</code> is a vector with the actual sizes of the values for binary variables.</p>
</li>
<li>
<p>Argument <code>nValues</code> provides the number of values in the <code>value</code> vector (and <code>size</code> vector, where applicable) which is only equal to <code>nvr</code> if all <code>valueReference</code>s point to scalar variables.</p>
</li>
<li>
<p>The strings returned by <code>fmi3GetString</code>, as well as the binary values returned by <code>fmi3GetBinary</code>, must be copied in the target environment because the allocated memory for these strings might be deallocated by the next call to any of the fmi3 interface functions or it might be an internal string buffer that is reused.</p>
</li>
<li>
<p>For ModelExchange: <code>fmi3Status = fmi3Discard</code> is possible for <code>fmi3GetReal</code> only, but not for <code>fmi3GetInteger</code>, <code>fmi3GetBoolean</code>, <code>fmi3GetString</code>, <code>fmi3GetBinary</code>, because these are discrete-time variables and their values can only change at an event instant where <code>fmi3Discard</code> does not make sense.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to <span class="underline">set</span> the values of <span class="underline">certain</span> variables at particular instants in time using the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetFloat32TYPE(fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3Float32 value[], size_t nValues);

typedef fmi3Status fmi3SetFloat64TYPE(fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3Float64 value[], size_t nValues);

typedef fmi3Status fmi3SetInt8TYPE   (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3Int8 value[], size_t nValues);

typedef fmi3Status fmi3SetUInt8TYPE  (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3UInt8 value[], size_t nValues);

typedef fmi3Status fmi3SetInt16TYPE  (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3Int16 value[], size_t nValues);

typedef fmi3Status fmi3SetUInt16TYPE (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3UInt16 value[], size_t nValues);

typedef fmi3Status fmi3SetInt32TYPE  (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3Int32 value[], size_t nValues);

typedef fmi3Status fmi3SetUInt32TYPE (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3UInt32 value[], size_t nValues);

typedef fmi3Status fmi3SetInt64TYPE  (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3Int64 value[], size_t nValues);

typedef fmi3Status fmi3SetUInt64TYPE (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3UInt64 value[], size_t nValues);

typedef fmi3Status fmi3SetBooleanTYPE(fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3Boolean value[], size_t nValues);

typedef fmi3Status fmi3SetStringTYPE (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const fmi3String value[], size_t nValues);

typedef fmi3Status fmi3SetBinaryTYPE (fmi3Component c,
                                      const fmi3ValueReference vr[], size_t nvr,
                                      const size_t size[], const fmi3Binary value[], size_t nValues);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set parameters, inputs, and start values, and re-initialize caching of variables that depend on these variables (see <a href="#definition-of-model-variables">Section 2.2.7</a> for the exact rules on which type of variables <code>fmi3SetXXX</code> can be called, as well as <a href="#state-machine-model-exchange">Section 3.2.3</a> in case of ModelExchange and <a href="#state-machine-co-simulation">Section 4.2.4</a> in case of CoSimulation).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>vr</code> is a vector of <code>nvr</code> value handles that define the variables that shall be set.</p>
</li>
<li>
<p>Argument <code>value</code> is a vector with the actual values of these variables.</p>
</li>
<li>
<p>Argument <code>size</code> is a vector with the actual sizes of the values of binary variables.</p>
</li>
<li>
<p>Argument <code>nValues</code> provides the number of values in the <code>value</code> vector which is only equal to <code>nvr</code> if all <code>valueReference</code>s point to scalar variables.</p>
</li>
<li>
<p>All strings passed as arguments to <code>fmi3SetString</code>, as well as all binary values passed as arguments to <code>fmi3SetBinary</code>, must be copied inside these functions, because there is no guarantee of the lifetime of strings or binary values, when these functions return.</p>
</li>
<li>
<p>Note, <code>fmi3Status = fmi3Discard</code> is possible for the <code>fmi3SetXXX</code> functions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For co-simulation FMUs, additional functions are defined in <a href="#transfer-of-input-output-and-parameters">Section 4.2.1</a> to set and inquire derivatives of variables with respect to time in order to allow interpolation.</p>
</div>
</div>
<div class="sect3">
<h4 id="get-set-fmu-state">2.1.8. Getting and Setting the Complete FMU State</h4>
<div class="paragraph">
<p>The FMU has an internal state consisting of all values that are needed to continue a simulation.
This internal state consists especially of the values of the continuous-time states, iteration variables, parameter values, input values, delay buffers, file identifiers, and FMU internal status information.
With the functions of this section, the internal FMU state can be copied and the pointer to this copy is returned to the environment.
The FMU state copy can be set as actual FMU state, in order to continue the simulation from it.</p>
</div>
<div class="paragraph">
<p><em>[Examples for using this feature:</em></p>
</div>
<div class="paragraph">
<p><em>For variable step-size control of co-simulation master algorithms (get the FMU state for every accepted communication step; if the follow-up step is not accepted, restart co-simulation from this FMU state).</em></p>
</div>
<div class="paragraph">
<p><em>For nonlinear Kalman filters (get the FMU state just before initialization; in every sample period, set new continuous states from the Kalman filter algorithm based on measured values; integrate to the next sample instant and inquire the predicted continuous states that are used in the Kalman filter algorithm as basis to set new continuous states).</em></p>
</div>
<div class="paragraph">
<p><em>For nonlinear model predictive control (get the FMU state just before initialization; in every sample period, set new continuous states from an observer, initialize and get the FMU state after initialization. From this state, perform many simulations that are restarted after the initialization with new input signals proposed by the optimizer).]</em></p>
</div>
<div class="paragraph">
<p>Furthermore, the FMU state can be serialized and copied in a byte vector:
<em>[This can be, for example, used to perform an expensive steady-state initialization, copy the received FMU state in a byte vector and store this vector on file. Whenever needed, the byte vector can be loaded from file and deserialized, and the simulation can be restarted from this FMU state, in other words, from the steady-state initialization.]</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetFMUstateTYPE (fmi3Component c, fmi3FMUstate* FMUstate);
typedef fmi3Status fmi3SetFMUstateTYPE (fmi3Component c, fmi3FMUstate  FMUstate);
typedef fmi3Status fmi3FreeFMUstateTYPE(fmi3Component c, fmi3FMUstate* FMUstate);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>fmi3GetFMUstate</code> makes a copy of the internal FMU state and returns a pointer to this copy (<code>FMUstate</code>).
If on entry <code>*FMUstate == NULL</code>, a new allocation is required.
If <code>*FMUstate != NULL</code>, then <code>*FMUstate</code> points to a previously returned <code>FMUstate</code> that has not been modified since.
In particular, <code>fmi3FreeFMUstate</code> had not been called with this <code>FMUstate</code> as an argument.
<em>[Function <code>fmi3GetFMUstate</code> typically reuses the memory of this <code>FMUstate</code>
in this case and returns the same pointer to it, but with the actual <code>FMUstate</code>.]</em></p>
</div>
<div class="paragraph">
<p><code>fmi3SetFMUstate</code> copies the content of the previously copied <code>FMUstate</code> back and uses it as actual new FMU state.
The <code>FMUstate</code> copy still exists.</p>
</div>
<div class="paragraph">
<p><code>fmi3FreeFMUstate</code> frees all memory and other resources allocated with the <code>fmi3GetFMUstate</code> call for this <code>FMUstate</code>.
The input argument to this function is the <code>FMUstate</code> to be freed.
If a null pointer is provided, the call is ignored.
The function returns a null pointer in argument <code>FMUstate</code>.</p>
</div>
<div class="paragraph">
<p>These functions are only supported by the FMU,
if the optional capability flag <code>canGetAndSetFMUstate</code> in <code>&lt;fmiModelDescription&gt; &lt;ModelExchange / CoSimulation&gt;</code> in the XML file is explicitly set to <code>true</code> (see <a href="#ModelExchange">Section 3.3.1</a> and <a href="#CoSimulation">Section 4.3.1</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SerializedFMUstateSizeTYPE(fmi3Component c,
                                                  fmi3FMUstate  FMUstate,
                                                  size_t* size);

typedef fmi3Status fmi3SerializeFMUstateTYPE     (fmi3Component c,
                                                  fmi3FMUstate  FMUstate,
                                                  fmi3Byte serializedState[],
                                                  size_t size);

typedef fmi3Status fmi3DeSerializeFMUstateTYPE   (fmi3Component c,
                                                  const fmi3Byte serializedState[],
                                                  size_t size,
                                                  fmi3FMUstate* FMUstate);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>fmi3SerializedFMUstateSize</code> returns the <code>size</code> of the byte vector, in order that <code>FMUstate</code> can be stored in it.
With this information, the environment has to allocate an <code>fmi3Byte</code> vector of the required length <code>size</code>.</p>
</div>
<div class="paragraph">
<p><code>fmi3SerializeFMUstate</code> serializes the data which is referenced by pointer <code>FMUstate</code> and copies this data in to the byte vector <code>serializedState</code> of length <code>size</code>, that must be provided by the environment.</p>
</div>
<div class="paragraph">
<p><code>fmi3DeSerializeFMUstate</code> deserializes the byte vector <code>serializedState</code> of length <code>size</code>, constructs a copy of the FMU state and returns <code>FMUstate</code>, the pointer to this copy.
<em>[The simulation is restarted at this state, when calling <code>fmi3SetFMUState</code> with <code>FMUstate</code>.]</em></p>
</div>
<div class="paragraph">
<p>These functions are only supported by the FMU,
if the optional capability flags <code>canGetAndSetFMUstate</code> and <code>canSerializeFMUstate</code> in
<code>&lt;fmiModelDescription&gt;&lt;ModelExchange / CoSimulation&gt;</code> in the XML file are explicitly set to <code>true</code> (see <a href="#ModelExchange">Section 3.3.1</a> and <a href="#CoSimulation">Section 4.3.1</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_partial_derivatives">2.1.9. Getting Partial Derivatives</h4>
<div class="paragraph">
<p>It is optionally possible to provide evaluation of partial derivatives for an FMU.
For Model Exchange, this means computing the partial derivatives at a particular time instant.
For Co-Simulation, this means to compute the partial derivatives at a particular communication point.
One function is provided to compute directional derivatives.
This function can be used to construct the desired partial derivative matrices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetDirectionalDerivativeTYPE(fmi3Component c,
                                                    const fmi3ValueReference vrUnknown[],
                                                    size_t nUnknown,
                                                    const fmi3ValueReference vrKnown[],
                                                    size_t nKnown,
                                                    const fmi3Float64 dvKnown[],
                                                    size_t nDvKnown,
                                                    fmi3Float64 dvUnknown[],
                                                    size_t nDvUnknown);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function computes the directional derivatives of an FMU.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>vrUnknown</code> contains the <code>valueReference</code>s of the unknown variables. The number of <code>valueReference</code>s is given by the argument <code>nUnknown</code>.</p>
</li>
<li>
<p>Argument <code>vrKnown</code> contains the <code>valueReference</code>s of the known variables. The number of <code>valueReference</code>s is given by the argument <code>nKnown</code>.</p>
</li>
<li>
<p>Arguments <code>dvKnown</code> and <code>dvUnknown</code> contain the serialized values of the referenced Variables (serializiation of values as defined in <a href="#get-and-set-variable-values">Section 2.1.7</a>).</p>
</li>
<li>
<p>Argument <code>nDvKnown</code> provides the number of values in <code>dvKnown</code> which is only equal to <code>nKnown</code> if all <code>valueReference</code>s of <code>vrKnown</code> point to scalar variables.</p>
</li>
<li>
<p>Argument <code>nDvUnknown</code> provides the number of values in <code>dvUnknown</code> which is only equal to <code>nUnknown</code> if all <code>valueReference</code>s of <code>vrUnknown</code> point to scalar variables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An FMU has different Modes and in every Mode an FMU might be described by different equations and different unknowns.
The precise definitions are given in the mathematical descriptions of Model Exchange (<a href="#math-model-exchange">Section 3.1</a>) and Co-Simulation (<a href="#math-co-simulation">Section 4.1</a>).
In every Mode, the general form of the FMU equations are:</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{v}_{unknown} = \mathbf{h}(\mathbf{v}_{known}, \mathbf{v}_{rest}),\]
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\color{blue}{\mathbf{v}_{unknown}}\) is the vector of unknown Real variables computed in the actual Mode:</p>
<div class="ulist">
<ul>
<li>
<p><em>Initialization Mode</em>: The exposed unknowns listed under <code>&lt;ModelStructure&gt;&lt;InitialUnknowns&gt;</code> that have type Real.</p>
</li>
<li>
<p><em>Continuous-Time Mode (ModelExchange)</em>: The continuous-time outputs and state derivatives (= the variables listed under <code>&lt;ModelStructure&gt;&lt;Outputs&gt;</code> with type Real and <code>variability = "continuous"</code> and the variables listed as state derivatives under <code>&lt;ModelStructure&gt;&lt;Derivatives&gt;</code>).</p>
</li>
<li>
<p><em>Event Mode (ModelExchange)</em>: The same variables as in the Continuous-Time Mode and additionally variables under <code>&lt;ModelStructure&gt;&lt;Outputs&gt;</code> with type Real and <code>variability = "discrete"</code>.</p>
</li>
<li>
<p><em>Step Mode (CoSimulation)</em>: The variables listed under <code>&lt;ModelStructure&gt;&lt;Outputs&gt;</code> with type Real and <code>variability = "continuous"</code> or <code>"discrete"</code>.
If <code>&lt;ModelStructure&gt;&lt;Derivatives&gt;</code> is present, also the variables listed here as state derivatives.</p>
</li>
</ul>
</div>
</li>
<li>
<p>\(\color{blue}{\mathbf{v}_{known}}\) is the vector of Real input variables of function <strong>h</strong>
that changes its value in the actual Mode.
Details are described in the description of element <code>dependencies</code> in <a href="#ModelStructure">Section 2.2.8</a>.
<em>[For example continuous-time inputs in Continuous-Time Mode.
If a variable with <code>causality = "independent"</code> is explicitly defined under <code>ScalarVariable</code>s, a directional derivative with respect to this variable can be computed.
If such a variable is not defined, the directional derivative with respect to the independent variable cannot be calculated].</em></p>
</li>
<li>
<p>\(\color{blue}{\mathbf{v}_{rest}}\) is the set of input variables of function <strong>h</strong> that either changes its value in the actual Mode but are non-Real variables, or do not change their values in this Mode, but change their values in other Modes <em>[for example, discrete-time inputs in Continuous-Time Mode]</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the capability attribute <code>providesDirectionalDerivative</code> is <code>true</code>, <code>fmi3GetDirectionalDerivative</code> computes a linear combination of the partial derivatives of <strong>h</strong> with respect to the selected input variables \(\color{blue}{\mathbf{v}_{known}}\):</p>
</div>
<div class="stemblock">
<div class="content">
\[\Delta \mathbf{v}_{unknown} = \frac{\delta \mathbf{h}}{\delta \mathbf{v}_{known}}\mathbf{v}_{known}\]
</div>
</div>
<div class="paragraph">
<p>Accordingly, it computes the directional derivative vector
\(\color{blue}{\Delta \mathbf{v}_{unknown}}\) (<code>dvUnknown</code>) from the seed vector
\(\color{blue}{\Delta \mathbf{v}_{known}}\) (<code>dvKnown</code>)</p>
</div>
<div class="paragraph">
<p><em>[The variable relationships are different in different modes.
For example, during Continuous-Time Mode, a continuous-time output y does not depend on discrete-time inputs (because they are held constant between events).
However, at Event Mode, y depends on discrete-time inputs.]</em> + <em>The function may compute the directional derivatives by numerical differentiation taking into account the sparseness of the equation system, or (preferred) by analytic derivatives.</em></p>
</div>
<div class="paragraph">
<p><em>Example:</em><br>
<em>Assume an FMU has the output equations</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{bmatrix}
y_1
\\
y_2
\end{bmatrix}
=
\begin{bmatrix}
g_1(x, u_1, u_3, u_4)
\\
g_2(x, u_1)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>and this FMU is connected, so that \(\color{blue}{y_1, u_1, u_3}\) appear in an algebraic loop.
Then the nonlinear solver needs a Jacobian and this Jacobian can be computed (without numerical differentiation) provided the partial derivative of \(\color{blue}{y_1}\) with respect to \(\color{blue}{u_1}\) and \(\color{blue}{u_3}\) is available.
Depending on the environment where the FMUs are connected, these derivatives can be provided</em></p>
</div>
<div class="paragraph">
<p>(a) <em>with one wrapper function around function fmi3GetDirectionalDerivative to compute the directional derivatives with respect to these two variables (in other words, \(\color{blue}{v_{unknown} = y_1}\), \(\color{blue}{v_{known} = \left \{ u_1, u_3 \right \}}\)), and then the environment calls this wrapper function with \(\color{blue}{\Delta v_{known} = \left \{ 1, 0 \right \}}\) to compute the partial derivative with respect to \(\color{blue}{u_1}\) and \(\color{blue}{\Delta v_{known} = \left \{ 0, 1 \right \}}\) to compute the partial derivative with respect to \(\color{blue}{u_3}\), or</em></p>
</div>
<div class="paragraph">
<p>(b) <em>with two direct function calls of fmi3GetDirectionalDerivative (in other words, \(\color{blue}{v_{unknown} = y_1, v_{known} = u_1, \Delta v_{known} = 1}\); and \(\color{blue}{v_{unknown} = y_1, v_{known} = u_3, \Delta v_{known} = 1}\)).</em></p>
</div>
<div class="paragraph">
<p><em>Note that a direct implementation of this function with analytic derivatives:</em></p>
</div>
<div class="paragraph">
<p>(a) <em>Provides the directional derivative for all input variables; so in the above example: \(\color{blue}{\Delta y_1 = \frac{\delta g_1}{\delta x} \cdot \Delta x + \frac{\delta g_1}{\delta u_1} \cdot \Delta u_1 + \frac{\delta g_1}{\delta u_3} \cdot \Delta u_3 + \frac{\delta g_1}{\delta u_4} \cdot \Delta u_4}\)</em></p>
</div>
<div class="paragraph">
<p>(b) <em>Initializes all seed-values to zero; so in the above example: \(\color{blue}{\Delta x = \Delta u_1 = \Delta u_3 = \Delta u_4 = 0}\)</em></p>
</div>
<div class="paragraph">
<p>(c) <em>Computes the directional derivative with the seed-values provided in the function arguments; so in the above example: \(\color{blue}{\Delta v_{unknown} = \Delta y_1 (\Delta x = 0, \Delta u_1 = 1, \Delta u_3 = 1, \Delta u_4 = 0)}\)]</em></p>
</div>
<div class="paragraph">
<p><em>[Note, function fmi3GetDirectionalDerivative can be utilized for the following purposes:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Numerical integrators of stiff methods need matrix \(\color{blue}{\frac{\delta \mathbf{f}}{\delta \mathbf{x}}}\).</em></p>
</li>
<li>
<p><em>If the FMU is connected with other FMUs, the partial derivatives of the state derivatives and outputs with respect to the continuous states and the inputs are needed in order to compute the Jacobian for the system of the connected FMUs.</em></p>
</li>
<li>
<p><em>If the FMU shall be linearized, the same derivatives as in the previous item are needed.</em></p>
</li>
<li>
<p><em>If the FMU is used as the model for an extended Kalman filter,
\(\color{blue}{\frac{\delta \mathbf{f}}{\delta \mathbf{x}}}\) and
\(\color{blue}{\frac{\delta \mathbf{g}}{\delta \mathbf{x}}}\) are needed.</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>If a dense matrix shall be computed, the columns of the matrix can be easily constructed by successive calls of fmi3GetDirectionalDerivative.
For example, constructing the system Jacobian \(\color{blue}{\mathbf{A} = \frac{\delta \mathbf{f}}{\delta \mathbf{x}}}\) as dense matrix can be performed in the following way (in pseudo-code notation):</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">m = M_fmi3Instantiate("m", ...)  // "m" is the instance name
                                 // "M_" is the MODEL_IDENTIFIER
// from XML file
nx     = ...   // number of states
x_ref [..] = ...   // vector of value references of cont.-time states
xd_ref[..] = ...   // vector of value references of state derivatives
...
// If required at this step, compute the Jacobian as dense matrix
   // Set time, states and inputs
   M_fmi3SetTime(m, time)
   M_fmi3SetContinuousStates(m, x, nx)
   M_fmi3SetReal/Integer/Boolean/String(m, ...)
   // Construct the Jacobian elements J[:,:] columnwise
for i in 1:nx loop
  M_fmi3GetDirectionalDerivative(m, x_ref[i], 1, xd_ref, nx, 1.0, ci);
  J[:,i] = ci;    // ci is an auxiliary vector of nx elements
                  // (it holds the i-th column of the Jacobian)
end for;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>If the sparsity of a matrix shall be taken into account,
then the matrix can be constructed in the following way:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>The incidence information of the matrix (whether an element is zero or not zero)
is extracted from the XML file from element &lt;ModelStructure&gt;.</em></p>
</li>
<li>
<p><em>A so-called graph coloring algorithm is employed to determine the columns of the matrix that can be computed by one call of fmi3GetDirectionalDerivative.
Efficient graph coloring algorithms are freely available, such as library ColPack (<a href="https://cscapes.cs.purdue.edu/coloringpage/" class="bare">https://cscapes.cs.purdue.edu/coloringpage/</a>) written in C/C++ (LGPL), or the routines by Coleman, Garbow, Moré: "Software for estimating sparse Jacobian matrices", ACM Transactions on Mathematical Software - TOMS, vol. 10, no. 3, pp. 346-347, 1984. See e.g. <a href="http://www.netlib.org/toms/618" class="bare">http://www.netlib.org/toms/618</a>.</em></p>
</li>
<li>
<p><em>For the columns determined in (2), one call to fmi3DirectionalDerivative is made.
After each such call, the elements of the resulting directional derivative vector are copied into their correct locations of the partial derivative matrix.</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>More details and implementational notes are available from (Akesson et.al. 2012).]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_number_of_event_indicators">2.1.10. Getting Number of Event Indicators</h4>
<div class="paragraph">
<p>The number of event indicators can change during simulation if it depends on one or more tunable structural parameters and can be retrieved after instantiating the FMU by calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNumberOfEventIndicatorsTYPE(fmi3Component c, size_t* nz);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of event indicators.  The dependency of the number of event indicators on structural parameters must be specified in the <code>ModelStructure</code> in the element <code>NumberOfEventIndicators</code>. This element is optional but necessary if the number of event indicators depends on structural parameters. If the <code>NumberOfEventIndicators</code> element is not present or its dependencies list is empty, the number of event indicators does not depend on structural parameters, i.e. it is constant.</p>
</div>
<div class="paragraph">
<p>The <code>numberOfEventIndicators</code> attribute of the <code>fmiModelDescription</code> element holds the number of event indicators if all structural parameters are unchanged, i.e. set to their start value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>nz</code> points to the <code>size_t</code> variable that will receive the number of event indicators.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_getting_number_of_states">2.1.11. Getting Number of States</h4>
<div class="paragraph">
<p>The number of states can change during simulation if it depends on one or more tunable structural parameters and can be retrieved after instantiating the FMU by calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNumberOfContinuousStatesTYPE(fmi3Component c, size_t* nx);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of states.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>nz</code> points to the <code>size_t</code> variable that will receive the number of states.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_getting_number_of_variable_dependencies_and_variable_dependencies">2.1.12. Getting Number of Variable Dependencies and Variable Dependencies</h4>
<div class="paragraph">
<p>The sparseness information within arrays is not given in the xml description. The sparseness muss be retrieved during run-time using the C-API functions. Zeros in the Jacobian are not necessarily due to the structure of the model. Zero in the Jacobian might be due to the current operating point (current state, current inputs) and not due to a structural independence.</p>
</div>
<div class="paragraph">
<p>The variable dependency information in the XML description does not resolve to dependencies of individual array elements, nor does it take into account changing dependencies due to resizing of arrays via structural parameters. An FMU can indicate via the <code>providesPerElementDependencies</code> capability flag that it is able to provide detailed dependency information at runtime through the following C-API. Note that these functions are only defined if the <code>providesPerElementDependencies</code> capability flag is true.</p>
</div>
<div class="paragraph">
<p>The number of dependencies of a given variable, which may change if structural parameters are changed, can be retrieved by calling the following function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNumberOfVariableDependenciesTYPE(fmi3Component c,
                                                           fmi3ValueReference vr,
                                                           size_t* nDependencies);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the number of dependencies for a given variable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>vr</code> specifies the <code>valueReference</code> of the variable for which the number of dependencies should be returned.</p>
</li>
<li>
<p>Argument <code>nDependencies</code> points to the <code>size_t</code> variable that will receive the number of dependencies.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The actual dependencies (of type <code>fmi3DependencyKind</code>) can be retrieved by calling the function <code>fmi3GetVariableDependencies</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum {
    /* fmi3Independent = 0, not needed but reserved for future use */
    fmi3Constant  = 1,
    fmi3Fixed     = 2,
    fmi3Tunable   = 3,
    fmi3Discrete  = 4,
    fmi3Dependent = 5
} fmi3DependencyKind;

typedef fmi3Status fmi3GetVariableDependenciesTYPE(fmi3Component c,
                                                   fmi3ValueReference vrDependent,
                                                   size_t elementIndexDependent[],
                                                   fmi3ValueReference vrIndependent[],
                                                   size_t elementIndexIndependent[],
                                                   fmi3DependencyKind dependencyType[],
                                                   size_t nDependencies);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns the dependency information for a single variable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argument <code>vrDependent</code> specifies the <code>valueReference</code> of the variable for which the dependencies should be returned.</p>
</li>
<li>
<p>Argument <code>nDependencies</code> specifies the number of dependencies that the calling environment allocated space for in the result buffers, and should correspond to the returned by calling <code>fmi3GetNumberOfVariableDependencies</code>.</p>
</li>
<li>
<p>Argument <code>elementIndexDependent</code> must point to a buffer of <code>size_t</code> values of size <code>nDependencies</code> allocated by the calling environment. It is filled in by this function with the element index of the dependent variable that dependency information is provided for. The element indices start with 1. Using the element index 0 means all elements of the variable. (Note: If an array has more than one dimension the indices are serialized in the same order as defined for values).</p>
</li>
<li>
<p>Argument <code>vrIndependent</code> must point to a buffer of <code>fmi3ValueReference</code> values of size <code>nDependencies</code> allocated by the calling environment. It is filled in by this function with the value reference of the independent variable that this dependency entry is dependent upon.</p>
</li>
<li>
<p>Argument <code>elementIndexIndependent</code> must point to a buffer of <code>size_t</code> values of size <code>nDependencies</code> allocated by the calling environment. It is filled in by this function with the element index of the independent variable that this dependency entry is dependent upon. The element indices start with 1. Using the element index 0 means all elements of the variable. (Note: If an array has more than one dimension the indices are serialized in the same order as defined for values).</p>
</li>
<li>
<p>Argument <code>dependencyType</code> must point to a buffer of <code>fmi3DependencyKind</code> values of size <code>nDependencies</code> allocated by the calling environment. It is filled in by this function with
the enumeration value describing the dependency of this dependency entry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this function is called before the <code>fmi3ExitInitializationMode()</code> call, it returns the initial dependencies.
If this function is called after the <code>fmi3ExitInitializationMode()</code> call, it returns the run-time dependencies.
The retrieved dependency information of one variable becomes invalid as soon as a structural parameter linked to the variable or to any of its depending variables are set. As a consequence, if you change structural parameters affecting B or A, the dependency of B becomes invalid. The dependency information must change only if structural parameters are changed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fmi-description-schema">2.2. FMI Description Schema</h3>
<div class="paragraph">
<p>All static information related to an FMU is stored in the text file <code>modelDescription.xml</code>
in XML format.
Especially, the FMU variables and their attributes such as name, unit, default initial value, etc. are stored in this file.
The structure of this XML file is defined with the schema file <code>fmiModelDescription.xsd</code>.
This schema file utilizes the following helper schema files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fmi3Annotation.xsd</code><br></p>
</li>
<li>
<p><code>fmi3AttributeGroups.xsd</code><br></p>
</li>
<li>
<p><code>fmi3ScalarVariable.xsd</code><br></p>
</li>
<li>
<p><code>fmi3Type.xsd</code><br></p>
</li>
<li>
<p><code>fmi3VariableDependency.xsd</code><br></p>
</li>
<li>
<p><code>fmi3Unit.xsd</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this section these schema files are discussed.
The normative definition are the above mentioned schema files <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>.
Below, optional elements are marked with a "dashed" box.
The required data types (like: xs:normalizedString) are defined in the XML-schema standard: <a href="http://www.w3.org/TR/XMLschema-2/" class="bare">http://www.w3.org/TR/XMLschema-2/</a>.
The types used in the fmi3 schema files are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XML</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description (<a href="http://www.w3.org/TR/xmlschema-2/">http://www.w3.org/TR/XMLschema-2/</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Mapping to C</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE double-precision 64-bit floating point type <em>[In order to not loose precision,
a number of this type should be stored on an XML file with at least <strong>16</strong> significant digits; for example, 2/3 should be stored as <code>0.6666666666666667</code>]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 2147483647 and minimum value -2147483648 (32 bit Integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:unsignedInt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 4294967295 and minimum value 0 (unsigned 32 bit Integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean number. Legal literals: false, true, 0, 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any number of characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:normalizedString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String without carriage return, line feed, and tab characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:hexBinary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrary hex-encoded binary data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:dateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date, time and time zone (for details see the link above).
Example: 2002-10-23T12:00:00Z (noon on October 23, 2002, Greenwich Mean Time)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tool specific</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first line of an XML file, such as <code>modelDescription.xml</code>, must contain the encoding scheme of the XML file.
It is required that the encoding scheme is always UTF-8:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FMI schema files (*.xsd) are also stored in "UTF-8".<br>
<em>[Note that the definition of an encoding scheme is a prerequisite in order for the XML file to contain letters outside of the 7 bit ANSI ASCII character set, such as German umlauts, or Asian characters. Furthermore, note the FMI calling interface requires that strings are encoded in UTF-8.
Since the XML files are also required to be encoded in UTF-8, string variables need not to be transformed when reading from the XML files in to C string variables.].</em></p>
</div>
<div class="paragraph">
<p>The special values NAN, +INF, -INF for variables values are not allowed in the FMI XML files.</p>
</div>
<div class="paragraph">
<p><em><span class="Note that child information items">ordered lists</span> according to document order, whereas attribute information items are <span class="underline">unordered sets</span> (see <a href="http://www.w3.org/TR/XML-infoset/#infoitem.element" class="bare">http://www.w3.org/TR/XML-infoset/#infoitem.element</a>).
The FMI schema is based on ordered lists in a sequence and therefore parsing must preserve this order.
For example, the information stored in <code>ModelVariables.Derivatives</code> is only correct if this property is fulfilled.]</em></p>
</div>
<div class="sect3">
<h4 id="fmiModelDescription">2.2.1. Definition of an FMU (fmiModelDescription)</h4>
<div class="paragraph">
<p>This is the root-level schema file and contains the following definition (the figure below contains all elements in the schema file.
Data is defined by attributes to these elements):</p>
</div>
<div id="system_overview" class="paragraph">
<p><span class="image"><img src="images/fmiModelDescription_schema.png" alt="fmiModelDescription schema"></span></p>
</div>
<div class="paragraph">
<p>On the top level, the schema consists of the following elements (see <a href="#system_overview">figure above</a>
<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element-Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModelExchange</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on "FMI for Model Exchange" <em>[(in other words, the FMU includes the model or the communication to a tool that provides the model, and the environment provides the simulation engine)]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CoSimulation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, the FMU is based on "FMI for Co-Simulation" <em><span class="(in other words">and</span> the simulation engine, or a communication to a tool that provides the model and the simulation engine, and the environment provides the master algorithm to run coupled FMU co-simulation slaves together)]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UnitDefinitions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of unit and display unit definitions <em>[for example, to convert display units into the units used in the model equations]</em>.
These definitions are used in the XML element <code>ModelVariables</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TypeDefinitions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of type definitions that are utilized in <code>ModelVariables</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LogCategories</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of log categories that can be set to define the log information that is supported from the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DefaultExperiment</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Providing default settings for the integrator, such as stop time and relative tolerance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VendorAnnotations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional data that a vendor might want to store and that other vendors might ignore.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModelVariables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The central FMU data structure defining all variables of the FMU that are visible/accessible via the FMU functions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModelStructure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the structure of the model.
Especially, the ordered lists of outputs, continuous-time states and initial unknowns (the unknowns during Initialization Mode) are defined here.
Furthermore, the dependency of the unkowns from the knowns can be optionally defined.
<em>[This information can be, for example, used to compute efficiently a sparse Jacobian for simulation, or to utilize the input/output dependency in order to detect that in some cases there are actually no algebraic loops when connecting FMUs together]</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At least one element of <code>ModelExchange</code> or <code>CoSimulation</code> must be present to identify the type of the FMU.
If both elements are defined, different types of models are included in the FMU.
The details of these elements are defined in <a href="#ModelExchange">Section 3.3.1</a> and <a href="#CoSimulation">Section 4.3.1</a>.</p>
</div>
<div class="paragraph">
<p>The XML attributes of <code>fmiModelDescription</code> are:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/fmiModelDescription_schema_2.png" alt="fmiModelDescription schema 2" width="80%"></span></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute-Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmiVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of "FMI for Model Exchange or Co-Simulation" that was used to generate the XML file.
The value for this version is "2.0".
Future minor revisions are denoted as "2.0.1", "2.0.2", &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the model as used in the modeling environment that generated the XML file, such as "Modelica.Mechanics.Rotational.Examples.CoupledClutches".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>instantiationToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The instantiationToken is a string that can be used by the FMU to check that the XML file is compatible with the implementation of the FMU.
For this purpose the importing tool must pass the instantiationToken from the modelDescription.xml to the fmi3Instantiate function call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional string with a brief description of the model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>author</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional string with the name and organization of the model author.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional version of the model, for example, "1.0".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>copyright</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional information on the intellectual property copyright for this FMU.<br>
<em>[Example: copyright = "© My Company 2011"]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>license</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional information on the intellectual property licensing
for this FMU.<br>
<em>[Example: license = "BSD license &lt;license text or link to license&gt;"]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generationTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional name of the tool that generated the XML file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generationDateAndTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional date and time when the XML file was generated.
The format is a subset of "xs:dateTime" and should be: "YYYY-MM-DDThh:mm:ssZ" (with one "T" between date and time; "Z" characterizes the Zulu time zone, in other words, Greenwich meantime).<br>
<em>[Example: "2009-12-08T14:33:22Z"]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>variableNamingConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines whether the variable names in <code>ModelVariables / ScalarVariable / name</code> and in <code>TypeDefinitions / Type / name</code> follow a particular convention.
For the details, see <a href="#variableNamingConvention">Section 2.2.9</a>. Currently standardized are:</p>
<p class="tableblock">- <code>flat</code>: A list of strings (the default).</p>
<p class="tableblock">- <code>structured</code>: Hierarchical names with "." as hierarchy separator,
and with array elements and derivative characterization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>numberOfEventIndicators</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The (fixed) number of event indicators for an FMU based on FMI for Model Exchange.<br>
For Co-Simulation, this value is ignored.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[The attribute <code>numberOfContinuousStates</code> available in FMI 1.0 has been removed for FMI 2.0,
since this information can be deduced from the remaining data in the XML file.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_units_unitdefinitions">2.2.2. Definition of Units (UnitDefinitions)</h4>
<div class="paragraph">
<p><em>[In this section, the units of the variables are (optionally) defined.
Unit support is important for technical systems since otherwise it is very easy for errors to occur.
Unit handling is a difficult topic, and there seems to be no method available that is really satisfactory for all applications, such as unit check, unit conversion, unit propagation or dimensional analysis.
In FMI, a pragmatic approach is used that takes into account that every software system supporting units has potentially its own specific technique to describe and utilize units.
The approach used here is slightly different than FMI 1.0 to reduce the need for standardized string representations.]</em></p>
</div>
<div class="paragraph">
<p>Element "<strong>UnitDefinitions</strong>" of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/UnitDefinitions_schema.png" alt="UnitDefinitions schema">
</div>
</div>
<div class="paragraph">
<p>It consists of zero or more <code>Unit</code> definitions <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup>.
A <code>Unit</code> is defined by its <code>name</code> attribute such as "N.m" or "N*m" or "Nm", which must be unique with respect to all other defined elements of the <code>UnitDefinitions</code> list.
If a variable is associated with a <code>Unit</code>, then the value of the variable has to be provided with the <code>fmi3SetXXX</code> functions or else is returned by the <code>fmi3GetXXX</code> functions with respect to this <code>Unit</code>.
<em>[The purpose of the name is to uniquely identify a unit and, for example, use it to display the unit in menus or in plots.
Since there is no standard to represent units in strings, and there are different ways how this is performed in different tools, no specific string representation of the unit is required.]</em></p>
</div>
<div class="paragraph">
<p>Optionally, a value given in unit <code>Unit</code> can be converted to a value with respect to unit <code>BaseUnit</code> utilizing the conversion <code>factor</code> and <code>offset</code> attributes:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/BaseUnit_schema.png" alt="BaseUnit schema" width="50%">
</div>
</div>
<div class="paragraph">
<p>Besides <code>factor</code> and <code>offset</code>, the <code>BaseUnit</code> definition consists of the exponents of the 7 SI base units "kg", "m", "s", "A", "K", "mol", "cd", and of the exponent of the SI derived unit "rad".
<em>[Depending on the analysis/operation carried out, the SI derived unit "rad" is or is not utilized, see discussion below.
The additional "rad" base unit helps to handle the often occurring quantities in technical systems that depend on an angle.]</em></p>
</div>
<div class="paragraph">
<p>A value with respect to <code>Unit</code> (abbreviated as "Unit_value") is converted with respect to <code>BaseUnit</code> (abbreviated as "BaseUnit_value") by the equation:</p>
</div>
<div class="paragraph">
<p>BaseUnit_value = <code>factor</code>* Unit_value + <code>offset</code></p>
</div>
<div class="paragraph">
<p><em>[For example, if</em> \(\color{blue}{p_{bar}}\) <em>is a pressure value in unit "bar", and</em> \(\color{blue}{p_{Pa}}\) <em>is the pressure value in <code>BaseUnit</code>, then</em></p>
</div>
<div class="paragraph">
<p>\(\color{blue}{p_{Pa} = 10^5 p_{bar}}\)</p>
</div>
<div class="paragraph">
<p><em>and therefore, <code>factor = 1.0e5</code> and <code>offset = 0.0</code>.</em></p>
</div>
<div class="paragraph">
<p><em>[In the following table several unit examples are given (Note that if in column <code>exponents</code> the definition "\(\color{blue}{kgm^2 / s^2}\)" is present, then the attributes of <code>BaseUnit</code> are: <code>kg=1, m=2, s=-2</code>):</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock"><strong>Quantity</strong></p></td>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock"><strong>Unit.name</strong><br>
(examples)</p></td>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>Unit.BaseUnit</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>exponents</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>factor</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>offset</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Torque</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N.m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\color{blue}{kg \cdot m^2 / s^2}\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Energy</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>J</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\color{blue}{kg \cdot m^2 / s^2}\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Pressure</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>bar</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\color{blue}{\frac{kg}{m \cdot s^2}}\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0e5</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Angle</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>deg</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.01745329251994330 (= pi/180)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Angular velocity</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Angular velocity</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rpm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.1047197551196598 (=2*pi/60)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Frequency</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Hz</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>6.283185307179586</code><br>
<code>(= 2*pi)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Temperature</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>°F</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>K</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.5555555555555556</code><br>
<code>(= 5/9)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>255.3722222222222</code><br>
<code>(= 273.15-32*5/9)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Per cent by length</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>%/m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1/m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.01</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Parts per million</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ppm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0e-6</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Length</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>km</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Length</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>yd</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.9144</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Note that "Hz" is typically used as <code>Unit.name</code> for a frequency quantity, but it can also be used as <code>DisplayUnit</code> for an angular velocity quantity (since <code>revolution/s</code>).]</em></p>
</div>
<div class="paragraph">
<p><em>The <code>BaseUnit</code> definitions can be utilized for different purposes (the following application examples are optional and a tool may also completely ignore the <code>Unit</code> definitions):</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Signal connection check</dt>
<dd>
<div class="paragraph">
<p><em>When two signals v1 and v2 are connected together, and on at least one of the signals no <code>BaseUnit</code> element is defined, then the connection equation "v2 = v1" holds (if v1 is an output of an FMU and v2 is an input of another FMU,with <code>fmi3GetXXX</code> the value of v1 is inquired and used as value for v2 by calling <code>fmi3SetXXX</code>).</em></p>
</div>
<div class="paragraph">
<p><em>When two signals v1 and v2 are connected together, and for both of them <code>BaseUnit</code> elements are defined, then they must have identical exponents of their <code>BaseUnit</code>.
If <code>factor</code> and <code>offset</code> are also identical, again the connection equation "v2 = v1" holds.
If <code>factor</code> and <code>offset</code> are not identical, the tool may either trigger an error or, if supported, perform a conversion; in other words, use the connection equation (in this case the <code>relativeQuantity</code> of the <code>TypeDefinition</code>, see below, has to be taken into account in order to determine whether <code>offset</code> shall or shall not be utilized):</em></p>
</div>
<div class="paragraph">
<p><code>factor(v1)*v1 + offset(v1) = factor(v2)*v2 + offset(v2)</code></p>
</div>
<div class="paragraph">
<p>_As a result, wrong connections can be detected (for example, connecting a force with an angle signal would trigger an error) and conversions between, say, US and SI units can be either automatically performed or, if not supported, an error is triggered as well.</p>
</div>
<div class="paragraph">
<p><em>[Note that this approach is not satisfactory for variables belonging to different quantities that have, however, the same <code>BaseUnit</code>, such as quantities "Energy" and "Torque", or "AngularVelocity" and "Frequency".
To handle such cases, quantity definitions have to be taken into account (see <code>TypeDefinitions</code>) and quantity names need to be standardized.]</em></p>
</div>
<div class="paragraph">
<p><em>This approach allows a general treatment of units, without being forced to standardize the grammar and allowed values for units (for example, in FMI 1.0, a unit could be defined as "N.m" in one FMU and as "N*m" in another FMU, and a tool would have to reject a connection, since the units are not identical. In FMI 2.0, the connection would be accepted, provided both elements have the same <code>BaseUnit</code> definition).</em></p>
</div>
</dd>
<dt class="hdlist1">Dimensional analysis of equations</dt>
<dd>
<div class="paragraph">
<p><em>In order to check the validity of equations in a modeling language,
the defined units can be used for dimensional analysis,
by using the <code>BaseUnit</code> definition of the respective unit.
For this purpose, the <code>BaseUnit</code> "rad" has to be treated as "1".
Example:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>J*α = τ → [kg.m2]*[rad/s2] = [kg.m2/s2]). // o.k. ("rad" is treated as "1")
J*α = f → [kg.m2]*[rad/s2] = [kg.m/s2]). // error, since dimensions do not agree</pre>
</div>
</div>
</dd>
<dt class="hdlist1">Unit propagation</dt>
<dd>
<div class="paragraph">
<p><em>If unit definitions are missing for signals, they might be deduced from the equations where the signals are used.
If no unit computation is needed, "rad" is propagated.
If a unit computation is needed and one of the involved units has "rad" as a <code>BaseUnit</code>, then unit propagation is not possible.
Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>a = b + c, and <code>Unit</code> of c is provided, but not <code>Unit</code> of a and b:</em><br>
<em>The Unit definition of c (in other words, <code>Unit.name</code>, <code>BaseUnit</code>, <code>DisplayUnit</code>) is also used for a and b.
For example, if BaseUnit(c) = "rad/s", then BaseUnit(a) = BaseUnit(b) = "rad/s".</em></p>
</li>
<li>
<p><em>a = b*c, and <code>Unit</code> of a and of c is provided, but not <code>Unit</code> of b:</em><br>
<em>If "rad" is either part of the <code>BaseUnit</code> of "a" and/or of "c", then the <code>BaseUnit</code> of b cannot be deduced (otherwise it can be deduced).
Example: If BaseUnit(a)="kg.m/s2" and BaseUnit(c)="m/s2", then the BaseUnit(b) can be deduced to be "kg".
In such a case <code>Unit.name</code> of b cannot be deduced from the <code>Unit.name</code> of a and c, and a tool would typically construct the <code>Unit.name</code> of b from the deduced <code>BaseUnit</code>.]</em></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additionally to the unit definition, optionally a set of display units can be defined that can be utilized for input/output of a value:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/DisplayUnit_schema.png" alt="DisplayUnit schema" width="80%">
</div>
</div>
<div class="paragraph">
<p>A <code>DisplayUnit</code> is defined by <code>name</code>, <code>factor</code> and <code>offset</code>.
The attribute <code>name</code> must be unique with respect to all other <code>names</code> of the <code>DisplayUnit</code> definitions of the same <code>Unit</code> [(different <code>Unit</code> elements may have the same <code>DisplayUnit</code> names)].
A value with respect to Unit (abbreviated as "Unit_value") is converted with respect to <code>DisplayUnit</code> (abbreviated as "DisplayUnit_value") by the equation:</p>
</div>
<div class="paragraph">
<p>DisplayUnit_value = <code>factor</code> * Unit_value + <code>offset</code></p>
</div>
<div class="paragraph">
<p><em>["offset" is, for example, needed for temperature units.]</em></p>
</div>
<div class="paragraph">
<p><em>[For example, if \(\color{blue}{T_K}\) is the temperature value of <code>Unit.name</code> (in "K") and \(\color{blue}{T_F}\) is the temperature value of <code>DisplayUnit</code> (in "°F"),
then</em></p>
</div>
<div class="stemblock">
<div class="content">
\[T_F = (9/5) * (T_K - 273.15) + 32\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, <code>factor = 1.8 (=9/5)</code> and <code>offset = -459.67 (= 32 - 273.15*9/5)</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Both the <code>DisplayUnit.name</code> definitions as well as the <code>Unit.name</code> definitions are used in the <code>ScalarVariable</code> elements.
Example for a definition:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;Unit name="rad/s"&gt;
    &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;DisplayUnit name="deg/s" factor= "57.29577951308232"/&gt;
    &lt;DisplayUnit name="rev/min" factor= "9.549296585513721"/&gt;
&lt;/Unit&gt;
 &lt;Unit name="bar"&gt;
    &lt;BaseUnit kg="1", m="-1", s="-2", factor="1.0e5", offset="0"/&gt;
&lt;/Unit&gt;
 &lt;Unit name="Re"&gt;
    &lt;BaseUnit/&gt;    // unit = "1"
                   //(dimensionless, all exponents of BaseUnit are zero)
 &lt;/Unit&gt;
 &lt;Unit name="Euro/PersonYear"/&gt;  // no mapping to BaseUnit defined</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>The schema definition is present in a separate file <code>fmi3Unit.xsd</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="definition-of-types">2.2.3. Definition of Types (TypeDefinitions)</h4>
<div class="paragraph">
<p>Element <strong>"TypeDefinitions"</strong> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/TypeDefinitions_schema.png" alt="TypeDefinitions schema" width="90%">
</div>
</div>
<div class="paragraph">
<p>This element consists of a set of <code>SimpleType</code> definitions according to schema <code>fmi3SimpleType</code> in file <code>fmi3Type.xsd</code>.
One <code>SimpleType</code> has a type <code>name</code> and <code>description</code> as attributes.
Attribute "name" must be unique with respect to all other elements of the <code>TypeDefinitions</code> list.
Furthermore,
<code>name</code> of a <code>SimpleType</code> must be different to all <code>name</code> attributes of <code>ScalarVariable</code>s <em>[if the same names would be used, then this would nearly always give problems when importing the FMU in an environment such as Modelica, where a type name cannot be used as instance name]</em>.
Additionally, one of the elements <code>Real</code>, <code>Integer</code>, <code>Boolean</code>, <code>String</code>, <code>Binary</code>, or <code>Enumeration</code> must be present.
They have the following definitions:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Real_schema.png" alt="Real schema" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Integer_schema.png" alt="Integer schema" width="50%">
</div>
</div>
<div class="paragraph">
<p><em>[The attributes of "Real" and "Integer" are collected in the attribute groups "fmi3RealAttributes" and "fmi3IntegerAttributes" in file "fmi3AttributeGroups.xsd", since these attributes are reused in the <code>ScalarVariable</code> element definitions below.]</em></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Enumeration_schema.png" alt="Enumeration schema" width="80%">
</div>
</div>
<div class="paragraph">
<p>These definitions are used as default values in element <code>ScalarVariable</code>s <em>[in order that, say, the definition of a "Torque" type does not have to be repeated over and over again]</em>.
The attributes and elements have the following meaning:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quantity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical quantity of the variable. <em>[For example, "Angle", or "Energy".
The quantity names are not standardized]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit of the variable defined with <code>UnitDefinitions.Unit.name</code> that is used for the model equations. <em>[For example, "N.m": in this case a <code>Unit.name = "N.m</code> must be present under <code>UnitDefinitions</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">displayUnit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default display unit. The conversion to the <code>unit</code> is defined with the element <code>&lt;fmiModelDescription&gt;&lt;UnitDefinitions&gt;</code>.
If the corresponding <code>displayUnit</code> is not defined under <code>&lt;UnitDefinitions&gt; &lt;Unit&gt; &lt;DisplayUnit&gt;</code>, then <code>displayUnit</code> is ignored.
It is an error if <code>displayUnit</code> is defined in element <code>Real</code>, but <code>unit</code> is not, or unit is not defined under <code>&lt;UnitDefinitions&gt;&lt;Unit&gt;</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mimeType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the type of data passed as a binary.
Defaults to <code>application/octet-stream</code>, which is unspecific. Implementations can use this information to provide guidance to the user about valid/useful connections.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">relativeQuantity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this attribute is <code>true</code>, then the <code>offset</code> of <code>displayUnit</code> must be ignored.
<em>[For example, 10 degree Celsius = 10 Kelvin if <code>relativeQuantity = "true"</code> and not 283.15 Kelvin.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum value of variable (variable value ≥ <code>min</code>).
If not defined, the minimum is the largest negative number that can be represented on the machine.
The <code>min</code> definition is information from the FMU to the environment defining the region in which the FMU is designed to operate, see also comment after this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum value of variable (variable value ≤ <code>max</code>).
If not defined, the maximum is the largest positive number that can be represented on the machine.
The <code>max</code> definition is information from the FMU to the environment defining the region in which the FMU is designed to operate, see also comment after this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nominal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nominal value of variable.
If not defined and no other information about the nominal value is available, then nominal = 1 is assumed.<br>
<em>[The nominal value of a variable can be, for example, used to determine the absolute tolerance for this variable as needed by numerical algorithms:</em><br>
absoluteTolerance = <code>nominal</code> * <code>tolerance</code> * 0.01<br>
<em>where <code>tolerance</code> is, for example, the relative tolerance defined in <code>&lt;DefaultExperiment&gt;</code>, see <a href="#DefaultExperiment">Section 2.2.5</a>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unbounded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, indicates that during time integration, the variable gets a value much larger than its nominal value <code>nominal</code>.
<em>[Typical examples are the monotonically increasing rotation angles of crank shafts and the longitudinal position of a vehicle along the track in long distance simulations.
This information can, for example, be used to increase numerical stability and accuracy by setting the corresponding bound for the relative error to zero (relative tolerance = 0.0), if the corresponding variable or an alias of it is a continuous state variable.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Items of an enumeration has a sequence of <code>name</code> and <code>value</code> pairs.
The values can be any integer number but must be unique within the same enumeration (in order that the mapping between <code>name</code> and <code>value</code> is bijective).
An <code>Enumeration</code> element must have at least one Item.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Attributes <code>min</code> and <code>max</code> can be set for variables of type Real, Integer or Enumeration.
The question is how <code>fmi3SetReal</code>, <code>fmi3SetInteger</code>, <code>fmi3GetReal</code>,
<code>fmi3GetInteger</code> shall utilize this definition.
There are several conflicting requirements:</em><br>
<em>Avoiding forbidden regions (for example, if "u" is an input and "sqrt(u)" is computed in the FMU, min=0 on "u" shall guarantee that only values of "u" in the allowed regions are provided).</em>
<em>Numerical algorithms (ODE-solver, optimizers. nonlinear solvers) do not guarantee constraints.
If a variable is outside of the bounds, the solver tries to bring it back into the bounds.
As a consequence, calling <code>fmi3GetReal</code> during an iteration of such a solver might return values that are not in the defined min/max region.
After the iteration is finalized, it is only guaranteed that a value is within its bounds up to a certain numerical precision.</em><br>
<em>In debug mode checks on min/max should be performed.
For maximum performance on a real-time system the checks might not be performed.</em><br>
<em>The approach in FMI is therefore that min/max definitions are an information from the FMU to the environment defining the region in which the FMU is designed to operate.
The environment is free to utilize this information (typically, in debug mode of the environment the min/max is checked in the cases as stated above).
In any case, it is expected that the FMU handles variables appropriately where the region definition is critical.
For example, dividing by an input (so the input should not be in a small range of zero) or taking the square root of an input (so the input should not be negative) may either result in fmi3Error, or the FMU is able to handle this situation in other ways.</em></p>
</div>
<div class="paragraph">
<p><em>If the FMU is generated so that min/max shall be checked whenever meaningful (for example, for debug purposes), then the following strategy should be used:</em></p>
</div>
<div class="paragraph">
<p><em>If <code>fmi3SetReal</code> or <code>fmi3SetInteger</code> is called violating the min/max attribute settings of the corresponding variable, the following actions are performed:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>On a fixed or tunable parameter <code>fmi3Status = fmi3Discard</code> is returned.</em></p>
</li>
<li>
<p><em>On an input, the FMU decides what to return (If no computation is possible, it could return <code>fmi3Status =  fmi3Discard</code>, in other situations it may return <code>fmi3Warning</code> or <code>fmi3Error</code>, or <code>fmi3OK</code>, if it is uncritical).</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>If an FMU defines min/max values for Integer and Enumerations (local and output variables), then the expected behavior of the FMU is that <code>fmi3GetInteger</code> returns values in the defined range.</em></p>
</div>
<div class="paragraph">
<p><em>If an FMU defines min/max values for Reals, then the expected behavior of the FMU is that <code>fmi3GetReal</code> returns values at the solution (accepted steps of the integrators) in the defined range with a certain uncertainty related to the tolerances of the numerical algorithms.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="definition-of-log-categories">2.2.4. Definition of Log Categories (LogCategories)</h4>
<div class="paragraph">
<p>Element <code>LogCategories</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/LogCategories_schema.png" alt="LogCategories schema" width="70%">
</div>
</div>
<div class="paragraph">
<p><code>LogCategories</code> defines an unordered set of category strings that can be utilized to define the log output via function <code>logger</code>, see <a href="#creation-destruction-and-logging">Section 2.1.5</a>.
A tool is free to use any <code>normalizedString</code> for a category value.
The <code>name</code> attribute of <code>Category</code> must be unique with respect to all other elements of the <code>LogCategories</code> list.</p>
</div>
<div class="paragraph">
<p>There are the following standardized names for <code>Category</code> and these names should be used if a tool supports the corresponding log category.
If a tool supports one of these log categories and wants to expose it, then an element Category with this name should be added to <code>LogCategories</code> <em>[To be clear, only the Category names listed under <code>LogCategories</code> in the XML file are known to the environment in which the FMU is called.]</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Category name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logEvents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log all events (during initialization and simulation).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logSingularLinearSystems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the solution of linear systems of equations if the solution is singular (and the tool picked one solution of the infinitely many solutions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logNonlinearSystems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the solution of nonlinear systems of equations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logDynamicStateSelection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the dynamic selection of states.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusWarning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning fmi3Warning status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusDiscard</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning fmi3Discard status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning fmi3Error status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusFatal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning fmi3Fatal status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusPending</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning fmi3Pending status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logAll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log all messages.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The optional attribute <code>description</code> shall contain a description of the respective log category.
<em>[Typically, this string can be shown by a tool if more details for a log category shall be presented.]</em></p>
</div>
<div class="paragraph">
<p><em>[This approach to define <code>LogCategories</code> has the following advantages:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>A simulation environment can present the possible log categories in a menu and the user can select the desired one (in the FMI 1.0 approach, there was no easy way for a user to figure out from a given FMU what log categories could be provided).</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>[Note that since element <code>&lt;LogCategories&gt;</code> is optional, an FMU does not need to expose its log categories.]</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>The log output is drastically reduced, because via <code>fmi3SetDebugLogging</code> exactly the categories are set that shall be logged and therefore the FMU only has to print the messages with the corresponding categories to the <code>logger</code> function.
In FMI 1.0, it was necessary to provide all log output of the FMU to the <code>logger</code> and then a filter in the <code>logger</code> could select what to show to the end-user.
The approach introduced in FMI 2.0 is therefore much more efficient.]</em></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="DefaultExperiment">2.2.5. Definition of a Default Experiment (DefaultExperiment)</h4>
<div class="paragraph">
<p>Element <code>DefaultExperiment</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/DefaultExperiment_schema.png" alt="DefaultExperiment schema" width="70%">
</div>
</div>
<div class="paragraph">
<p><code>DefaultExperiment</code> consists of the optional default start time, stop time, relative tolerance, and step size for the first simulation run.
A tool may ignore this information.
However, it is convenient for a user that <code>startTime</code>, <code>stopTime</code>, <code>tolerance</code> and <code>stepSize</code> have already a meaningful default value for the model at hand.
Furthermore, for CoSimulation the <code>stepSize</code> defines the preferred <code>communicationStepSize</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_vendor_annotations_vendorannotations">2.2.6. Definition of Vendor Annotations (VendorAnnotations)</h4>
<div class="paragraph">
<p>Element <code>VendorAnnotations</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/VendorAnnotations_schema.png" alt="VendorAnnotations schema" width="80%">
</div>
</div>
<div class="paragraph">
<p><code>VendorAnnotations</code> consist of an ordered set of annotations that are identified by the name of the tool that can interpret the <code>any</code> element.
The <code>any</code> element can be an arbitrary XML data structure defined by the tool.
Attribute <code>name</code> must be unique with respect to all other elements of the <code>VendorAnnotation</code> list.</p>
</div>
</div>
<div class="sect3">
<h4 id="definition-of-model-variables">2.2.7. Definition of Model Variables (ModelVariables)</h4>
<div class="paragraph">
<p>The <code>ModelVariables</code> element of <code>fmiModelDescription</code> is the central part of the model description.
It provides the static information of all exposed variables and is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ModelVariables_schema.png" alt="ModelVariables schema" width="100%">
</div>
</div>
<div class="paragraph">
<p>The <code>ModelVariables</code> element consists of an ordered set of <code>ScalarVariable</code> elements (see figure above).
The first element has <code>index = 1</code>,
the second <code>index=2</code>, etc.
This <code>ScalarVariable</code> <code>index</code> is used in element <code>ModelStructure</code> to uniquely and efficiently refer to <code>ScalarVariable</code> definitions.
A <code>ScalarVariable</code> represents a variable of primitive type, like a real or integer variable.
For simplicity,
only scalar variables are supported in the schema file in this version and structured entities (like arrays or records) have to be mapped to scalars.
The schema definition is present in a separate file <code>fmi3ScalarVariable.xsd</code>.
The attributes of <code>ScalarVariable</code> are:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ScalarVariable_schema.png" alt="ScalarVariable schema" width="90%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Attribute-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full, <span class="underline">unique name</span> of the variable.
Every variable is uniquely identified within an FMU instance by this name or by its <code>ScalarVariable index</code> (the element position in the <code>ModelVariables</code> list; the first list element has <code>index=1</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueReference</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A handle of the variable to efficiently identify the variable value in the model interface.
This handle is a secret of the tool that generated the C functions.
It is not required to be unique.
The only guarantee is that valueReference is sufficient to identify the respective variable value in the call of the C functions.
This implies that it is unique for a particular base data type (<code>Real</code>, <code>Integer/Enumeration</code>, <code>Boolean</code>, <code>String</code>) with exception of variables that have identical values (such variables are also called "alias" variables).
This attribute is "required".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional description string describing the meaning of the variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>causality</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumeration that defines the causality of the variable.
Allowed values of this enumeration:</p>
<p class="tableblock">- <code>"parameter"</code>: Independent parameter (a data value that is constant during the simulation and is provided by the environment and cannot be used in connections).
<code>variability</code> must be <code>"fixed"</code> or <code>"tunable"</code>.
<code>initial</code> must be <code>"exact"</code> or not present (meaning <code>"exact"</code>).</p>
<p class="tableblock">- <code>"calculatedParameter"</code>: A data value that is constant during the simulation and is computed during initialization or when tunable parameters change.
<code>variability</code> must be <code>"fixed"</code> or <code>"tunable"</code>.
<code>initial</code> must be <code>"approx"</code>, <code>"calculated"</code> or not present (meaning <code>"calculated"</code>).</p>
<p class="tableblock">- <code>"input"</code>: The variable value can be provided from another model or slave.
It is not allowed to define <code>initial</code>.</p>
<p class="tableblock">- <code>"output"</code>: The variable value can be used by another model or slave.
The algebraic relationship to the inputs is defined via the <code>dependencies</code> attribute of <code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;&lt;Outputs&gt;&lt;Unknown&gt;</code>.</p>
<p class="tableblock">- <code>"local"</code>: Local variable that is calculated from other variables or is a continuous-time state (see <a href="#ModelStructure">Section 2.2.8</a>).
It is not allowed to use the variable value in another model or slave.</p>
<p class="tableblock">- <code>"independent""</code>: The independent variable (usually <code>time</code>).
All variables are a function of this independent variable.
<code>variability</code> must be <code>"continuous"</code>.
At most one <code>ScalarVariable</code> of an FMU can be defined as <code>"independent"</code>.
If no variable is defined as <code>"independent"</code>, it is implicitly present with name = <code>time</code> and <code>unit = "s"</code>.
If one variable is defined as <code>"independent"</code>, it must be defined as <code>Real</code> without a <code>start</code> attribute.
It is not allowed to call function <code>fmi3SetReal</code> on an <code>"independent"</code> variable.
Instead, its value is initialized with <code>fmi3SetupExperiment</code> and after initialization set by <code>fmi3SetTime</code> for ModelExchange and by arguments <code>currentCommunicationPoint</code> and <code>communicationStepSize</code> of <code>fmi3DoStep</code> for CoSimulation.
<em>[The actual value can be inquired with <code>fmi3GetReal</code>.]</em></p>
<p class="tableblock">The default of causality is <code>"local"</code>.<br>
A continuous-time state must have <code>causality = "local"</code> or <code>output"</code>, see also <a href="#ModelStructure">Section 2.2.8</a>.</p>
<p class="tableblock"><em>[<code>causality = "calculatedParameter"</code> and <code>causality = "local"</code> with <code>variability = "fixed"</code> or <code>"tunable"</code> are similar.
The difference is that a <code>"calculatedParameter"</code> can be used in another model or slave, whereas a local variable cannot.
For example, when importing an FMU in a Modelica environment, a <code>"calculatedParameter"</code> should be imported in a <code>public</code> section as <code>final parameter</code>, whereas a <code>"local"</code> variable should be imported in a <code>protected</code> section of the model.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>variability</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumeration that defines the time dependency of the variable, in other words, it defines the time instants when a variable can change its value.
<em>[The purpose of this attribute is to define when a result value needs to be inquired and to be stored.
For example, discrete variables change their values only at event instants (ModelExchange) or at a communication point (CoSimulation) and it is therefore only necessary to inquire them with <code>fmi3GetXXX</code> and store them at event times.]</em>
Allowed values of this enumeration:</p>
<p class="tableblock">- <code>"constant"</code>: The value of the variable never changes.</p>
<p class="tableblock">- <code>"fixed"</code>: The value of the variable is fixed after initialization, in other words, after <code>fmi3ExitInitializationMode</code> was called the variable value does not change anymore.</p>
<p class="tableblock">- <code>"tunable"</code>: The value of the variable is constant between <code>external events</code> (ModelExchange) and between <em>Communication Points</em> (CoSimulation) due to changing variables with <code>causality = "parameter"</code> or <code>"input"</code> and <code>variability = "tunable"</code>.
Whenever a parameter or input signal with <code>variability = "tunable"</code> changes, an event is triggered externally (ModelExchange), or the change is performed at the next <em>Communication Point</em> (CoSimulation) and the variables with <code>variability = "tunable"</code> and <code>causality = "calculatedParameter"</code> or <code>"output"</code> must be newly computed.</p>
<p class="tableblock">- <code>"discrete"</code>:<br>
ModelExchange: The value of the variable is constant between <em>external</em> and <em>internal events</em> (= time,
state, step events defined implicitly in the FMU).<br>
CoSimulation: By convention, the variable is from a "real" sampled data system and its value is only changed at Communication Points (also inside the slave).</p>
<p class="tableblock">- <code>"continuous"</code>: Only a variable of <code>type = "Real"</code> can be <code>"continuous"</code>.<br>
ModelExchange: No restrictions on value changes.<br>
CoSimulation: By convention, the variable is from a differential</p>
<p class="tableblock">The default is <code>"continuous"</code>.</p>
<p class="tableblock"><em>[Note that the information about continuous states is defined with element <code>fmiModelDescription.ModelStructure.Derivatives</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initial</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumeration that defines how the variable is initialized.
It is not allowed to provide a value for <code>initial</code> if <code>causality = "input"</code> or <code>"independent"</code>:</p>
<p class="tableblock">- = <code>"exact"</code>: The variable is initialized with the start value (provided under <code>Real</code>, <code>Integer</code>, <code>Boolean</code>, <code>String</code> or <code>Enumeration</code>).</p>
<p class="tableblock">- = <code>"approx"</code>: The variable is an iteration variable of an algebraic loop and the iteration at initialization starts with the start value.</p>
<p class="tableblock">- = <code>"calculated"</code>: The variable is calculated from other variables during initialization.
It is not allowed to provide a <code>"start"</code> value.</p>
<p class="tableblock">If <code>initial</code> is not present, it is defined by the table below based on <code>causality</code> and <code>variability</code>.
If <code>initial = "exact"</code> or <code>"approx"</code>, or <code>causality = "input"</code>, a start value must be provided.
If <code>initial = "calculated"</code>, or <code>causality = "independent"</code>, it is not allowed to provide a start value.</p>
<p class="tableblock"><em>[The environment decides when to use the start value of a variable with <code>causality = "input"</code>.
Examples: (a) automatic tests of FMUs are performed, and the FMU is tested by providing the start value as constant input.
(b) For a ModelExchange FMU, the FMU might be part of an algebraic loop.
If the input variable is iteration variable of this algebraic loop, then initialization starts with its start value.]</em></p>
<p class="tableblock">If <code>fmi3SetXXX</code> is not called on a variable with <code>causality = "input"</code>, then the FMU must use the start value as value of this input.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code>canHandleMultipleSetPerTimeInstant</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only for ModelExchange (if only CoSimulation FMU, this attribute must not be present.
If both ModelExchange and CoSimulation FMU, this attribute is ignored for CoSimulation):<br>
Only for variables with <code>variability = "input"</code>:<br>
If present with <code>value = false</code>, then only one <code>fmi3SetXXX</code> call is allowed at one super dense time instant (model evaluation) on this variable.
That is, this input is not allowed to appear in a (real) algebraic loop requiring multiple calls of <code>fmi3SetXXX</code> on this variable <em>[for example, due to a Newton iteration]</em>.<br>
<em>[This flag must be set by FMUs where (internal) discrete-time states are directly updated when assigned (xd := f(xd) instead of xd = f(previous(xd)),
and at least one output depends on this input and on discrete states.</em><br>
<em>It is strongly recommended that such an FMU checks the fulfillment of the requirement by itself during run-time, because an environment might not be able to check it; usually, there is a generic mechanism to import an FMU in an environment, but the mechanism to connect FMUs together is unrelated to the import mechanism.
For example, there is no mechanism in the Modelica language to formulate connection restrictions for C functions (the FMU) called in a Modelica model.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>fmi3SetXXX</strong> can be called on any variable with <code>variability ≠ "constant"</code> <strong>before initialization</strong> (before calling <code>fmi3EnterInitializationMode</code>)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>initial = "exact"</code> or <code>"approx"</code> <em>[in order to set the corresponding <code>start</code> value.]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>fmi3SetXXX</strong> can be called on any variable with <code>variability ≠ "constant"</code> <strong>during initialization</strong> (after calling <code>fmi3EnterInitializationMode</code> and before <code>fmi3ExitInitializationMode</code> is called)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>initial = "exact"</code> <em>[in order to set the corresponding <code>start</code> value]</em>, or</p>
</li>
<li>
<p>if <code>causality = "input"</code> <em>[in order to provide new values for inputs]</em>,</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>fmi3SetXXX</strong> can be called on any variable <strong>for ModelExchange</strong> <strong>at an event instant</strong> (after calling <code>fmi3EnterEventMode</code> and before <code>fmi3EnterContinuousTimeMode</code> is called), and <strong>for Co-Simulation at every communication point</strong>,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>causality = "parameter"</code> and <code>variability = "tunable"</code> <em>[in order to change the value of the tunable parameter at an event instant or at a communication point]</em>, or</p>
</li>
<li>
<p>if causality = "input" <em>[in order to provide new values for inputs]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>fmi3SetXXX</strong> can be called on any variable for <strong>ModelExchange in Continuous-Time Mode</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>causality = "input"</code> and <code>variability = "continuous"</code><br>
<em>[in order to provide new values for inputs during continuous integration]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>initial</code> is not present, its value is defined by the following tables based on the values of <code>causality</code> and <code>variability</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3" rowspan="2"></td>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong>causality</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>parameter</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>calculated</strong> <strong>parameter</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>input</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>output</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>local</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>independent</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="5"><p class="tableblock"><strong>variability</strong></p></td>
<td class="tableblock halign-center valign-top" rowspan="3"><p class="tableblock">data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>constant</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>fixed</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>tunable</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">signals</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>discrete</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="aqua">(D)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>continuous</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="aqua">(D)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="purple">(E)</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>with</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>initial</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>default</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>possible values</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="green">exact</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="green">exact</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="maroon">calculated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="maroon">approx,</span><br>
 <span class="maroon">calculated</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exact,<br>
approx,<br>
calculated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="aqua">(D)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="aqua">---</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="aqua">---</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="purple">(E)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="purple">---</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="purple">---</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Note: (1) If <code>causality = "independent"</code>, it is neither allowed to define a value for <code>initial</code> nor a value for start.
(2) If <code>causality = "input"</code>, it is not allowed to define a value for <code>initial</code> and a value for start must be defined.
(3) If (C) and <code>initial = "exact"</code>, then the variable is explicitly defined by its start value in Initialization Mode (so directly after calling <code>fmi3ExitInitializationMode</code>, the value of the variable is either the start value stored in element <code>&lt;ScalarVariable&gt;&lt;XXX start=YYY/&gt;</code> or the value provided by <code>fmi3SetXXX</code>, if this function was called on this variable).]</em></p>
</div>
<div class="paragraph">
<p>The following combinations of variability/causality settings are allowed:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3" rowspan="2"></td>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong>causality</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>parameter</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>calculated</strong> <strong>parameter</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>input</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>output</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>local</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>independent</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="5"><p class="tableblock"><strong>variability</strong></p></td>
<td class="tableblock halign-center valign-top" rowspan="3"><p class="tableblock">data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>constant</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (a)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (a)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (a)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(7)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(10)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (c)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>fixed</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(1)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(3)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (d)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (e)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(11)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (c)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>tunable</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(2)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(4)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (d)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (e)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(12)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (c)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">signals</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>discrete</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(5)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(8)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(13)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--(c)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>continuous</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(6)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(9)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(14)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(15)</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Discussion of the combinations that are <span class="underline">not allowed</span></em>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Explanation why this combination is not allowed</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(a)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The combinations <code>"constant" / "parameter"</code>, <code>"constant" / "calculatedParameter"</code> and <code>"constant" / "input"</code> do not make sense, since parameters and inputs are set from the environment, whereas a constant has always a value.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(b)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The combinations <code>"discrete / parameter"</code>, <code>"discrete / calculatedParameter"</code>, <code>"continuous / parameter"</code> and <code>"continuous" / "calculatedParameter"</code> do not make sense, since <code>causality = "parameter"</code> and <code>"calculatedParameter"</code> define variables that do not depend on time, whereas <code>"discrete"</code> and <code>"continuous"</code> define variables where the values can change during simulation.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(c)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>For an <code>"independent"</code> variable only <code>variability = "continuous"</code> makes sense.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(d)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A <code>"fixed"</code> or <code>"tunable"</code> input has exactly the same properties as a <code>"fixed"</code> or <code>"tunable"</code> parameter.
For simplicity, only <code>"fixed"</code> and <code>"tunable"</code> parameters shall be defined.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(e)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A <code>"fixed"</code> or <code>"tunable"</code> output has exactly the same properties as a <code>"fixed"</code> or <code>"tunable"</code> <code>calculatedParameter</code>.
For simplicity, only <code>"fixed"</code> and <code>"tunable"</code> <code>calculatedParameters</code> shall be defined.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Discussion of the combinations that are</em> <span class="underline">allowed</span>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 25%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><em>Setting</em></th>
<th class="tableblock halign-left valign-top"><em>Example</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(1)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fixed parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Non-tunable independent parameter</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(2)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tunable parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Tunable independent parameter (changing such a parameter triggers an external event (ModelExchange) or takes effect at the next Communication Point (CoSimulation), and tunable calculatedParameter/output/local variables might change their values).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(3)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fixed dependent parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Non-tunable dependent parameter (variable that is computed directly or indirectly from constants or parameters).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(4)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tunable dependent parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Tunable dependent parameter (changing an independent parameter triggers an external event (ModelExchange) or takes effect at the next Communication Point (CoSimulation), and tunable dependent parameters and tunable local variables might change their values).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(5)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>discrete input</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Discrete input variable from another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(6)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>continuous input</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Continuous input variable from another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(7)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>constant output</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable where the value never changes and that can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(8)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>discrete output</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Discrete variable that is computed in the FMU.
Can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(9)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>continuous output</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Continuous variable that is computed in the FMU and can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(10)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>constant local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable where the value never changes.
Cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(11)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fixed local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local variable that depends on fixed parameters only and is computed in the FMU.
Cannot be used in another model.
After initialization, the value of this local variable cannot change.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(12)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tunable local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local variable that depends on tunable parameters only and is computed in the FMU.
Cannot be used in another model.
The value of this local variable can only change during initialization and at event instants, provided a tunable parameter was changed.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(13)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>discrete local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Discrete variable that is computed in the FMU and cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(14)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>continuous local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Continuous variable that is computed in the FMU and cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(15)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>continuous independent</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>All variables are a function of the continuous-time variable marked as <code>"independent"</code>.
Usually, this is `time`</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>How to treat tunable variables:</em></p>
</div>
<div class="paragraph">
<p><em>A parameter p is a variable that does not change its value during simulation, in other words, dp/dt = 0.
If the parameter "p" is changing, then Dirac impulses are introduced since dp/dt of a discontinuous constant variable "p" is a Dirac impulse.
Even if this Dirac impulse would be modeled correctly by the modeling environment, it would introduce unwanted "vibrations".
Furthermore, in many cases the model equations are derived under the assumption of a constant value (like mass or capacity), and the model equations would be different if "p" would be time varying.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Model Exchange:</em><br>
<em>Therefore, "tuning a parameter" during simulation does not mean to "change the parameter online" during simulation.
Instead, this is a short hand notation for:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Stop the simulation at an event instant (usually, a step event, in other words, after a successful integration step).</em></p>
</li>
<li>
<p><em>Change the values of the tunable parameters.</em></p>
</li>
<li>
<p><em>Compute all parameters that depend on the tunable parameters.</em></p>
</li>
<li>
<p><em>Newly start the simulation using as initial values the current values of all previous variables and the new values of the parameters.</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Basically this means that a new simulation run is started from the previous FMU state with changed parameter values.
With this interpretation, changing parameters online is "clean", as long as these changes appear at an event instant.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Co-Simulation:</em>
<em>Changing of tunable parameters is allowed before an <code>fmi3DoStep</code> call (so, whenever an input can be set with <code>fmi3SetXXX</code>) and before <code>fmi3ExitInitializationMode</code> is called (that is before and during Initialization Mode).
The FMU internally carries out event handling if necessary.]</em></p>
</div>
<div class="paragraph">
<p>Variables of the same base type (like <code>fmi3Real</code>) that have identical <code>valueReference</code> definitions are called "alias" variables.
The main purpose of "alias" variables is to enhance efficiency.
If two variables <code>a</code> and <code>b</code> are alias variables, then this is only allowed if the behavior of the FMU would be exactly the same if <code>a</code> and <code>b</code> were not treated as alias variables (that is, had different <code>valueReference</code>s).
This requirement leads naturally to the following restrictions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Variables <code>a</code> and <code>b</code> that can both be set with <code>fmi3SetXXX</code>, or variable <code>a</code> that can be set with <code>fmi3SetXXX</code> and variable <code>b</code> that is defined with <code>causality = "independent"</code>, cannot be alias variables [since these variables are <code>"independent"</code> variables and alias means that there is a constraint equation between variables (= the values are the same), these variables are no longer <code>"independent"</code>.<br>
For example, if variables <code>a</code> and <code>b</code> have <code>causality = "parameter"</code>, then the value references of <code>a</code> and <code>b</code> must be different.
However, if variable a has <code>causality = "parameter"</code> and <code>b</code> has <code>causality = "calculatedParameter"</code> and <code>b := a</code>, then <code>a</code> and <code>b</code> can have the same value reference.].</p>
</li>
<li>
<p>At most one variable of the same alias set of variables with <code>variability = "constant"</code> can have a start attribute.</p>
</li>
<li>
<p>A variable with <code>variability = "constant"</code> can only be aliased to another variable with <code>variability = "constant"</code>.
It is then required that the start values of all aliased (constant) variables are identical.</p>
</li>
<li>
<p>All variables of the same alias set must all have either no <code>&lt;Unit&gt;</code> element defined, or all of them must have the same <code>&lt;Unit name&gt;</code> and the same <code>&lt;Unit&gt;&lt;BaseUnit&gt;</code> definitions.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The aliasing of variables only means that the <code>value</code> of the variables is always identical.
However, aliased variables may have different attributes, such as <code>min/max/nominal</code> values or description texts.
<em>[For example, if v1, v2 are two alias variables with <code>v1=v2</code> and <code>v1.max=10</code> and <code>v2.max=5</code>, then the FMU will trigger an error if either <code>v1</code> or <code>v2</code> becomes larger than 5.]</em></p>
</div>
<div class="paragraph">
<p><em>[The dependency definition in <code>fmiModelDescription.ModelStructure</code> is completely unrelated to the alias definition.
In particular, the "direct dependency" definition can be a superset of the "real" direct dependency definition, even if the "alias" information shows that this is too conservative.
For example, if it is stated that the output <code>y1</code> depends on input <code>u1</code> and the output <code>y2</code> depends on input <code>u2</code>, and <code>y1</code> is an alias to <code>y2</code>, then this definition is fine, although it can be deduced that in reality neither <code>y1</code> nor <code>y2</code> depend on any input.].</em></p>
</div>
<div class="paragraph">
<p>Type specific properties are defined in the required choice element, where exactly one of <code>Real</code>, <code>Integer</code>, <code>Boolean</code>, <code>String</code>, <code>Enumeration</code> must be present in the XML file:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Real_Schema_large.png" alt="Real Schema large" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Integer_Schema_large.png" alt="Integer Schema large" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Boolean_Schema_large.png" alt="Boolean Schema large" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/String_Schema_large.png" alt="String Schema large" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Enumeration_Schema_large.png" alt="Enumeration Schema large" width="50%">
</div>
</div>
<div class="paragraph">
<p>The attributes are defined in <a href="#definition-of-types">Section 2.2.3</a> (<code>TypeDefinitions</code>), except:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Attribute-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>declaredType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, name of type defined with <code>TypeDefinitions / SimpleType</code>.
The value defined in the corresponding <code>TypeDefinition</code> (see <a href="#definition-of-types">Section 2.2.3</a>) is used as default.
<em>[For example, if <code>min</code> is present both in <code>Real</code> (of <code>TypeDefinition</code>) and in <code>Real</code> (of <code>ScalarVariable</code>), then the <code>min</code> of <code>ScalarVariable</code> is actually used.]</em>
For <code>Real</code>, <code>Integer</code>, <code>Boolean</code>, <code>String</code>, this attribute is optional.
For <code>Enumeration</code> it is required, because the Enumeration items are defined in <code>TypeDefinitions / SimpleType</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial or guess value of variable.
<strong>This value is also stored in the C functions</strong>.
<em>[Therefore, calling</em> <code>fmi3SetXXX</code> <em>to set start values is only necessary, if a different value as stored in the XML file is desired.]</em> The interpretation of start is defined by <code>ScalarVariable / initial</code>.
A different start value can be provided with an <code>fmi3SetXXX</code> function before <code>fmi3ExitInitializationMode</code> is called (but not for variables with <code>variability = "constant"</code>).</p>
<p class="tableblock"><em>[The standard approach is to set the start value before <code>fmi3EnterInitializationMode</code>.
However, if the initialization shall be modified in the calling environment (for example, changing from initialization of states to steady-state initialization), it is also possible to use the start value as iteration variable of an algebraic loop: using an additional condition in the environment, such as</em> \(\color{blue}{\dot{x} = 0}\) <em>, the actual start value is determined.]</em></p>
<p class="tableblock">If <code>initial = "exact"</code> or <code>"approx"</code> or <code>causality = "input"</code>, a <code>start</code> value must be provided.</p>
<p class="tableblock">If <code>initial = "calculated"</code> or <code>causality = "independent"</code>, it is not allowed to provide a start value.</p>
<p class="tableblock">Variables with <code>causality = "parameter"</code> or <code>"input"</code>, as well as variables with <code>variability = "constant"</code>, must have a <code>start</code> value.</p>
<p class="tableblock">- If <code>causality = "parameter"</code>, the start-value is the value of it.</p>
<p class="tableblock">- If <code>causality = "input"</code>, the start value is used by the model as value of the input, if the input is not set by the environment.</p>
<p class="tableblock">- If <code>variability = "constant"</code>, the start value is the value of the constant.</p>
<p class="tableblock">- If <code>causality = "output"</code> or <code>"local"</code>, then the start value is either an <code>initial</code> or a <code>guess</code> value, depending on the setting of attribute <code>initial</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>derivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, this variable is the derivative of variable with <code>ScalarVariable</code> index "derivative".
<em>[For example,
if there are 10 <code>ScalarVariable</code>s and <code>derivative = 3</code> for <code>ScalarVariable</code> 8, then <code>ScalarVariable</code> 8 is the derivative of <code>ScalarVariable</code> 3 with respect to the independent variable (usually time).
This information might be especially used if an input or an output is the derivative of another input or output, or to define the states.]</em></p>
<p class="tableblock">The state derivatives of an FMU are listed under element <code>&lt;ModelStructure&gt;&lt;Derivatives&gt;</code>.
All <code>ScalarVariable</code>s listed in this element must have attribute <code>derivative</code> (in order that the continuous-time states are uniquely defined).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reinit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only for ModelExchange (if only CoSimulation FMU, this attribute must not be present.
If both ModelExchange and CoSimulation FMU, this attribute is ignored for CoSimulation):<br>
Can only be present for a continuous-time state.<br>
If true, state can be reinitialized at an event by the FMU.<br>
If false, state will not be reinitialized at an event by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min / max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional attributes <code>min</code> and <code>max</code> in element <code>Enumeration</code> restrict the allowed values of the enumeration.
The <code>min/max</code> definitions are information from the FMU to the environment defining the region in which the FMU is designed to operate, see also comment in <a href="#definition-of-types">Section 2.2.3</a>.
<em>[If, for example, an <code>Enumeration</code> is defined with <code>name1 = -4</code>, <code>name2 = 1</code>, <code>name3 = 5</code>, <code>name4 = 11</code> and min=-2, max = 5, then only <code>name2</code> and <code>name3</code> are allowed.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With element <code>Annotations</code> additional, tool specific data can be defined:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Annotations_schema.png" alt="Annotations schema" width="80%">
</div>
</div>
<div class="paragraph">
<p>With <code>Tool.name</code> the name of the tool is defined that can interpret the <code>any</code> element.
The <code>any</code> element can be an arbitrary XML data structure defined by the tool.
<em>[Typically, additional data is defined here how to build up the menu for the variable, including the graphical layout and enabling/disabling an input field based on the values of other parameters.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="ModelStructure">2.2.8. Definition of the Model Structure (ModelStructure)</h4>
<div class="paragraph">
<p>The structure of the model is defined in element <code>ModelStructure</code> within <code>fmiModelDescription</code>.
This structure is with respect to the underlying model equations, independently how these model equations are solved.
<em>[For example, when exporting a model both in Model Exchange and Co-Simulation format; then the model structure is identical in both cases.
The Co-Simulation FMU has either an integrator included that solves the model equations, or the discretization formula of the integrator and the model equations are solved together ("inline integration").
In both cases the model has the same continuous-time states.
In the second case the internal implementation is a discrete-time system, but from the outside this is still a continuous-time model that is solved with an integration method.]</em></p>
</div>
<div class="paragraph">
<p>The required part defines an ordering of the outputs and of the (exposed) derivatives, and defines the unknowns that are available during Initialization <em>[Therefore, when linearizing an FMU, every tool will use the same ordering for the outputs, states, and derivatives for the linearized model.
The ordering of the inputs should be performed in this case according to the ordering in <code>ModelVariables</code>.]</em>
A ModelExchange FMU must expose all derivatives of its continuous-time states in element <code>Derivatives</code>.
A Co- Simulation FMU does not need to expose these state derivatives.
<em>[If a Co-Simulation FMU exposes its state derivatives, they are usually not utilized for the co-simulation, but, for example, to linearize the FMU at a communication point.]</em></p>
</div>
<div class="paragraph">
<p>The optional part defines in which way derivatives and outputs depend on inputs, and continuous-time states at the current super dense time instant (ModelExchange) or at the current Communication Point (CoSimulation).
<em>[A simulation environment can utilize this information to improve the efficiency, for example, when connecting FMUs together, or when computing the partial derivative of the derivatives with respect to the states in the simulation engine.]</em>.</p>
</div>
<div class="paragraph">
<p><code>ModelStructure</code> has the following definition:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ModelStructure_schema.png" alt="ModelStructure schema" width="80%">
</div>
</div>
<div class="paragraph">
<p><code>fmi3VariableDependency</code> is defined as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Unknown_schema.png" alt="Unknown schema" width="80%">
</div>
</div>
<div class="paragraph">
<p>Elements of the <code>InitialUnknowns</code> list:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/InitialUnknowns_schema.png" alt="InitialUnknowns schema" width="50%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Unknown_schema_2.png" alt="Unknown schema 2" width="80%">
</div>
</div>
<div class="paragraph">
<p>Note that attribute <code>dependenciesKind</code> for element <code>InitialUnknowns</code> has less enumeration values as <code>dependenciesKind</code> in the other lists.</p>
</div>
<div class="paragraph">
<p>ModelStructure consists of the following elements (see also figures above; the symbols of the mathematical equations describing the dependency are defined in <a href="#math-model-exchange">Section 3.1</a>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Element-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Outputs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordered list of all outputs,
in other words, a list of <code>ScalarVariable</code> indices where every corresponding <code>ScalarVariable</code> must have <code>causality = "output"</code> (and <strong>every variable with <code>causality="output"</code> must be listed here</strong>).
<em>[Note that all output variables are listed here, especially discrete and continuous outputs.
The ordering of the variables in this list is defined by the exporting tool.
Usually, it is best to order according to the declaration order in the source model, since then the <code>Outputs</code> list does not change if the declaration order of outputs in the source model is not changed.
This is for example, important for linearization, in order that the interpretation of the output vector does not change for a re-exported FMU.]</em>
Attribute <code>dependencies</code> defines the dependencies of the outputs from the knowns at the current super dense time instant in <em>Event</em> and in <em>Continuous-Time Mode</em> (ModelExchange) and at the current <em>Communication Point</em> (CoSimulation).
The functional dependency is defined as (dependencies of variables that are fixed in <em>Event</em> and <em>Continuous-Time Mode</em> and at <em>Communication Points</em> are not shown):<br>
<span class="blue">\(\color{blue}{(\mathbf{y}_c, \mathbf{y}_d) := \mathbf{f}_{output}(\mathbf{x}_c, \mathbf{u}_c, \mathbf{u}_d, t, \mathbf{p}_{tune})}\)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Derivatives</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordered list of all state derivatives, in other words, a list of <code>ScalarVariable</code> <code>indices</code> where every corresponding <code>ScalarVariable</code> must be a state derivative.
<em>[Note that only continuous Real variables are listed here.
If a state or a derivative of a state shall not be exposed from the FMU, or if states are not statically associated with a variable (due to dynamic state selection), then dummy <code>ScalarVariable</code>s have to be introduced, for example, <code>x[4]</code>, or <code>xDynamicStateSet2[5]</code>.
The ordering of the variables in this list is defined by the exporting tool.
Usually, it is best to order according to the declaration order of the states in the source model, since then the &lt;Derivatives&gt; list does not change if the declaration order of states in the source model is not changed.
This is for example, important for linearization, in order that the interpretation of the state vector does not change for a re-exported FMU.</em>].
The corresponding continuous-time states are defined by attribute <code>derivative</code> of the corresponding <code>ScalarVariable</code> state derivative element.
<em>[Note that higher order derivatives must be mapped to first order derivatives but the mapping definition can be preserved due to attribute <code>derivative</code>.
Example: if</em> \(\color{blue}{\frac{\text{ds}}{\text{dt}} = v,\ \frac{\text{dv}}{\text{dt}} =f(..)}\) <em>,then</em> \(\color{blue}{\left\{ v,\ \frac{\text{dv}}{\text{dt}} \right\}}\) _ is the vector of state derivatives and attribute <code>derivative</code> of_ \(\color{blue}{v}\) <em>references</em> \(\color{blue}{s}\) <em>,
and attribute <code>derivative</code> of</em> \(\color{blue}{\frac{\text{dv}}{\text{dt}}}\) <em>references</em> \(\color{blue}{v}\) <em>.]</em><br>
For Co-Simulation, element <code>Derivatives</code> is ignored if capability flag <code>providesDirectionalDerivative</code> has a value of <code>false</code>, in other words, it cannot be computed. <em>[This is the default.
If an FMU supports both ModelExchange and CoSimulation, then the <code>Derivatives</code> element might be present, since it is needed for ModelExchange.
If the above flag is set to false for the CoSimulation case, then the <code>Derivatives</code> element is ignored for CoSimulation.
If "inline integration" is used for a CoSimulation slave, then the model still has continuous-time states and just a special solver is used (internally the implementation results in a discrete-time system, but from the outside, it is still a continuous-time system).]</em><br>
Attribute <code>dependencies</code> defines the dependencies of the state derivatives from the knowns at the current super dense time instant in <em>Event</em> and in <em>Continuous-Time Mode</em> (ModelExchange) and at the current <em>Communication Point</em> (CoSimulation).
The functional dependency is defined as (dependencies of variables that are fixed in <em>Event</em> and <em>Continuous-Time Mode</em> and at <em>Communication Points</em> are not shown):<br>
<span class="blue">\(\color{blue}{\dot{\mathbf{x}_c} := \mathbf{f}_{der}(\mathbf{x}_c, \mathbf{u}_c, \mathbf{u}_d, t, \mathbf{p}_{tune})}\)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitialUnknowns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordered list of all exposed <code>Unknowns</code> in Initialization Mode.
This list consists of all variables with</p>
<p class="tableblock">1. <code>causality = "output"</code> and (<code>initial = "approx"</code> or <code>"calculated"</code>), and</p>
<p class="tableblock">2. <code>causality = "calculatedParameter"</code> and</p>
<p class="tableblock">3. all continuous-time states and all state derivatives (defined with element <code>&lt;Derivatives&gt;</code> from <code>&lt;ModelStructure&gt;</code>) with <code>initial = "approx"</code> or <code>"calculated"</code> <em>[if a Co-Simulation FMU does not define the &lt;Derivatives&gt; element, (3) cannot be present]</em>.</p>
<p class="tableblock">The resulting list is not allowed to have duplicates (for example, if a state is also an output, it is included only once in the list).
The <code>Unknowns</code> in this list must be ordered according to their <code>ScalarVariable</code> index (for example, if for two variables A and B the <code>ScalarVariable</code> index of A is less than the index of B, then A must appear before B in <code>InitialUnknowns</code>).<br>
Attribute <code>dependencies</code> defines the dependencies of the <code>Unknowns</code> from the <code>Knowns</code> in <em>Initialization Mode</em> at the initial time.
The functional dependency is defined as:</p>
<p class="tableblock"><span class="blue">\(\color{blue}{\dot{\mathbf{v}}_{initialUnknowns} := \mathbf{f}_{init}(\mathbf{u}_c, \mathbf{u}_d, t_0, \mathbf{v}_{initial = exact})}\)</span></p>
<p class="tableblock">Since, outputs, continuous-time states and state derivatives are either present as <code>Knowns</code> (if <code>initial = "exact"</code>) or as <code>Unknowns</code> (if <code>initial = "approx"</code> or <code>"calculated"</code>),
they can be inquired with <code>fmi3GetXXX</code> in InitializationMode.</p>
<p class="tableblock"><em>[Example: Assume an FMU is defined in the following way:</em></p>
<p class="tableblock">\(\color{blue}{(\mathbf{y}_{c+d}, \dot{\mathbf{x}}_c) := \mathbf{f}_{init}(\mathbf{x}_c, \mathbf{u}_{c+d}, t_0, \mathbf{p})}\)<br></p>
<p class="tableblock">\(\color{blue}{(\mathbf{y}_{c+d}, \dot{\mathbf{x}}_c) := \mathbf{f}_{sim}(\mathbf{x}_c, \mathbf{u}_{c+d}, t_i, \mathbf{p})}\)<br></p>
<p class="tableblock"><em>Therefore, the initial state \(\color{blue}{\mathbf{x}_c(t_0)}\) has <code>initial = "exact"</code> and the initial state derivative \(\color{blue}{\dot{\mathbf{x}}_c(t_0)}\) has <code>initial = "calculated"</code>.
The environment can still initialize this FMU in steady-state, by using \(\color{blue}{\mathbf{x}_c(t_0)}\) as iteration variables and adding the equations \(\color{blue}{\mathbf{x}_c(t_0) = \mathbf{0}}\) in the environment.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Unknown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An element of one of the lists above defining the unknown with a reference to the corresponding <code>ScalarVariable</code> element.
It is assumed that at a super-dense time instant \(\color{blue}{t = (t_R, t_I)}\) (ModelExchange) and at a Communication Point (CoSimulation) the following relationship holds:</p>
<p class="tableblock">\(\color{blue}{v_{unknown} = h(\mathbf{v}_{known}, \mathbf{v}_{freeze})}\)</p>
<p class="tableblock">where</p>
<p class="tableblock">- \(\color{blue}{v_{unknown}}\) is the unknown variable defined with this element <em>[for example, an output or a state derivative].</em></p>
<p class="tableblock">- \(\color{blue}{\mathbf{v}_{known}}\) is the vector of input arguments of function <em>h</em> that changes its value in the actual Mode <em>[for example, continuous-time inputs in Continuous-Time Mode]</em>.</p>
<p class="tableblock">- \(\color{blue}{\mathbf{v}_{freeze}}\) is the set of input arguments of function <em>h</em> that do not change their values in this Mode, but change their values in other Modes <em>[for example, fixed parameters in Continuous-Time Mode]</em>.</p>
<p class="tableblock">Attribute <code>dependencies</code> of <code>Unknown</code> defines the dependency of \(\color{blue}{v_{unknown}}\) with respect to \(\color{blue}{\mathbf{v}_{known}}\).<br>
<em>[If, for example, a continuous-time output</em> \(\color{blue}{y_{2}}\) <em>is a function of the continuous-time inputs</em> \(\color{blue}{u_{3}}\) <em>and</em> \(\color{blue}{u_{5}}\), <em>and these inputs have changed, then</em> <code>fmi3SetXXX</code> <em>on</em> \(\color{blue}{u_{3}}\) <em>and</em> \(\color{blue}{u_{5}}\) <em>must always be called before calling</em> <code>fmi3GetXXX</code> <em>on</em> \(\color{blue}{y_{2}}\) <em>.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Element <code>Unknown</code> in <code>Outputs</code>, <code>Derivatives</code> and <code>InitialUnknowns</code> has the following attributes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Attribute-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>ScalarVariable</code> index of the <code>Unknown</code> \(\color{blue}{v_{\text{unknown}}}\).
<em>[For example, if there are 10 <code>ScalarVariable</code>s and index = 3, then the third <code>ScalarVariable</code> is the unknown defined with this element.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependencies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional attribute defining the dependencies of the unknown \(\color{blue}{v_{\text{unknown}}}\) (directly or indirectly via auxiliary variables) with respect to \(\color{blue}{\mathbf{v}_{\text{known}}}\).
If not present, it must be assumed that the <code>Unknown</code> depends on all <code>Knowns</code>.
If present as empty list, the <code>Unknown</code> depends on none of the <code>Knowns</code>.
Otherwise the <code>Unknown</code> depends on the <code>Knowns</code> defined by the given <code>ScalarVariable</code> indices.
The indices are ordered according to magnitude, starting with the smallest index.<br>
<code>Knowns</code> \(\color{blue}{\mathbf{v}_{\text{known}}}\) in <em>Event</em> and <em>Continuous-Time Mode</em> (ModelExchange) and at <em>Communication Points</em> (CoSimulation) for elements <code>Outputs</code>, <code>Derivatives</code>:</p>
<p class="tableblock">- inputs (variables with <code>causality = "input"</code>)</p>
<p class="tableblock">- continuous-time states</p>
<p class="tableblock">- independent variable (usually time; <code>causality = "independent"</code>).
If an independent variable is not explicitly defined under <code>ScalarVariable</code>s, it is assumed that the <code>Unknown</code> depends explicitly on the independent variable.</p>
<p class="tableblock"><code>Knowns</code> \(\color{blue}{\mathbf{v}_{\text{known}}}\) in <em>Initialization Mode</em> (for elements <code>InitialUnknowns</code>):</p>
<p class="tableblock">- inputs (variables with <code>causality = "input"</code>)</p>
<p class="tableblock">- variables with <code>initial = "exact"</code><br>
<em>[for example, independent parameters or initial states.]</em></p>
<p class="tableblock">- independent variable (usually time; <code>causality = "independent"</code>).
If an independent variable is not explicitly defined under <code>ScalarVariable</code>s, it is assumed that the <code>Unknown</code> depends explicitly on the independent variable.</p>
<p class="tableblock">For Co-Simulation, <code>dependencies</code> does not list the dependency on continuous-time, if the capability flag <code>providesDirectionalDerivative</code> has a value of <code>"false"</code>.
In other words, the respective partial derivatives cannot be computed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependenciesKind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If not present, it must be assumed that the <code>Unknown</code> \(\color{blue}{v_{\text{unknown}}}\) depends on the <code>Knowns</code> \(\color{blue}{\mathbf{v}_{\text{known}}}\) without a particular structure.
Otherwise, the corresponding Known \(\color{blue}{v_{known,i}}\) enters the equation as:</p>
<p class="tableblock">If <code>dependenciesKind</code> is present, <code>dependencies</code> must be present and must have the same number of list elements.</p>
<p class="tableblock"><code>= "dependent"</code>: no particular structure, \(\color{blue}{{h(..,\ v}_{known,i}}\),..)</p>
<p class="tableblock">Only for Real unknowns \(\color{blue}{v_{\text{unknown}}}\):</p>
<p class="tableblock"><code>= "constant"</code>: constant factor,
\(\color{blue}{c \cdot v_{known,i}}\) where \(\color{blue}{c}\) is an expression that is evaluated before <code>fmi3EnterInitializationMode</code> is called.</p>
<p class="tableblock">Only for Real unknowns \(\color{blue}{v_{\text{unknown}}}\) in Event and Continuous-Time Mode (ModelExchange) and at <em>Communication Points</em> (CoSimulation), and not for <code>InitialUnknowns</code> for Initialization Mode:</p>
<p class="tableblock"><code>= "fixed"</code>: fixed factor, \(\color{blue}{p \cdot v_{known,i}}\) where \(\color{blue}{p}\) is an expression that is evaluated before <code>fmi3ExitInitializationMode</code> is called.</p>
<p class="tableblock"><code>= "tunable"</code>: tunable factor, \(\color{blue}{p \cdot v_{known,i}}\) where \(\color{blue}{p}\) is an expression that is evaluated before <code>fmi3ExitInitializationMode</code> is called and in Event Mode due to an external event (ModelExchange) or at a Communication Point (CoSimulation)</p>
<p class="tableblock"><code>= "discrete"</code>: discrete factor, \(\color{blue}{d \cdot v_{known,i}}\) where \(\color{blue}{d}\) is an expression that is evaluated before <code>fmi3ExitInitializationMode</code> is called and in Event Mode due to an external or internal event or at a Communication Point (CoSimulation).</p>
<p class="tableblock">If <code>dependenciesKind</code> is present, <code>dependencies</code> must be present and must have the same number of list elements.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Example 1:</em></p>
</div>
<div class="paragraph">
<p><em>An FMU is defined by the following equations:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}

\frac{d}{\text{dt}}\begin{bmatrix}
x_{1} \\
x_{2} \\
x_{3} \\
\end{bmatrix}

&amp;=

\begin{bmatrix}
f_{1}\left( x_{2} \right) \\
f_{2}\left( x_{1} \right) + 3 \cdot p^{2} \cdot x_{2} + 2 \cdot u_{1} + 3 \cdot u_{3} \\
f_{3}\left( x_{1},x_{3},u_{1},u_{2},u_{3} \right) \\
\end{bmatrix}

\\

y &amp;= g_1(x_2, x_3)

\end{align*},\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \(\color{blue}{u_{1}}\) <em>is a continuous-time input (<code>variability="continuous"</code>),</em> \(\color{blue}{u_{2}}\) <em>is any type of input,</em> \(\color{blue}{u_{3}}\) <em>is a Real discrete-time input (<code>variability="discrete"</code>), and</em> \(\color{blue}{p}\) <em>is a fixed parameter (<code>variability="fixed"</code>).
The initialization is defined by:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[x_1 = 1.1, \frac{dx_2}{dt} = 0, y = 3.3,\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, the initialization equations are:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}
x_{2} &amp;= \frac{1}{3 \cdot p^{2}} \cdot ( f_{2}\left( x_{1} \right) + 2 \cdot u_{1} + 3 \cdot u_{3} )
\\
x_{3} &amp;= g_{1}^{- 1}( x_{2}, y)
\end{align*}\]
</div>
</div>
<div class="paragraph">
<p><em>This equation system can be defined as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelVariables&gt;
   &lt;ScalarVariable name="p"      , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="1" --&gt;
   &lt;ScalarVariable name="u1"     , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="2" --&gt;
   &lt;ScalarVariable name="u2"     , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="3" --&gt;
   &lt;ScalarVariable name="u3"     , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="4" --&gt;
   &lt;ScalarVariable name="x1"     , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="5" --&gt;
   &lt;ScalarVariable name="x2"     , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="6" --&gt;
   &lt;ScalarVariable name="x3"     , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="7" --&gt;
   &lt;ScalarVariable name="der(x1)", ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="8" --&gt;
   &lt;ScalarVariable name="der(x2)", ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="9" --&gt;
   &lt;ScalarVariable name="der(x3)", ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="10" --&gt;
   &lt;ScalarVariable name="y"      , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!—index="11" --&gt;
&lt;/ModelVariables&gt;

&lt;ModelStructure&gt;
   &lt;Outputs&gt;
     &lt;Unknown index="11" dependencies="6 7" /&gt;
   &lt;/Outputs&gt;
   &lt;Derivatives&gt;
     &lt;Unknown index="8"  dependencies="6" /&gt;
     &lt;Unknown index="9"  dependencies="2 4 5 6"
                         dependenciesKind="constant constant dependent fixed"/&gt;
     &lt;Unknown index="10" dependencies="2 3 4 5 6" /&gt;
   &lt;/Derivatives&gt;

   &lt;InitialUnknowns&gt;
     &lt;Unknown index="6" dependencies="2 4 5" /&gt;
     &lt;Unknown index="7" dependencies="2 4 5 11" /&gt;
     &lt;Unknown index="8" ... /&gt;
     &lt;Unknown index="10" ... /&gt;
   &lt;/InitialUnknowns&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Example 2:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[y = \left\{ \begin{matrix}
2 \cdot u \ \mathrm{if} \ u &gt; 0 \\
3 \cdot u \ \mathrm{else} \\
\end{matrix}\right.\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \(\color{blue}{u}\) <em>is a continuous-time input with index="1" and</em> \(\color{blue}{y}\) <em>is a continuous-time output with index="2".
The definition of the model structure is then:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelStructure&gt;
  &lt;Outputs&gt;
    &lt;Unknown index="2" dependencies="1" dependenciesKind="discrete"/&gt;
  &lt;/Outputs&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>[Note that</em> \(\color{blue}{y = d \cdot u}\) <em>where</em> \(\color{blue}{d}\) <em>changes only during Event Mode (</em>\(\color{blue}{d = 2 \cdot u}\) <em>or</em> \(\color{blue}{3 \cdot u\ }\) <em>depending on relation</em> \(\color{blue}{u &gt; 0}\) <em>that changes only at Event Mode).
Therefore dependenciesKind="discrete".]</em></p>
</div>
<div class="paragraph">
<p><em>Example 3:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[y = \left\{ \begin{matrix}
2\ \ \mathrm{if}\ \ u &gt; 0 \\
3\ \ \mathrm{else} \\
\end{matrix}\right.\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \(\color{blue}{u}\) <em>is a continuous-time input with index="1" and</em> \(\color{blue}{y}\) <em>is a continuous-time output with index="2".
The definition of the model structure is then:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelStructure&gt;
  &lt;Outputs&gt;
    &lt;Unknown index="2" dependencies="1" dependenciesKind="dependent"/&gt;
  &lt;/Outputs&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>[Note that</em> \(\color{blue}{y = c}\) <em>where</em> \(\color{blue}{c}\) <em>changes only during Event Mode (</em>\(\color{blue}{c = 2}\) <em>or</em> \(\color{blue}{3\ }\)<em>depending on relation</em> \(\color{blue}{u &gt; 0}\) <em>that changes only at Event Mode).
Therefore <code>dependenciesKind="dependent"</code> because it is not a linear relationship on</em> \(\color{blue}{u}\).]_</p>
</div>
<div class="paragraph">
<p><em>Defining FMU features with the</em> <code>dependencies</code> <em>list:</em></p>
</div>
<div class="paragraph">
<p><em>[Note that via the <code>dependencies</code> list the supported features of the FMU can be defined.
Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>If a state derivative <code>der_x</code> is a function of a parameter p (so of a start value of a variable with <code>causality = "parameter"</code> and <code>variability = "fixed"</code>), and the FMU does not support an iteration over <code>p</code> during <code>InitializationMode</code> (for example, to iterate over p such that the state derivative <code>der_x</code> is zero), then the dependencies list of <code>der_x</code> should not include <code>p</code>.
If an FMU is imported in an environment and such an iteration is set up, then the tool can figure out that the resulting algebraic system of equations is structurally singular and therefore can reject such a definition.</em></p>
</li>
<li>
<p><em>For standard Co-Simulation FMUs, it is common that no algebraic loops over the input/output variables nor over start-values is supported.
In such a case, all <code>dependencies</code> lists for output variables under the <code>InitialUnknowns</code> element should be defined as empty lists defining that the setting of inputs and/or of start values does not influence the outputs.
As a result, it is not possible to formulate algebraic loops of connected FMUs during InitializationMode.]</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="variableNamingConvention">2.2.9. Variable Naming Conventions (variableNamingConvention)</h4>
<div class="paragraph">
<p>With attribute <code>variableNamingConvention</code> of element <code>fmiModelDescription</code>, the convention is defined how the <code>ScalarVariable.name</code>s have been constructed.
If this information is known, the environment may be able to represent the names in a better way (for example, as a tree and not as a linear list).</p>
</div>
<div class="paragraph">
<p>In the following definitions, the <a href="http://en.wikipedia.org/wiki/Extended_BNF">EBNF</a> is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=   production rule
[ ] optional
{ } repeat zero or more times
|   or</pre>
</div>
</div>
<div class="paragraph">
<p>The following conventions for scalar names are defined:</p>
</div>
<div class="paragraph">
<p><strong><code>variableNamingConvention = "flat"</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>name = Unicode-char { Unicode-char } // identical to xs:normalizedString
Unicode-char = any Unicode character without carriage return (#xD),
line feed (#xA) nor tab (#x9)</pre>
</div>
</div>
<div class="paragraph">
<p>The names must be unique, non-empty strings.<br>
<em>[It is recommended that the names are visually clearly different from each other; but it is not required.]</em></p>
</div>
<div class="paragraph">
<p><strong><code>variableNamingConvention = "structured"</code></strong></p>
</div>
<div class="paragraph">
<p>Structured names are hierarchical using "." as a separator between hierarchies.
A name consists of "_", letters and digits or may consist of any characters enclosed in single apostrophes.
A name may identify an array element on every hierarchical level using "[&#8230;&#8203;]" to identify the respective array index.
A derivative of a variable is defined with <code>der(name)</code> for the first time derivative and <code>der(name,N)</code> for the N-th derivative.
Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle.engine.speed
resistor12.u
v_min
robot.axis.'motor #234'
der(pipe[3,4].T[14],2) // second time derivative of pipe[3,4].T[14]</pre>
</div>
</div>
<div class="paragraph">
<p>The precise syntax is <sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>name            = identifier | "der(" identifier ["," unsignedInteger ] ")"
identifier      = B-name [ arrayIndices ] {"." B-name [ arrayIndices ] }
B-name          = nondigit { digit | nondigit } | Q-name
nondigit        = "pass:[_]" | letters "a" to "z" | letters "A" to "Z"
digit           = "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"
Q-name          = "’" ( Q-char | escape ) { Q-char | escape } "’"
Q-char          = nondigit | digit | "!" | "#" | "$" | "%" | "&amp;" | "(" | ")" |
                                     "*" | "+" | "," | "-" | "." | "/" | ":" |
                                     ";" | "&lt;" | "&gt;" | "=" | "?" | "@" | "[" |
                                     "]" | "^" | "{" | "}" | "|" | "~" | " "
escape          = "\’" | "\"" | "\?" | "\\" | "\a" | "\b" |
                  "\f" | "\n" | "\r" | "\t" | "\v"
arrayIndices    = "[" unsignedInteger {"," unsignedInteger} "]"
unsignedInteger = digit { digit }</pre>
</div>
</div>
<div class="paragraph">
<p>The tree of names is mapped to an ordered list of <code>ScalarVariable.name</code>s in <a href="http://en.wikipedia.org/wiki/Depth-first_search">depth-first</a> order.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle
  transmission
    ratio
    outputSpeed
  engine
    inputSpeed
    temperature</pre>
</div>
</div>
<div class="paragraph">
<p>is mapped to the following list of <code>ScalarVariable.name</code>s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle.transmission.ratio
vehicle.transmission.outputSpeed
vehicle.engine.inputSpeed
vehicle.engine.temperature</pre>
</div>
</div>
<div class="paragraph">
<p>All array elements are given in a consecutive sequence of <code>ScalarVariable</code>s.
Elements of multi-dimensional arrays are ordered according to "row major" order that is elements of the last index are given in sequence.</p>
</div>
<div class="paragraph">
<p><em>[For example, the vector "centerOfMass" in body "arm1" is mapped to the following <code>ScalarVariable</code>s:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>robot.arm1.centerOfMass[1]
robot.arm1.centerOfMass[2]
robot.arm1.centerOfMass[3]</pre>
</div>
</div>
<div class="paragraph">
<p><em>For example,
a table T[4,3,2] (first dimension 4 entries, second dimension 3 entries,
third dimension 2 entries) is mapped to the following <code>ScalarVariable</code>s:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>T[1,1,1]
T[1,1,2]
T[1,2,1]
T[1,2,2]
T[1,3,1]
T[1,3,2]
T[2,1,1]
T[2,1,2]
T[2,3,1]
…</pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>It might be that not all elements of an array are present.
If they are present, they are given in consecutive order in the XML file.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fmu-distribution">2.3. FMU Distribution</h3>
<div class="paragraph">
<p>An FMU description consists of several files.
An FMU implementation may be distributed in source code and/or in binary format.
All relevant files are stored in a ZIP file with a pre-defined structure.
The implementation must either implement all the functions of FMI for Model Exchange or all the functions of FMI for Co-Simulation or both.
Specifically it is required that all functions specified for Model Exchange and/or Co-Simulation are present, even if they are only needed for capabilities that the FMU does not support.
The behavior of those functions is unspecified, so while calling environments can rely on the functions being present, they cannot rely on any particular behavior for functions only needed for capabilities the FMU does not support.
The extension of the ZIP file must be "<strong>.fmu</strong>", for example, "HybridVehicle.fmu".
The compression method used for the ZIP file must be "deflate" <em>[(most free tools, such as zlib, offer only the common compression method "deflate")]</em>.</p>
</div>
<div class="paragraph">
<p>Every FMU is distributed with its own ZIP file.
This ZIP file has the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Structure of ZIP file of an FMU
modelDescription.xml          // description of FMU (required file)
model.png                     // image file of FMU icon (optional)
documentation                 // directory containing the documentation (optional)
   index.html                 // entry point of the documentation
   &lt;other documentation files&gt;
sources                       // directory containing the C sources (optional)
   // all needed C sources and C header files to compile and link the FMU
   // with exception of: fmi3TypesPlatform.h, fmi3FunctionTypes.h and fmi3Functions.h
   // The files to be compiled (but not the files included from these files)
   // have to be reported in the XML file under the structure
   // &lt;ModelExchange&gt;&lt;SourceFiles&gt; ... and &lt;CoSimulation&gt;&lt;SourceFiles&gt;
binaries                      // directory containing the binaries (optional)
   x86_64-windows             // binaries for Windows on Intel 64-bit
      &lt;modelIdentifier&gt;.dll   // shared library of the FMI implementation
      &lt;other DLLs&gt;            // the DLL can include other DLLs
   x86_64-windows-msvc140mt   // static libraries for 64-bit Windows generated with
      &lt;modelIdentifier&gt;.lib   // Visual Studio 2015 with /MT flag
   i686-linux                 // binaries for Linux on Intel 32-bit
      &lt;modelIdentifier&gt;.so    // shared library of the FMI implementation
   aarch32-linux              // binaries for Linux on ARM 32-bit
      &lt;modelIdentifier&gt;.so    // shared library of the FMI implementation
   x86_64-darwin              // binaries for macOS
      &lt;modelIdentifier&gt;.dylib // shared library of the FMI implementation
resources                     // resources needed by the FMU (optional)
   // data in FMU specific files which will be read during initialization;
   // also more folders can be added under resources (tool/model specific).
   // In order for the FMU to access these resource files, the resource directory
   // must be available in unzipped form and the absolute path to this directory
   // must be reported via argument "fmuResourceLocation" via fmi3Instantiate.</pre>
</div>
</div>
<div class="paragraph">
<p>An FMU has to implement all common functions (according to tables in <a href="#state-machine-model-exchange">Section 3.2.3</a> and <a href="#state-machine-co-simulation">Section 4.2.4</a>).
ModelExchange FMUs have to provide additionally the respective Model Exchange function, CoSimulation FMUs the Co-Simulation functions.</p>
</div>
<div class="paragraph">
<p>The FMU must be distributed with <span class="underline">at least</span> one implementation, in other words, either <span class="underline">sources</span> or one of the <span class="underline">binaries</span> for a particular machine.
It is also possible to provide the sources and binaries for different target machines together in one ZIP file.
The names of the binary directories are standardized by the "platform tuple".
Further names can be introduced by vendors.
Dynamic link libraries must include all referenced resources that are not available on a standard target machine <em>[for example, DLLs on Windows machines must be built with option "MT" to include the run-time environment of VisualStudio in the DLL, and not use the option "MD" where this is not the case]</em>.
When compiling a shared object on Linux, <code>RPATH="$ORIGIN"</code> has to be set when generating the shared object in order that shared objects used from it, can be dynamically loaded.</p>
</div>
<div class="paragraph">
<p>The binaries must be placed in the respective &lt;platformTuple&gt; directory with the general format <code>&lt;arch&gt;-&lt;sys&gt;{-&lt;abi&gt;{&lt;abi_ver&gt;}{&lt;abi_sub&gt;}}</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Architecture <code>&lt;arch&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM 32-bit Architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aarch64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM 64-bit Architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i386</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel 3rd generation x86 32-bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i586</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel 5th generation x86 32-bit w/o SSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i686</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel 6th generation x86 32-bit with SSE2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86_64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel/AMD x86 64-bit</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Operating system <code>&lt;sys&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">darwin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Darwin (macOS, iOS, watchOS, tvOS, audioOS)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Windows</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Application Binary Interface (ABI) <code>&lt;abi&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ELF file format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gnu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">android</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Android</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">macho</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mach object file format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msvc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Visual C</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">ABI version <code>&lt;abi_ver&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2005 (MSVC++ 8.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2008 (MSVC++ 9.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2010 (MSVC++ 10.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2012 (MSVC++ 11.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2013 (MSVC++ 12.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">140</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2015 (MSVC++ 14.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">141</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio 2017 (MSVC++ 15.0)</p></td>
</tr>
</tbody>
</table>
</dd>
<dt class="hdlist1">Sub-ABI <code>&lt;abi_sub&gt;</code></dt>
<dd>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">md</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mdd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MDd</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visual Studio with /MTd</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Typical scenarios are to provide binaries only for one machine type (for example, on the machine where the target simulator is running and for which licenses of run-time libraries are available) or to provide only sources (for example, for translation and download for a particular micro-processor).
If run-time libraries cannot be shipped due to licensing, special handling is needed, for example, by providing the run-time libraries at appropriate places by the receiver.</p>
</div>
<div class="paragraph">
<p>FMI provides the means for two kinds of implementation: <code>needsExecutionTool = "true"</code> and <code>needsExecutionTool = "false"</code>.
In the first case a tool specific wrapper DLL/SharedObject has to be provided as the binary, in the second a compiled or source code version of the model with its solver is stored (see <a href="#CoSimulation">Section 4.3.1</a> for details).</p>
</div>
<div class="paragraph">
<p>In an FMU both a version for ModelExchange and for CoSimulation might be present.
If in both cases the executable part is provided as a shared library, then two different or only one library can be provided.
The library names are defined in the <code>modelIdentifier</code> attribute of elements <code>fmiModelDescription.ModelExchange</code> and <code>fmiModelDescription.CoSimulation</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Example for different libraries:
   binaries
     x86_64-windows
        MyModel_ModelExchange.dll   // ModelExchange.modelIdentifier =
                                    //    "MyModel_ModelExchange"
        MyModel_CoSimulation.dll    // CoSimulation.modelIdentifier =
                                    //    "MyModel_CoSimulation"
]</pre>
</div>
</div>
<div class="paragraph">
<p>The usual distribution of an FMU will be with DLLs/SharedObjects because then further automatic processing <em>[(for example, importing into another tool)]</em> is possible.<br>
If run-time libraries are needed by the FMU that have to be present on the target machine, then automatic processing is likely impossible.
The requirements and the expected processing should be documented in the <code>documentation</code> directory in this case.<br>
A source-based distribution might require manual interaction in order that it can be utilized.
The intention is to support platforms that are not known in advance (such as HIL-platforms or micro-controllers).
Typically, in such a case the complete source code in ANSI-C is provided (for example, one C source file that includes all other needed C files with the <code>#include</code> directive).
All C source file names that need to be defined in a compiler directive have to be defined in the XML file under structure <code>&lt;ModelExchange&gt;&lt;SourceFiles&gt;</code> and <code>&lt;CoSimulation&gt;&lt;SourceFiles&gt;</code>.
These files may include other files.
<code>#include</code> directive with <code>""</code> should be used for header-filers distributed in the FMU instead of using <code>&lt;&#8230;&#8203;&gt;</code>.
If default options of the compiler are sufficient, it might then be possible to automatically process such source code FMUs.
An exporting tool should give documentation on how to build an executable, either via a documentation file and/or via a template makefile for a particular platform, from which a user can construct the makefile for his/her target platform.
This documentation should be stored in the <code>documentation</code> directory, possibly with a link to the template makefile (stored in the <code>sources</code> directory).
<em>[As template makefile, CMake (<a href="http://www.cmake.org" class="bare">http://www.cmake.org</a>), a cross- platform, open-source build system might be used.]</em><br>
In directory <code>resources</code>, additional data can be provided in FMU specific formats, typically for tables and maps used in the FMU.
This data must be read into the model at the latest during initialization (that is, before <code>fmi3ExitInitializationMode</code> is called).
The actual file names in the ZIP file to access the data files can either be hard-coded in the generated FMU functions, or the file names can be provided as string parameters via the <code>fmi3SetString</code> function.
<em>[Note that the absolute file name of the resource directory is provided by the initialization functions]</em>.
In the case of a co-simulation implementation of <code>needsExecutionTool = "true"</code> type, the <code>resources</code> directory can contain the model file in the tool specific file format.</p>
</div>
<div class="paragraph">
<p><em>[Note that the header files <code>fmi3TypesPlatform.h</code> and <code>fmi3FunctionTypes.h/fmi3Functions.h</code> are not included in the FMU due to the following reasons:</em></p>
</div>
<div class="paragraph">
<p><em><code>fmi3TypesPlatform.h</code> makes no sense in the <code>sources</code> directory, because if sources are provided, then the target simulator defines this header file and not the FMU.<br>
This header file is not included in the <code>binaries</code> directory, because it is implicitly defined by the platform directory (for example, i686-windows for a 32-bit machine or x86_64-linux for a 64-bit machine).</em></p>
</div>
<div class="paragraph">
<p><em><code>fmi3FunctionTypes.h</code> / <code>fmi3Functions.h</code> are not needed in the <code>sources</code> directory, because they are implicitly defined by attribute <code>fmiVersion</code> in file <code>modelDescription.xml</code>.
Furthermore, in order that the C compiler can check for consistent function arguments, the header file from the target simulator should be used when compiling the C sources.
It would therefore be counter-productive (unsafe) if this header file was present.<br>
These header files are not included in the <code>binaries</code> directory, since they are already utilized to build the target simulator executable.
The version number of the header file used to construct the FMU can be deduced via attribute <code>fmiVersion</code> in file <code>modelDescription.xml</code> or via function call <code>fmi3GetVersion</code>.]</em></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-model-exchange">3. FMI for Model Exchange</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter contains the interface description to access the equations of a dynamic system from a C program.
A schematic view of a model in "FMI for Model Exchange" format is shown in <a href="#figure-model-exchange-data-flow">Figure 2</a>:</p>
</div>
<div id="figure-model-exchange-data-flow" class="imageblock text-center">
<div class="content">
<img src="images/model-exchange-data-flow.svg" alt="model exchange data flow" width="80%">
</div>
<div class="title">Figure 2. Data flow between the environment and an FMU for Model Exchange</div>
</div>
<div class="paragraph">
<p><strong class="blue">Blue</strong> arrows: Information provided by the FMU.<br>
<strong class="red">Red</strong> arrows : Information provided to the FMU.<br>
\(\mathbf{v}_{start}\), \(\mathbf{u}\), \(\mathbf{y}\), \(\mathbf{w}\), \(\mathbf{x}_d\) are of type Real, Integer, Boolean, String;
\(\mathbf{t}\), \(\mathbf{x}_c\), \(\mathbf{z}\) are of type Real.</p>
</div>
<div class="sect2">
<h3 id="math-model-exchange">3.1. Mathematical description</h3>
<div class="paragraph">
<p>The goal of the Model Exchange interface is to numerically solve a system of differential, algebraic and discrete-time equations.
In this version of the interface, ordinary differential equations in state-space form with events are handled (abbreviated as "hybrid ODE").
Algebraic equation systems might be contained inside the FMU.
Also, the FMU might consist of discrete-time equations only, for example, describing a sampled-data controller.</p>
</div>
<div class="paragraph">
<p>The independent variable time \(t \in \mathbb{T}\) is a tuple \(t = (t_R,t_I)\), where \(t_R \in \mathbb{R},\ t_{I} \in \mathbb{N} = \{0, 1, 2, \ldots\}\).
The real part \(t_R\) of this tuple is the independent variable of the FMU for describing the continuous-time behavior of the model between events.
In this phase \(t_I = 0\).
The integer part \(t_I\) of this tuple is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(t_R\).
This time definition is also called "super dense time" in literature, see, for example, (Lee and Zheng 2007).
An ordering is defined on \(\mathbb{\text{T}}\) leading to the following notation <sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 58.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Operation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Mathematical meaning</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t_1 &lt; t_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((t_{R1},t_{I1}) &lt; (t_{R2}, t_{I2})\ \Leftrightarrow \ t_{R1} &lt; t_{R2}\ \textbf{or} \ t_{R1}= t_{R2} \ \textbf{and} \ t_{I1} &lt; t_{I2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_1\) is before \(t_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t_1 = t_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((t_{R1},t_{I1}) = (t_{R2},t_{I2}) \ \Leftrightarrow  t_{R1}= t_{R2}\ \textbf{and} \ t_{I1} = t_{I2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_1\) is identical to \(t_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t^{+}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({{(t}_{R},t_{I})}^{+} \Leftrightarrow (\lim_{\epsilon \rightarrow 0}{\left(t_{R} + \varepsilon \right),t_{Imax})}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">right limit at \(t\).
\(t_{Imax}\) is the largest occurring Integer index of super dense time</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^-t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{-}{{(t}_{R},t_{I})} \Leftrightarrow (\lim_{\epsilon \rightarrow 0}{\left( t_{R} - \varepsilon \right),0)}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left limit at \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{\bullet}{\left( t_{R},t_{I} \right)\ } \Leftrightarrow \left\{ \begin{matrix} ^-t \ &amp; \mathbf{if} \ t_I = 0 \\ (t_R, t_I - 1) \ &amp; \mathbf{if} \ t_I &gt; 0 \\ \end{matrix} \right.\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">previous time instant (= either left limit or previous event instant).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(v^+\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(t^+)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the right limit of \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{-}v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^-t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the left limit of \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^{\bullet}t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">previous value (= either left limit or value from the previous event)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Assume that an FMU has an event at \(t_R=2.1s\) and here a signal changes discontinuously.
If no event iteration occurs, the time instant when the event occurs is defined as (2.1, 0), and the time instant whenthe integration is restarted is defined as (2.1, 1).]</em></p>
</div>
<div class="paragraph">
<p>The hybrid ODEs supported by FMI are described as <span class="underline">piecewise continuous-time systems</span>.
Discontinuities can occur at time instants \(t_0, t_1, \ldots, t_n\) where \(t_i &lt; t_{i+1}\).
These time instants are called "events".
Events can be known before hand (= time event), or are defined implicitly (= state and step events), see below.
Between events, variables are either continuous or do not change their value.
A variable is called discrete-time, if it changes its value only at an event instant.
Otherwise the variable is called continuoustime.
Only real variables can be continuous-time.
The following variable indices are used to describe the timing behavior of the corresponding variable (for example, 𝑣𝑑 is a discrete-time variable).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Index</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <strong>continuous-time</strong> variable,
that is, a variable that is a continuous function of time inside each interval \(t_i^+ &lt; \ ^-t_{i+1}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <strong>discrete-time</strong> variable,
that is, a variable that changes its value only at an event instant \(t_i\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c+d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of <strong>continuous-time</strong> and <strong>discrete-time</strong> variables</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At every event instant \(t_i\), variables might be discontinuous (see <a href="#figure-piecwise-continuous-variables">Figure 3</a>).</p>
</div>
<div id="figure-piecwise-continuous-variables" class="imageblock">
<div class="content">
<img src="images/PieceWiseContinuousVariables.svg" alt="PieceWiseContinuousVariables" width="60%">
</div>
<div class="title">Figure 3. Piecewise-continuous variables of an FMU: continuous-time (\(v_c\)) and discrete-time (\(v_d\)).</div>
</div>
<div class="paragraph">
<p>An <span class="underline">event instant</span> \(t_i\) is defined by one of the following conditions that give the smallest time instant:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The environment of the FMU triggers an event at the current time instant because at least one discrete-time input changes its value, a continuous-time input has a discontinuous change, or a tunable parameter changes its value.
Such an event is called <span class="underline">external event</span>.
 <em>[Note that if an FMU A is connected to an FMU B, and an event is triggered for A, then potentially all outputs of A will be discontinuous at this time instant.
 It is therefore adviceable to trigger an external event for B at this time instant too, if an output of A is connected to B.
 This means to call <code>fmi3EnterEventMode</code> on B.]</em><br>
All the following events are internal events.</p>
</li>
<li>
<p>At a predefined time instant \(t_i=(T_{next}(t_{i-1}, 0)\) that was defined at the previous event instant ti-1 by the FMU.
Such an event is called <span class="underline">time event</span>.</p>
</li>
<li>
<p>At a time instant, where an <span class="underline">event indicator</span> \(z_j(t)\) changes its domain from \(z_j &gt; 0\) to \(z_j \leq 0\) or from \(z_j \leq 0\) to \(z_j &gt; 0\) (see <a href="#figure-events">Figure 4</a> below).
More precisely: An event \(t = t_i\) occurs at the smallest time instant "min t" with \(t&gt;t_{i-1}\) where "\((z_j(t)&gt;0) \ne (z_j(t_{i-1}) &gt;0)\)".
Such an event is called <span class="underline">state event</span> <sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup>.
All event indicators are piecewise continuous and are collected together in one vector of real numbers \(\mathbf{z(t)}\).<br></p>
</li>
</ol>
</div>
<div id="figure-events" class="imageblock text-center">
<div class="content">
<img src="images/Event.svg" alt="Event" width="60%">
</div>
<div class="title">Figure 4. An event occurs when the event indicator changes its domain from \(z&gt;0\) to \(z\leq 0\) or vice versa.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>At every completed step of an integrator, <code>fmi3CompletedIntegratorStep</code> must be called (provided the capability flag <code>ModelDescription.completedIntegratorStepNotNeeded = false</code>).
An event occurs at this time instant, if indicated by the return argument <code>enterEventMode = fmi3True</code>.
Such an event is called <span class="underline">step event</span>.
<em>[Step events are, for example, used to dynamically change the (continuous) states of a model internally in the FMU, because the previous states are no longer suited numerically.]</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An FMI Model-Exchange model is described by the following variables:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Variable</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Independent variable time \(\in \mathbb{T}\).
(Variable defined with <code>causality = "independent"</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of all exposed variables (all variables defined in element <code>&lt;ModelVariables&gt;</code>,
see <a href="#definition-of-model-variables">Section 2.2.7</a>).
A subset of the variables is selected via a subscript.
Example: \(\mathbf{v}_{initial=exact}\) are variables defined with attribute <code>initial ="exact"</code> (see <a href="#definition-of-model-variables">Section 2.2.7</a>).
These are independent parameters and startvalues of other variables, such as initial values for states, state derivatives or outputs.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{p}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters that are constant during simulation.
The symbol without a subscript references independent parameters (variables with <code>causality = "parameter"</code>).
Dependent parameters (variables with <code>causality = "calculatedParameter"</code>) are denoted as \(\mathbf{p}_{calculated}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{u}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input variables.
The values of these variables are defined outside of the model.
Variables of this type are defined with attribute <code>causality = "input"</code>.
Whether the input is a discrete-time or continuous-time variable is defined via attribute <code>variability = "discrete"</code> or <code>"continuous"</code> (see <a href="#definition-of-model-variables">Section 2.2.7</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{y}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output variables.
The values of these variables are computed in the FMU and they are designed to be used in a model connection.
For instance, output variables might be used in the environment as input values to other FMUs or other submodels.
Variables of this type are defined with attribute <code>causality = "output"</code>.
Whether the output is a discrete-time or continuous-time variable is defined via attribute <code>variability = "discrete"</code> or <code>"continuous"</code> (see <a href="#definition-of-model-variables">Section 2.2.7</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{w}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local variables of the FMU that cannot be used for FMU connections.
Variables of this type are defined with attribute <code>causality = "local"</code>, see <a href="#definition-of-model-variables">Section 2.2.7</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{z}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of real continuous-time variables utilized to define state events, see below.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_c(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of real continuous-time variables representing the continuous-time states.
For notational convenience,
a continuous-time state is conceptually treated as a different type of variable as an output or a local variable for the mathematical description below.
In reality, a continuous-time state is however part of the outputs \(\mathbf{y}\) or the local variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\)<br>
\(^{\bullet}\mathbf{x}_d(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\) is a vector of (internal) discrete-time variables (of any type) representing the discrete states.<br>
\({}^{\bullet}\mathbf{x}_d(t)\) a is the value of \(\mathbf{x}_d(t)\) at the previous super dense time instant, so \({}^{\bullet}\mathbf{x}_d(t)=\mathbf{x}_d({}^{\bullet}t)\).
Given the previous values of the discrete-time states,
\({}^{\bullet}\mathbf{x}_d(t)\), at the actual time instant \(t\), all other discrete-time variables, especially the discrete states \(\mathbf{x}_d(t)\), can be computed.<br>
Discrete states are not visible in the interface of an FMU and are only introduced here to clarify the mathematical description.
Formally, a discrete state is part of the outputs \(\mathbf{y}\) or the local variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(T_{next}(t_{i})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At initialization or at an event insant, an FMU can define the next time instant \(T_{next}\), at which the next event occurs (see also the definition of events above).
Every event removes automatically a previous definition of \(T_{next}\), and it must be explicitly defined again, if a previously defined \(T_{next}\) was not triggered at the current event instant.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{r}(t_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of Boolean variables with \(r_{i} := z_{i} &gt; 0\).
When entering Continuous-Time Mode all relations reported via the event indicators \(\mathbf{z}\) are fixed and during this Mode these relations are replaced by \(\mathbf{r}\).
Only during Initialization or Event Mode the domains \(z_{i} &gt; 0\) can be changed.
For notational convenience, \(\mathbf{r} := \mathbf{z} &gt; 0\)is an abbreviation for \(\mathbf{r}:=\{z_1&gt;0, z_2&gt;0, \ldots \}\).
<em>[For more details, see "Remark 3" below.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Computing the solution of an FMI model means to split the solution process in different phases, and in every phase different equations and solution methods are utilized.
The phases can be categorized according to the following modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Initialization Mode</dt>
<dd>
<p>This mode is used to compute at the start time stem[t_0] initial values for continuous-time states, \(\mathbf{x}_c(t_0)\),
and for the previous (internal) discrete-time states, \(\mathbf{x}_d(t_0)\), by utilizing extra equations not present in the other modes (for example, equations to define the start value for a state or for the derivative of a state).</p>
</dd>
<dt class="hdlist1">Continuous-Time Mode</dt>
<dd>
<p>This mode is used to compute the values of all (real) continuous-time variables between events by numerically solving ordinary differential and algebraic equations.
All discrete-time variables are fixed during this phase and the corresponding discrete-time equations are not evaluated.</p>
</dd>
<dt class="hdlist1">Event Mode</dt>
<dd>
<p>This mode is used to compute new values for all continuous-time variables, as well as for all discrete-time variables that are activated at the current event instant \(t\), given the values of the variables from the previous instant \({}^{\bullet}t\).
This is performed by solving algebraic equations consisting of all continuous-time and all active discrete-time equations.
In FMI 2.0 there is no mechanism that the FMU can provide the information whether a discrete-time variable is active or is not active (is not computed) at an event instant.
Therefore, the environment has to assume that at an event instant always all discrete-time variables are computed, although internally in the FMU only a subset might be newly computed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When connecting FMUs together, loop structures can occur that lead to particular difficulties because linear or non-linear algebraic systems of equations in Real variables but also in Boolean or Integer variables might be present.
In order to solve such systems of equations over FMUs efficiently, the dependency information is needed stating, for example, which outputs depend directly on inputs.
This data is optionally provided in the XML file under element <code>&lt;ModelStructure&gt;</code>.
If this data is not provided, the worst case must be assumed (for example, all output variables depend algebraically on all input variables).</p>
</div>
<div class="paragraph">
<p><em>[Example: In <a href="#figure-connected-fmus">Figure 5</a> two different types of connected FMUs are shown (the "dotted lines" characterize the dependency information):</em></p>
</div>
<div id="figure-connected-fmus" class="imageblock text-center">
<div class="content">
<img src="images/ArtificialAlgebraicLoop.svg" alt="ArtificialAlgebraicLoop" width="80%">
</div>
<div class="title">Figure 5. Calling sequences for FMUs that are connected in a loop.</div>
</div>
<div class="paragraph">
<p><em>In the upper diagram, FMU1 and FMU2 are connected in such a way that by an appropriate sequence of <code>fmi3SetXXX</code> and <code>fmi3GetXXX</code> calls, the FMU variables can be computed.
In the lower diagram, FMU3 and FMU4 are connected in such a way that a "real" algebraic loop is present.
This loop might be solved iteratively with a Newton method.
In every iteration the iteration variable \(u_4\) is provided by the solver, and via the shown sequence of <code>fmi3SetXXX</code> and <code>fmi3GetXXX</code> calls, the residue is computed and is provided back to the solver.
Based on the residue a new value of \(u_4\) is provided.
The iteration is terminated when the residue is close to zero.
These types of artifical or real algebraic loops can occur in all the different modes, such as Initialization Mode, Event Mode, and Continuous-Time Mode.
Since different variables are computed in every Mode and the causality of variable computation can be different in Initialization Mode as with respect to the other two Modes, it might be necessary to solve different kinds of loops in the different Modes.]</em></p>
</div>
<div class="paragraph">
<p>In <a href="#table-math-model-exchange">Table 1</a> the equations are defined that can be evaluated in the respective Mode.
The following color coding is used in the table:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="silver"><strong>grey</strong></span>: If a variable in an argument list is marked in <span class="silver">grey</span>, then this variable is not changing in this mode and just the last calculated value from the previous mode is internally used.
For an input argument, it is not allowed to call <code>fmi3SetXXX</code>.
For an output argument, calling <code>fmi3GetXXX</code> on such a variable returns always the same value in this mode.</p>
</li>
<li>
<p><span class="lime"><strong>green</strong></span>: Functions marked in <span class="lime">green</span> are special functions to enter or leave a mode.</p>
</li>
<li>
<p><span class="blue"><strong>blue</strong></span>: Equations and functions marked in <span class="blue">blue</span> define the actual computations to be performed in the respective mode.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Function <code>fmi3SetXXX</code> is an abbreviation for functions <code>fmi3SetReal</code>, <code>fmi3SetBoolean</code>, <code>fmi3SetInteger</code> and <code>fmi3SetString</code> respectively.
Function <code>fmi3GetXXX</code> is an abbreviation for functions <code>fmi3GetReal</code>, <code>fmi3GetBoolean</code>, <code>fmi3GetInteger</code> and <code>fmi3GetString</code> respectively.</p>
</div>
<div class="paragraph">
<p><em>[In the following table the setting of the super dense time, (\(t_R\), \(t_I\)), is precisely described.
Tools will usually not have such a representation of time.
However, super-dense time defines precisely when a new "model evaluation" starts and therefore which variable values belong to the same "model evaluation" at the same (super dense) time instant and should be stored together.]</em></p>
</div>
<table id="table-math-model-exchange" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Mathematical description of an FMU for Model Exchange.</caption>
<colgroup>
<col style="width: 62.5%;">
<col style="width: 37.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Equations</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FMI functions</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations before Initialization Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent variable time \(T_{R0}\) and define \(t_0 := (t_{R0},0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetupExperiment</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(\mathbf{v}_{initial=exact}\) and \(\mathbf{v}_{initial=approx}\)  that have a start value (<code>initial</code> = <code>"exact"</code> or `"approx`")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Initialization Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Initialization Mode at \(t=t_0\) (activate initialization,
discrete-time and continuous-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3EnterInitializationMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(\mathbf{v}_{initial=exact}\) that have a start value with
<code>initial="exact"</code> (independent parameters \(\mathbf{p}\) and
continuous-time states with start values \(\mathbf{x}_{c,initial=exact}\) are included here)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time inputs \(\mathbf{u}(\color{grey}t_{\color{grey} 0})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\(\mathbf{v}_{initialUnknowns}:=f_{init}(\mathbf{u_c}, \mathbf{u_d}, \color{grey}t_{\color{grey} 0}, \mathbf{v}_{initial=exact}\))</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi3GetXXX</span></code>, <code><span class="blue">fmi3GetContinuousStates</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Exit Initialization Mode (de-activate initialization equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3ExitInitializationMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Event Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Event Mode at \(t = t_{i}\) with \({t_{i}\ : = (t}_{R},t_{I} + 1)\) <strong>if</strong>  <em>externalEvent</em> <strong>or</strong> <em>nextMode</em> \(\equiv\) <em>EventMode</em> <strong>or</strong> \(t_i=(T_{next}(t_{i-1}), 0)\) <strong>or</strong>  \(\min_{t&gt;t_{i-1}} t:\left\lbrack z_{j}\left( t \right) &gt; 0\  \neq \ z_{j}\left( t_{i - 1} \right) &gt; 0 \right\rbrack\)<br>
(activate discrete-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3EnterInitializationMode</span></code> <span class="lime">(only from Continuous-Time Mode or after calling</span> <code><span class="lime">fmi3SetTime</span></code>
<span class="lime">if FMU has no continuous-time equations)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent tunable parameters \(\mathbf{p}_{tune}\)<br>
(and do not set other parameters \(\mathbf{p}_{other}\))</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time inputs \(\mathbf{u}(t_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time states \(\mathbf{x}_c(t_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code>,
<code>fmi3SetContinuousStates</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{w}_{c+d}, \mathbf{z}, \mathbf{x}_{c, reinit})=\mathbf{f}_{sim}(\mathbf{x_c}, \mathbf{u_{c+d}}, \color{grey}t_{\color{grey} i}, \mathbf{p}_{tune}, \color{grey}{\mathbf{p}_{other})}\)</span> <br>
\(\mathbf{f}_{sim}\)is also a function of the internal variables \({}^\bullet\mathbf{x}_d\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi3GetXXX</span></code>,
<code><span class="blue">fmi3GetContinuousStates</span></code>,
<code><span class="blue">fmi3GetDerivatives</span></code>
<code><span class="blue">fmi3GetEventIndicators</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Increment super dense time and define with</span>
<code><span class="lime">newDiscreteStatesNeeded</span></code> <span class="lime">whether a new event iteration is required.</span><br>
<span class="blue">\(\qquad\)<strong>if not</strong></span> <code><span class="blue">newDiscreteStatesNeeded</span></code><span class="blue"><strong>then</strong><br>
\(\qquad \qquad T_{next}=T_{next}(\mathbf{x}_c,{}^\bullet\mathbf{x}_d, \mathbf{u_{c+d}}, \color{grey}t_{\color{grey} i}, \mathbf{p}_{tune}, \color{grey}{\mathbf{p}_{other})}\)</span><br>
<span class="blue">\(\qquad\)<strong>end if</strong></span><br>
<span class="blue">\(\qquad t:=t(t_R, t_i+1)\)</span><br>
<span class="blue">\(\qquad {}^\bullet\mathbf{x}_d:=\mathbf{x}_d\)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3NewDiscreteState</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent variable time \(t_i := (T_{next},0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetTime</code><br>
(if no continuous-time equations)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Continuous-Time Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Continuous-Time Mode:</span><br>
<span class="lime">\(\qquad \textrm{// de-activate discrete-time equations}\)</span><br>
<span class="lime">\(\qquad \textrm{// "freeze" variables:}\)</span><br>
<span class="lime">\(\qquad \mathbf{r} := \mathbf{z}&gt;0 \qquad \textrm{//all relations}\)</span><br>
<span class="lime">\(\qquad \textbf{x}_d, \textbf{w}_d \qquad \textrm{//all discrete-time variables}\)</span><br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3EnterContinuousTimeMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent variable time \(t(&gt;t_{enter  mode}): t:=(t_R, 0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetTime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time inputs \(\mathbf{u}_{c}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time states \(\mathbf{x}_{c}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code>,
<code>fmi3SetContinuousStates</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="blue">\((\mathbf{y}_{c}\mathbf{,} \color{grey}{\mathbf{y}_{d}}\mathbf{,\ }{\dot{\mathbf{x}}}_{c}\mathbf{,}_{}\mathbf{w}_{c}\mathbf{,}\color{grey}{\mathbf{w}_{d}}\mathbf{,z,}\color{grey}{\mathbf{x}_{c,reinit}}):=\mathbf{f}_{sim}(\mathbf{x}_{c},\ \mathbf{u}_{c}\mathbf{,} \color{grey}{\mathbf{\ u}_{d}}, t,\color{grey}{\mathbf{p}_{tune},\mathbf{p}_{other}})\)</span><br>
<span class="blue">\(\qquad \mathbf{f}_{sim}\) is also a function of the internal variables</span> <span class="silver">\({}^\bullet\mathbf{x}_{d},\mathbf{r}\).</span></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><span class="blue">fmi3GetXXX,</span></code>
<code><span class="blue">fmi3GetDerivatives,</span></code>
<code><span class="blue">fmi3GetEventIndicators</span></code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Complete integrator step and return <em>enterEventMode</em></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi3CompletedIntegratorStep</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Data types</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">\(t \in \mathbb{R}, \mathbf{p} \in \mathbb{P}^{np},  \mathbf{u}(t) \in \mathbb{P}^{nu},\mathbf{y}(t) \in \mathbb{P}^{ny}, \mathbf{x}_c(t) \in \mathbb{R}^{nxc}, \mathbf{x}_d(t) \in \mathbb{P}^{nxd}, \mathbf{w}(t) \in \mathbb{P}^{nw}, \mathbf{z}(t) \in \mathbb{R}^{nz}\)<br>
\(\qquad \mathbb{R}\): Real variable, \(\mathbb{P}\): real <strong>or</strong> boolean <strong>or</strong> integer <strong>or</strong> enumeration <strong>or</strong> string variable<br>
\(\mathbf{f}_{init}, \mathbf{f}_{sim} \in C^0\) (=continuous functions with respect to all input arguments inside the respective mode).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Remark 1 - Calling Sequences:</em></p>
</div>
<div class="paragraph">
<p><em>In the table above, for notational convenience in every Mode one function call is defined to compute all output arguments from all inputs arguments.
In reality, every scalar output argument is computed by one <code>fmi3GetXXX</code> function call.
Additionally, the output argument need not be a function of all input arguments, but of only a subset from it, as defined in the XML file under</em> <code>&lt;ModelStructure&gt;</code>.
<em>This is essential when FMUs are connected in a loop, as shown in <a href="#figure-connected-fmus">Figure 5</a>. For example, since</em> \(y_{2a}\) <em>depends only on</em>
\(u_{1a}\) <em>, but not on</em> \(u_{1b}\)<em>, it is possible to call</em> <code>fmi3SetXXX</code> <em>to set</em> \(u_{1a}\) <em>, and then inquire</em> \(y_{2a}\) <em>with</em> <code>fmi3GetXXX</code> <em>without setting</em> \(u_{1b}\) <em>beforehand.</em></p>
</div>
<div class="paragraph">
<p><em>It is non-trivial to provide code for <code>fmi3SetXXX</code>, <code>fmi3GetXXX</code>, if the environment can call</em> <code>fmi3SetXXX</code> <em>on the inputs in quite different orders.
A simple remedy is to provide the <span class="underline">dependency information</span>, not according to the "real" functional dependency, but according to the <span class="underline">sorted equations in the generated code</span>.
Example:</em></p>
</div>
<div class="paragraph">
<p>Assume an FMU is described by the following equations (<code>u1</code>, <code>u2</code> are inputs, <code>y1</code>, <code>y2</code> are outputs,<code>w1</code>, <code>w2</code> are internal variables):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>w1 = w2 + u1
w2 = u2
y1 = w1
y2 = w2</pre>
</div>
</div>
<div class="paragraph">
<p>Sorting of the equations might result in (this ordering is not unique):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>w2 := u2
y2 := w2
w1 := w2 + u1
y1 := w1</pre>
</div>
</div>
<div class="paragraph">
<p>With this ordering, the dependency should be defined as <code>y2 = f(u2), y1 = f(u1,u2)</code>.
When <code>y2</code> is called first with <code>fmi3GetXXX</code>, then only <code>u2</code> must be set first (since <code>y2 = f(u2)</code>), and the first two equations are evaluated.
If later <code>y1</code> is inquired as well, then the first two equations are not evaluated again and only the last two equations are evaluated.
On the other hand, if <code>y1</code> is inquired first, then <code>u1</code> and <code>u2</code> must be set first (since <code>y1 = f(u1,u2)</code>) and then all equations are computed.
When <code>y2</code> is inquired afterwards, the cached value is returned.</p>
</div>
<div class="paragraph">
<p>If sorting of the equations in this example would instead result in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>w2 := u2
w1 := w2 + u1
y1 := w1
y2 := w2</pre>
</div>
</div>
<div class="paragraph">
<p>then the dependency should be defined as <code>y2 = f(u1,u2)</code>, <code>y1 = f(u1,u2)</code>, because <code>u1</code> and <code>u2</code> must be first set, before <code>y2</code> can be inquired with <code>fmi3GetXXX</code> when executing this code.</p>
</div>
<div class="paragraph">
<p><em>Remark 2 - Mathematical Model of Discrete-Time FMUs:</em></p>
</div>
<div class="paragraph">
<p><em>There are many different ways discrete-time systems are described.
For FMI, the following basic mathematical model for discrete-time systems is used (other description forms must be mapped, as sketched below):</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/remark_2_source.png" alt="remark 2 source" width="70%">
</div>
</div>
<div class="paragraph">
<p><em>At an event instant, the discrete system is described by algebraic equations as function of the previous (internal) discrete-time states</em> \(_{‍}^{\bullet}\mathbf{x}_{d}\) <em>and the discrete-time inputs</em> \(\mathbf{u}_{d}\)<em>.
If FMUs are connected in a loop, these algebraic equations are called iteratively, until the solution is found.
If the actual discrete-time states</em> \(\mathbf{x}_{d}\) <em>and the previous discrete-time states</em> \(_{‍}^{\bullet}\mathbf{x}_{d}\) <em>are not identical, the discrete-time states are updated, the Integer part of the time is incremented and a new event iteration is performed.
Other discrete-time models must be mapped to this description form.
Examples:</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Synchronous systems</dt>
<dd>
<p><em>A synchronous system,
such as Lucid Synchrone (Pouzet 2006) or Modelica 3.3 (Modelica 2012), is called periodically, and at every sample instant the discrete-time equations are evaluated exactly once.
An FMU of this type can be implemented by activating the model equations only at the first event iteration and returning always <code>newDiscreteStatesNeeded = false</code> from <code>fmi3NewDiscreteStates</code>.
Furthermore, the discrete-time states are not updated by <code>fmi3NewDiscreteStates</code>, but as first action before the discrete-time equations are evaluated, in order that</em> \(^{\bullet}\mathbf{x}_d\) <em>(= value at the previous clock tick) and</em> \(\mathbf{x}_d\) <em>(value at the latest clock tick) have reasonable values between clock ticks.</em></p>
</dd>
<dt class="hdlist1">State machines with one memory location for a state</dt>
<dd>
<p><em>In such a system there is only one memory location for a discrete-time state and not two, and therefore a discrete-time state is updated in the statement where it is assigned (and not in <code>fmi3NewDiscreteStates</code>).
As a result, <code>fmi3NewDiscreteStates</code> is basically just used to start a new (super dense) time instant.
This is unproblematic, as long as no algebraic loops occur.
FMUs of this type can therefore not be used in "real" algebraic loops if the involved variables depend on a discrete-time state.
This restriction is communicated to the environment of the FMU by the <code>ScalarVariable</code> definition of the corresponding input with flag <code>canHandleMultipleSetPerTimeInstant = false</code> (so an input with this flag is not allowed to be called in an algebraic loop).</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>Remark 3 - Event Indicators / Freezing Relations:</em></p>
</div>
<div class="paragraph">
<p><em>In the above table, vector</em> <strong>r</strong> <em>is used to collect all relations together that are utilized in the event indicators</em> <strong>z</strong> <em>.
In Continuous-Time Mode all these relations are "frozen" and do not change during the evaluations in the respective Mode.
This is indicated in the table above by computing_</em> <strong>r</strong> <em>when entering the Continuous-Time Mode and providing</em> <strong>r</strong> <em>as (internal) input argument to the evaluation functions.
Example:</em></p>
</div>
<div class="paragraph">
<p><em>An equation of the form</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>y = if x1 &gt; x2 or x1 &lt; x3 then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>can be implemented in the FMU as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>z1 := x1 - x2;
z2 := x3 - x1;
if InitializationMode or EventMode then
  r1 := z1 &gt; 0;
  r2 := z2 &gt; 0;
end if;
y = if r1 or r2 then +1 else -1</pre>
</div>
</div>
<div class="paragraph">
<p><em>Therefore, the original if-clause is evaluated in this form only during Initialization and Event Mode.
In Continuous-Time Mode this equation is evaluated as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>z1 = x1 - x2;
z2 = x3 - x1
y = if r1 or r2 then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>and when entering Continuous-Time Mode r1 and r2 are computed as</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>r1 = z1 &gt; 0
r2 = z2 &gt; 0</pre>
</div>
</div>
<div class="paragraph">
<p><em>When z1 changes from z1 &gt; 0 to z1 &#8656; 0 or vice versa, or z2 correspondingly, the integration is halted, and the environment must call <code>fmi3EnterEventMode</code>.</em></p>
</div>
<div class="paragraph">
<p><em>An actual implementation will pack the code in an impure function, say Greater(&#8230;&#8203;), resulting in:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>y = if Greater(x1-x2,...) or Greater(x3-x1,...) then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>Furthermore, a hysteresis should be added for the event indicators.
For more details see the companion document FunctionalMockupInterface-ImplementationHints.docx.</em></p>
</div>
<div class="paragraph">
<p><em>Remark 4 - Pure Discrete-Time FMUs:</em></p>
</div>
<div class="paragraph">
<p><em>If an FMU has only discrete-time equations (and no variables with <code>variability = "continuous"</code>),
then the environment need not to call <code>fmi3EnterContinuousTimeMode</code> but can directly call
<code>fmi3SetTime</code> to set the value of the next event instant,
before <code>fmi3EnterEventMode</code> is called.]</em></p>
</div>
<div class="paragraph">
<p>An FMU is initialized in Initialization Mode with \(\mathbf{f}_{init}(\ldots)\).
The input arguments to this function consist of the input variables (= variables with <code>causality = "input"</code>), of the independent variable (= variable with <code>causality = "independent"</code>; usually the default value <code>"time"</code>), and of all variables that have a start value with (explicitly or implicitly) <code>initial = "exact"</code> in order to compute the continuous-time states and the output variables at the initial time \(t_0\).
In the above table, the variables with <code>initial = "exact"</code> are collected together in variable \(\mathbf{v}_{initial=exact}\).
For example, initialization might be defined by providing initial start values for the states, \(\mathbf{x}_{c0}\), or by stating that the state derivatives are zero (\(\dot{\mathbf{x}}_{c} = \mathbf{0}\)).
Initialization is a difficult topic by itself, and it is required that an FMU solves a well-defined initialization problem inside the FMU in Initialization Mode.<br>
After calling <code>fmi3ExitInitializationMode</code>, the FMU is implicitly in Event Mode, and all discrete-time and continuous-time variables at the initial time instant \((t_R, 0)\) can be calculated.
If these variables are present in an algebraic loop, iteration can be used to compute them.
Once finalized, <code>fmi3NewDiscreteStates</code> must be called, and depending on the value of the return argument, the FMU either continues the event iteration at the initial time instant or switches to Continuous-Time Mode.<br>
After switching to Continuous-Time Mode, the integration is started.
Basically, in this phase the derivatives of the continuous states are computed.
If FMUs and/or submodels are connected together, then the inputs of these models are the outputs of other models, and therefore, the corresponding FMU outputs must be computed.
Whenever result values shall be stored, usually at output points defined before the start of the simulation, the <code>fmi3GetXXX</code> function with respect to the desired variables must be called.<br>
Continuous integration is stopped at an event instant.
An event instant is determined by a time, state or step event, or by an external event triggered by the environment.
In order to determine a state event, the event indicators <strong>z</strong> have to be inquired at every completed integrator step.
Once the event indicators signal a change of their domain, an iteration over time is performed between the previous and the actual completed integrator step, in order to determine the time instant of the domain change up to a certain precision.<br>
After an event is triggered, the FMU needs to be switched to Event Mode.
In this mode, systems of equations over connected FMUs might be solved (similarily as in Continuous-Time Mode).
Once convergence is reached, <code>fmi3NewDiscreteStates</code> must be called to increment super dense time (and conceptually update the discrete-time states defined internally in the FMU by \(^{\bullet}\mathbf{x}_d := \mathbf{x}_d\)).
Depending on the discrete-time model, a new event iteration might be needed (for example, because the FMU describes internally a state machine
and transitions are still able to fire, but new inputs shall be taken into account).<br>
The function calls in the table above describe precisely which input arguments are needed to compute the desired output argument(s).
There is no 1:1 mapping of these mathematical functions to C functions.
Instead, all input arguments are set with <code>fmi3SetXXX</code> C function calls, and then the result argument(s) can be determined with the C functions defined in the right column of the above table.
This technique is discussed in detail in <a href="#providing-independent-variables-and-re-initialization">Section 3.2.1</a>.
<em><span class="In short:
For efficiency reasons">one</span> (internal) C function.
With the C functions described in the next sections, input arguments are copied into the internal model data structure only when their value has changed in the environment.
With the C functions in the right column of the table above, the internal function is called in such a way that only the minimum needed equations are evaluated.
Hereby, variable values calculated from previous calls can be reused.
This technique is called "caching" and can significantly enhance the simulation efficiency of real-world models.]</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_fmi_application_programming_interface_2">3.2. FMI Application Programming Interface</h3>
<div class="paragraph">
<p>This section contains the interface description to evaluate different model parts from a C program.</p>
</div>
<div class="sect3">
<h4 id="providing-independent-variables-and-re-initialization">3.2.1. Providing Independent Variables and Re-initialization of Caching</h4>
<div class="paragraph">
<p>Depending on the situation, different variables need to be computed.
In order to be <span class="underline">efficient</span>, it is important that the interface requires only the <span class="underline">computation</span> of variables that are needed in the <span class="underline">present  context</span>.
For example, during the iteration of an integrator step, only the state derivatives need to be computed, provided the output of a model is not connected.
It might be that at the same time instant other variables are needed.
For example, if an integrator step is completed, the event indicator functions need to be computed as well.
If the state derivatives have already been computed at the present time instant, then it is important for efficiency that they are not newly computed in the call to compute the event indicator functions.
This means, the state derivatives shall be reused from the previous call.
This feature is called "<span class="underline">caching of variables</span>" in the sequel.<br>
Caching requires that the model evaluation can detect when the input arguments, like time or states, have changed.
This is achieved by setting them explicitly with a function call, since every such function call signals precisely a change of the corresponding variables.
For this reason, this section contains functions to set the input arguments of the equation evaluation functions.
This is unproblematic for time and states, but is more involved for parameters and inputs, since the latter may have different data types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetTimeTYPE(fmi3Component c, fmi3Float64 time);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set a new time instant and re-initialize caching of variables that depend on time, provided the newly provided time value is different to the previously set time value (variables that depend solely on constants or parameters need not to be newly computed in the sequel, but the previously computed values can be reused).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetContinuousStatesTYPE(fmi3Component c,
                                               const fmi3Float64 x[],
                                               size_t nx);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set a new (continuous) state vector and re-initialize caching of variables that depend on the states.
Argument nx is the length of vector x and is provided for checking purposes (variables that depend solely on constants, parameters, time, and inputs do not need to be newly computed in the sequel, but the previously computed values can be reused).
Note that the continuous states might also be changed in Event Mode.
Note that <code>fmi3Status = fmi3Discard</code> is possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi3Status fmi3SetXXX(..);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set new values for (independent) parameters, start values and inputs and re-initialize caching of variables that depend on these variables.
The details of these functions are defined in <a href="#get-and-set-variable-values">Section 2.1.7</a>.</p>
</div>
<div class="paragraph">
<p><em>[The functions above have the slight drawback that values must always be copied.
For example, a call to</em> <code>fmi3SetContinuousStates</code> <em>will provide the actual states in a vector, and this function has to copy the values in to the internal model data structure "</em> <code>c</code> <em>" so that subsequent evaluation calls can utilize these values.
If this turns out to be an efficiency issue, a future release of FMI might provide additional functions to provide the address of a memory area where the variable values are present.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="evaluation-of-model-equations">3.2.2. Evaluation of Model Equations</h4>
<div class="paragraph">
<p>This section contains the core functions to evaluate the model equations.
Before one of these functions can be called,
the appropriate functions from the previous section have to be used,
to set the input arguments to the current model evaluation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterEventModeTYPE(fmi3Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The model enters <strong>Event Mode</strong> from the <strong>Continuous-Time Mode</strong> and discrete-time equations may become active (and relations are not "frozen").</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3NewDiscreteStatesTYPE(fmi3Component c,
                                             fmi3EventInfo* fmi3eventInfo);

typedef struct {
    fmi3Boolean newDiscreteStatesNeeded;
    fmi3Boolean terminateSimulation;
    fmi3Boolean nominalsOfContinuousStatesChanged;
    fmi3Boolean valuesOfContinuousStatesChanged;
    fmi3Boolean nextEventTimeDefined;
    fmi3Float64 nextEventTime;  /* next event if nextEventTimeDefined=fmi3True */
} fmi3EventInfo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FMU is in <strong>Event Mode</strong> and the super dense time is incremented by this call.<br>
If the super dense time before a call to <code>fmi3NewDiscreteStates</code> was \((t_R,t_I)\), then the time instant after the call is \((t_R,t_I)\).<br>
If return argument <code>fmi3eventInfo->newDiscreteStatesNeeded</code> = <code>fmi3True</code>, the FMU should stay in Event Mode, and the FMU requires to set new inputs to the FMU (<code>fmi3SetXXX</code> on inputs) to compute and get the outputs (<code>fmi3GetXXX</code> on outputs) and to call <code>fmi3NewDiscreteStates</code> again.
Depending on the connection with other FMUs, the environment shall</p>
</div>
<div class="ulist">
<ul>
<li>
<p>call <code>fmi3Terminate</code>, if <code>terminateSimulation</code> = <code>fmi3True</code> is returned by at least one FMU,</p>
</li>
<li>
<p>call <code>fmi3EnterContinuousTimeMode</code> if all FMUs return <code>newDiscreteStatesNeeded</code> = <code>fmi3False</code>, and</p>
</li>
<li>
<p>stay in <strong>Event Mode</strong> otherwise.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the FMU is terminated, it is assumed that an appropriate message is printed by the logger function (see <a href="#creation-destruction-and-logging">Section 2.1.5</a>) to explain the reason for the termination.<br>
If <code>nominalsOfContinuousStatesChanged = fmi3True</code>, then the nominal values of the states have changed due to the function call and can be inquired with <code>fmi3GetNominalsOfContinuousStates</code>.<br>
If <code>valuesOfContinuousStatesChanged = fmi3True</code>, then at least one element of the continuous state vector has changed its value due to the function call.
The new values of the states can be inquired with <code>fmi3GetContinuousStates</code>.
If no element of the continuous state vector has changed its value, <code>valuesOfContinuousStatesChanged</code> must return <code>fmi3False</code>.
<em>[If <code>fmi3True</code> would be returned in this case, an infinite event loop may occur.]</em><br>
If <code>nextEventTimeDefined = fmi3True</code>, then the simulation shall integrate at most until <code>time = nextEventTime</code>, and shall call <code>fmi3EnterEventMode</code> at this time instant.
If integration is stopped before <code>nextEventTime</code>, for example, due to a state event, the definition of <code>nextEventTime</code> becomes obsolete.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3EnterContinuousTimeModeTYPE(fmi3Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The model enters <strong>Continuous-Time Mode</strong> and all discrete-time equations become inactive and all relations are "frozen".<br>
This function has to be called when changing from <strong>Event Mode</strong> (after the global event iteration in <strong>Event Mode</strong> over all involved FMUs and other models has converged) into <strong>Continuous-Time Mode</strong>.<br></p>
</div>
<div class="paragraph">
<p><em>[This function might be used for the following purposes:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>If the FMU stores results internally on file, then the results after the initialization and/or the event has been processed can be stored.</em></p>
</li>
<li>
<p><em>If the FMU contains dynamically changing states, then a new state selection might be performed with this function.]</em></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3CompletedIntegratorStepTYPE(fmi3Component c,
                                                   fmi3Boolean noSetFMUStatePriorToCurrentPoint,
                                                   fmi3Boolean* enterEventMode,
                                                   fmi3Boolean* terminateSimulation);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function must be called by the environment after every completed step of the integrator provided the capability flag <code>completedIntegratorStepNotNeeded = false</code>.
Argument <code>noSetFMUStatePriorToCurrentPoint</code> is <code>fmi3True</code> if <code>fmi3SetFMUState</code> will no longer be called for time instants prior to current time in this simulation run [the FMU can use this flag to flush a result buffer].<br>
The function returns <code>enterEventMode</code> to signal to the environment if the FMU shall call <code>fmi3EnterEventMode</code>, and it returns <code>terminateSimulation</code> to signal if the simulation shall be terminated.
If <code>enterEventMode</code> = <code>fmi3False</code> and <code>terminateSimulation</code> = <code>fmi3False</code> the FMU stays in <strong>Continuous-Time Mode</strong> without calling <code>fmi3EnterContinuousTimeMode</code> again.
When the integrator step is completed and the states are <span class="underline">modified</span> by the integrator <span class="underline">afterwards</span> (for example, correction by a BDF method),
then <code>fmi3SetContinuousStates</code> has to be called with the updated states <span class="underline">before</span> <code>fmi3CompletedIntegratorStep</code> is called.<br>
When the integrator step is completed and one or more event indicators change sign (with respect to the previously completed integrator step),
then the integrator or the environment has to determine the time instant of the sign change that is closest to the previous completed step up to a certain precision (usually a small multiple of the machine epsilon).
This is usually performed by an iteration where time is varied and state variables needed during the iteration are determined by interpolation.
Function <code>fmi3CompletedIntegratorStep</code> must be called after this state event location procedure and not after the successful computation of the time step by the integration algorithm.
The intended purpose of the function call is to indicate to the FMU that at this stage all inputs and state variables have valid (accepted) values.
After <code>fmi3CompletedIntegratorStep</code> is called, it is still allowed to go back in time (calling <code>fmi3SetTime</code>) and inquire values of variables at previous time instants with <code>fmi3GetXXX</code> <em>[for example, to determine values of non-state variables at output points]</em>.
However, it is not allowed to go back in time over the previous <code>fmi3CompletedIntegratorStep</code> or the previous <code>fmi3EnterEventMode</code> call.</p>
</div>
<div class="paragraph">
<p><em>[This function might be used, for example, for the following purposes:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Delays:</em><br>
<em>All variables that are used in a "delay(..)" operator are stored in an appropriate buffer and the function returns with <code>enterEventMode</code> = <code>fmi3False</code>, and <code>terminateSimulation</code> = <code>fmi3False</code>.</em></p>
</li>
<li>
<p><em>Dynamic state selection:<br>
It is checked whether the dynamically selected states are still numerically appropriate.
If yes, the function returns with <code>enterEventMode</code> = <code>fmi3False</code>  otherwise with <code>enterEventMode</code> = <code>fmi3True</code>.</em>
<em>In the latter case, <code>fmi3EnterEventMode</code> has to be called and the states are dynamically changed by a subsequent <code>fmi3NewDiscreteStates</code>.</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Note that this function is not used to detect time or state events, for example, by comparing event indicators of the previous with the current call of <code>fmi3CompletedIntegratorStep</code>.
These types of events are detected in the environment, and the environment has to call <code>fmi3EnterEventMode</code> independently in these cases,
whether the return argument <code>enterEventMode</code> of <code>fmi3CompletedIntegratorStep</code> is <code>fmi3True</code> or <code>fmi3False</code>.]</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetDerivativesTYPE(fmi3Component c,
                                          fmi3Float64 derivatives[],
                                          size_t nx);

typedef fmi3Status fmi3GetEventIndicatorsTYPE(fmi3Component c,
                                              fmi3Float64 eventIndicators[],
                                              size_t ni);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compute state derivatives and event indicators at the current time instant and for the current states.
The derivatives are returned as a vector with <code>nx</code> elements.
A state event is triggered when the domain of an event indicator changes from \(z_j &gt; 0\) to \(z_j \leq 0\) or vice versa.
The FMU must guarantee that at an event restart \(z_j \neq 0\), for example, by shifting \(z_j\) with a small value.
Furthermore, \(z_j\) should be scaled in the FMU with its nominal value (so all elements of the returned vector <code>eventIndicators</code> should be in the order of "one").
The event indicators are returned as a vector with <code>ni</code> elements.<br>
The ordering of the elements of the derivatives vector is identical to the ordering of the state vector (for example, <code>derivatives[2]</code> is the derivative of <code>x[2]</code>).
Event indicators are not necessarily related to variables on the Model Description File.<br>
Note that <code>fmi3Status</code> = <code>fmi3Discard</code> is possible for both functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetContinuousStatesTYPE(fmi3Component c, fmi3Float64 x[], size_t nx);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Return the new (continuous) state vector x.
This function has to be called directly after calling function <code>fmi3EnterContinuousTimeMode</code> if it returns with <code>eventInfo&#8594;valuesOfContinuousStatesChanged = fmi3True</code> (indicating that the (continuous-time) state vector has changed).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetNominalsOfContinuousStatesTYPE(fmi3Component c,
                                                         fmi3Float64 x_nominal[],
                                                         size_t nx);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Return the nominal values of the continuous states.
This function should always be called after calling function <code>fmi3NewDiscreteStates</code> if it returns with <code>eventInfo&#8594;nominalsOfContinuousStatesChanged = fmi3True</code>, since then the nominal values of the continuous states have changed <em>[for example, because the association of the continuous states to variables has changed due to internal dynamic state selection]</em>.
If the FMU does not have information about the nominal value of a continuous state i, a nominal value <code>x_nominal[i] = 1.0</code> should be returned.
Note that it is required that <code>x_nominal[i] &gt; 0.0</code>.
<em>[Typically, the nominal values of the continuous states are used to compute the absolute tolerance required by the integrator.
Example:<br>
<code>absoluteTolerance[i] = 0.01*tolerance*x_nominal[i];</code>]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="state-machine-model-exchange">3.2.3. State Machine of Calling Sequence</h4>
<div class="paragraph">
<p>Every implementation of the FMI must support calling sequences of the functions according to the following state chart:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/CallingSequenceME.png" alt="CallingSequenceME" width="100%">
</div>
<div class="title">Figure 6. Calling sequence of Model Exchange C functions in form of an UML 2.0 state machine.</div>
</div>
<div class="paragraph">
<p>The objective of the start chart is to define the allowed calling sequences for functions of the FMI: Calling sequences not accepted by the state chart are not supported by the FMI.
The behavior of an FMU is undefined for such a calling sequence.
For example, the state chart indicates that when an FMU for Model Exchange is in state <strong>Continuous-Time Mode</strong>, a call to <code>fmi3SetReal</code> for a discrete input is not supported.
The state chart is given here as UML 2.0 state machine.
If a transition is labelled with one or more function names (for example, <code>fmi3GetReal</code>, <code>fmi3GetInteger</code>), this means that the transition is taken if any of these functions is successfully called.
Note that the FMU can always determine in which state it is since every state is entered by a particular function call (such as <code>fmi3EnterEventMode</code>), or a particular return value (such as <code>fmi3Fatal</code>).</p>
</div>
<div class="paragraph">
<p>The transition conditions <code>external event</code>, <code>time event</code>, and <code>state event</code> are defined in <a href="#math-model-exchange">Section 3.1</a>.
Each state of the state machine corresponds to a certain phase of a simulation as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">instantiated</dt>
<dd>
<p>In this state, start and guess values (= variables that have <code>initial = "exact"</code> or <code>"approx"</code>) can be set.</p>
</dd>
<dt class="hdlist1">Initialization Mode</dt>
<dd>
<p>In this state, equations are active to determine all continuous-time states, as well as all outputs (and optionally other variables exposed by the exporting tool).
The variables that can be retrieved by <code>fmi3GetXXX</code> calls are (1) defined in the XML file under <code>&lt;ModelStructure&gt;&lt;InitialUnknowns&gt;</code> and (2) variables with <code>causality</code> = <code>"output"</code>.
Variables with <code>initial</code> = <code>"exact"</code>, as well as variables with <code>variability</code> = <code>"input"</code> can be set.</p>
</dd>
<dt class="hdlist1">Continuous-Time Mode</dt>
<dd>
<p>In this state, the continuous-time model equations are active and integrator steps are performed.
The event time of a state event may be determined if a domain change of at least one event indicator is detected at the end of a completed integrator step.</p>
</dd>
<dt class="hdlist1">Event Mode</dt>
<dd>
<p>If an event is triggered in <strong>Continuous-Time Mode</strong>, then <strong>Event Mode</strong> is entered by calling <code>fmi3EnterEventMode</code>.
In this mode all continuous-time and discrete-time equations are active and the unknowns at an event can be computed and retrieved.
After an event is completely processed, <code>fmi3NewDiscreteStates</code> must be called and depending on the return argument, <code>newDiscreteStatesNeeded</code>, the state chart stays in <strong>Event Mode</strong> or switches to <strong>Continuous-Time Mode</strong>.
When the <strong>Initialization Mode</strong> is terminated with <code>fmi3ExitInitializationMode</code>, then <strong>Event Mode</strong> is directly entered, and the continuous-time and discrete-time variables at the initial time are computed based on the initial continuous-time states determined in the <strong>Initialization Mode</strong>.</p>
</dd>
<dt class="hdlist1">terminated</dt>
<dd>
<p>In this state, the solution at the final time of a simulation can be retrieved.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that simulation backward in time is only allowed over continuous time intervals.
As soon as an event occurred (<code>fmi3EnterEventMode</code> was called), going back in time is forbidden, because <code>fmi3EnterEventMode</code> / <code>fmi3NewDiscreteStates</code> can only compute the next discrete state, not the previous one.</p>
</div>
<div class="paragraph">
<p>Note that during <strong>Initialization</strong>, <strong>Event</strong>, and <strong>Continuous-Time Mode</strong> input variables can be set with <code>fmi3SetXXX</code> and output variables can be retrieved with <code>fmi3GetXXX</code> interchangeably according to the model structure defined under element <code>&lt;ModelStructure&gt;</code> in the XML file.
<em>[For example, if one output <code>y1</code> depends on two inputs <code>u1</code>, <code>u2</code>, then these two inputs must be set, before <code>y1</code> can be retrieved.
If additionally an output <code>y2</code> depends on an input <code>u3</code>, then <code>u3</code> can be set and <code>y2</code> can be retrieved afterwards.
As a result, artificial or "real" algebraic loops over connected FMUs in any of these three modes can be handled by using appropriate numerical algorithms.]</em></p>
</div>
<div class="paragraph">
<p>The allowed function calls in the respective states are summarized in the following table (functions marked in "<span class="yellow-background">yellow</span>" are only available for "Model Exchange", the other functions are available both for "Model Exchange" and "Co-Simulation"):</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<colgroup>
<col style="width: 55.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.556%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-bottom" rowspan="2"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock"><strong>FMI 2.0 for Model Exchange</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">start, end</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">instantiated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Initialization Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Event Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Continuous-Time Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">terminated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">error</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">fatal</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetDebugLogging</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3Instantiate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3FreeInstance</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetupExperiment</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3EnterInitializationMode</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3ExitInitializationMode</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3Terminate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3Reset</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3FreeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SerializedFMUstateSize</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SerializeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3DeSerializeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetDirectionalDerivative</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3EnterEventMode               </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3NewDiscreteStates             </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3EnterContinuousTimeMode       </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3CompletedIntegratorStep       </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3SetTime                       </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3SetContinuousStates           </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3GetEventIndicators            </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3GetContinuousStates           </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3GetDerivatives                </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3GetNominalsOfContinuousStates </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>x</strong> means: call is allowed in the corresponding state<br>
<strong>number</strong> means: call is allowed if the indicated condition holds:<br>
<strong>1</strong> for a variable with <code>variability</code> \(\neq\) <code>"constant"</code> that has <code>initial</code> =
<code>"exact"</code> or <code>"approx"</code><br>
<strong>2</strong> for a variable with <code>causality = "output"</code>, or continuous-time states or state derivatives<br>
<strong>3</strong> for a variable with <code>variability</code> \(\neq\) <code>"constant"</code> that has <code>initial</code> = <code>"exact"</code>,
or <code>causality</code> = <code>"input"</code><br>
<strong>4</strong> for a variable with <code>causality</code> = <code>"input"</code>,
or (<code>causality</code> = <code>"parameter"</code> and <code>variability</code> = <code>"tunable"</code>)<br>
<strong>5</strong> for a variable with <code>causality</code> = <code>"input"</code> and <code>variability</code> = <code>"continuous"</code><br>
<strong>7</strong> always, but retrieved values are usable for debugging only</p>
</div>
</div>
<div class="sect3">
<h4 id="_pseudo_code_example">3.2.4. Pseudo-code Example</h4>
<div class="paragraph">
<p>In the following example, the usage of the <code>fmi3XXX</code> functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
The example is given in a mix of pseudo-code and C, in order to keep it small and understandable.
Furthermore, it is assumed that one FMU is directly integrated in a simulation environment.
If the FMU would be used inside another model, additional code is needed, especially initialization and event iteration has to be adapted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">m = M_fmi3Instantiate("m", ...)  // "m" is the instance name
                                 // "M_" is the MODEL_IDENTIFIER
nx = ...         // number of states, from XML file
nz = ...         // number of event indicators, from XML file
Tstart = 0       // could also be retrieved from XML file
Tend = 10        // could also be retrieved from XML file
dt = 0.01        // fixed step size of 10 milli-seconds

// set the start time
Tnext = Tend
time  = Tstart
M_fmi3SetTime(m, time)

// set all variable start values (of "ScalarVariable / &lt;type&gt; / start") and
// set the input values at time = Tstart
M_fmi3SetReal/Integer/Boolean/String(m, ...)

// initialize
   // determine continuous and discrete states
   M_fmi3SetupExperiment(m,fmi3False,0.0, Tstart, fmi3True,Tend)
   M_fmi3EnterInitializationMode(m)
   M_fmi3ExitInitializationMode(m)

   // event iteration
   eventInfo.newDiscreteStatesNeeded = true;
   while eventInfo.newDiscreteStatesNeeded loop
     // update discrete states
     M_fmi3NewDiscreteStates(m, &amp;eventInfo)
     if eventInfo.terminateSimulation then goto TERMINATE_MODEL
   end while

// enter Continuous-Time Mode
M_fmi3EnterContinuousTimeMode(m)

// retrieve initial state x and
// nominal values of x (if absolute tolerance is needed)
M_fmi3GetContinuousStates(m, x, nx)
M_fmi3GetNominalsOfContinuousStates(m, x_nominal, nx)

// retrieve solution at t=Tstart, for example, for outputs
M_fmi3GetReal/Integer/Boolean/String(m, ...)

while time &lt; Tend loop
  // compute derivatives
  M_fmi3GetDerivatives(m, der_x, nx)

  // advance time
  h = min(dt, Tnext-time)
  time = time + h
  M_fmi3SetTime(m, time)

  // set inputs at t = time
  M_fmi3SetReal/Integer/Boolean/String(m, ...)

  // set states at t = time and perform one step
  x = x + h*der_x  // forward Euler method
  M_fmi3SetContinuousStates(m, x, nx)

  // get event indicators at t = time
  M_fmi3GetEventIndicators(m, z, nz)

  // detect  events, if any
  time_event = abs(time - Tnext) &lt;= eps
  state_event = ...          // compare sign of z with previous z

  // inform the model about an accepted step
  M_fmi3CompletedIntegratorStep(m, fmi3True, &amp;enterEventMode, &amp;terminateSimulation)
  if terminateSimulation then goto TERMINATE_MODEL

  // handle events
  if entertEventMode or time_event or state_event then
    M_fmi3EnterEventMode(m)

    // event iteration
    eventInfo.newDiscreteStatesNeeded = true;
    while eventInfo.newDiscreteStatesNeeded loop
      // update discrete states
      M_fmi3NewDiscreteStates(m, &amp;eventInfo)
      if eventInfo.terminateSimulation then goto TERMINATE_MODEL
    end while

    // enter Continuous-Time Mode
    M_fmi3EnterContinuousTimeMode(m)

    // retrieve solution at simulation restart
    M_fmi3GetReal/Integer/Boolean/String(m, ...)
    if eventInfo.valuesOfContinuousStatesChanged == fmi3True then
      //the model signals a value change of states, retrieve them
      M_fmi3GetContinuousStates(m, x, nx)
    end if

    if eventInfo.nominalsOfContinuousStatesChanged = fmi3True then
      //the meaning of states has changed; retrieve new nominal values
      M_fmi3GetNominalsOfContinuousStates(m, x_nominal, nx)
    end if

    if eventInfo.nextEventTimeDefined then
      Tnext = min(eventInfo.nextEventTime, Tend)
    else
      Tnext = Tend
    end if
  end if
end while

// terminate simulation and retrieve final values
TERMINATE_MODEL:
M_fmi3Terminate(m)
M_fmi3GetReal/Integer/Boolean/String(m, ...)

// cleanup
M_fmi3FreeInstance(m)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above, errors are not handled. Typically, <code>fmi3XXX</code> function calls are performed in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">status = M_fmi3GetDerivatives(m, der_x, nx);
switch ( status ) { case fmi3Discard: ....; break; // reduce step size and try again
                    case fmi3Error  : ....; break; // cleanup and stop simulation
                    case fmi3Fatal  : ....; }      // stop using the model</code></pre>
</div>
</div>
<div class="paragraph">
<p>The switch statement could also be stored in a macro to simplify the code.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fmi_description_schema">3.3. FMI Description Schema</h3>
<div class="paragraph">
<p>This is defined in 2.2.
Additionally, the Model Exchange-specific element "ModelExchange" is defined in the next section.</p>
</div>
<div class="sect3">
<h4 id="ModelExchange">3.3.1. Model Exchange FMU (ModelExchange)</h4>
<div class="paragraph">
<p>If the XML file defines an FMU for Model Exchange, element "ModelExchange" must be present.
It is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/model_exchange_schema_1.png" alt="model exchange schema 1" width="80%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/model_exchange_schema_2.png" alt="model exchange schema 2" width="70%">
</div>
</div>
<div class="paragraph">
<p>The following attributes are defined (all of them are optional, with exception of <code>modelIdentifier</code>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelIdentifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short class name according to C syntax, for example, "A_B_C".
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries, but not if the functions are provided by a DLL/SharedObject.
<code>modelIdentifier</code> is also used as name of the static library or DLL/SharedObject.
See also <a href="#header-files-and-naming-of-functions">Section 2.1.1</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>needsExecutionTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, a tool is needed to execute the model and the FMU just contains the communication to this tool.
<em>[Typically, this information is only utilized for information purposes.
For example, when loading an FMU with <code>needsExecutionTool = "true"</code>, the environment can inform the user that a tool has to be available on the computer where the model is instantiated.
The name of the tool can be taken from attribute generationTool of fmiModelDescription.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>completedIntegratorStepNotNeeded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, function <code>fmi3CompletedIntegratorStep</code> need not be called (this gives a slightly more efficient integration).
If it is called, it has no effect.<br>
If <code>false</code> (the default), the function must be called after every completed integrator step, see <a href="#evaluation-of-model-equations">Section 3.2.2</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canBeInstantiatedOnlyOncePerProcess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This flag indicates cases (especially for embedded code), where only one instance per FMU is possible (multiple instantiation is default = <code>false</code>; if multiple instances are needed and the flag <code>canBeInstantiatedOnlyOncePerProcess = "true"</code>, the FMUs must be instantiated in different processes).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canNotUseMemoryManagementFunctions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the FMU uses its own functions for memory allocation and freeing only.
The callback functions <code>allocateMemory</code> and <code>freeMemory</code> given in <code>fmi3Instantiate</code> are ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canGetAndSetFMUstate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the environment can inquire the internal FMU state and can restore it.
That is, functions <code>fmi3GetFMUstate</code>, <code>fmi3SetFMUstate</code>, and <code>fmi3FreeFMUstate</code> are supported by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canSerializeFMUstate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the environment can serialize the internal FMU state, in other words, functions <code>fmi3SerializedFMUstateSize</code>, <code>fmi3SerializeFMUstate</code>, <code>fmi3DeSerializeFMUstate</code> are supported by the FMU.
If this is the case, then flag <code>canGetAndSetFMUstate</code> must be true as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesDirectionalDerivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the directional derivative of the equations can be computed with <code>fmi3GetDirectionalDerivative</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The flags have the following default values.</p>
</div>
<div class="paragraph">
<p>boolean: false<br>
unsignedInt: 0</p>
</div>
</div>
<div class="sect3">
<h4 id="xml-example-model-exchange">3.3.2. Example XML Description File</h4>
<div class="paragraph">
<p>When generating an FMU from the hypothetical model "MyLibrary.SpringMassDamper", the XML file may have the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF8"?&gt;
&lt;fmiModelDescription
  fmiVersion="3.0-dev"
  modelName="MyLibrary.SpringMassDamper"
  instantiationToken="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2011-09-23T16:57:33Z"
  variableNamingConvention="structured"&gt;
  &lt;CoSimulation
    modelIdentifier="MyLibrary_SpringMassDamper"
    canHandleVariableCommunicationStepSize="true"
    canInterpolateInputs="true"/&gt;
  &lt;UnitDefinitions&gt;
    &lt;Unit name="rad"&gt;
      &lt;BaseUnit rad="1"/&gt;
      &lt;DisplayUnit name="deg" factor="57.2957795130823"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="rad/s"&gt;
      &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="kg.m2"&gt;
      &lt;BaseUnit kg="1" m="2"/&gt;
    &lt;/Unit&gt;
  &lt;/UnitDefinitions&gt;
  &lt;TypeDefinitions&gt;
    &lt;SimpleType name="Modelica.SIunits.Inertia"&gt;
      &lt;Float64 quantity="MomentOfInertia" unit="kg.m2" min="0.0"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.Torque"&gt;
      &lt;Float64 quantity="Torque" unit="N.m"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.AngularVelocity"&gt;
      &lt;Float64 quantity="AngularVelocity" unit="rad/s"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.Angle"&gt;
      &lt;Float64 quantity="Angle" unit="rad"/&gt;
    &lt;/SimpleType&gt;
  &lt;/TypeDefinitions&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;Float64 name="inertia1.J" valueReference="1073741824"
      description="Moment of load inertia" causality="parameter" variability="fixed"
      declaredType="Modelica.SIunits.Inertia" start="1"/&gt;
    &lt;Float64 name="torque.tau" valueReference="536870912"
      description="Accelerating torque acting at flange (= -flange.tau)" causality="input"
      declaredType="Modelica.SIunits.Torque" start="0"/&gt;
    &lt;Float64 name="inertia1.phi" valueReference="805306368"
      description="Absolute rotation angle of component" causality="output"
      declaredType="Modelica.SIunits.Angle"/&gt;
    &lt;Float64 name="inertia1.w" valueReference="805306369"
      description="Absolute angular velocity of component (= der(phi))" causality="output"
      declaredType="Modelica.SIunits.AngularVelocity"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Outputs&gt;
      &lt;Unknown valueReference="805306368"/&gt;
      &lt;Unknown valueReference="805306369"/&gt;
    &lt;/Outputs&gt;
    &lt;InitialUnknowns&gt;
      &lt;Unknown valueReference="805306368"/&gt;
      &lt;Unknown valueReference="805306369"/&gt;
    &lt;/InitialUnknowns&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fmi-for-co-simulation">4. FMI for Co‑Simulation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the Functional Mock-up Interface (FMI) for the coupling of two or more simulation models in a co-simulation environment (FMI for Co-Simulation).
Co-simulation is a rather general approach to the simulation of coupled technical systems and coupled physical phenomena in engineering with focus on instationary (time-dependent) problems.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation is designed both for coupling with subsystem models, which have been exported by their simulators together with its solvers as runnable code (<a href="#figure-co-simulation-with-generated-code">Figure 7</a>), and for coupling of simulation tools (simulator coupling, tool coupling (<a href="#figure-co-simulation-with-tool-coupling">Figure 8</a> <a href="#figure-co-simulation-with-generated-code">Figure 7</a>)).</p>
</div>
<div id="figure-co-simulation-with-generated-code" class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-single-slave.svg" alt="co simulation single slave" width="50%">
</div>
<div class="title">Figure 7. Co-simulation with generated code on a single computer (for simplicity shown for one slave only).</div>
</div>
<div id="figure-co-simulation-with-tool-coupling" class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-tool-coupling.svg" alt="co simulation tool coupling" width="70%">
</div>
<div class="title">Figure 8. Co-simulation with tool coupling on a single computer (for simplicity shown for one slave only).</div>
</div>
<div class="paragraph">
<p>In the tool coupling case the FMU implementation wraps the FMI function calls to API calls which are provided by the simulation tool (for example, a COM or CORBA API).
Additionally to the FMU the simulation tool is needed to run a co-simulation.</p>
</div>
<div class="paragraph">
<p>In its most general form, a tool coupling based co-simulation is implemented on distributed hardware with subsystems being handled by different computers with different OS (cluster computer, computer farm, computers at different locations).
The data exchange and communication between the subsystems is typically done using one of the network communication technologies (for example, MPI, TCP/IP).
The definition of this communication layer is not part of the FMI standard.
However, distributed co-simulation scenarios can be implemented using FMI as shown in <a href="#figure-distributed-co-simulation">Figure 9</a>.</p>
</div>
<div id="figure-distributed-co-simulation" class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-distributed-infrastructure.svg" alt="co simulation distributed infrastructure" width="90%">
</div>
<div class="title">Figure 9. Distributed co-simulation infrastructure (for simplicity shown for one slave only).</div>
</div>
<div class="paragraph">
<p>The master has to implement the communication layer.
Additional parameters for establishing the network communication (for example, identification of the remote computer, port numbers, user account) are to be set via the GUI of the master.
These data are not transferred via the FMI API.</p>
</div>
<div class="sect2">
<h3 id="math-co-simulation">4.1. Mathematical Description</h3>
<div class="sect3">
<h4 id="_basics">4.1.1. Basics</h4>
<div class="paragraph">
<p>Co-simulation exploits the modular structure of coupled problems in all stages of the simulation process beginning with the separate model setup and preprocessing for the individual <em>subsystems</em> in different <em>simulation tools</em> (which can be powerful simulators as well as simple C programs).
During time integration, the simulation is again performed independently for all subsystems restricting the data exchange between subsystems to discrete <em>communication points</em> \(tc_i\).
For simulator coupling, also the visualization and post-processing of simulation data is done individually for each subsystem in its own native simulation tool.
In different contexts, the communication points \(tc_i\), the <em>communication steps</em> \(tc_i \rightarrow tc_{i+1}\) and the <em>communication step sizes</em> \(hc_i := tc_{i+1} - tc_i\) are also known as sampling points (synchronization points), macro steps and sampling rates, respectively.
The term "communication point" in FMI for Co-Simulation refers to the communication between subsystems in a co-simulation environment and should not be mixed with the output points for saving simulation results to file.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation provides an interface standard for the solution of time dependent <em>coupled systems</em> consisting of subsystems that are continuous in time (model components that are described by instationary differential equations) or time-discrete (model components that are described by difference equations such as discrete controllers).
In a block representation of the coupled system, the subsystems are represented by blocks with (internal) <em>state variables</em> \(x(t)\) that are connected to other subsystems (blocks) of the coupled problem by <em>subsystem inputs</em> \(u(t)\) and <em>subsystem outputs</em>  \(y(t)\).
In this framework, the physical connections between subsystems are represented by mathematical coupling conditions between the inputs \(u(t)\) and the outputs \(y(t)\) of all subsystems, <em>Kübler and Schiehlen (2000)</em>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-data-flow.svg" alt="co simulation data flow" width="80%">
</div>
<div class="title">Figure 10. Data flow at communication points.</div>
</div>
<div class="paragraph">
<p>For co-simulation two basic groups of functions have to be realized:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>functions for the data exchange between subsystems</p>
</li>
<li>
<p>functions for algorithmic issues to synchronize the simulation of <em>all</em> subsystems and to proceed in communication steps \(tc_i \rightarrow tc_{i+1}\) from initial time \(tc_0 := t_{start}\) to end time \(tc_N := t_{stop}\)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In FMI for Co-Simulation, both functions are implemented in one software component, the co-simulation <em>master</em>.
The data exchange between the subsystems (<em>slaves</em>) is handled via the master only.
There is no direct communication between the slaves.
The master functionality can be implemented by a special software tool (a separate simulation backplane) or by one of the involved simulation tools.
In its most general form, the coupled system may be simulated in <em>nested</em> co-simulation environments and FMI for Co-Simulation applies to each level of the hierarchy.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation defines interface routines for the communication between the master and all slaves (subsystems) in a co-simulation environment.
The most common master algorithm stops at each communication point \(tc_i\) the simulation (time integration) of all slaves, collects the outputs \(y(tc_i)\) from all subsystems, evaluates the subsystem inputs \(u(tc_i)\), distributes these subsystem inputs to the slaves and continues the (co-)simulation with the next communication step \(tc_i \rightarrow tc_{i+1} = tc_i + hc\) with fixed communication step size \(hc\).
In each slave, an appropriate solver is used to integrate one of the subsystems for a given communication step \(tc_i \rightarrow tc_{i+1}\).
The most simple co-simulation algorithms approximate the (unknown) subsystem inputs \(u(t), (t &gt; tc_i))\) by frozen data \(u(tc_i)\) for \(tc_i \leq t &lt; tc_{i+1}\).
FMI for Co-Simulation supports this classical brute force approach as well as more sophisticated master algorithms.
FMI for Co-Simulation is designed to support a very general class of master algorithms but it does <em>not</em> define the master algorithm itself.</p>
</div>
<div class="paragraph">
<p>The ability of slaves to support more sophisticated master algorithms is characterized by a set of <em>capability flags</em> inside the XML description of the slave (see <a href="#CoSimulation">Section 4.3.1</a>).
Typical examples are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the ability to handle variable communication step sizes \(hc_i\),</p>
</li>
<li>
<p>the ability to repeat a rejected communication step \(tc_i \rightarrow tc_{i+1}\) with reduced communication step size,</p>
</li>
<li>
<p>the ability to provide derivatives w.r.t. time of outputs to allow interpolation (<a href="#transfer-of-input-output-and-parameters">Section 4.2.1</a>),</p>
</li>
<li>
<p>or the ability to provide Jacobians.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation is restricted to slaves with the following properties:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All calculated values are time dependent functions within an a priori defined time interval \(t_{start} \leq t \leq t_{stop}\) (provided <code>stopTimeDefined = fmi3True</code> when calling <code>fmi3SetupExperiment</code>).</p>
</li>
<li>
<p>All calculations (simulations) are carried out with increasing time in general.
The current time \(t\) is running step by step from \(t_{start}\) to \(t_{stop}\).
The algorithm of the slave may have the property to be able to repeat the simulation of parts of \([t_{start}, t_{stop}\)] or the whole time interval \([t_{start}, t_{stop}\)].</p>
</li>
<li>
<p>The slave can be given a time value \(tc_i, t_{start} \leq tc_i \leq t_{stop}\).</p>
</li>
<li>
<p>The slave is able to interrupt the simulation when \(tc_i\) is reached.</p>
</li>
<li>
<p>During the interrupted simulation the slave (and its individual solver) can receive values for inputs \(u(tc_i)\) and send values of outputs \(y(tc_i)\).</p>
</li>
<li>
<p>Whenever the simulation in a slave is interrupted, a new time value \(tc_{i+1}, tc_i \leq tc_{i+1} \leq t_{stop}\), can be given to simulate the time subinterval \(tc_i &lt; t \leq tc_{i+1}\)</p>
</li>
<li>
<p>The subinterval length \(hc_i\) is the communication step size of the \(i^{th}\) communication step, \(hc_i = tc_{i+1} - tc_i\).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The communication step size has to be greater than zero.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation allows a co-simulation flow which starts with instantiation and initialization (all slaves are prepared for computation, the communication links are established), followed by simulation (the slaves are forced to simulate a communication step), and finishes with shutdown.
The details of the flow are given in the state machine of the calling sequences from master to slave (see <a href="#state-machine-co-simulation">Section 4.2.4</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_mathematical_model">4.1.2. Mathematical Model</h4>
<div class="paragraph">
<p>This section contains a formal mathematical model of a Co-Simulation FMU.
The following fundamental assumptions are made:</p>
</div>
<div class="paragraph">
<p>The slave simulators are seen by the master simulator as purely sampled-data systems.
Such a sampled-data system can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A "real" sampled-data system (so a sampled discrete controller; the inputs and outputs can be of type Real, Integer, Boolean, String, or enumeration.
Variables of this type are defined with <code>variability = "discrete"</code>; the smallest sample period as accessible by the outside of the FMU is defined by attribute <code>stepSize</code> in element <code>DefaultExperiment</code>).</p>
</li>
<li>
<p>A hybrid ODE that is integrated between communication points (known as "sampled access to time continuous systems") where internal events may occur and be handled, but events are not visible from the outside of the FMU.
It is assumed here that all inputs and all outputs of this hybrid ODE are Real signals (defined with <code>variability = "continuous"</code>),</p>
</li>
<li>
<p>A combination of the systems above.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The communication between the master and a slave takes only place at a discrete set of time instants, called <em>communication points</em>.</p>
</div>
<div class="paragraph">
<p>An FMI Co-Simulation model is described by the following variables:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><em>Variable</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Independent variable time \(\in \mathbb{R}\).
(Variable defined with <code>causality = "independent"</code>).<br>
The i-th communication point is denoted as \(t = tc_i\)<br>
The communication step size is denoted as \(hc_i = tc_{i+1} - tc_i\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{v}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of all exposed variables (all variables defined in element <code>&lt;ModelVariables&gt;</code>, see <a href="#definition-of-model-variables">Section 2.2.7</a>).
A subset of the variables is selected via a subscript.
Example:<br>
\(\mathbf{v}_{initial=exact}\) are variables defined with attribute <code>initial = "exact"</code>, see <a href="#definition-of-model-variables">Section 2.2.7</a>.
These are independent parameters and start values of other variables, such as initial values for states, state derivatives or outputs.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{p}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters that are constant during simulation.
The symbol without a subscript references independent parameters (variables with <code>causality = "parameter"</code>).
Dependent parameters (variables with <code>causality = "calculatedParameter"</code>) are denoted as \(\mathbf{p}_{calculated}\) and tunable parameters (variables with <code>causality = "parameter"</code> and <code>variability = "tunable"</code>) are denoted as \(\mathbf{p}_{tune}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{u}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input variables.
The values of these variables are defined outside of the model.
Variables of this type are defined with attribute <code>causality = "input"</code>.
Whether the input is a discrete-time or continuous-time variable is defined via attribute <code>variability = "discrete"</code> or <code>"continuous"</code> (see <a href="#definition-of-model-variables">Section 2.2.7</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{y}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output variables.
The values of these variables are computed in the FMU and they are designed to be used in a model connection.
So output variables might be used in the environment as input values to other FMUs or other submodels.
Variables of this type are defined with attribute <code>causality = "output"</code>.
Via attribute <code>variability = "discrete"</code> or <code>"continuous"</code> it is defined whether the output is a discrete-time or continuous-time variable, see <a href="#definition-of-model-variables">Section 2.2.7</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{w}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local variables of the FMU that cannot be used for FMU connections.
Variables of this type are defined with attribute <code>causality = "local"</code> (see <a href="#definition-of-model-variables">Section 2.2.7</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_c(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of real continuous-time variables representing the continuous-time states.
For notational convenience, a continuous-time state is conceptually treated as a different type of variable as an output or a local variable for the mathematical description below.
However, at a communication point, a continuous-time state is part of the outputs or the local variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\)<br>
\(^{\bullet}\mathbf{x}_d(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\) is a vector of (internal) discrete-time variables (of any type) representing the (internal) discrete states.<br>
\(^{\bullet}\mathbf{x}_d(t)\) is the value of \(\mathbf{x}_d(t)\) at the previous sample time instant, so \(^{\bullet}\mathbf{x}_d(t) = \mathbf{x}_d(^{\bullet}t)\).<br>
Given the previous values of the discrete-time states, \(^{\bullet}\mathbf{x}_d(t)\), at the actual time instant \(t\), all other discrete-time variables, especially the discrete states \(\mathbf{x}_d(t)\), can be computed.<br>
Discrete states are not visible in the interface of an FMU and are only introduced here to clarify the mathematical description.
Formally, a discrete state is part of the outputs \(\mathbf{y}\) or the local variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the transient simulation of the coupled system through co-simulation is completed, the sequence of evaluations is the following (here \(\mathbf{x} = {\lbrack \mathbf{x}_c; \mathbf{x}_d \rbrack}^T\) is the combined vector of continuous-time and discrete-time states, and \(\mathbf{y} = {\lbrack \mathbf{y}_c; \mathbf{y}_d \rbrack}^T\)) is the combined vector of continuous-time and discrete-time outputs):</p>
</div>
<div class="stemblock">
<div class="title">(4.1)</div>
<div class="content">
\[\mathrm{\text{for}}\ i = 0, \cdots, n-1

\begin{Bmatrix}

\mathbf{x}_{i+1} = \Phi_i \left( \mathbf{x}_i \left\{ \mathbf{u}_i^{(j)} \right\}_{j=0,\cdots,m_{ido}}, \mathbf{p}_{tune,i}, hc_i  \right)

\\

\left( \left\{ \mathbf{y}^{(j)}_{i+1} \right\}_{j=0,\cdots,m_{odo}}, \mathbf{w}_{i+1}\right) = \Gamma_i \left( \mathbf{x}_i, \left\{ \mathbf{u}^{(j)}_i \right\}_{j=0,\cdots,m_{ido}}, \mathbf{p}_{tune}, hc_i \right)

\end{Bmatrix}\]
</div>
</div>
<div class="paragraph">
<p>where \(\mathbf{\Phi}_i\) and \(\mathbf{\Gamma}_i\) define the system behavior for the time interval \(tc_i \leq t &lt; tc_{i+1}\),
with \(tc_i = tc_0 + \sum_{k=0}^{i-1}hc_k\).</p>
</div>
<div class="paragraph">
<p><em>[For the part of the co-simulation slave that is based on an ODE, a differential equation is solved between communication points:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\dot{\mathbf{x}}_c = \mathbf{\varphi} \left( \mathbf{x}_c(t), \mathbf{u}_c(t),
\mathbf{p}_{tune} \right)\]
</div>
</div>
<div class="paragraph">
<p><em>In this case, the following relationship should hold (note the use of</em> \(\mathbf{x}_{i+1}\) <em>here):</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\frac{\partial\mathbf{\Phi_i}}{\partial hc_i}
=
\boldsymbol{\varphi} \left( \mathbf{x}_{c,i+1},
\sum^{m_{ido}}_{j=0} \mathbf{u}^{(j)}_{c,i} \frac{hc^j_i}{j!},
\mathbf{p}_{tune,i}  \right)\]
</div>
</div>
<div class="paragraph">
<p><em>This relation is in practice inexact due to using finite precision on machines and stopping iterations early.
The slave simulators are responsible for implementing</em> \(\mathbf{\Phi}_i\) <em>and</em> \(\mathbf{\Gamma}_i\) <em>; for example, to handle stiff differential equations as:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{\Phi}_i \left( \mathbf{x}_{c,i}, \left\{ \mathbf{u}_{c,i}^{(j)} \right\}_{= 0,\cdots,m_{ido}},\ \mathbf{p}_{tune,i}, tc_i \right)
=
\mathbf{x}_{ci} + \left( \mathbf{I} -
hc_i \frac{\partial \mathbf{\varphi}}{\partial \mathbf{x}_c} \right)^{- 1}  hc_i \mathbf{\phi} \left( \mathbf{x}_{c,i}, \mathbf{u}_{c,i}, \mathbf{p}_{tune,i} \right) +
O(hc_i^{2}).\]
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>Definition (4.1) is consistent with the definition of co-simulation by (Kübler, Schiehlen 2000).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At the communication points, the master provides generalized inputs to the slave, which can be:</p>
<div class="ulist">
<ul>
<li>
<p>The current input variables \(\mathbf{u}_i^{(0)}\) of the subsystem (in other words, the input variables of the model contained in the slave simulator, in the sense of system-level simulation), along with some of their successive derivatives \(\left\{ \mathbf{u}_i^{(j)} \right\}_{j=1,\cdots,m_{ido}}\) (in case of continuous-time variables).</p>
</li>
<li>
<p>Varying parameters \(\mathbf{p}_{tune,i}\), also known as tunable parameters.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The slave provides generalized outputs to the master, which are:</p>
<div class="ulist">
<ul>
<li>
<p>The current output variables \(\mathbf{y}_{i+1}^{(0)}\)of the subsystem (same remark as above), along with some of their successive derivatives \(\left\{ \mathbf{y}_{i+1}^{(j)} \right\}_{j=1,\cdots,m_{odo}}\)(in case of continuous-time variables).</p>
</li>
<li>
<p>Observation variables and "calculated" varying parameters \(\mathbf{w}_{i+1}\), along with directional derivatives estimated at \(t = tc_{i+1}\) (in case of continuous-time variables).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Initialization: The slave being a sampled-data system, its internal states (which can be either continuous-time or discrete-time) need to be initialized at \(t = tc_0\).
This is performed through an auxiliary function <em>[this relationship is defined in the XML file under <code>&lt;ModelStructure&gt;&lt;InitialUnknowns&gt;</code>]</em>:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Computing the solution of an FMI Co-Simulation model means to split the solution process in two phases and in every phase different equations
and solution methods are utilized.
The phases can be categorized according to the following modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Initialization Mode</dt>
<dd>
<p>This mode is used to compute at the start time \(t_0\) initial values for internal variables of the Co-Simulation slave, especially for continuous-time states, \(\mathbf{x}_d(t_0)\), and for the previous discrete-time states, \(^{\bullet}\mathbf{x}_d(t_0)\), by utilizing extra equations not present in the other mode <em>[for example, equations to set all derivatives to zero, that is, to initialize in steady-state]</em>.
If the slave is connected in loops with other models, iterations over the FMU equations are possible.
Algebraic equations are solved in this mode.</p>
</dd>
<dt class="hdlist1">Step Mode</dt>
<dd>
<p>This mode is used to compute the values of all (real) continuous-time and discrete-time variables at communication points by numerically solving ordinary differential, algebraic and discrete equations.
If the slave is connected in loops with other models, no iterations over the FMU equations are possible.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>[Note that for a Co-Simulation FMU, no super dense time description is used at communication points.]</em></p>
</div>
<div class="paragraph">
<p>The equations are defined in <a href="#table-math-co-simulation">Table 2</a> can be evaluated in the respective Mode.
The following color coding is used in the table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="silver"><strong>grey</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a variable in an argument list is marked in grey, then this variable is not changing in this mode and just the last calculated value from the previous mode is internally used.
For an input argument it is not allowed to call <code>fmi3SetXXX</code>.
For an output argument, calling <code>fmi3GetXXX</code> on such a variable returns always the same value in this mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime"><strong>green</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functions marked in <span class="lime">green</span> are special functions to enter or leave a mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue"><strong>blue</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equations and functions marked in <span class="blue">blue</span> define the actual computations to be performed in the respective mode.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Function <code>fmi3SetXXX</code> used in the table below, is an abbreviation for functions <code>fmi3SetReal</code>, <code>fmi3SetBoolean</code>, <code>fmi3SetInteger</code> and <code>fmi3SetString</code> respectively.
Function <code>fmi3GetXXX</code> is an abbreviation for functions <code>fmi3GetReal</code>, <code>fmi3GetBoolean</code>, <code>fmi3GetInteger</code> and <code>fmi3GetString</code> respectively.</p>
</div>
<table id="table-math-co-simulation" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Mathematical description of an FMU for Co-Simulation.</caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Equations</strong></th>
<th class="tableblock halign-left valign-top"><strong>FMI functions</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Equations before Initialization Mode</strong> ("instantiated" in state machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set and set start value of independent variable \(tc_{i=0}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetupExperiment</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables and that have a start value (<code>initial</code> = <code>"exact"</code> or <code>"approx"</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Equations during Initialization Mode</strong> ("InitializationMode" in state machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Initialization Mode at (activate initialization, discrete-time and continuous-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">fmi3EnterInitializationMode</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(v_{initial=exact}\) and \(v_{initial=approx}\) that have a start value with <code>initial</code> = <code>"exact"</code> (independent parameters \(\mathbf{p}\) and continuous-time states with start values \(\mathbf{x}_{c,initial=exact}\) are included here)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time inputs \(\mathbf{u}_{c+d}(tc_0)\) and optionally the derivatives of continuous-time inputs \(\mathbf{u}_{c}^{(j)}(tc_0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code><br>
<code>fmi3SetRealInputDerivatives</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\(\mathbf{v}_{InitialUnknowns} := \mathbf{f}_{init}(\mathbf{u}_c, \mathbf{u}_d, t_0, \mathbf{v}_{initial=exact})\)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi3GetXXX</span></code><br>
<code><span class="blue">fmi3GetDirectionalDerivative</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Exit Initialization Mode (de-activate initialization equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">fmi3ExitInitializationMode</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Equations during Step Mode</strong> ("stepComplete", "stepInProgress" in state machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent tunable parameters \(\mathbf{p}_{tune}\) (and do not set other parameters \(\mathbf{p}_{other}\))</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time inputs \(\mathbf{u}_{d+c}(tc_i)\) and optionally the derivatives of continuous-time inputs \(\mathbf{u}_{c}^{(j)}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi3SetXXX</code><br>
<code>fmi3SetRealInputDerivatives</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\(\begin{matrix} tc_{i+1} := tc_i + hc_i \\ (\mathbf{y}_{c+d}, \mathbf{y}_c^{(j)}, \mathbf{w}_{c+d}) := \mathbf{f}_{doStep}(\mathbf{u}_{c+d}, \mathbf{u}_{c}^{(j)}, tc_i, hc_i, \mathbf{p}_{tune}, \mathbf{p}_{other})_{tc_i} \\ tc_i := tc_{i+1} \end{matrix}\)</span><br>
<span class="blue">\(\mathbf{f}_{doStep}\) is also a function of the internal variables \(\mathbf{x}_c\), \(^{\bullet}\mathbf{x}_d\)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi3DoStep</span></code><br>
<code>fmi3GetXXX</code><br>
<code><span class="blue">fmi3GetRealOutputDerivatives</span></code><br>
<code><span class="blue">fmi3GetDirectionalDerivative</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Data types</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">\(t, tc, hc \in \mathbb{R}, \mathbf{p} \in \mathbb{P}^{np}, \mathbf{u}(tc) \in \mathbb{P}^{nu}, \mathbf{y}(tc) \in \mathbb{P}^{ny}, \mathbf{x}_c(t) \in \mathbb{R}^{nxc}, \mathbf{x}_d(t) \in \mathbb{P}^{nxd}, \mathbf{w}(tc) \in \mathbb{P}^{nw}\)<br>
\(\mathbb{R}\): Real variable, \(\mathbb{R}\): real <strong>or</strong> boolean <strong>or</strong> integer <strong>or</strong> enumeration <strong>or</strong> string variable<br>
\(\mathbf{f}_{init}, \mathbf{f}_{out} \in C^0\) (=continuous functions with respect to all input arguments inside the respective mode).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Remark - Calling Sequences:</em></p>
</div>
<div class="paragraph">
<p><em>In the table above, for notational convenience in Initialization Mode one function call is defined to compute all output arguments from all inputs arguments.
In reality, every scalar output argument is computed by one</em> <code>fmi3GetXXX</code> <em>function call.</em></p>
</div>
<div class="paragraph">
<p><em>In</em> <em>Step Mode the input arguments to</em> \(\mathbf{f}_{doStep}\) <em>are defined by calls to</em> <code>fmi3SetXXX</code> <em>and</em> <code>fmi3SetRealInputDerivatives</code> <em>functions.
The variables computed by</em> \(\mathbf{f}_{doStep}\) <em>can be inquired by</em>  <code>fmi3GetXXX</code> <em>function calls.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fmi_application_programming_interface_3">4.2. FMI Application Programming Interface</h3>
<div class="paragraph">
<p>This section contains the interface description to access the in/output data and status information of a co-simulation slave from a C program.</p>
</div>
<div class="sect3">
<h4 id="transfer-of-input-output-and-parameters">4.2.1. Transfer of Input / Output Values and Parameters</h4>
<div class="paragraph">
<p>Input and output variables and variables are transferred via the <code>fmi3GetXXX</code> and <code>fmi3SetXXX</code> functions, defined in <a href="#get-and-set-variable-values">Section 2.1.7</a>.</p>
</div>
<div class="paragraph">
<p>In order to enable the slave to interpolate the continuous real inputs between communication steps, the derivatives of the inputs with respect to time can be provided.
Also, higher derivatives can be set to allow higher order interpolation.
Whether a slave is able to interpolate and therefore needs this information is provided by the capability attribute <code>canInterpolateInputs</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3SetInputDerivativesTYPE(fmi3Component c,
                                               const fmi3ValueReference vr[],
                                               size_t nvr,
                                               const fmi3Int32 order[],
                                               const fmi3Float64 value[],
                                               size_t nValues);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sets the n-th time derivative of real input variables.
Argument <code>vr</code> is a vector of value references that define the variables whose derivatives shall be set.
The array <code>order</code> contains the orders of the respective derivative (1 means the first derivative, 0 is not allowed).
Argument "value" is a vector with the values of the derivatives.
<code>nvr</code> is the dimension of the vectors.<br>
Restrictions on using the function are the same as for the <code>fmi3SetReal</code> function.</p>
</div>
<div class="paragraph">
<p>Inputs and their derivatives are set with respect to the beginning of a communication time step.</p>
</div>
<div class="paragraph">
<p>To allow interpolation/approximation of the real output variables between communication steps (if they are used as inputs for other slaves), the derivatives of the outputs with respect to time can be read.
Whether the slave is able to provide the derivatives of outputs is given by the unsigned integer capability flag <code>MaxOutputDerivativeOrder</code>.
It delivers the maximum order of the output derivative.
If the actual order is lower (because the order of integration algorithm is low), the retrieved value is 0.</p>
</div>
<div class="paragraph">
<p><em>[Example: If the internal polynomial is of order 1 and the master inquires the second derivative of an output, the slave will return zero.]</em></p>
</div>
<div class="paragraph">
<p>The derivatives can be retrieved by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetOutputDerivativesTYPE(fmi3Component c,
                                                const fmi3ValueReference vr[],
                                                size_t nvr,
                                                const fmi3Int32 order[],
                                                fmi3Float64 value[],
                                                size_t nValues);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Retrieves the n-th derivative of output values.
Argument <code>vr</code> is a vector of <code>nvr</code> value references that define the variables whose derivatives shall be retrieved.
The array <code>order</code> contains the order of the respective derivative (1 means the first derivative, 0 is not allowed).
Argument <code>value</code> is a vector with the actual values of the derivatives.<br>
Restrictions on using the function are the same as for the <code>fmi3GetReal</code> function.</p>
</div>
<div class="paragraph">
<p>The returned outputs correspond to the current slave time.
E.g. after a successful <code>fmi3DoStep(&#8230;&#8203;)</code> the returned values are related to the end of the communication time step.</p>
</div>
<div class="paragraph">
<p>This standard supports polynomial interpolation and extrapolation as well as more sophisticated signal extrapolation schemes like rational extrapolation, see the companion document "FunctionalMockupInterface-ImplementationHints.pdf".</p>
</div>
</div>
<div class="sect3">
<h4 id="_computation">4.2.2. Computation</h4>
<div class="paragraph">
<p>The computation of time steps is controlled by the following function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3DoStepTYPE(fmi3Component c,
                                  fmi3Float64 currentCommunicationPoint,
                                  fmi3Float64 communicationStepSize,
                                  fmi3Boolean noSetFMUStatePriorToCurrentPoint);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The computation of a time step is started.<br>
Argument <code>currentCommunicationPoint</code> is the current communication point of the master (\(tc_i\)) and argument <code>communicationStepSize</code> is the communication step size (\(hc_i\)).
The latter must be \(&gt; 0.0\).
The slave must integrate until time instant \(tc_{i+1} = tc_i + hc_i\).
<em>[The calling environment defines the communication points and <code>fmi3DoStep</code> must synchronize to these points by always integrating exactly to \(tc_i + hc_i\).
It is up to <code>fmi3DoStep</code> how to achieve this.]</em>
At the first call to <code>fmi3DoStep</code> after <code>fmi3ExitInitializationMode</code> was called <code>currentCommunicationPoint</code> must be equal to <code>startTime</code> as set with <code>fmi3SetupExperiment</code>.
<em>[Formally, argument <code>currentCommunicationPoint</code> is not needed.
It is present in order to handle a mismatch between the master and the FMU state of the slave: The <code>currentCommunicationPoint</code> and the FMU state of the slaves defined by former</em> <code>fmi3DoStep</code> <em>or</em> <code>fmi3SetFMUState</code> <em>calls have to be consistent with respect to each other.
For example, if the slave does not use the update formula for the independent variable as required above,</em> \(tc_{i+1} = tc_i + hc_i\) <em>(using argument</em> \(tc_i\) = <code>currentCommunicationPoint</code> <em>of</em> <code>fmi3DoStep</code>) <em>but uses internally an own update formula, such as</em> \(tc_{s,i+1} = tc_{s,i} + hc_{s,i}\) <em>then the slave could use as time increment</em> \(\text{hc}_{s,i} := (tc_i - tc_{s,i}) + hc_i\) <em>(instead of</em> \(\text{hc}_{s,i} := hc_i\) <em>) to avoid a mismatch between the master time</em> \(tc_{i+1}\) <em>and the slave internal time</em> \(tc_{s,i+1}\) <em>for large i.]</em></p>
</div>
<div class="paragraph">
<p>Argument <code>noSetFMUStatePriorToCurrentPoint</code> is <code>fmi3True</code> if <code>fmi3SetFMUState</code> will no longer be called for time instants prior to <code>currentCommunicationPoint</code> in this simulation run <em>[the slave can use this flag to flush a result buffer]</em>.</p>
</div>
<div class="paragraph">
<p>The function returns:<br>
<code>fmi3OK</code> - if the communication step was computed successfully until its end.<br>
<code>fmi3Discard</code> - if the slave computed successfully only a subinterval of the communication step.
The master can call the appropriate <code>fmi3GetXXXStatus</code> functions to get further information.
If possible, the master should retry the simulation with a shorter communication step size.
<em>[Redoing a step is only possible if the FMU state has been recorded at the beginning of the current (failed) step with <code>fmi3GetFMUState</code>.
Redoing a step is performed by calling <code>fmi3SetFMUState</code> and afterwards calling <code>fmi3DoStep</code> with the new communicationStepSize.
Note that it is not possible to change <code>currentCommunicationPoint</code> in such a call.]</em><br>
<code>fmi3Error</code> - the communication step could not be carried out at all.
The master can try to repeat the step with other input values and/or a different communication step size in the same way as described in the <code>fmi3Discard</code> case above.<br>
<code>fmi3Fatal</code> - if an error occurred which corrupted the FMU irreparably.
<em>[The master should stop the simulation run immediatlely.]</em> See <a href="#status-returned-by-functions">Section 2.1.3</a> for details.<br>
<code>fmi3Pending</code> - this status is returned if the slave executes the function asynchronously.
That means the slave starts the computation but returns immediately.
The master has to call <code>fmi3GetDoStepPendingStatus</code> to find out if the slave is done.
An alternative is to wait until the callback function <code>fmi3StepFinished</code> is called by the slave.
<code>fmi3CancelStep</code> can be called to cancel the current computation.
It is not allowed to call any other function during a pending <code>fmi3DoStep</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3CancelStepTYPE(fmi3Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be called if <code>fmi3DoStep</code> returned <code>fmi3Pending</code> in order to stop the current asynchronous execution.
The master calls this function if, for example, the co-simulation run is stopped by the user or one of the slaves.
Afterwards only calls to <code>fmi3Reset</code>, <code>fmi3FreeInstance</code>, or <code>fmi3SetFMUstate</code> are valid to exit the <strong>step Canceled</strong> state.
Refer to <a href="#state-machine-co-simulation">Section 4.2.4</a> for all other valid functions in this state.</p>
</div>
<div class="paragraph">
<p>It depends on the capabilities of the slave which parameter constellations and calling sequences are allowed (see <a href="#CoSimulation">Section 4.3.1</a>)</p>
</div>
</div>
<div class="sect3">
<h4 id="retrieving-status-from-slave">4.2.3. Retrieving Status Information from the Slave</h4>
<div class="paragraph">
<p>Status information is retrieved from the slave by the following functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetDoStepPendingStatusTYPE(fmi3Component c,
                                                  fmi3Status* status,
                                                  fmi3String* message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be called when the <code>fmi3DoStep</code> function returned <code>fmi3Pending</code>.
<code>status</code> is the result of the asynchronously executed <code>fmi3DoStep</code> call or <code>fmi3Pending</code> if the computation is not finished.
<code>message</code> is a pointer to string which informs about the status of the currently running asynchronous <code>fmi3DoStep</code> computation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef fmi3Status fmi3GetDoStepDiscardedStatusTYPE(fmi3Component c,
                                                    fmi3Boolean* terminate,
                                                    fmi3Float64* lastSuccessfulTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be called after <code>fmi3DoStep</code> returned <code>fmi3Discard</code>.
<code>terminate</code> is true if the slave wants to terminate the simulation.
<code>lastSuccessfulTime</code> is the time instant at which the slave stopped the <code>fmi3DoStep</code> call.</p>
</div>
</div>
<div class="sect3">
<h4 id="state-machine-co-simulation">4.2.4. State Machine of Calling Sequence from Master to Slave</h4>
<div class="paragraph">
<p>The following state machine defines the supported calling sequences.</p>
</div>
<div class="paragraph">
<div class="title">Calling sequence of Co-Simulation C functions in form of an UML 2.0 state machine.</div>
<p><span class="image"><img src="images/figure11.png" alt="figure11"></span></p>
</div>
<div class="paragraph">
<p>Each state of the state machine corresponds to a certain phase of a simulation as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">instantiated</dt>
<dd>
<p>In this state, start and guess values (= variables that have <code>initial</code> = <code>"exact"</code> or <code>"approx"</code>) can be set.</p>
</dd>
<dt class="hdlist1">Initialization Mode</dt>
<dd>
<p>In this state, equations are active to determine all outputs (and optionally other variables exposed by the exporting tool).
The variables that can be retrieved by <code>fmi3GetXXX</code> calls are (1) defined in the XML file under <code>&lt;ModelStructure&gt;&lt;InitialUnknowns&gt;</code>, and (2) variables with <code>causality</code> = <code>"output"</code>.
Variables with <code>initial</code> = <code>"exact"</code>, as well as variables with <code>variability</code> = <code>"input"</code> can be set.</p>
</dd>
<dt class="hdlist1">slaveInitialized</dt>
<dd>
<p>In this state, the slave is initialized and the co-simulation computation is performed. The calculation until the next communication point is performed with function <code>fmi3DoStep</code>. Depending on the return value, the slave is in a different state (<strong>step Complete</strong>, <strong>step Failed</strong>, <strong>step Canceled</strong>).</p>
</dd>
<dt class="hdlist1">terminated</dt>
<dd>
<p>In this state, the solution at the final time of the simulation can be retrieved.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that in <strong>Initialization Mode</strong> input variables can be set with <code>fmi3SetXXX</code> and output variables can be retrieved with <code>fmi3GetXXX</code> interchangeably according to the model structure defined under element <code>&lt;ModelStructure&gt;&lt;InitialUnknowns&gt;</code> in the XML file.
<em>[For example, if one output <code>y1</code> depends on two inputs <code>u1</code>, <code>u2</code>, then these two inputs must be set, before <code>y1</code> can be retrieved.
If additionally an output <code>y2</code> depends on an input <code>u3</code>, then <code>u3</code> can be set and <code>y2</code> can be retrieved afterwards.
As a result, artificial or "real" algebraic loops over connected FMUs in <strong>Initialization Mode</strong> can be handled by using appropriate numerical algorithms.]</em></p>
</div>
<div class="paragraph">
<p>There is the additional restriction in <strong>slaveInitialized</strong> state that it is not allowed to call <code>fmi3GetXXX</code> functions after <code>fmi3SetXXX</code> functions without an <code>fmi3DoStep</code> call in between.</p>
</div>
<div class="paragraph">
<p>_[The reason is to avoid different interpretations of the caching, since contrary to FMI for Model Exchange, <code>fmi3DoStep</code> will perform the actual calculation instead of <code>fmi3GetXXX</code>, and therefore, dummy algebraic loops at communication points cannot be handeled by an appropriate sequence of <code>fmi3GetXXX</code> and, <code>fmi3SetXXX</code> calls as for ModelExchange.</p>
</div>
<div class="paragraph">
<p>Examples:_</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Correct calling sequence</em></th>
<th class="tableblock halign-left valign-top"><em>Wrong calling sequence</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi3SetXXX on inputs</em><br>
<em>fmi3DoStep</em><br>
<em>fmi3GetXXX on outputs</em><br>
<em>fmi3SetXXX on inputs</em><br>
<em>fmi3DoStep</em><br>
<em>fmi3GetXXX on outputs</em><br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi3SetXXX on inputs</em><br>
<em>fmi3DoStep</em><br>
<em>fmi3GetXXX on outputs</em><br>
<em>fmi3SetXXX on inputs</em><br>
<em>fmi3GetXXX on outputs // not allowed</em><br>
<em>fmi3DoStep</em><br>
<em>fmi3GetXXX on outputs</em><br></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>The allowed function calls in the respective states are summarized in the following table (functions marked in <span class="yellow-background">"yellow"</span> are only available for "Co-Simulation", the other functions are available both for "Model Exchange" and "Co-Simulation"):</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-bottom" rowspan="2"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="10"><p class="tableblock"><strong>FMI 2.0 for Co-Simulation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">start, end</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">instantiated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Initialization Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepComplete</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepInProgress</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepFailed</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepCanceled</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">terminated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">error</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">fatal</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetDebugLogging</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3Instantiate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3FreeInstance</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetupExperiment</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3EnterInitializationMode</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3ExitInitializationMode</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3Terminate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3Reset</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SetFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3FreeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SerializedFMUstateSize</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3SerializeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3DeSerializeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi3GetDirectionalDerivative</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3SetRealInputDerivatives  </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3GetRealOutputDerivatives </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3DoStep                   </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3CancelStep               </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3GetDoStepPendingStatus   </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi3GetDoStepDiscardedStatus </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>x</strong> means: call is allowed in the corresponding state<br>
<strong>number</strong> means: call is allowed if the indicated condition holds:<br>
<strong>1</strong> for a variable with <code>variability = "constant"</code> that has <code>initial = "exact"</code> or <code>"approx"</code><br>
<strong>2</strong> for a variable with <code>causality = "output"</code> or continuous-time states or state derivatives
(if element <code>&lt;Derivatives&gt;</code> is present)<br>
<strong>3</strong> for a variable with <code>variability = "constant"</code> that has <code>initial = "exact"</code>,
or <code>causality</code> = <code>"input"</code><br>
<strong>6</strong> for a variable with <code>causality</code> = <code>"input"</code> or (<code>causality</code> = <code>"parameter"</code> and <code>variability</code> = <code>"tunable"</code>)<br>
<strong>7</strong> always, but retrieved values are usable for debugging only<br>
<strong>8</strong> always, but if status is other than <code>fmi3Terminated</code>,
retrieved values are useable for debugging only</p>
</div>
</div>
<div class="sect3">
<h4 id="_pseudo_code_example_2">4.2.5. Pseudo-code Example</h4>
<div class="paragraph">
<p>In the following example, the usage of the FMI functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
The example is given in a mix of pseudo-code and C, in order to keep it small and understandable.
We consider two slaves, where both have one continuous real input and one continuous real output which are connected in the following way:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/co-simulation-connection-of-slaves.svg" alt="co simulation connection of slaves" width="30%">
</div>
<div class="title">Figure 11. Connection graph of the slaves.</div>
</div>
<div class="paragraph">
<p>We assume no algebraic dependency between input and output of each slave.
The code demonstrates the simplest master algorithm as shown in <a href="#math-co-simulation">Section 4.1</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Constant communication step size.</p>
</li>
<li>
<p>No repeating of communication steps.</p>
</li>
<li>
<p>The slaves do not support asynchronous execution of <code>fmi3DoStep</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The error handling is implemented in a very rudimentary way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">//////////////////////////
//Initialization sub-phase
//Set callback functions,
fmi3CallbackFunctions cbf;
cbf.logger = loggerFunction;  //logger function
cbf.allocateMemory = calloc;
cbf.freeMemory = free;
cbf.stepFinished = NULL;      //synchronous execution
cbf.componentEnvironment = NULL;

//Instantiate both slaves
fmi3Component s1 = s1_fmi3Instantiate("Tool1" , fmi3CoSimulation, instantiationToken1, "",
                                    fmi3False, fmi3False, &amp;cbf, fmi3True);
fmi3Component s2 = s2_fmi3Instantiate("Tool2" , fmi3CoSimulation, instantiationToken2, "",
                                    fmi3False, fmi3False, &amp;cbf, fmi3True);

if ((s1 == NULL) || (s2 == NULL))
      return FAILURE;

// Start and stop time
startTime = 0;
stopTime = 10;

//communication step size
h = 0.01;

// set all variable start values (of "ScalarVariable / &lt;type&gt; / start")
s1_fmi3SetReal/Integer/Boolean/String(s1, ...);
s2_fmi3SetReal/Integer/Boolean/String(s2, ...);

//Initialize slaves
s1_fmi3SetupExperiment(s1, fmi3False, 0.0, startTime, fmi3True, stopTime);
s2_fmi3SetupExperiment(s1, fmi3False, 0.0, startTime, fmi3True, stopTime);
s1_fmi3EnterInitializationMode(s1);
s2_fmi3EnterInitializationMode(s2);

// set the input values at time = startTime
s1_fmi3SetReal/Integer/Boolean/String(s1, ...);
s2_fmi3SetReal/Integer/Boolean/String(s2, ...);
s1_fmi3ExitInitializationMode(s1);
s2_fmi3ExitInitializationMode(s2);

//////////////////////////
//Simulation sub-phase
tc = startTime; //Current master time

while ((tc &lt; stopTime) &amp;&amp; (status == fmi3OK))
{
    //retrieve outputs
    s1_fmi3GetReal(s1, ..., 1, &amp;y1);
    s2_fmi3GetReal(s2, ..., 1, &amp;y2);

    //set inputs
    s1_fmi3SetReal(s1, ..., 1, &amp;y2);
    s2_fmi3SetReal(s2, ..., 1, &amp;y1);

    //call slave s1 and check status
    status = s1_fmi3DoStep(s1, tc, h, fmi3True);
    switch (status) {
    case fmi3Discard:
      s1_fmi3GetDoStepDiscardedStatus(s1, &amp;boolVal, &amp;lastSuccessfulTime);
      if (boolVal == fmi3True)
            printf("Slave s1 wants to terminate simulation.");
    case fmi3Error:
    case fmi3Fatal:
      terminateSimulation = true;
      break;
    }
    if (terminateSimulation)
      break;

    //call slave s2 and check status as above
    status = s2_fmi3DoStep(s2, tc, h, fmi3True);
    ...

    //increment master time
    tc += h;
}

//////////////////////////
//Shutdown sub-phase
if ((status != fmi3Error) &amp;&amp; (status != fmi3Fatal))
{
    s1_fmi3Terminate(s1);
    s2_fmi3Terminate(s2);
}

if (status != fmi3Fatal)
{
    s1_fmi3FreeInstance(s1);
    s2_fmi3FreeInstance(s2);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fmi_description_schema_2">4.3. FMI Description Schema</h3>
<div class="paragraph">
<p>This is defined in <a href="#fmi-description-schema">Section 2.2</a>.
Additionally, the co-simulation specific element "Implementation" is defined in the next section.</p>
</div>
<div class="sect3">
<h4 id="CoSimulation">4.3.1. Co-Simulation FMU (CoSimulation)</h4>
<div class="paragraph">
<p>If the XML file defines an FMU for Co-Simulation, element "CoSimulation" must be present.
It is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cs_xml_1.png" alt="cs xml 1" width="80%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cs_xml_2.png" alt="cs xml 2" width="70%">
</div>
</div>
<div class="paragraph">
<p>These attributes have the following meaning (all attributes are optional with exception of <code>modelIdentifier</code>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelIdentifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short class name according to C syntax, for example, "A_B_C".
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries, but not if the functions are provided by a DLL/SharedObject.
<code>modelIdentifier</code> is also used as name of the static library or DLL/SharedObject.
See also <a href="#header-files-and-naming-of-functions">Section 2.1.1</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>needsExecutionTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, a tool is needed to execute the model.
The FMU just contains the communication to this tool (see <a href="#figure-co-simulation-with-tool-coupling">Figure 8</a>).
<em>[Typically, this information is only utilized for information purposes.
For example, a co-simulation master can inform the user that a tool has to be available on the computer where the slave is instantiated.
The name of the tool can be taken from attribute <code>generationTool</code> of <code>fmiModelDescription</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canHandleVariableCommunicationStepSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slave can handle variable communication step size.
The communication step size (parameter communicationStepSize of <code>fmi3DoStep</code>) has not to be constant for each call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canInterpolateInputs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slave is able to interpolate continuous inputs.
Calling of <code>fmi3SetRealInputDerivatives</code> has an effect for the slave.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxOutputDerivativeOrder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slave is able to provide derivatives of outputs with maximum order.
Calling of <code>fmi3GetRealOutputDerivatives</code> is allowed up to the order defined by <code>maxOutputDerivativeOrder</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canRunAsynchronuously</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This flag describes the ability to carry out the <code>fmi3DoStep</code> call asynchronously.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canBeInstantiatedOnlyOncePerProcess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This flag indicates cases (especially for embedded code), where only one instance per FMU is possible. (For multiple instantiation the default is <code>false</code>; if multiple instances are needed, the FMUs must be instantiated in different processes.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canNotUseMemoryManagementFunctions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the slave uses its own functions for memory allocation and freeing only.
The callback functions <code>allocateMemory</code> and <code>freeMemory</code> given in <code>fmi3Instantiate</code> are ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canGetAndSetFMUstate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the environment can inquire the internal FMU state and restore it.
That is, <code>fmi3GetFMUstate</code>, <code>fmi3SetFMUstate</code>, and <code>fmi3FreeFMUstate</code> are supported by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canSerializeFMUstate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the environment can serialize the internal FMU state, in other words, <code>fmi3SerializedFMUstateSize</code>, <code>fmi3SerializeFMUstate</code>, <code>fmi3DeSerializeFMUstate</code> are supported by the FMU.
If this is the case, then flag <code>canGetAndSetFMUstate</code> must be true as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesDirectionalDerivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the directional derivative of the equations at communication points can be computed with <code>fmi3GetDirectionalDerivative</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The flags have the following default values.<br>
boolean: false<br>
unsignedInt: 0<br></p>
</div>
<div class="paragraph">
<p>Note that if <code>needsExecutionTool = true</code>, then it is required that the original tool is available to be executed in co-simulation mode.
If <code>needsExecutionTool = false</code>, the slave is completely contained inside the FMU in source code or binary format (DLL/SharedObject).</p>
</div>
</div>
<div class="sect3">
<h4 id="_example_xml_description_file">4.3.2. Example XML Description File</h4>
<div class="paragraph">
<p>The example below is the same one as shown in <a href="#xml-example-model-exchange">Section 3.3.2</a> for a ModelExchange FMU.
The only difference is the replacement of element ModelExchange by element CoSimulation (with additional attributes) and the removal of local variables, which are associated with continuous states and their derivatives.
The XML file may have the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF8"?&gt;
&lt;fmiModelDescription
  fmiVersion="3.0-dev"
  modelName="MyLibrary.SpringMassDamper"
  instantiationToken="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2011-09-23T16:57:33Z"
  variableNamingConvention="structured"&gt;
  &lt;CoSimulation
    modelIdentifier="MyLibrary_SpringMassDamper"
    canHandleVariableCommunicationStepSize="true"
    canInterpolateInputs="true"/&gt;
  &lt;UnitDefinitions&gt;
    &lt;Unit name="rad"&gt;
      &lt;BaseUnit rad="1"/&gt;
      &lt;DisplayUnit name="deg" factor="57.2957795130823"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="rad/s"&gt;
      &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="kg.m2"&gt;
      &lt;BaseUnit kg="1" m="2"/&gt;
    &lt;/Unit&gt;
  &lt;/UnitDefinitions&gt;
  &lt;TypeDefinitions&gt;
    &lt;SimpleType name="Modelica.SIunits.Inertia"&gt;
      &lt;Float64 quantity="MomentOfInertia" unit="kg.m2" min="0.0"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.Torque"&gt;
      &lt;Float64 quantity="Torque" unit="N.m"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.AngularVelocity"&gt;
      &lt;Float64 quantity="AngularVelocity" unit="rad/s"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.Angle"&gt;
      &lt;Float64 quantity="Angle" unit="rad"/&gt;
    &lt;/SimpleType&gt;
  &lt;/TypeDefinitions&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;Float64 name="inertia1.J" valueReference="1073741824"
      description="Moment of load inertia" causality="parameter" variability="fixed"
      declaredType="Modelica.SIunits.Inertia" start="1"/&gt;
    &lt;Float64 name="torque.tau" valueReference="536870912"
      description="Accelerating torque acting at flange (= -flange.tau)" causality="input"
      declaredType="Modelica.SIunits.Torque" start="0"/&gt;
    &lt;Float64 name="inertia1.phi" valueReference="805306368"
      description="Absolute rotation angle of component" causality="output"
      declaredType="Modelica.SIunits.Angle"/&gt;
    &lt;Float64 name="inertia1.w" valueReference="805306369"
      description="Absolute angular velocity of component (= der(phi))" causality="output"
      declaredType="Modelica.SIunits.AngularVelocity"/&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Outputs&gt;
      &lt;Unknown valueReference="805306368"/&gt;
      &lt;Unknown valueReference="805306369"/&gt;
    &lt;/Outputs&gt;
    &lt;InitialUnknowns&gt;
      &lt;Unknown valueReference="805306368"/&gt;
      &lt;Unknown valueReference="805306369"/&gt;
    &lt;/InitialUnknowns&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_literature">5. Literature</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Åkesson J., Braun W., Lindholm P., and Bachmann B. (2012): <strong>Generation of Sparse Jacobians for the Functional Mockup Interface 2.0</strong>. 9th International Modelica Conference, Munich, 2012. <a href="http://www.ep.liu.se/ecp/076/018/ecp12076018.pdf" class="bare">http://www.ep.liu.se/ecp/076/018/ecp12076018.pdf</a></p>
</li>
<li>
<p>Benveniste A., Caillaud B., Pouzet M. (2010): <strong>The Fundamentals of Hybrid Systems Modelers</strong>. In 49th IEEE International Conference on Decision and Control (CDC), Atlanta, Georgia, USA, December 15-17. <a href="http://www.di.ens.fr/~pouzet/bib/cdc10.pdf" class="bare">http://www.di.ens.fr/~pouzet/bib/cdc10.pdf</a></p>
</li>
<li>
<p>Blochwitz T., Otter M., Arnold M., Bausch C., Clauß C., Elmqvist H., Junghanns A., Mauss J., Monteiro M., Neidhold T., Neumerkel D., Olsson H., Peetz J.-V., Wolf S. (2011): <strong>The Functional Mockup Interface for Tool independent Exchange of Simulation Models</strong>. 8th International Modelica Conference, Dresden 2011. <a href="http://www.ep.liu.se/ecp/063/013/ecp11063013.pdf" class="bare">http://www.ep.liu.se/ecp/063/013/ecp11063013.pdf</a></p>
</li>
<li>
<p>Blochwitz T., Otter M., Akesson J., Arnold M., Clauß C., Elmqvist H., Friedrich M., Junghanns A., Mauss J,, Neumerkel D., Olsson H., Viel A. (2012): <strong>Functional Mockup Interface 2.0: The Standard for Tool independent Exchange of Simulation Models</strong>. 9th International Modelica Conference, Munich, 2012. <a href="http://www.ep.liu.se/ecp/076/017/ecp12076017.pdf" class="bare">http://www.ep.liu.se/ecp/076/017/ecp12076017.pdf</a></p>
</li>
<li>
<p>Kübler R., Schiehlen, W. (2000): <strong>Two methods of simulator coupling</strong>. Mathematical and Computer Modeling of Dynamical Systems 6 pp. 93-113.
Lee E.A., Zheng H. (2007): Leveraging Synchronous Language Principles for Heterogeneous Modeling and Design of Embedded Systems. EMSOFT’07, Sept. 30 - Oct. 3, 2007, Salzburg, Austria. <a href="https://ptolemy.berkeley.edu/publications/papers/07/unifying/LeeZheng_SRUnifying.pdf" class="bare">https://ptolemy.berkeley.edu/publications/papers/07/unifying/LeeZheng_SRUnifying.pdf</a></p>
</li>
<li>
<p>Lee E.A., Zheng H. (2007): <strong>Leveraging Synchronous Language Principles for Heterogeneous Modeling and Design of Embedded Systems</strong>. EMSOFT’07, September 30–October 3, Salzburg, Austria. <a href="https://dl.acm.org/citation.cfm?id=1289949" class="bare">https://dl.acm.org/citation.cfm?id=1289949</a></p>
</li>
<li>
<p>Modelica (2012): <strong>Modelica, A Unified Object-Oriented Language for Systems Modeling</strong>. Language Specification, Version 3.3, May 9, 2012. <a href="https://www.modelica.org/documents/ModelicaSpec33.pdf" class="bare">https://www.modelica.org/documents/ModelicaSpec33.pdf</a></p>
</li>
<li>
<p>MODELISAR Glossary (2009): <strong>MODELISAR WP2 Glossary and Abbreviations</strong>. Version 1.0, June 9, 2009. Pouzet M. (2006): Lucid Synchrone, Version 3.0, Tutorial and Reference Manual.
<a href="http://www.di.ens.fr/~pouzet/lucid-synchrone/" class="bare">http://www.di.ens.fr/~pouzet/lucid-synchrone/</a></p>
</li>
<li>
<p>XML: www.w3.org/XML, en.wikipedia.org/wiki/XML</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fmi_revision_history">Appendix A: FMI Revision History</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix describes the history of the FMI design and its contributors. The current version of this document is available from <a href="https://fmi-standard.org/" class="bare">https://fmi-standard.org/</a>.</p>
</div>
<div class="paragraph">
<p>The Functional Mock-up Interface development was initiated and organized by Daimler AG (from Bernd Relovsky and others) as subproject inside the <a href="http://www.itea2.org/">ITEA2</a> MODELISAR project.</p>
</div>
<div class="paragraph">
<p>The development of versions 1.0 and 2.0 was performed within WP200 of MODELISAR, organized by the WP200 work package leader Dietmar Neumerkel from Daimler.</p>
</div>
<div class="sect2">
<h3 id="_a_1_version_1_0_fmi_for_model_exchange">A.1 Version 1.0 – FMI for Model Exchange</h3>
<div class="paragraph">
<p>Version 1.0 of FMI for Model Exchange was released on Jan. 26, 2010.</p>
</div>
<div class="paragraph">
<p>The subgroup "FMI for Model Exchange" was headed by Martin Otter (DLR-RM).
The essential part of the design of this version was performed by (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Torsten Blochwitz, ITI, Germany</p>
</li>
<li>
<p>Hilding Elmqvist, Dassault Systèmes, Sweden</p>
</li>
<li>
<p>Andreas Junghanns, QTronic, Germany</p>
</li>
<li>
<p>Jakob Mauss, QTronic, Germany</p>
</li>
<li>
<p>Hans Olsson, Dassault Systèmes, Sweden</p>
</li>
<li>
<p>Martin Otter, DLR-RM, Germany</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This version was evaluated with prototypes implemented for (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dymola by Peter Nilsson, Dan Henriksson, Carl Fredrik Abelson, and Sven Erik Mattson, Dassault Systèmes,</p>
</li>
<li>
<p>JModelica.org by Tove Bergdahl, Modelon AB,</p>
</li>
<li>
<p>Silver by Andreas Junghanns, and Jakob Mauss, QTronic</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These prototypes have been used to refine the design of "FMI for Model
Exchange".</p>
</div>
<div class="paragraph">
<p>The following MODELISAR partners participated at FMI design meetings and contributed to the discussion (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ingrid Bausch-Gall, Bausch-Gall GmbH, Munich, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Alex Eichberger, SIMPACK AG, Gilching, Germany</p>
</li>
<li>
<p>Hilding Elmqvist, Dassault Systèmes, Lund, Sweden</p>
</li>
<li>
<p>Andreas Junghanns, QTronic GmbH, Berlin, Germany</p>
</li>
<li>
<p>Rainer Keppler, SIMPACK AG, Gilching, Germany</p>
</li>
<li>
<p>Gerd Kurzbach, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Carsten Kübler, TWT, Germany</p>
</li>
<li>
<p>Jakob Mauss, QTronic GmbH, Berlin, Germany</p>
</li>
<li>
<p>Johannes Mezger, TWT, Germany</p>
</li>
<li>
<p>Thomas Neidhold, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Dietmar Neumerkel, Daimler AG, Stuttgart, Germany</p>
</li>
<li>
<p>Peter Nilsson, Dassault Systèmes, Lund, Sweden</p>
</li>
<li>
<p>Hans Olsson, Dassault Systèmes, Lund, Sweden</p>
</li>
<li>
<p>Martin Otter, German Aerospace Center (DLR), Oberpfaffenhofen, Germany</p>
</li>
<li>
<p>Antoine Viel, LMS International (Imagine), Roanne, France</p>
</li>
<li>
<p>Daniel Weil, Dassault Systèmes, Grenoble, France</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following people outside of the MODELISAR consortium contributed with comments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Johan Akesson, Lund University, Lund, Sweden</p>
</li>
<li>
<p>Joel Andersson, KU Leuven, The Netherlands</p>
</li>
<li>
<p>Roberto Parrotto, Politecnico di Milano, Italy</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_a_2_version_1_0_fmi_for_co_simulation">A.2 Version 1.0 – FMI for Co-Simulation</h3>
<div class="paragraph">
<p>Version 1.0 of FMI for Co-Simulation was released on Oct. 10, 2010.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation was developed in three subgroups: "Solver Coupling" headed by Martin Arnold (University Halle) and Torsten Blochwitz (ITI), "Tool Coupling" headed by Jörg-Volker Peetz (Fraunhofer SCAI), and "Control Logic" headed by Manuel Monteiro (Atego).
The essential part of the design of this version was performed by (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Martin Arnold, University Halle, Germany</p>
</li>
<li>
<p>Constanze Bausch, Atego Systems GmbH, Wolfsburg, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Christoph Clauß, Fraunhofer IIS EAS, Dresden, Germany</p>
</li>
<li>
<p>Manuel Monteiro, Atego Systems GmbH, Wolfsburg, Germany</p>
</li>
<li>
<p>Thomas Neidhold, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Jörg-Volker Peetz, Fraunhofer SCAI, St. Augustin, Germany</p>
</li>
<li>
<p>Susann Wolf, Fraunhofer IIS EAS, Dresden, Germany</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This version was evaluated with prototypes implemented for (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SimulationX by Torsten Blochwitz and Thomas Neidhold (ITI GmbH)</p>
</li>
<li>
<p>Master algorithms by Christoph Clauß (Fraunhofer IIS EAS)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following MODELISAR partners participated at FMI design meetings and contributed to the discussion (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Martin Arnold, University Halle, Germany</p>
</li>
<li>
<p>Jens Bastian, Fraunhofer IIS EAS, Dresden, Germany</p>
</li>
<li>
<p>Constanze Bausch, Atego Systems GmbH, Wolfsburg, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Christoph Clauß, Fraunhofer IIS EAS, Dresden, Germany</p>
</li>
<li>
<p>Manuel Monteiro, Atego Systems GmbH, Wolfsburg, Germany</p>
</li>
<li>
<p>Thomas Neidhold, ITI GmbH, Dresden, Germany</p>
</li>
<li>
<p>Dietmar Neumerkel, Daimler AG, Böblingen, Germany</p>
</li>
<li>
<p>Martin Otter, DLR, Oberpfaffenhofen, Germany</p>
</li>
<li>
<p>Jörg-Volker Peetz, Fraunhofer SCAI, St. Augustin, Germany</p>
</li>
<li>
<p>Tom Schierz, University Halle, Germany</p>
</li>
<li>
<p>Klaus Wolf, Fraunhofer SCAI, St. Augustin, Germany</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_a_3_version_2_0_fmi_for_model_exchange_and_co_simulation">A.3 Version 2.0 – FMI for Model Exchange and Co-Simulation</h3>
<div class="paragraph">
<p>FMI 2.0 for Model Exchange and Co-Simulation was released on July 25, 2014.</p>
</div>
<div class="sect3">
<h4 id="_a_3_1_overview">A.3.1 Overview</h4>
<div class="paragraph">
<p>This section gives an overview about the changes with respect to versions 1.0 for Model Exchange and 1.0 for Co-Simulation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI 2.0 is not backwards compatible to FMI 1.0.</p>
</li>
<li>
<p>The documents, schema and header files for Model Exchange and for Co-Simulation have been merged. Due to the merging, some conflicts had to be resolved leading to some non-backwards compatible changes with respect to FMI 1.0.</p>
</li>
<li>
<p>Parameters can be declared to be "tunable" in the FMU, in other words, during simulation these parameters can be changed (if supported by the simulation environment).</p>
</li>
<li>
<p>When enabling logging, log categories to be logged can be defined, so that the FMU only needs to generate logs of the defined categories (in FMI 1.0, logs had to be generated for all log categories and they had to be filtered afterwards). Log categories that are supported by an FMU can be optionally defined in the XML file so that a simulation environment can provide them to the user for selection.</p>
</li>
<li>
<p>In order that tools can more simply support importing both FMI 1.0 and 2.0, all file and function names of FMI 2.0 start with <code>fmi2</code>, whereas they start with <code>fmi</code> for FMI 1.0.</p>
</li>
<li>
<p>FMI function names are no longer prefixed with the <code>modelIdentifier</code> if used in a DLL/sharedObject. As a result, FMUs that need a tool can use a generic communication DLL, and the loading of DLLs is no longer FMU dependent.</p>
</li>
<li>
<p>The different modes of an FMU are now clearly signaled with respective function calls (<code>fmi2EnterInitializationMode</code>, <code>fmi2EnterEventMode</code>, <code>fmi2EnterContinuousTimeMode</code>).</p>
</li>
<li>
<p>The interfaces have been redesigned, in order that algebraic loops over connected FMUs with Real, Integer, or Boolean unknowns can now be handled reasonably not only in Continuous Time Mode, but also in Initialization and Event Mode. In FMI 1.0, algebraic loops in Initialization and Even Mode could not be handled.</p>
</li>
<li>
<p>The termination of every global event iteration over connected FMUs must be reported by a new function call (<code>fmi2EnterContinuousTimeMode</code>).</p>
</li>
<li>
<p>The unit definitions have been improved: The tool-specific unit-name can optionally be expressed as function of the 7 SI base units and the SI derived unit "rad". It is then possible to check units when FMUs are connected together (without standardizing unit names), or to convert variable values that are provided in different units (for the same physical quantity).</p>
</li>
<li>
<p>Enumerations have an arbitrary (but unique) mapping to integers (in FMI 1.0, the mapping was automatically to 1,2,3,&#8230;&#8203;).</p>
</li>
<li>
<p>The alias/negatedAlias variable definitions have been removed, to simplify the interface: If variables of the same base type (like <code>fmi2Real</code>) have the same valueReference, they have identical values. A simulation environment may ignore this completely (this was not possible in FMI 1.0), or can utilize this information to more efficiently store results on file.</p>
</li>
<li>
<p>When instantiating an FMU, the absolute path to the FMU resource directory is now reported also in Model Exchange, in order that the FMU can read all of its resources (for example, maps, tables, &#8230;&#8203;) independently of the "current directory" of the simulation environment where the FMU is used.</p>
</li>
<li>
<p>An ordering is defined for input, output, and state variables in the XML file of an FMU, in order for this order to be defined in the FMU, and not be (arbitrarily) selected by the simulation environment. This is essential, for example, when linearizing an FMU, or when providing "sparsity" information (see below).</p>
</li>
<li>
<p>Several optional features have been added:</p>
<div class="ulist">
<ul>
<li>
<p>The complete FMU state can be saved, restored, and serialized to a byte vector (that can be stored on file). As a result, a simulation (both for Model Exchange and for Co-Simulation) can be restarted from a saved FMU state. Rejecting steps for variable step-size Co-Simulation master algorithms is now performed with this feature (instead of the less powerful method of FMI 1.0).</p>
</li>
<li>
<p>The dependency of state derivatives and of output variables from inputs and states can be defined in the XML file, in other words, the sparsity pattern for Jacobians can be defined. This allows simulating stiff FMUs with many states (&gt; 1000 states) since sparse matrix methods can be utilized in the numerical integration method. Furthermore, it can be stated whether this dependency is linear (this allows to transform nonlinear algebraic equation systems into linear equation systems when connecting FMUs).</p>
</li>
<li>
<p>Directional derivatives can be computed for derivatives of continuous-time states and for outputs. This is useful when partial derivatives of connected FMUs must be computed. If the exported FMU performs this computation analytically, then all numerical algorithms based on these partial derivatives (for example, the numerical integration method or nonlinear algebraic solvers) are more efficient and more reliable.</p>
</li>
<li>
<p>Every scalar variable definition can have an additional "annotation" data structure that is arbitrary ("any" element in XML). A tool vendor can store tool-dependent information here (that other tools can ignore), for example, to store the graphical layout of parameter menus. The <code>VendorAnnotations</code> element was also generalized from (name, value) pairs to any XML data structure.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Many smaller improvements have been included, due to the experience in using FMI 1.0 (for example, the causality/variability attributes have been changed and more clearly defined, the fmi2ModelFunctions.h header has been split into two header files (one for the function signature, and one for the function names), in order that the header files can be directly used both for DLLs and for source code distribution).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_a_3_2_main_changes">A.3.2 Main changes</h4>
<div class="paragraph">
<p>This section gives the details about the changes with respect to versions 1.0 for Model Exchange and 1.0 for Co-Simulation:</p>
</div>
<div class="paragraph">
<p>In this version, the documents of version 1.0 for Model Exchange and for Co-Simulation have been merged and several new features have been added.</p>
</div>
<div class="paragraph">
<p><strong>The following changes in FMI 2.0 are <span class="underline">not backwards compatible</span> due to the merging</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>File fmiModelTypes.h (in FMI for Model Exchange) has been renamed to fmi2TypesPlatform.h (the file name used in FMI for Co-Simulation).</p>
</li>
<li>
<p>File fmiModelFunctions.h (in FMI for Model Exchange) has been renamed to fmi2Functions.h (the file name used in FMI for Co-Simulation), and the function prototypes in this header files have been merged from "Model Exchange" and from "Co-Simulation"). Additionally, a new header files has been added, <code>fmi2FunctionTypes.h</code> that contains a definition of the function signatures. This header file is also used in <code>fmi2Functions.h</code> (so the signature is not duplicated). The benefit is that <code>fmi2FunctionTypes.h</code> can be directly used when loading a DLL/sharedObject (in FMI 1.0, the tool providers had to provide this header file by themselves).</p>
</li>
<li>
<p>Fixing ticket #47:<br>
In FMI 1.0 for Model Exchange the fmiModelDescription.version was
defined as string, whereas in Co-Simulation it was defined as integer.
This has been changed, so that version is a string.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>The following <span class="underline">backwards compatible</span> improvements have been made in FMI 2.0:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The FMI 1.0 documents have been merged (for example, all common definitions have been placed in the new <a href="#fmi-common-concepts">Section 2</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>The following <span class="underline">not backwards compatible</span> improvements have been made in FMI 2.0:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Element "fmiModelDescription.Implementation" in the model description schema file has been replaced by a different structure where one hierarchical level is removed. There are now 2 elements directly under fmiModelDescription: "ModelExchange" and "CoSimulation".<br>
File "fmiImplementation.xsd" has been removed.<br>
New capability flags have been introduced both for <code>ModelExchange</code> and for <code>CoSimulation</code>, such as <code>canGetAndSetFMUstate</code>, <code>canSerializeFMUstate</code>, etc.<br>
Attribute <code>modelIdentifier</code> has been moved from an <code>fmiModelDescription</code> attribute to an attribute in <code>ModelExchange</code> and in <code>CoSimulation</code>. This allows providing different identifiers, and then an FMU may contain both distribution types with different DLL names (which correspond to the <code>modelIdentifier</code> names).<br>
A new attribute <code>needsExecutionTool</code> has been introduced both in <code>ModelExchange</code> and in <code>CoSimulation</code> in order to define whether a tool is needed to execute the FMU. The previous elements in <code>CoSimulation_Tool</code> have been removed.</p>
</li>
<li>
<p>The state machines of ModelExchange and CoSimulation have been improved. Especially, the entering of the states in this state machine are now clearly marked by corresponding function calls (<code>fmi2EnterInitializationMode</code>, <code>fmi2EnterEventMode</code>, <code>fmi2EnterContinuousTimeMode</code>).</p>
</li>
<li>
<p>Fixing ticket #9:<br>
A new element <code>LogCategory</code> was introduced in <code>fmiModelDescription</code>. This is an unordered set of strings representing the possible values of the log categories of the FMU (for example, <code>logEvent</code>).<br>
Function <code>fmi2SetDebugLogging</code> has two new arguments to define the categories (from <code>LogCategory</code>) to be used in log messages.</p>
</li>
<li>
<p>Fixing ticket #33:<br>
The <code>causality</code> and <code>variability</code> attributes of a <code>ScalarVariable</code> have not been fully clear. This has been fixed by changing the enumeration values of variability from <code>"constant", "parameter", "discrete", "continuous"</code> to <code>"constant", "fixed", "tunable", "discrete", "continuous"</code> and causality from <code>"input", "output", "internal", none"</code> to <code>"parameter", "input", "output", "local"</code>. This change includes now also the support of parameters that can be tuned (changed) during simulation.</p>
</li>
<li>
<p>Fixing ticket #35:<br>
In order to simplify implementation (for example, an "element event handler" is no longer needed in SAX XML parser), the only location where data is not defined by attributes, is changed to an attribute definition: Element <code>DirectDependency</code> in <code>ScalarVariable</code> is removed. The same information can now be obtained from the <code>InputDependency</code> attribute inside <code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;&lt;Outputs&gt;</code>.</p>
</li>
<li>
<p>Fixing ticket #37:<br>
The new status flag <code>fmi2Terminate</code> is added to the Co-Simulation definition. This allows a slave to terminate the simulation run before the stop time is reached without triggering an error.</p>
</li>
<li>
<p>Fixing ticket #39:<br>
Wrong example in the previous section 2.10 of Co-Simulation has been fixed.</p>
</li>
<li>
<p>Fixing ticket #41:<br>
New types introduced in fmi2TypesPlatform.h :<br>
<code>fmi2ComponentEnvironment</code>, <code>fmi2FMUstate</code>, <code>fmi2Byte</code>.<br>
Struct <code>fmi2CallbackFunctions</code> gets a new last argument:<br>
<code>fmi2ComponentEnvironment componentEnvironment</code><br>
The first argument of function <code>logger</code> is changed from type <code>fmi2Component</code>
to <code>fmi2ComponentEnvironment</code>.<br>
By these changes, a pointer to a data structure from the simulation environment is passed to the <code>logger</code> and allows the <code>logger</code>, for example, to transform a <code>valueReference</code> in the log message to a variable name.</p>
</li>
<li>
<p>Fixing ticket #42:<br>
Enumerations defined in fmi2Type.xsd are now defined with (name, value) pairs. An enumeration value must be unique within the same enumeration (to have a bijective mapping between enumeration names and values, in order that results can optionally be presented with names and not with values).<br>
Furthermore, the <code>min/max</code> values of element <code>Enumeration</code> in <code>TypeDefinition</code> have been removed because they are meaningless.</p>
</li>
<li>
<p>Fixing ticket #43:<br>
The previous header file fmiFunctions.h is split into 2 header files, fmi2FunctionTypes.h and fmi2Functions.h, in order to simplify the dynamic loading of an FMU (the typedefs of the function prototypes defined in fmi2FunctionTypes.h can be used to type case the function pointers of the dynamic loading).</p>
</li>
<li>
<p>Fixing ticket #45:<br>
Contrary to the ticket proposal, no new function <code>fmiResetModel</code> is added. Instead 6 new functions are added to get and set the internal FMU state via a pointer and to serialize and deserialize an FMU state via a byte vector provided by the environment. For details, see <a href="#get-set-fmu-state">Section 2.1.8</a>. This feature allows, for example, to support more sophisticated co-simulation master algorithms which require the repetition of communication steps. Additionally, two capability flags have been added (<code>canGetAndSetFMUstate</code>, <code>canSerializeFMUstate</code>) in order to define whether these features are supported by the FMU.</p>
</li>
<li>
<p>Fixing ticket #46:<br>
The unit definitions have been enhanced by providing an optional mapping to the 7 SI base units and the SI derived unit <code>"rad"</code>, in order for a tool to be able to check whether a signal provided to the FMU or inquired by the FMU has the expected unit.</p>
</li>
<li>
<p>Fixing ticket #48:<br>
The definition of <code>fmiBoolean</code> in <code>fmiTypesPlatform.h</code> for <code>"standard32"</code> was changed from <code>char</code> to <code>int</code>. The main reason is to avoid unnecessary casting of Boolean types when exporting an FMU from a Modelica environment or when importing it into a Modelica environment.<br>
The current definition of <code>char</code> for a Boolean was not meaningful, since, for example, for embedded code generation usually Booleans are packed on integers and <code>char</code> for one Boolean would also not be used. It is planned to add more supported data types to an FMU in the future, which should then also include support for packed Booleans.</p>
</li>
<li>
<p>Fixing ticket #49:<br>
Argument <code>fmiComponent</code> in function pointer <code>stepFinished</code> was changed to <code>fmi2ComponentEnvironment</code> (when <code>stepFinished</code> is called from a co-simulation slave and provides <code>fmi2ComponentEnvironment</code>, then this data structure provided by the environment can provide environment specific data to efficiently identify the slave that called the function).</p>
</li>
<li>
<p>Fixing ticket #54:<br>
In <a href="#fmu-distribution">Section 2.3</a> it is now stated, that the FMU must include all referenced resources. This means especially that for Microsoft VisualStudio the option "MT" has to be used when constructing a DLL in order to include the run-time environment of VisualStudio in the DLL.</p>
</li>
<li>
<p>Fixing ticket #75:<br>
Since states are now explicitly defined in the XML file, function <code>fmiGetStateValueReferences</code> is no longer needed, as well as the special type <code>fmiUndefinedValueReference</code> that might be used as return value of this function. Therefore, both elements have been removed in FMI 2.0.</p>
</li>
<li>
<p>Fixing ticket #85:<br>
New argument <code>noSetFMUStatePriorToCurrentPoint</code> to function <code>fmi2CompletedIntegratorStep</code>, similarly to <code>fmi2DoStep</code>, in order that the FMU can flush a result buffer if necessary.</p>
</li>
<li>
<p>Fixing ticket #86:<br>
The fmi2TypesPlatform.h header file has been slightly changed: The default value of <code>fmi2TypesPlatform</code> is changed from <code>"standard32"</code> to <code>"default"</code>, since this definition holds for most platforms and compilers. Furthermore, the default type of <code>fmi2ValueReference</code> has been changed from <code>unsigned int</code> to <code>size_t</code>.</p>
</li>
<li>
<p>Fixing ticket #88:<br>
The definition of fmi2Functions.h slightly changed to improve portability (the header file can now be utilized both for Microsoft and gnu compilers, and the danger of name conflicts has been reduced).</p>
</li>
<li>
<p>Fixing ticket #95:<br>
FMI XML files need to be UTF-8 encoded (as are XML schema files and strings in the C-API), in order to simplify reading of XML files.</p>
</li>
<li>
<p>Fixing ticket #113:<br>
Changed function name <code>fmiTerminateSlave</code> to <code>fmi2Terminate</code> in order to be consistent with the other function definitions (<code>fmi2EnterSlaveInitializationMode</code>, <code>fmi2Terminate</code>).</p>
</li>
<li>
<p>Fixing ticket #115:<br>
Clarification added, that the special values <code>NAN</code>, <code>+INF</code>, <code>-INF</code>, are not allowed in the FMI XML files.</p>
</li>
<li>
<p>Fixing ticket #127:<br>
Added clarifications in section 2.1, that all C-API functions are not thread safe and that FMUs must not influence each other.</p>
</li>
<li>
<p>Fixing ticket #218:<br>
Changed all name prefixes from <code>fmi</code> to <code>fmi2</code> in *.h, *.xsd, *.png files and in the specification to avoid compiler and linker problems when supporting both FMI 1.0 and 2.0 in the same program.</p>
</li>
<li>
<p>Function <code>fmiInitialize</code> was split into two functions: <code>fmi2EnterInitializationMode</code> and <code>fmi2ExitInitializationMode</code> in order that artificial or "real" algebraic loops over connected FMUs can be handled in an efficient way.</p>
</li>
<li>
<p>Function <code>stepEvent</code> in <code>struct fmi2CallbackFunctions</code> had different locations in the FMI documentation and in the header file. This inconsistency has been corrected by using the location in the header file (at the end of the <code>struct</code>).</p>
</li>
<li>
<p>The <code>struct fmi2CallbackFunctions</code> is provided as a pointer to the <code>struct</code> when instantiating an FMU, and not as the <code>struct</code> itself. This simplifies the importing of an FMU into a Modelica environment.</p>
</li>
<li>
<p>Defined how to utilize the <code>min</code>/<code>max</code> attributes for <code>fmi2SetReal</code>, <code>fmi2SetInteger</code>, <code>fmi2GetReal</code>, <code>fmi2GetInteger</code> calls.</p>
</li>
<li>
<p>Attributes <code>numberOfScalarVariables</code>, <code>numberOfContinuousStates</code>, <code>numberOfInputs</code>, <code>numberOfOutputs</code> available in FMI 1.0 have been removed, because they can be deduced from the remaining XML file (so in FMI 2.0 this would have been redundant information).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_a_3_3_contributors">A.3.3 Contributors</h4>
<div class="paragraph">
<p>The development group for this version was headed by Torsten Blochwitz (ITI). The essential part of the design of this version was performed by (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Johan Akesson, Modelon, Sweden</p>
</li>
<li>
<p>Martin Arnold, University Halle, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ITI, Germany</p>
</li>
<li>
<p>Christoph Clauss, Fraunhofer IIS EAS, Germany</p>
</li>
<li>
<p>Hilding Elmqvist, Dassault Systèmes, Sweden</p>
</li>
<li>
<p>Rüdiger Franke, ABB AG, Germany</p>
</li>
<li>
<p>Markus Friedrich, SIMPACK AG, Germany</p>
</li>
<li>
<p>Lev Greenberg, IBM Research, Israel</p>
</li>
<li>
<p>Andreas Junghanns, QTronic, Germany</p>
</li>
<li>
<p>Jakob Mauss, QTronic, Germany</p>
</li>
<li>
<p>Iakov Nakhimovski, Modelon, Sweden</p>
</li>
<li>
<p>Dietmar Neumerkel, Daimler AG, Germany</p>
</li>
<li>
<p>Hans Olsson, Dassault Systèmes, Sweden</p>
</li>
<li>
<p>Martin Otter, DLR RMC-SR, Germany</p>
</li>
<li>
<p>Antoine Viel, Siemens PLM Software, France</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The FMI 2.0 document was edited by Martin Otter (DLR), Torsten Blochwitz (ITI), and Martin Arnold (Uni Halle). The State Machines and tables for the Calling Sequences for Model Exchange and Co-Simulation are from Jakob Mauss (QTronic).</p>
</div>
<div class="paragraph">
<p>This version was evaluated with prototypes implemented for (alphabetical
list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dymola by Peter Nilsson, Karl Wernersson, and Sven Erik Mattson, Dassault Systèmes, Sweden</p>
</li>
<li>
<p>FMI Compliance Checker by Iakov Nakhimovski, Modelon AB, Sweden</p>
</li>
<li>
<p>LMS Imagine.Lab AMESim by Antoine Viel, Siemens PLM Software, France</p>
</li>
<li>
<p>MapleSim, by Kaska Kowalska, Maplesoft, Canada</p>
</li>
<li>
<p>Silver by Andreas Junghanns, QTronic, Germany</p>
</li>
<li>
<p>SimulationX by Torsten Blochwitz, ITI, Germany</p>
</li>
<li>
<p>SCALEXIO and VEOS by Irina Zacharias, Andreas Pillekeit, dSPACE GmbH, Germany</p>
</li>
<li>
<p>xMOD by Mongi ben Gaid, Bertrand Hugon, Bruno Léty, and Fabien Debertolis, IFPEN, France</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These prototypes have been used to refine the design of "FMI 2.0 for Model Exchange and Co-Simulation".</p>
</div>
<div class="paragraph">
<p>The open source FMITest library (<a href="https://svn.fmi-standard.org/fmi/branches/public/Test_FMUs/_FMIModelicaTest/FMITest/help/FMITest.html" class="bare">https://svn.fmi-standard.org/fmi/branches/public/Test_FMUs/_FMIModelicaTest/FMITest/help/FMITest.html</a>) to test difficult cases of connected FMUs was implemented by Martin Otter (DLR, Germany) based on suggestions by Hilding Elmqvist (Dassault Systèmes, Sweden) and Torsten Blochwitz (ITI, Germany).</p>
</div>
<div class="paragraph">
<p>The following partners participated at FMI 2.0 design meetings and contributed to the discussion (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Johan Akesson, Modelon, Sweden</p>
</li>
<li>
<p>Christian Andersson, Modelon, Sweden</p>
</li>
<li>
<p>Martin Arnold, University Halle, Germany</p>
</li>
<li>
<p>Adeel Asghar, PELAB, Sweden</p>
</li>
<li>
<p>Mongi Ben-Gaid, IFP, France</p>
</li>
<li>
<p>Christian Bertsch, Robert Bosch GmbH, Germany</p>
</li>
<li>
<p>Torsten Blochwitz, ITI, Germany</p>
</li>
<li>
<p>Christoph Clauss, Fraunhofer IIS EAS, Germany</p>
</li>
<li>
<p>Alex Eichberger, SIMPACK AG, Germany</p>
</li>
<li>
<p>Hilding Elmqvist, Dassault Systèmes, Sweden</p>
</li>
<li>
<p>Rüdiger Franke, ABB AG, Germany</p>
</li>
<li>
<p>Markus Friedrich, SIMPACK AG, Germany</p>
</li>
<li>
<p>Peter Fritzson, PELAB, Sweden</p>
</li>
<li>
<p>Rafael Gilles (Erbacher), dSPACE GmbH, Germany</p>
</li>
<li>
<p>Lev Greenberg, IBM Research, Israel</p>
</li>
<li>
<p>Anton Haumer, Modelon, Germany</p>
</li>
<li>
<p>Andreas Junghanns, QTronic, Germany</p>
</li>
<li>
<p>Karsten Krügel, dSPACE GmbH, Germany</p>
</li>
<li>
<p>Edward Lee, Berkeley University, U.S.A.</p>
</li>
<li>
<p>Bruno Loyer, Siemens PLM Software, France</p>
</li>
<li>
<p>Petter Lindholm, Modelon, Sweden</p>
</li>
<li>
<p>Kristin Majetta, Fraunhofer IIS EAS, Germany</p>
</li>
<li>
<p>Sven Erik Mattsson, Dassault Systèmes, Sweden</p>
</li>
<li>
<p>Jakob Mauss, QTronic, Germany</p>
</li>
<li>
<p>Monika Mühlbauer, Siemens AG, Germany</p>
</li>
<li>
<p>Dietmar Neumerkel, Daimler AG, Germany</p>
</li>
<li>
<p>Peter Nilsson, Dassault Systèmes, Sweden</p>
</li>
<li>
<p>Hans Olsson, Dassault Systèmes, Sweden</p>
</li>
<li>
<p>Martin Otter, DLR RMC-SR, Germany</p>
</li>
<li>
<p>Nicolas Pernet, IFPEN, France</p>
</li>
<li>
<p>Andreas Pillekeit, dSPACE GmbH, Germany</p>
</li>
<li>
<p>Bernd Relovsky, Daimler AG, Germany</p>
</li>
<li>
<p>Tom Schierz, University Halle, Germany</p>
</li>
<li>
<p>Chad Schmitke, Maplesoft, Canada</p>
</li>
<li>
<p>Stefan-Alexander Schneider, BMW, Germany</p>
</li>
<li>
<p>Klaus Schuch, AVL List GmbH, Austria</p>
</li>
<li>
<p>Bernhard Thiele, DLR RMC-SR, Germany</p>
</li>
<li>
<p>Antoine Viel, Siemens PLM Software, France</p>
</li>
<li>
<p>Karl Wernersson, Dassault Systèmes, Sweden</p>
</li>
<li>
<p>Irina Zacharias, dSPACE GmbH, Germany</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following people contributed with comments (alphabetical list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Peter Aaronsson, MathCore, Sweden</p>
</li>
<li>
<p>Bernhard Bachmann, University of Bielefeld, Germany</p>
</li>
<li>
<p>Andreas Pfeiffer, DLR RMC-SR</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_glossary">Appendix B: Glossary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This glossary is a subset of (<em>MODELISAR Glossary, 2009</em>) with some extensions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Term</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>algorithm</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A formal recipe for solving a specific type of problem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>application programming interface (API)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of functions, procedures, methods or classes together with type conventions/declarations (for example, C header files) that an operating system, library or service provides to support requests made by computer programs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AUTOSAR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AUTomotive Open System Architecture (<a href="http://www.autosar.org/">www.autosar.org</a>).<br>
Evolving standard of the automotive industry to define the implementation of embedded systems in vehicles including communication mechanisms. An important part is the standardization of C functions and macros to communicate between software components. AUTOSAR is targeted to built on top of the real-time operating system OSEK (<a href="http://www.osek-vdx.org/">www.osek-vdx.org</a>, <a href="http://de.wikipedia.org/wiki/OSEK">de.wikipedia.org/wiki/OSEK</a>). The use of the AUTOSAR standard requires AUTOSAR membership.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>communication points</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time grid for data exchange between master and slaves in a co-simulation environment (also known as "sampling points" or "synchronization points").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>communication step size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance between two subsequent <em>communication points</em> (also known as "sampling rate" or "macro step size").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>co-simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coupling (in other words, dynamic mutualexchange and utilization of intermediate results) of several <em>simulation programs</em> including their numerical solvers in order to simulate a system consisting of several subsystems.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>co-simulation platform</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software used for coupling several <em>simulation programs</em> for <em>co-simulation.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ECU</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Electronic Control Unit (Microprocessor that is used to control a sub-system in a vehicle).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Something that occurs instantaneously at a specific time or when a specific condition occurs. At an event, numerical integration is suspended and variables may change their values discontinuously.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface:<br>
Interface of a functional mock-up in form of a model. In analogy to the term digital mock-up (see <em>mock-up</em>), functional mock-up describes a computer-based representation of the functional behaviour of a system for all kinds of analyses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for Co-Simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface for Co-Simulation:<br>
One of the MODELISAR <em>functional mock-up interfaces.</em> It connects the <em>master solver</em> component with one or more <em>slave solvers</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for Model Exchange</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface for Model Exchange:<br>
One of the MODELISAR <em>functional mock-up interfaces.</em> It consists of the <em>model description interface</em> and the <em>model execution interface</em>.<br>
It connects the <em>external model</em> component with the <em>solver</em> component.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMU</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Unit:<br>
A "model class" from which one or more "model instances" can be instantiated for simulation. An FMU is stored in one ZIP file as defined in <a href="#fmu-distribution">Section 2.3</a> consisting basically of one XML file that defines the model variables and a set of C functions (see section 2.1), in source or binary form, to execute the model equations or the simulator slave. In case of tool execution, additionally, the original simulator is required to perform the co-simulation (compare <a href="#CoSimulation">Section 4.3.1</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integration algorithm</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The numerical algorithm to solve differential equations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integrator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>software component</em>, which implements an <em>integration algorithm</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An abstraction of a <em>software component</em> that describes its behavior without dealing with the internal implementation. <em>Software components</em> communicate with each other via interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>master/slave</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A method of communication, where one device or process has unidirectional control over one or more other devices. Once a master/slave relationship between devices or processes is established, the direction of control is always from the master to the slaves. In some systems a master is elected from a group of eligible devices, with the other devices acting in the role of slaves.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>mock-up</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A full-sized structural, but not necessarily functional model built accurately to scale, used chiefly for study, testing, or display. In the context of computer aided design (CAD), a digital mock-up (DMU) means a computer-based representation of the product geometry with its parts, usually in 3-D, for all kinds of geometrical and mechanical analyses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A model is a mathematical or logical representation of a system of entities, phenomena, or processes. Basically a model is a simplified abstract view of the complex reality.<br>
It can be used to compute its expected behavior under specified conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model description file</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The model description file is an XML file, which supplies a description of all properties of a <em>model</em> (for example, input/output variables).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model description interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An interface description to write or retrieve information from the <em>model description file</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Model Description Schema</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <em>XML</em> schema that defines how all relevant, non-executable, information about a "model class" (<em>FMU)</em> is stored in a text file in <em>XML</em> format. Most important, data for every variable is defined (variable name, handle, data type, variability, unit, etc.), see <a href="#fmi-description-schema">Section 2.2</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>numerical solver</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>solver</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>output points</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tool internal time grid for saving output data to file (in some tools also known as "<em>communication points</em>" – but this term is used in a different way in FMI for Co-Simulation, see above).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>output step size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance between two subsequent <em>output points</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A quantity within a <em>model</em>, which remains constant during <em>simulation (fixed parameter) or may change at event instances (tunable parameter)</em>. Examples are a mass, stiffness, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>slave</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>master/slave</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute the behavior of one or several <em>models</em> under specified conditions.<br>
(see also <em>co-simulation</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation model</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>model</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation program</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software to develop and/or solve simulation <em>models</em>. The software includes a <em>solver</em>, may include a user interface and methods for post processing (see also: <em>simulation tool</em>, <em>simulation environment</em>).<br>
Examples of simulation programs are: AMESim, Dymola, SIMPACK, SimulationX, SIMULINK.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation tool</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>simulation program</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A simulator can include one or more <em>simulation programs</em>, which solve a common simulation task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>solver</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Software component,</em> which includes algorithms to solve <em>model</em>s, for example, <em>integration algorithms</em> and <em>event handling</em> methods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>state</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The "continuous states" of a model are all variables that appear differentiated in the model and are independent from each other.<br>
The "discrete states" of a model are time-discrete variables that have two values in a model: The value of the variable from the previous <em>event</em> instant, and the value of the variable at the actual event instant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>state event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that is defined by the time instant where the domain \(z &gt; 0\) of an event indicator variable <code>z</code> is changed to \(z \leq 0\), or vice versa.<br>
This definition is slightly different from the usual standard definition of state events: "\(z(t)*z(t_{i-1}) \leq 0\)" which has the severe drawback that the value of the event indicator at the previous event instant, \(z(t_{i-1}) \neq 0\), must be non-zero and this condition cannot be guaranteed. The often used term "zero crossing function" for <code>z</code> is misleading (and is therefore not used in this document), since a state event is defined by a change of a domain and not by a zero crossing of a variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>step event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that might occur at a completed integrator step. Since this event type is not defined by a precise time or condition, it is usually not defined by a user. A program may use it, for example, to dynamically switch between different states. A step event is handled much more efficiently than a <em>state event</em>, because the event is just triggered after performing a check at a completed integrator step, whereas a search procedure is needed for a state event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>super dense time</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A precise definition of time taking into account iterations at an event. For an <em>FMU</em>, the independent variable time \(t \in \mathbb{T}\) is a tuple \(t = (t_R, t_I)\) where \(t_R \in  \mathbb{R}, t_I \in \mathbb{N} = \{0,1,2,\ldots\}\). The real part \(t_R\) of this tuple is the independent variable of the FMU for describing the continuous-time behavior of the model between events. In this phase \(t_I = 0\). The integer part \(t_I\) of this tuple is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(t_R\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>time event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that is defined by a predefined time instant. Since the time instant is known in advance, the integrator can select its step size so that the event point is directly reached. Therefore, this event can be handled efficiently.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The part of the simulation program that gives the user control over the simulation and allows watching results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>value reference</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of a scalar variable of an FMU is identified with an Integer handle called <em>value reference</em>. This handle is defined in the modelDescription.xml file (as attribute <code>valueReference</code> in element <code>ScalarVariable</code>). Element <code>valueReference</code> might not be unique for all variables. If two or more variables of the same base data type (such as <code>fmi2Real</code>) have the same <code>valueReference</code>, then they have identical values but other parts of the variable definition might be different (for example, min/max attributes).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XML</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eXtensible Markup Language (<a href="http://www.w3.org/XML/">www.w3.org/XML</a>, <a href="http://en.wikipedia.org/wiki/Xml">en.wikipedia.org/wiki/XML</a>) – An open standard to store information in text files in a structured form.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Modelica is a registered trademark of the Modelica Association, Simulink is a registered trademark of the MathWorks Inc., SIMPACK is a registered trademark of SIMPACK AG.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. For Microsoft and Cygwin compilers; <code>FMI3_Export</code> is defined as <code>__declspec(dllexport)</code> and for Gnu-Compilers <code>FMI3_Export</code> is defined as <code>__attribute__ ( ( visibility("default") ) )</code> in order to export the name for dynamic loading. Otherwise it is an empty definition.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. Functions <code>fmi3SetXXX</code> are usually not performing calculations but just store the passed values in internal buffers. The actual calculation is performed by <code>fmi3GetXXX</code> functions. Still <code>fmi3SetXXX</code> functions could check whether the input arguments are in their validity range. If not, these functions could return with <code>fmi3Discard</code>.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. Typically, <code>fmi3Error</code> return is for non-numerical reasons, like "disk full". There might be cases where the environment can fix such errors (eventually with the help oft the user), and then simulation can continue at the last consistent state defined with <code>fmi3SetFMUstate</code>.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. The variable that is defined with <code>causality = "independent"</code> in the <code>fmiModelDescription.xml</code> file.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. Note that the screenshots of this section have been generated from the schema files with the tool "Altova XMLSpy" (www.altova.com). With the enterprise edition of XMLSpy it is possible to automatically generate C++, C# and Java code that reads an XML file of fmiModelDescription.xsd. An efficient open source XML parser is SAX (<a href="http://sax.sourceforge.net/" class="bare">http://sax.sourceforge.net/</a>, <a href="http://en.wikipedia.org/wiki/Simple_API_for_XML" class="bare">http://en.wikipedia.org/wiki/Simple_API_for_XML</a>). All data from the XML file is only defined via "attributes" and not via "elements". Therefore, only an "attribute" handler needs to be defined for a SAX parser.
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. Note, elements <code>&lt;ModelVariables&gt;</code> and <code>&lt;ModelStructure&gt;</code> are mandatory, whereas <code>&lt;UnitDefinitions&gt;</code>, <code>&lt;TypeDefinitions&gt;</code>, <code>&lt;LogCategories&gt;</code>, <code>&lt;DefaultExperiment&gt;</code>, <code>&lt;VendorAnnotation&gt;</code> are optional. If an optional element is present and defines a list (such as <code>&lt;UnitDefinitions&gt;</code>), the list must have at least one element (such as <code>&lt;Unit&gt;</code>).
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. If no units are defined, element <code>&lt;UnitDefinitions&gt;</code> must not be present. If 1 or more units are defined, this element must be present.
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. This definition is identical to the syntax of an identifier in Modelica version 3.2.
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. The notation \(^{\bullet}t\) is from (<em>Benveniste et.al. 2010</em>) adapted from non-standard analysis to super-dense time, in order to precisely define the value from the previous event iteration.
</div>
<div class="footnote" id="_footnotedef_11">
<a href="#_footnoteref_11">11</a>. This definition is slightly different from the standard definition of state events: "\(z_j(t) \cdot z_j(t_{i-1}) \leq 0\)". This often used definition has the severe drawback that \(z_j(t_{i-1}) \ne 0\) is required in order to be well-defined and this condition cannot be guaranteed.
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>